{"version":3,"mappings":"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","names":["toTrianglesDrawMode","geometry","drawMode","TrianglesDrawMode","TriangleFanDrawMode","TriangleStripDrawMode","index","indices","position","i","numberOfTriangles","newIndices","newGeometry","GLTFLoader","Loader","manager","parser","GLTFMaterialsClearcoatExtension","GLTFMaterialsDispersionExtension","GLTFTextureBasisUExtension","GLTFTextureWebPExtension","GLTFTextureAVIFExtension","GLTFMaterialsSheenExtension","GLTFMaterialsTransmissionExtension","GLTFMaterialsVolumeExtension","GLTFMaterialsIorExtension","GLTFMaterialsEmissiveStrengthExtension","GLTFMaterialsSpecularExtension","GLTFMaterialsIridescenceExtension","GLTFMaterialsAnisotropyExtension","GLTFMaterialsBumpExtension","GLTFLightsExtension","GLTFMeshoptCompression","GLTFMeshGpuInstancing","url","onLoad","onProgress","onError","scope","resourcePath","relativeUrl","LoaderUtils","_onError","e","loader","FileLoader","data","gltf","dracoLoader","ktx2Loader","meshoptDecoder","callback","path","json","extensions","plugins","textDecoder","BINARY_EXTENSION_HEADER_MAGIC","EXTENSIONS","GLTFBinaryExtension","error","GLTFParser","plugin","extensionName","extensionsRequired","GLTFMaterialsUnlitExtension","GLTFDracoMeshCompressionExtension","GLTFTextureTransformExtension","GLTFMeshQuantizationExtension","resolve","reject","GLTFRegistry","objects","key","object","nodeDefs","nodeIndex","nodeLength","nodeDef","lightIndex","cacheKey","dependency","lightDef","lightNode","color","Color","LinearSRGBColorSpace","range","DirectionalLight","PointLight","SpotLight","assignExtrasToUserData","type","self","light","MeshBasicMaterial","materialParams","materialDef","pending","metallicRoughness","array","SRGBColorSpace","materialIndex","emissiveStrength","MeshPhysicalMaterial","extension","scale","Vector2","colorFactor","colorArray","textureIndex","textureDef","name","source","handler","bufferView","extensionDef","buffer","decoder","res","byteOffset","byteLength","count","stride","result","meshDef","primitive","WEBGL_CONSTANTS","attributesDef","attributes","accessor","results","nodeObject","meshes","instancedMeshes","mesh","Matrix4","p","Vector3","q","Quaternion","s","instancedMesh","InstancedMesh","attributeName","attr","InstancedBufferAttribute","Object3D","BINARY_EXTENSION_HEADER_LENGTH","BINARY_EXTENSION_CHUNK_TYPES","headerView","chunkContentsLength","chunkView","chunkIndex","chunkLength","chunkType","contentArray","bufferViewIndex","gltfAttributeMap","threeAttributeMap","attributeNormalizedMap","attributeTypeMap","threeAttributeName","ATTRIBUTES","accessorDef","componentType","WEBGL_COMPONENT_TYPES","attribute","normalized","texture","transform","GLTFCubicSplineInterpolant","Interpolant","parameterPositions","sampleValues","sampleSize","resultBuffer","values","valueSize","offset","i1","t0","t","t1","stride2","stride3","td","pp","ppp","offset1","offset0","s2","s3","s0","s1","p0","m0","p1","m1","_quaternion","GLTFCubicSplineQuaternionInterpolant","WEBGL_FILTERS","NearestFilter","LinearFilter","NearestMipmapNearestFilter","LinearMipmapNearestFilter","NearestMipmapLinearFilter","LinearMipmapLinearFilter","WEBGL_WRAPPINGS","ClampToEdgeWrapping","MirroredRepeatWrapping","RepeatWrapping","WEBGL_TYPE_SIZES","PATH_PROPERTIES","INTERPOLATION","InterpolateLinear","InterpolateDiscrete","ALPHA_MODES","createDefaultMaterial","cache","MeshStandardMaterial","FrontSide","addUnknownExtensionsToUserData","knownExtensions","objectDef","gltfDef","addMorphTargets","targets","hasMorphPosition","hasMorphNormal","hasMorphColor","il","target","pendingPositionAccessors","pendingNormalAccessors","pendingColorAccessors","pendingAccessor","accessors","morphPositions","morphNormals","morphColors","updateMorphTargets","targetNames","createPrimitiveKey","primitiveDef","geometryKey","dracoExtension","createAttributesKey","attributesKey","keys","getNormalizedComponentScale","constructor","getImageURIMimeType","uri","_identityMatrix","options","isSafari","safariVersion","isFirefox","firefoxVersion","userAgent","safariMatch","TextureLoader","ImageBitmapLoader","ext","dependencies","scene","skinDefs","meshDefs","skinIndex","skinLength","joints","ref","updateMappings","original","clone","mappings","child","func","defs","def","bufferIndex","bufferDef","bufferViewDef","accessorIndex","itemSize","TypedArray","BufferAttribute","pendingBufferViews","bufferViews","elementBytes","itemBytes","byteStride","bufferAttribute","ibSlice","ibCacheKey","ib","InterleavedBuffer","InterleavedBufferAttribute","itemSizeIndices","TypedArrayIndices","byteOffsetIndices","byteOffsetValues","sparseIndices","sparseValues","sourceIndex","sourceDef","promise","sampler","URL","sourceURI","isObjectURL","blob","imageBitmap","Texture","mapName","mapDef","colorSpace","gltfReference","material","useDerivativeTangents","useVertexColors","useFlatShading","pointsMaterial","PointsMaterial","Material","lineMaterial","LineBasicMaterial","cachedMaterial","materialType","materialExtensions","kmuExtension","DoubleSide","alphaMode","emissiveFactor","originalName","sanitizedName","PropertyBinding","primitives","createDracoPrimitive","addPrimitiveAttributes","cached","geometryPromise","BufferGeometry","meshIndex","materials","geometries","SkinnedMesh","Mesh","LineSegments","Line","LineLoop","Points","group","Group","cameraIndex","camera","cameraDef","params","PerspectiveCamera","MathUtils","OrthographicCamera","skinDef","inverseBindMatrices","jointNodes","bones","boneInverses","jointNode","mat","Skeleton","animationIndex","animationDef","animationName","pendingNodes","pendingInputAccessors","pendingOutputAccessors","pendingSamplers","pendingTargets","channel","input","output","nodes","inputAccessors","outputAccessors","samplers","tracks","node","inputAccessor","outputAccessor","createdTracks","k","animation","AnimationClip","o","nodePending","childPending","childrenDef","skeletonPending","children","skeleton","nodeName","meshPromise","Bone","matrix","mapping","sceneIndex","sceneDef","nodeIds","reduceAssociations","reducedAssociations","value","targetName","TypedKeyframeTrack","NumberKeyframeTrack","QuaternionKeyframeTrack","VectorKeyframeTrack","interpolation","outputArray","j","jl","track","scaled","interpolantType","computeBounds","box","Box3","min","max","boxScale","maxDisplacement","vector","sphere","Sphere","assignAttributeAccessor","gltfAttributeName","ColorManagement","CONFIG","AssetManager","LoadingManager","AnimationLoader","AudioLoader","NavMeshLoader","AudioListener","audio","PositionalAudio","animationLoader","clips","clip","audioLoader","audios","listener","blasterShot","shotgunShot","assaultRifleShot","reload","shotgunShotReload","step1","step2","impact1","impact2","impact3","impact4","impact5","impact6","impact7","health","ammo","loadingManager","configs","response","gltfLoader","textureLoader","models","animations","shadowTexture","planeGeometry","PlaneGeometry","planeMaterial","shadowPlane","renderComponent","oldMaterial","hash","x","y","z","positions","normals","colors","minY","maxY","rangeY","grayValue","noise","occlusion","posNoise","newMaterial","muzzleTexture","muzzleMaterial","SpriteMaterial","muzzle","Sprite","bulletLineGeometry","bulletLineMaterial","bulletLine","navMeshLoader","navMesh","CostTable","Item","GameEntity","itemType","respawnTime","_entity","WEAPON_TYPES_BLASTER","WEAPON_TYPES_SHOTGUN","WEAPON_TYPES_ASSAULT_RIFLE","WEAPON_STATUS_READY","WEAPON_STATUS_SHOT","WEAPON_STATUS_RELOAD","WEAPON_STATUS_EMPTY","WEAPON_STATUS_OUT_OF_AMMO","WEAPON_STATUS_EQUIP","WEAPON_STATUS_HIDE","WEAPON_STATUS_UNREADY","STATUS_ALIVE","STATUS_DYING","STATUS_DEAD","HEALTH_PACK","MESSAGE_HIT","MESSAGE_DEAD","HealthPack","entity","ItemGiver","Trigger","region","item","SceneUtils","cloneLookup","parallelTraverse","sourceNode","clonedNode","sourceMesh","sourceBones","clonedMesh","sourceBone","uuid","canvas","context","CanvasTexture","sprite","hitbox","Float32BufferAttribute","lines","spawnPoints","nodeColor","nodeMaterial","nodeGeometry","CylinderGeometry","l","nodeMesh","trigger","triggerGeometry","SphereGeometry","triggerMaterial","triggerMesh","a","b","WeaponItem","SpawningManager","world","delta","itemsList","itemList","competitor","spawnPoint","enemy","spawningPoints","competitors","maxDistance","bestSpawningPoint","spawningPoint","closestDistance","distance","levelConfig","rotation","assetManager","healthPack","sync","blasterItem","shotgunItem","assaultRilfleItem","radius","sphericalTriggerRegion","SphericalTriggerRegion","triggerHelper","___$insertStyle","css","style","colorToString","forceCSSHex","colorFormat","r","g","h","v","str","ARR_EACH","ARR_SLICE","Common","obj","toCall","args","itr","_key","fnc","threshold","callImmediately","timeout","delayed","callNow","_isNaN","isNaN","_x","INTERPRETATIONS","test","toReturn","interpret","family","conversion","conversionName","tmpComponent","ColorMath","hi","f","hex","componentIndex","_typeof","classCallCheck","instance","Constructor","createClass","defineProperties","props","descriptor","protoProps","staticProps","get","property","receiver","desc","parent","getter","inherits","subClass","superClass","possibleConstructorReturn","call","defineRGBComponent","component","componentHexIndex","defineHSVComponent","Controller","newValue","EVENT_MAP","EVENT_MAP_INV","CSS_VALUE_PIXELS","cssValueToPixels","val","match","dom","elem","selectable","hor","vert","vertical","horizontal","eventType","pars","aux","className","evt","clientX","clientY","init","event","newBool","bool","classes","el","BooleanController","_Controller","_this2","_this","onChange","OptionController","opts","map","element","opt","desiredValue","StringController","onBlur","numDecimals","NumberController","_params","_v","minValue","maxValue","stepValue","roundToDecimal","decimals","tenTo","NumberControllerBox","_NumberController","prevY","attempted","onFinish","onMouseDrag","diff","onMouseUp","onMouseDown","i2","o1","o2","NumberControllerSlider","step","onTouchStart","bgRect","onTouchMove","onTouchEnd","pct","FunctionController","text","ColorController","valueField","linearGradient","hueGradient","fieldDown","fieldDownH","setSV","fieldUpSV","setH","fieldUpH","fieldRect","_ref","_ref2","mismatch","flip","_flip","vendors","vendor","indoc","doc","link","cssContent","injected","head","saveDialogContents","ControllerFactory","initialValue","requestAnimationFrame","requestAnimationFrame$1","CenteredDiv","hide","styleSheet","CSS_NAMESPACE","HIDE_KEY_CODE","CLOSE_BUTTON_HEIGHT","DEFAULT_DEFAULT_PRESET_NAME","SUPPORTS_LOCAL_STORAGE","SAVE_DIALOGUE","autoPlaceVirgin","autoPlaceContainer","hideableGuis","GUI","useLocalStorage","getLocalStorageHash","saveToLocalStorage","titleRow","setPresetSelectIndex","setWidth","savedGui","titleRowName","addRow","onClickTitle","addResizeHandle","resetWidth","root","gui","_add","controller","subfolder","removeListeners","newGuiParams","li","folder","top","addSaveMenu","getCurrentPreset","markPresetModified","presetName","addPresetOption","recallSavedValue","updateDisplays","newDom","liBefore","modified","augmentController","_options","nextSibling","_nextSibling","_name","method","pc","pb","returned","oldName","wasListening","newController","matchedIndex","controllerMap","presetMap","preset","factoryArgs","container","setSelected","showHideExplain","explain","div","gears","button","button2","button3","select","localStorageCheckBox","saveLocally","newConstructorTextArea","pmouseX","drag","dragStop","dragStart","w","useInitialValues","savedValues","controllerArray","c","GUI$1","PI25","PI75","UIManager","width","height","Scene","DAT.GUI","folderNavMesh","pathHelper","folderWorld","itemHelper","levelMesh","folderEnemy","uuidHelper","skeletonHelper","angle","fragMessages","message","fragger","victim","string","fraggerSpan","middleSpan","victimSpan","frag","fragMessage","weapon","player","crosshairsTexture","crosshairsMaterial","crosshairs","frontIndicatorTexture","frontIndicatorMaterial","frontIndicator","rigthIndicatorTexture","rightIndicatorMaterial","rightIndicator","leftIndicatorTexture","leftIndicatorMaterial","leftIndicator","backIndicatorTexture","backIndicatorMaterial","backIndicator","PI05","velocity","elapsed","euler","FirstPersonControls","EventDispatcher","owner","onMouseMove","onPointerlockChange","onPointerlockError","onKeyDown","onKeyUp","onWheel","onContextMenu","err","speed","_delta","isMovingForward","weaponContainer","motion","sensitivityMultiplier","Logger","weaponIndex","equippedWeapons","direction","NavMeshUtils","regions","edge","edges","triangleCount","v1","v2","v3","graph","nodeSize","edgeColor","IcosahedronGeometry","edgesGeometry","edgesMaterial","fromNode","toNode","spatialIndex","cells","cell","Level","BVH","ray","intersectionPoint","FollowPathGoal","Goal","followPathBehavior","onPathBehavior","waypoint","FindPathGoal","from","to","pathPlanner","onPathFound","HuntGoal","CompositeGoal","targetPosition","SeekToPositionGoal","seekBehavior","right","left","DodgeGoal","ChargeGoal","AttackGoal","currentSubgoal","status","Feature","weaponSystem","ammoBlaster","ammoShotgun","ammoAssaultRifle","f1","f2","f3","weaponType","score","AttackEvaluator","GoalEvaluator","characterBias","desirability","ExploreGoal","ExploreEvaluator","rayBindSpace","Ray","CharacterBounds","AABB","hitboxes","headBone","bindMatrix","bindMatrixInverse","spineBone","spine","rightArmBone","rightArm","rightForeArmBone","rightForeArm","leftArmBone","leftArm","leftForeArmBone","leftForeArm","rightUpLegBone","rightUpLeg","rightLegBone","rightLeg","leftUpLegBone","leftUpLeg","leftLegBone","leftLeg","center","bone","inverseBoneMatrix","tick","entry","Weapon","rounds","_distance","_targetPosition","spread","Blaster","toReload","mixer","AnimationMixer","shotClip","reloadClip","hideClip","equipClip","shotAction","LoopOnce","reloadAction","hideAction","equipAction","Shotgun","AssaultRifle","displacement","WeaponSystem$1","highestDesirability","bestWeaponType","distanceToTarget","_b","_a","_d","_c","_f","_e","_h","_g","_j","_i","_l","_k","_n","_m","_p","_o","_r","_q","_t","_s","_u","_w","weaponInventory","targetSystem","targeted","timeBecameVisible","elapsedTime","currentWeapon","blasterMesh","muzzleSprite","shot","shotgunMesh","shotReload","assaultRifleMesh","FuzzyModule","fuzzyModuleAssaultRifle","fuzzyModuleBlaster","fuzzyModuleShotGun","FuzzyVariable","targetClose","LeftShoulderFuzzySet","targetMedium","TriangularFuzzySet","targetFar","RightShoulderFuzzySet","undesirable","desirable","veryDesirable","fuzzySets","ammoStatusBlaster","lowBlaster","okayBlaster","LoadsBlaster","FuzzyRule","FuzzyAND","ammoStatusShotgun","lowShot","okayShot","LoadsShot","ammoStatusAssaultRifle","lowAssault","okayAssault","LoadsAssault","visibleRecords","invisibleRecords","TargetSystem","records","record","minDistance","maxTimeLastSensed","GetItemGoal","Regulator","GetHealthEvaluator","distanceScore","healthScore","GetWeaponEvaluator","weaponScore","WeaponType","BASE_AUDIO_PATH","DEFAULT_SPRAY_PATTERN","DEFAULT_SCREEN","DEFAULT_ANIMATION","WEAPON_CONFIG","WeaponSystem","_scene","_assetManager","audioManager","zoomed","config","initialConfig","initialPos","spriteMat","THREE.SpriteMaterial","THREE.AdditiveBlending","THREE.Sprite","spriteMat2","THREE.PointLight","loadedPaths","weapons","state","currentIndex","muzzleOffset","muzzlePos","THREE.Vector3","weaponBasePos","dir","_onGround","isSprinting","_velocity","now","msPerShot","ejectionPos","ejectionDir","baseDir","THREE.Euler","directions","spreadAmount","u","up","recoilConfig","deltaTime","mouseMovement","headBobTime","needed","toAdd","THREE.MathUtils","minSpread","swayAmount","swayRecovery","targetSprint","targetReload","targetZoom","ratio","kickZ","hideThreshold","hideProgress","targetX","targetY","targetZ","bobInfluence","bobX","bobY","targetRotX","targetRotZ","lerpSpeed","pos","THREE.Group","body","THREE.Mesh","THREE.BoxGeometry","THREE.MeshStandardMaterial","barrel","THREE.CylinderGeometry","mag","handguard","sight","slide","grip","upper","pump","shroud","positiveWeightings","weightings","lookDirection","moveDirection","quaternion","transformedDirection","worldPosition","customTarget","Enemy","Vehicle","Think","MemorySystem","FollowPathBehavior","OnPathBehavior","SeekBehavior","Vision","run","level","memorySystem","vision","sum","dot","amount","action","behavior","dying","tolerance","ignoreItem","handBone","boneName","RIFTWeaponSystem","groundLevel","weaponMount","randomWeapon","oldComponents","targetThree","ThreeVector3","obstacles","damage","telegram","sender","memoryRecord","PLAYER_CONFIG","Projectile","MovingEntity","distanceToIntersection","validDistance","projectile","attackDirection","cross","Player","inputDir","wantsToSprint","wantsJump","wantsCrouch","_arenaObjects","hasInput","proj","targetSpeed","isGrounded","horizVel","slideSpeed","targetSlideVel","alpha","accel","decel","targetVel","decayFactor","moveStep","newPos","onGround","weaponMap","angleDegrees","projectileDirection","det","Bullet","PathPlannerTask","Task","planner","vehicle","PathPlanner","TaskQueue","task","Sky","shader","SkyShader","ShaderMaterial","UniformsUtils","BackSide","BoxGeometry","ParticlePool","createFn","initialSize","ParticleSystem","THREE.SphereGeometry","THREE.MeshBasicMaterial","THREE.NormalBlending","THREE.TorusGeometry","THREE.TextureLoader","particle","isKill","spriteCount","spriteMaterial","normal","spark","opacity","dust","onHit","flash","fireCount","fire","debrisCount","debris","smokeCount","smoke","shockwave","size","gravity","lifeRatio","shell","groundY","impactSpeed","bounceFactor","frictionFactor","SurfaceMaterial","ImpactSystem","THREE.AudioLoader","paths","volume","sound","THREE.PositionalAudio","randomBuffer","temp","THREE.Object3D","THREE.Audio","volumeScale","buffers","fallback","DecalSystem","THREE.PlaneGeometry","THREE.DoubleSide","decal","oldest","fadeProgress","BulletTracerSystem","_camera","THREE.RepeatWrapping","start","end","useFireTexture","THREE.Quaternion","endpoints","tracer","ScreenEffects","intensity","duration","frequency","decay","weaponPower","damagePercent","pitch","yaw","rate","shake","progress","decayMultiplier","currentIntensity","eased","currentPunch","fov","KillfeedManager","killer","isHeadshot","isMultiKill","killerTeam","victimTeam","killerClass","victimClass","headshotIcon","HUDManager","maxHealth","healthPercent","armor","maxArmor","stamina","maxStamina","current","reserve","wave","currentScore","isReloading","show","directionAngle","damageAmount","radians","pulseColor","pulseIntensity","hitmarker","img","msgDisplay","stats","gameOver","finalScore","finalWaves","finalKills","finalAccuracy","finalTime","isMoving","isAirborne","gap","menu","screen","tierClass","hud","scores","myUserId","tbody","id","tr","visible","scoreboard","waitingEl","teamScoreEl","red","blue","redEl","blueEl","redStatus","blueStatus","flagStatusEl","getStatusColor","timeToShrink","zoneEl","timeStr","aliveEl","specEl","playerPos","mapSize","zoneRadius","zoneCenter","remotePlayers","minimapCanvas","ctx","settingsManager","onBack","settingsBtn","settingsMenu","backBtn","pauseMenu","sensSlider","sensValue","volSlider","volValue","fovSlider","fovValue","AudioManager","THREE.AudioListener","pathOrBuffer","category","setup","firePath","tailPath","pool","RIFTIntegration","audioListener","THREE.Raycaster","playerOnGround","playerIsSprinting","playerVelocity","recoilPitch","recoilYaw","muzzleDir","muzzlePosition","shooter","rayOrigin","intersects","endPoint","hitObject","hit","ancestor","obs","entityY","entityHeight","headZone","baseDamage","_width","_height","GameModeType","Team","BaseGameMode","hudManager","playerId","killerId","victimId","headshot","killerScore","killerName","victimName","team","minutes","seconds","timerElement","reason","winner","highestScore","winnerName","_id","FFA_CONFIG","FreeForAllMode","customConfig","timer","leaderScore","previousLeader","highestKills","winnerId","newLeader","kills","streakMessages","TDM_CONFIG","TeamDeathmatchMode","victimScore","players","half","scoreContainer","redScoreEl","blueScoreEl","hudContainer","WAVE_CONFIG","WaveSurvivalMode","playerScore","remaining","_victimId","_weapon","baseScore","headshotBonus","_playerId","maxEnemies","waveBonus","spawned","comp","waveDisplay","counter","scoreEl","GameModeManager","newMode","mode","DEFAULT_NETWORK_CONFIG","RemotePlayer","username","bodyGeometry","THREE.CapsuleGeometry","bodyMaterial","headGeometry","headMaterial","THREE.CanvasTexture","_isSprinting","_isGrounded","renderTime","state1","state2","timeDiff","latest","smoothing","startTime","animate","NetworkManager","serverUrl","token","matchId","socketIo","__vitePreload","parts","userId","userIdStr","remotePlayer","targetId","attackerId","victimIdStr","deadPlayer","uid","rp","localPlayer","origin","hitLocation","targetTeam","LobbyEventType","DEFAULT_GAME_MODES","LobbyManager","matchData","modeId","m","partyId","listeners","LobbyUI","lobbyManager","containerId","modes","closeBtn","tab","cancelBtn","acceptBtn","declineBtn","cards","card","tabs","grid","timeEl","mins","secs","infoEl","timeLeft","timerEl","countdown","currentIntersectionPoint","World","EntityManager","Time","bullet","entities","hittedEntity","squaredDistance","closestItem","fromRegion","toRegion","AxesHelper","hemiLight","HemisphereLight","dirLight","sky","skyMaterial","WebGLRenderer","enemyCount","idleClip","runForwardClip","runBackwardClip","strafeLeftClip","strafeRightClip","death1Clip","death2Clip","SkeletonHelper","vertices","MeshGeometry","depth","cellsX","cellsY","cellsZ","CellSpacePartitioning","collisionGeometry","collisionMaterial","collisionMesh","syncCamera","oldAmmo","oldHealth","oldFragList","bounceNumber","isZoomed","oldWeaponNames","meshesToRemove","gameMode","hitPoint","hitNormal","hitEntity","threeHitPoint","threeNormal","recoil","shakeOffset","shakeWorld","movementX","movementY","startButton","startScreen"],"ignoreList":[0,1,11],"sources":["../../node_modules/three/examples/jsm/utils/BufferGeometryUtils.js","../../node_modules/three/examples/jsm/loaders/GLTFLoader.js","../../src/core/Config.ts","../../src/core/AssetManager.ts","../../src/entities/Item.ts","../../src/core/Constants.ts","../../src/entities/HealthPack.ts","../../src/triggers/ItemGiver.ts","../../src/utils/SceneUtils.ts","../../src/entities/WeaponItem.ts","../../src/core/SpawningManager.ts","../../node_modules/dat.gui/build/dat.gui.module.js","../../src/core/UIManager.ts","../../src/controls/FirstPersonControls.ts","../../src/utils/NavMeshUtils.ts","../../src/entities/Level.ts","../../src/goals/FollowPathGoal.ts","../../src/goals/FindPathGoal.ts","../../src/goals/HuntGoal.ts","../../src/goals/SeekToPositionGoal.ts","../../src/goals/DodgeGoal.ts","../../src/goals/ChargeGoal.ts","../../src/goals/AttackGoal.ts","../../src/core/Feature.ts","../../src/evaluators/AttackEvaluator.ts","../../src/goals/ExploreGoal.ts","../../src/evaluators/ExploreEvaluator.ts","../../src/utils/CharacterBounds.ts","../../src/weapons/Weapon.ts","../../src/weapons/Blaster.ts","../../src/weapons/Shotgun.ts","../../src/weapons/AssaultRifle.ts","../../src/core/WeaponSystem.ts","../../src/core/TargetSystem.ts","../../src/goals/GetItemGoal.ts","../../src/evaluators/GetHealthEvaluator.ts","../../src/evaluators/GetWeaponEvaluator.ts","../../src/types/weapons.ts","../../src/config/weaponConfigs.ts","../../src/systems/WeaponSystem.ts","../../src/entities/Enemy.ts","../../src/config/gameConfig.ts","../../src/weapons/Projectile.ts","../../src/entities/Player.ts","../../src/weapons/Bullet.ts","../../src/utils/PathPlannerTask.ts","../../src/utils/PathPlanner.ts","../../src/effects/Sky.ts","../../src/systems/ParticleSystem.ts","../../src/systems/ImpactSystem.ts","../../src/systems/DecalSystem.ts","../../src/systems/BulletTracerSystem.ts","../../src/systems/ScreenEffects.ts","../../src/ui/KillfeedManager.ts","../../src/ui/HUDManager.ts","../../src/managers/AudioManager.ts","../../src/rift-integration.ts","../../src/gamemodes/IGameMode.ts","../../src/gamemodes/BaseGameMode.ts","../../src/gamemodes/FreeForAllMode.ts","../../src/gamemodes/TeamDeathmatchMode.ts","../../src/gamemodes/WaveSurvivalMode.ts","../../src/gamemodes/GameModeManager.ts","../../src/network/types.ts","../../src/network/RemotePlayer.ts","../../src/network/NetworkManager.ts","../../src/lobby/types.ts","../../src/lobby/LobbyManager.ts","../../src/lobby/LobbyUI.ts","../../src/core/World.ts","../../src/main.ts"],"sourcesContent":["import {\n\tBufferAttribute,\n\tBufferGeometry,\n\tFloat32BufferAttribute,\n\tInstancedBufferAttribute,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tTrianglesDrawMode,\n\tVector3,\n} from 'three';\n\n/**\n * @module BufferGeometryUtils\n * @three_import import * as BufferGeometryUtils from 'three/addons/utils/BufferGeometryUtils.js';\n */\n\n/**\n * Computes vertex tangents using the MikkTSpace algorithm. MikkTSpace generates the same tangents consistently,\n * and is used in most modelling tools and normal map bakers. Use MikkTSpace for materials with normal maps,\n * because inconsistent tangents may lead to subtle visual issues in the normal map, particularly around mirrored\n * UV seams.\n *\n * In comparison to this method, {@link BufferGeometry#computeTangents} (a custom algorithm) generates tangents that\n * probably will not match the tangents in other software. The custom algorithm is sufficient for general use with a\n * custom material, and may be faster than MikkTSpace.\n *\n * Returns the original BufferGeometry. Indexed geometries will be de-indexed. Requires position, normal, and uv attributes.\n *\n * @param {BufferGeometry} geometry - The geometry to compute tangents for.\n * @param {Object} MikkTSpace - Instance of `examples/jsm/libs/mikktspace.module.js`, or `mikktspace` npm package.\n * Await `MikkTSpace.ready` before use.\n * @param {boolean} [negateSign=true] - Whether to negate the sign component (.w) of each tangent.\n * Required for normal map conventions in some formats, including glTF.\n * @return {BufferGeometry} The updated geometry.\n */\nfunction computeMikkTSpaceTangents( geometry, MikkTSpace, negateSign = true ) {\n\n\tif ( ! MikkTSpace || ! MikkTSpace.isReady ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Initialized MikkTSpace library required.' );\n\n\t}\n\n\tif ( ! geometry.hasAttribute( 'position' ) || ! geometry.hasAttribute( 'normal' ) || ! geometry.hasAttribute( 'uv' ) ) {\n\n\t\tthrow new Error( 'BufferGeometryUtils: Tangents require \"position\", \"normal\", and \"uv\" attributes.' );\n\n\t}\n\n\tfunction getAttributeArray( attribute ) {\n\n\t\tif ( attribute.normalized || attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst dstArray = new Float32Array( attribute.count * attribute.itemSize );\n\n\t\t\tfor ( let i = 0, j = 0; i < attribute.count; i ++ ) {\n\n\t\t\t\tdstArray[ j ++ ] = attribute.getX( i );\n\t\t\t\tdstArray[ j ++ ] = attribute.getY( i );\n\n\t\t\t\tif ( attribute.itemSize > 2 ) {\n\n\t\t\t\t\tdstArray[ j ++ ] = attribute.getZ( i );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn dstArray;\n\n\t\t}\n\n\t\tif ( attribute.array instanceof Float32Array ) {\n\n\t\t\treturn attribute.array;\n\n\t\t}\n\n\t\treturn new Float32Array( attribute.array );\n\n\t}\n\n\t// MikkTSpace algorithm requires non-indexed input.\n\n\tconst _geometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\n\t// Compute vertex tangents.\n\n\tconst tangents = MikkTSpace.generateTangents(\n\n\t\tgetAttributeArray( _geometry.attributes.position ),\n\t\tgetAttributeArray( _geometry.attributes.normal ),\n\t\tgetAttributeArray( _geometry.attributes.uv )\n\n\t);\n\n\t// Texture coordinate convention of glTF differs from the apparent\n\t// default of the MikkTSpace library; .w component must be flipped.\n\n\tif ( negateSign ) {\n\n\t\tfor ( let i = 3; i < tangents.length; i += 4 ) {\n\n\t\t\ttangents[ i ] *= - 1;\n\n\t\t}\n\n\t}\n\n\t//\n\n\t_geometry.setAttribute( 'tangent', new BufferAttribute( tangents, 4 ) );\n\n\tif ( geometry !== _geometry ) {\n\n\t\tgeometry.copy( _geometry );\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * Merges a set of geometries into a single instance. All geometries must have compatible attributes.\n *\n * @param {Array<BufferGeometry>} geometries - The geometries to merge.\n * @param {boolean} [useGroups=false] - Whether to use groups or not.\n * @return {?BufferGeometry} The merged geometry. Returns `null` if the merge does not succeed.\n */\nfunction mergeGeometries( geometries, useGroups = false ) {\n\n\tconst isIndexed = geometries[ 0 ].index !== null;\n\n\tconst attributesUsed = new Set( Object.keys( geometries[ 0 ].attributes ) );\n\tconst morphAttributesUsed = new Set( Object.keys( geometries[ 0 ].morphAttributes ) );\n\n\tconst attributes = {};\n\tconst morphAttributes = {};\n\n\tconst morphTargetsRelative = geometries[ 0 ].morphTargetsRelative;\n\n\tconst mergedGeometry = new BufferGeometry();\n\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\tconst geometry = geometries[ i ];\n\t\tlet attributesCount = 0;\n\n\t\t// ensure that all geometries are indexed, or none\n\n\t\tif ( isIndexed !== ( geometry.index !== null ) ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure index attribute exists among all geometries, or in none of them.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather attributes, exit early if they're different\n\n\t\tfor ( const name in geometry.attributes ) {\n\n\t\t\tif ( ! attributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. All geometries must have compatible attributes; make sure \"' + name + '\" attribute exists among all geometries, or in none of them.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( attributes[ name ] === undefined ) attributes[ name ] = [];\n\n\t\t\tattributes[ name ].push( geometry.attributes[ name ] );\n\n\t\t\tattributesCount ++;\n\n\t\t}\n\n\t\t// ensure geometries have the same number of attributes\n\n\t\tif ( attributesCount !== attributesUsed.size ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. Make sure all geometries have the same number of attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\t// gather morph attributes, exit early if they're different\n\n\t\tif ( morphTargetsRelative !== geometry.morphTargetsRelative ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. .morphTargetsRelative must be consistent throughout all geometries.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tfor ( const name in geometry.morphAttributes ) {\n\n\t\t\tif ( ! morphAttributesUsed.has( name ) ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '.  .morphAttributes must be consistent throughout all geometries.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tif ( morphAttributes[ name ] === undefined ) morphAttributes[ name ] = [];\n\n\t\t\tmorphAttributes[ name ].push( geometry.morphAttributes[ name ] );\n\n\t\t}\n\n\t\tif ( useGroups ) {\n\n\t\t\tlet count;\n\n\t\t\tif ( isIndexed ) {\n\n\t\t\t\tcount = geometry.index.count;\n\n\t\t\t} else if ( geometry.attributes.position !== undefined ) {\n\n\t\t\t\tcount = geometry.attributes.position.count;\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed with geometry at index ' + i + '. The geometry must have either an index or a position attribute' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.addGroup( offset, count, i );\n\n\t\t\toffset += count;\n\n\t\t}\n\n\t}\n\n\t// merge indices\n\n\tif ( isIndexed ) {\n\n\t\tlet indexOffset = 0;\n\t\tconst mergedIndex = [];\n\n\t\tfor ( let i = 0; i < geometries.length; ++ i ) {\n\n\t\t\tconst index = geometries[ i ].index;\n\n\t\t\tfor ( let j = 0; j < index.count; ++ j ) {\n\n\t\t\t\tmergedIndex.push( index.getX( j ) + indexOffset );\n\n\t\t\t}\n\n\t\t\tindexOffset += geometries[ i ].attributes.position.count;\n\n\t\t}\n\n\t\tmergedGeometry.setIndex( mergedIndex );\n\n\t}\n\n\t// merge attributes\n\n\tfor ( const name in attributes ) {\n\n\t\tconst mergedAttribute = mergeAttributes( attributes[ name ] );\n\n\t\tif ( ! mergedAttribute ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' attribute.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tmergedGeometry.setAttribute( name, mergedAttribute );\n\n\t}\n\n\t// merge morph attributes\n\n\tfor ( const name in morphAttributes ) {\n\n\t\tconst numMorphTargets = morphAttributes[ name ][ 0 ].length;\n\n\t\tif ( numMorphTargets === 0 ) break;\n\n\t\tmergedGeometry.morphAttributes = mergedGeometry.morphAttributes || {};\n\t\tmergedGeometry.morphAttributes[ name ] = [];\n\n\t\tfor ( let i = 0; i < numMorphTargets; ++ i ) {\n\n\t\t\tconst morphAttributesToMerge = [];\n\n\t\t\tfor ( let j = 0; j < morphAttributes[ name ].length; ++ j ) {\n\n\t\t\t\tmorphAttributesToMerge.push( morphAttributes[ name ][ j ][ i ] );\n\n\t\t\t}\n\n\t\t\tconst mergedMorphAttribute = mergeAttributes( morphAttributesToMerge );\n\n\t\t\tif ( ! mergedMorphAttribute ) {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeGeometries() failed while trying to merge the ' + name + ' morphAttribute.' );\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t\tmergedGeometry.morphAttributes[ name ].push( mergedMorphAttribute );\n\n\t\t}\n\n\t}\n\n\treturn mergedGeometry;\n\n}\n\n/**\n * Merges a set of attributes into a single instance. All attributes must have compatible properties and types.\n * Instances of {@link InterleavedBufferAttribute} are not supported.\n *\n * @param {Array<BufferAttribute>} attributes - The attributes to merge.\n * @return {?BufferAttribute} The merged attribute. Returns `null` if the merge does not succeed.\n */\nfunction mergeAttributes( attributes ) {\n\n\tlet TypedArray;\n\tlet itemSize;\n\tlet normalized;\n\tlet gpuType = - 1;\n\tlet arrayLength = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.array must be of consistent array types across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( itemSize === undefined ) itemSize = attribute.itemSize;\n\t\tif ( itemSize !== attribute.itemSize ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.itemSize must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( normalized === undefined ) normalized = attribute.normalized;\n\t\tif ( normalized !== attribute.normalized ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.normalized must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tif ( gpuType === - 1 ) gpuType = attribute.gpuType;\n\t\tif ( gpuType !== attribute.gpuType ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils: .mergeAttributes() failed. BufferAttribute.gpuType must be consistent across matching attributes.' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.count * itemSize;\n\n\t}\n\n\tconst array = new TypedArray( arrayLength );\n\tconst result = new BufferAttribute( array, itemSize, normalized );\n\tlet offset = 0;\n\n\tfor ( let i = 0; i < attributes.length; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\t\tif ( attribute.isInterleavedBufferAttribute ) {\n\n\t\t\tconst tupleOffset = offset / itemSize;\n\t\t\tfor ( let j = 0, l = attribute.count; j < l; j ++ ) {\n\n\t\t\t\tfor ( let c = 0; c < itemSize; c ++ ) {\n\n\t\t\t\t\tconst value = attribute.getComponent( j, c );\n\t\t\t\t\tresult.setComponent( j + tupleOffset, c, value );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tarray.set( attribute.array, offset );\n\n\t\t}\n\n\t\toffset += attribute.count * itemSize;\n\n\t}\n\n\tif ( gpuType !== undefined ) {\n\n\t\tresult.gpuType = gpuType;\n\n\t}\n\n\treturn result;\n\n}\n\n/**\n * Performs a deep clone of the given buffer attribute.\n *\n * @param {BufferAttribute} attribute - The attribute to clone.\n * @return {BufferAttribute} The cloned attribute.\n */\nfunction deepCloneAttribute( attribute ) {\n\n\tif ( attribute.isInstancedInterleavedBufferAttribute || attribute.isInterleavedBufferAttribute ) {\n\n\t\treturn deinterleaveAttribute( attribute );\n\n\t}\n\n\tif ( attribute.isInstancedBufferAttribute ) {\n\n\t\treturn new InstancedBufferAttribute().copy( attribute );\n\n\t}\n\n\treturn new BufferAttribute().copy( attribute );\n\n}\n\n/**\n * Interleaves a set of attributes and returns a new array of corresponding attributes that share a\n * single {@link InterleavedBuffer} instance. All attributes must have compatible types.\n *\n * @param {Array<BufferAttribute>} attributes - The attributes to interleave.\n * @return {?Array<InterleavedBufferAttribute>} An array of interleaved attributes. If interleave does not succeed, the method returns `null`.\n */\nfunction interleaveAttributes( attributes ) {\n\n\t// Interleaves the provided attributes into an InterleavedBuffer and returns\n\t// a set of InterleavedBufferAttributes for each attribute\n\tlet TypedArray;\n\tlet arrayLength = 0;\n\tlet stride = 0;\n\n\t// calculate the length and type of the interleavedBuffer\n\tfor ( let i = 0, l = attributes.length; i < l; ++ i ) {\n\n\t\tconst attribute = attributes[ i ];\n\n\t\tif ( TypedArray === undefined ) TypedArray = attribute.array.constructor;\n\t\tif ( TypedArray !== attribute.array.constructor ) {\n\n\t\t\tconsole.error( 'AttributeBuffers of different types cannot be interleaved' );\n\t\t\treturn null;\n\n\t\t}\n\n\t\tarrayLength += attribute.array.length;\n\t\tstride += attribute.itemSize;\n\n\t}\n\n\t// Create the set of buffer attributes\n\tconst interleavedBuffer = new InterleavedBuffer( new TypedArray( arrayLength ), stride );\n\tlet offset = 0;\n\tconst res = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\tfor ( let j = 0, l = attributes.length; j < l; j ++ ) {\n\n\t\tconst attribute = attributes[ j ];\n\t\tconst itemSize = attribute.itemSize;\n\t\tconst count = attribute.count;\n\t\tconst iba = new InterleavedBufferAttribute( interleavedBuffer, itemSize, offset, attribute.normalized );\n\t\tres.push( iba );\n\n\t\toffset += itemSize;\n\n\t\t// Move the data for each attribute into the new interleavedBuffer\n\t\t// at the appropriate offset\n\t\tfor ( let c = 0; c < count; c ++ ) {\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\tiba[ setters[ k ] ]( c, attribute[ getters[ k ] ]( c ) );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\treturn res;\n\n}\n\n/**\n * Returns a new, non-interleaved version of the given attribute.\n *\n * @param {InterleavedBufferAttribute} attribute - The interleaved attribute.\n * @return {BufferAttribute} The non-interleaved attribute.\n */\nfunction deinterleaveAttribute( attribute ) {\n\n\tconst cons = attribute.data.array.constructor;\n\tconst count = attribute.count;\n\tconst itemSize = attribute.itemSize;\n\tconst normalized = attribute.normalized;\n\n\tconst array = new cons( count * itemSize );\n\tlet newAttribute;\n\tif ( attribute.isInstancedInterleavedBufferAttribute ) {\n\n\t\tnewAttribute = new InstancedBufferAttribute( array, itemSize, normalized, attribute.meshPerAttribute );\n\n\t} else {\n\n\t\tnewAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t}\n\n\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\tnewAttribute.setX( i, attribute.getX( i ) );\n\n\t\tif ( itemSize >= 2 ) {\n\n\t\t\tnewAttribute.setY( i, attribute.getY( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 3 ) {\n\n\t\t\tnewAttribute.setZ( i, attribute.getZ( i ) );\n\n\t\t}\n\n\t\tif ( itemSize >= 4 ) {\n\n\t\t\tnewAttribute.setW( i, attribute.getW( i ) );\n\n\t\t}\n\n\t}\n\n\treturn newAttribute;\n\n}\n\n/**\n * Deinterleaves all attributes on the given geometry.\n *\n * @param {BufferGeometry} geometry - The geometry to deinterleave.\n */\nfunction deinterleaveGeometry( geometry ) {\n\n\tconst attributes = geometry.attributes;\n\tconst morphTargets = geometry.morphTargets;\n\tconst attrMap = new Map();\n\n\tfor ( const key in attributes ) {\n\n\t\tconst attr = attributes[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tattributes[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n\tfor ( const key in morphTargets ) {\n\n\t\tconst attr = morphTargets[ key ];\n\t\tif ( attr.isInterleavedBufferAttribute ) {\n\n\t\t\tif ( ! attrMap.has( attr ) ) {\n\n\t\t\t\tattrMap.set( attr, deinterleaveAttribute( attr ) );\n\n\t\t\t}\n\n\t\t\tmorphTargets[ key ] = attrMap.get( attr );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Returns the amount of bytes used by all attributes to represent the geometry.\n *\n * @param {BufferGeometry} geometry - The geometry.\n * @return {number} The estimate bytes used.\n */\nfunction estimateBytesUsed( geometry ) {\n\n\t// Return the estimated memory used by this geometry in bytes\n\t// Calculate using itemSize, count, and BYTES_PER_ELEMENT to account\n\t// for InterleavedBufferAttributes.\n\tlet mem = 0;\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst attr = geometry.getAttribute( name );\n\t\tmem += attr.count * attr.itemSize * attr.array.BYTES_PER_ELEMENT;\n\n\t}\n\n\tconst indices = geometry.getIndex();\n\tmem += indices ? indices.count * indices.itemSize * indices.array.BYTES_PER_ELEMENT : 0;\n\treturn mem;\n\n}\n\n/**\n * Returns a new geometry with vertices for which all similar vertex attributes (within tolerance) are merged.\n *\n * @param {BufferGeometry} geometry - The geometry to merge vertices for.\n * @param {number} [tolerance=1e-4] - The tolerance value.\n * @return {BufferGeometry} - The new geometry with merged vertices.\n */\nfunction mergeVertices( geometry, tolerance = 1e-4 ) {\n\n\ttolerance = Math.max( tolerance, Number.EPSILON );\n\n\t// Generate an index buffer if the geometry doesn't have one, or optimize it\n\t// if it's already available.\n\tconst hashToIndex = {};\n\tconst indices = geometry.getIndex();\n\tconst positions = geometry.getAttribute( 'position' );\n\tconst vertexCount = indices ? indices.count : positions.count;\n\n\t// next value for triangle indices\n\tlet nextIndex = 0;\n\n\t// attributes and new attribute arrays\n\tconst attributeNames = Object.keys( geometry.attributes );\n\tconst tmpAttributes = {};\n\tconst tmpMorphAttributes = {};\n\tconst newIndices = [];\n\tconst getters = [ 'getX', 'getY', 'getZ', 'getW' ];\n\tconst setters = [ 'setX', 'setY', 'setZ', 'setW' ];\n\n\t// Initialize the arrays, allocating space conservatively. Extra\n\t// space will be trimmed in the last step.\n\tfor ( let i = 0, l = attributeNames.length; i < l; i ++ ) {\n\n\t\tconst name = attributeNames[ i ];\n\t\tconst attr = geometry.attributes[ name ];\n\n\t\ttmpAttributes[ name ] = new attr.constructor(\n\t\t\tnew attr.array.constructor( attr.count * attr.itemSize ),\n\t\t\tattr.itemSize,\n\t\t\tattr.normalized\n\t\t);\n\n\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\tif ( morphAttributes ) {\n\n\t\t\tif ( ! tmpMorphAttributes[ name ] ) tmpMorphAttributes[ name ] = [];\n\t\t\tmorphAttributes.forEach( ( morphAttr, i ) => {\n\n\t\t\t\tconst array = new morphAttr.array.constructor( morphAttr.count * morphAttr.itemSize );\n\t\t\t\ttmpMorphAttributes[ name ][ i ] = new morphAttr.constructor( array, morphAttr.itemSize, morphAttr.normalized );\n\n\t\t\t} );\n\n\t\t}\n\n\t}\n\n\t// convert the error tolerance to an amount of decimal places to truncate to\n\tconst halfTolerance = tolerance * 0.5;\n\tconst exponent = Math.log10( 1 / tolerance );\n\tconst hashMultiplier = Math.pow( 10, exponent );\n\tconst hashAdditive = halfTolerance * hashMultiplier;\n\tfor ( let i = 0; i < vertexCount; i ++ ) {\n\n\t\tconst index = indices ? indices.getX( i ) : i;\n\n\t\t// Generate a hash for the vertex attributes at the current index 'i'\n\t\tlet hash = '';\n\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\tconst name = attributeNames[ j ];\n\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\tconst itemSize = attribute.itemSize;\n\n\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t// double tilde truncates the decimal value\n\t\t\t\thash += `${ ~ ~ ( attribute[ getters[ k ] ]( index ) * hashMultiplier + hashAdditive ) },`;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Add another reference to the vertex if it's already\n\t\t// used by another index\n\t\tif ( hash in hashToIndex ) {\n\n\t\t\tnewIndices.push( hashToIndex[ hash ] );\n\n\t\t} else {\n\n\t\t\t// copy data to the new index in the temporary attributes\n\t\t\tfor ( let j = 0, l = attributeNames.length; j < l; j ++ ) {\n\n\t\t\t\tconst name = attributeNames[ j ];\n\t\t\t\tconst attribute = geometry.getAttribute( name );\n\t\t\t\tconst morphAttributes = geometry.morphAttributes[ name ];\n\t\t\t\tconst itemSize = attribute.itemSize;\n\t\t\t\tconst newArray = tmpAttributes[ name ];\n\t\t\t\tconst newMorphArrays = tmpMorphAttributes[ name ];\n\n\t\t\t\tfor ( let k = 0; k < itemSize; k ++ ) {\n\n\t\t\t\t\tconst getterFunc = getters[ k ];\n\t\t\t\t\tconst setterFunc = setters[ k ];\n\t\t\t\t\tnewArray[ setterFunc ]( nextIndex, attribute[ getterFunc ]( index ) );\n\n\t\t\t\t\tif ( morphAttributes ) {\n\n\t\t\t\t\t\tfor ( let m = 0, ml = morphAttributes.length; m < ml; m ++ ) {\n\n\t\t\t\t\t\t\tnewMorphArrays[ m ][ setterFunc ]( nextIndex, morphAttributes[ m ][ getterFunc ]( index ) );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\thashToIndex[ hash ] = nextIndex;\n\t\t\tnewIndices.push( nextIndex );\n\t\t\tnextIndex ++;\n\n\t\t}\n\n\t}\n\n\t// generate result BufferGeometry\n\tconst result = geometry.clone();\n\tfor ( const name in geometry.attributes ) {\n\n\t\tconst tmpAttribute = tmpAttributes[ name ];\n\n\t\tresult.setAttribute( name, new tmpAttribute.constructor(\n\t\t\ttmpAttribute.array.slice( 0, nextIndex * tmpAttribute.itemSize ),\n\t\t\ttmpAttribute.itemSize,\n\t\t\ttmpAttribute.normalized,\n\t\t) );\n\n\t\tif ( ! ( name in tmpMorphAttributes ) ) continue;\n\n\t\tfor ( let j = 0; j < tmpMorphAttributes[ name ].length; j ++ ) {\n\n\t\t\tconst tmpMorphAttribute = tmpMorphAttributes[ name ][ j ];\n\n\t\t\tresult.morphAttributes[ name ][ j ] = new tmpMorphAttribute.constructor(\n\t\t\t\ttmpMorphAttribute.array.slice( 0, nextIndex * tmpMorphAttribute.itemSize ),\n\t\t\t\ttmpMorphAttribute.itemSize,\n\t\t\t\ttmpMorphAttribute.normalized,\n\t\t\t);\n\n\t\t}\n\n\t}\n\n\t// indices\n\n\tresult.setIndex( newIndices );\n\n\treturn result;\n\n}\n\n/**\n * Returns a new indexed geometry based on `TrianglesDrawMode` draw mode.\n * This mode corresponds to the `gl.TRIANGLES` primitive in WebGL.\n *\n * @param {BufferGeometry} geometry - The geometry to convert.\n * @param {number} drawMode - The current draw mode.\n * @return {BufferGeometry} The new geometry using `TrianglesDrawMode`.\n */\nfunction toTrianglesDrawMode( geometry, drawMode ) {\n\n\tif ( drawMode === TrianglesDrawMode ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Geometry already defined as triangles.' );\n\t\treturn geometry;\n\n\t}\n\n\tif ( drawMode === TriangleFanDrawMode || drawMode === TriangleStripDrawMode ) {\n\n\t\tlet index = geometry.getIndex();\n\n\t\t// generate index if not present\n\n\t\tif ( index === null ) {\n\n\t\t\tconst indices = [];\n\n\t\t\tconst position = geometry.getAttribute( 'position' );\n\n\t\t\tif ( position !== undefined ) {\n\n\t\t\t\tfor ( let i = 0; i < position.count; i ++ ) {\n\n\t\t\t\t\tindices.push( i );\n\n\t\t\t\t}\n\n\t\t\t\tgeometry.setIndex( indices );\n\t\t\t\tindex = geometry.getIndex();\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Undefined position attribute. Processing not possible.' );\n\t\t\t\treturn geometry;\n\n\t\t\t}\n\n\t\t}\n\n\t\t//\n\n\t\tconst numberOfTriangles = index.count - 2;\n\t\tconst newIndices = [];\n\n\t\tif ( drawMode === TriangleFanDrawMode ) {\n\n\t\t\t// gl.TRIANGLE_FAN\n\n\t\t\tfor ( let i = 1; i <= numberOfTriangles; i ++ ) {\n\n\t\t\t\tnewIndices.push( index.getX( 0 ) );\n\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\t// gl.TRIANGLE_STRIP\n\n\t\t\tfor ( let i = 0; i < numberOfTriangles; i ++ ) {\n\n\t\t\t\tif ( i % 2 === 0 ) {\n\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tnewIndices.push( index.getX( i + 2 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i + 1 ) );\n\t\t\t\t\tnewIndices.push( index.getX( i ) );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( ( newIndices.length / 3 ) !== numberOfTriangles ) {\n\n\t\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unable to generate correct amount of triangles.' );\n\n\t\t}\n\n\t\t// build final geometry\n\n\t\tconst newGeometry = geometry.clone();\n\t\tnewGeometry.setIndex( newIndices );\n\t\tnewGeometry.clearGroups();\n\n\t\treturn newGeometry;\n\n\t} else {\n\n\t\tconsole.error( 'THREE.BufferGeometryUtils.toTrianglesDrawMode(): Unknown draw mode:', drawMode );\n\t\treturn geometry;\n\n\t}\n\n}\n\n/**\n * Calculates the morphed attributes of a morphed/skinned BufferGeometry.\n *\n * Helpful for Raytracing or Decals (i.e. a `DecalGeometry` applied to a morphed Object with a `BufferGeometry`\n * will use the original `BufferGeometry`, not the morphed/skinned one, generating an incorrect result.\n * Using this function to create a shadow `Object3`D the `DecalGeometry` can be correctly generated).\n *\n * @param {Mesh|Line|Points} object - The 3D object to compute morph attributes for.\n * @return {Object} An object with original position/normal attributes and morphed ones.\n */\nfunction computeMorphedAttributes( object ) {\n\n\tconst _vA = new Vector3();\n\tconst _vB = new Vector3();\n\tconst _vC = new Vector3();\n\n\tconst _tempA = new Vector3();\n\tconst _tempB = new Vector3();\n\tconst _tempC = new Vector3();\n\n\tconst _morphA = new Vector3();\n\tconst _morphB = new Vector3();\n\tconst _morphC = new Vector3();\n\n\tfunction _calculateMorphedAttributeData(\n\t\tobject,\n\t\tattribute,\n\t\tmorphAttribute,\n\t\tmorphTargetsRelative,\n\t\ta,\n\t\tb,\n\t\tc,\n\t\tmodifiedAttributeArray\n\t) {\n\n\t\t_vA.fromBufferAttribute( attribute, a );\n\t\t_vB.fromBufferAttribute( attribute, b );\n\t\t_vC.fromBufferAttribute( attribute, c );\n\n\t\tconst morphInfluences = object.morphTargetInfluences;\n\n\t\tif ( morphAttribute && morphInfluences ) {\n\n\t\t\t_morphA.set( 0, 0, 0 );\n\t\t\t_morphB.set( 0, 0, 0 );\n\t\t\t_morphC.set( 0, 0, 0 );\n\n\t\t\tfor ( let i = 0, il = morphAttribute.length; i < il; i ++ ) {\n\n\t\t\t\tconst influence = morphInfluences[ i ];\n\t\t\t\tconst morph = morphAttribute[ i ];\n\n\t\t\t\tif ( influence === 0 ) continue;\n\n\t\t\t\t_tempA.fromBufferAttribute( morph, a );\n\t\t\t\t_tempB.fromBufferAttribute( morph, b );\n\t\t\t\t_tempC.fromBufferAttribute( morph, c );\n\n\t\t\t\tif ( morphTargetsRelative ) {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA, influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB, influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC, influence );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t_morphA.addScaledVector( _tempA.sub( _vA ), influence );\n\t\t\t\t\t_morphB.addScaledVector( _tempB.sub( _vB ), influence );\n\t\t\t\t\t_morphC.addScaledVector( _tempC.sub( _vC ), influence );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t_vA.add( _morphA );\n\t\t\t_vB.add( _morphB );\n\t\t\t_vC.add( _morphC );\n\n\t\t}\n\n\t\tif ( object.isSkinnedMesh ) {\n\n\t\t\tobject.applyBoneTransform( a, _vA );\n\t\t\tobject.applyBoneTransform( b, _vB );\n\t\t\tobject.applyBoneTransform( c, _vC );\n\n\t\t}\n\n\t\tmodifiedAttributeArray[ a * 3 + 0 ] = _vA.x;\n\t\tmodifiedAttributeArray[ a * 3 + 1 ] = _vA.y;\n\t\tmodifiedAttributeArray[ a * 3 + 2 ] = _vA.z;\n\t\tmodifiedAttributeArray[ b * 3 + 0 ] = _vB.x;\n\t\tmodifiedAttributeArray[ b * 3 + 1 ] = _vB.y;\n\t\tmodifiedAttributeArray[ b * 3 + 2 ] = _vB.z;\n\t\tmodifiedAttributeArray[ c * 3 + 0 ] = _vC.x;\n\t\tmodifiedAttributeArray[ c * 3 + 1 ] = _vC.y;\n\t\tmodifiedAttributeArray[ c * 3 + 2 ] = _vC.z;\n\n\t}\n\n\tconst geometry = object.geometry;\n\tconst material = object.material;\n\n\tlet a, b, c;\n\tconst index = geometry.index;\n\tconst positionAttribute = geometry.attributes.position;\n\tconst morphPosition = geometry.morphAttributes.position;\n\tconst morphTargetsRelative = geometry.morphTargetsRelative;\n\tconst normalAttribute = geometry.attributes.normal;\n\tconst morphNormal = geometry.morphAttributes.position;\n\n\tconst groups = geometry.groups;\n\tconst drawRange = geometry.drawRange;\n\tlet i, j, il, jl;\n\tlet group;\n\tlet start, end;\n\n\tconst modifiedPosition = new Float32Array( positionAttribute.count * positionAttribute.itemSize );\n\tconst modifiedNormal = new Float32Array( normalAttribute.count * normalAttribute.itemSize );\n\n\tif ( index !== null ) {\n\n\t\t// indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = index.getX( j );\n\t\t\t\t\tb = index.getX( j + 1 );\n\t\t\t\t\tc = index.getX( j + 2 );\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( index.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = index.getX( i );\n\t\t\t\tb = index.getX( i + 1 );\n\t\t\t\tc = index.getX( i + 2 );\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t} else {\n\n\t\t// non-indexed buffer geometry\n\n\t\tif ( Array.isArray( material ) ) {\n\n\t\t\tfor ( i = 0, il = groups.length; i < il; i ++ ) {\n\n\t\t\t\tgroup = groups[ i ];\n\n\t\t\t\tstart = Math.max( group.start, drawRange.start );\n\t\t\t\tend = Math.min( ( group.start + group.count ), ( drawRange.start + drawRange.count ) );\n\n\t\t\t\tfor ( j = start, jl = end; j < jl; j += 3 ) {\n\n\t\t\t\t\ta = j;\n\t\t\t\t\tb = j + 1;\n\t\t\t\t\tc = j + 2;\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tpositionAttribute,\n\t\t\t\t\t\tmorphPosition,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedPosition\n\t\t\t\t\t);\n\n\t\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\t\tobject,\n\t\t\t\t\t\tnormalAttribute,\n\t\t\t\t\t\tmorphNormal,\n\t\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\t\ta, b, c,\n\t\t\t\t\t\tmodifiedNormal\n\t\t\t\t\t);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tstart = Math.max( 0, drawRange.start );\n\t\t\tend = Math.min( positionAttribute.count, ( drawRange.start + drawRange.count ) );\n\n\t\t\tfor ( i = start, il = end; i < il; i += 3 ) {\n\n\t\t\t\ta = i;\n\t\t\t\tb = i + 1;\n\t\t\t\tc = i + 2;\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tpositionAttribute,\n\t\t\t\t\tmorphPosition,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedPosition\n\t\t\t\t);\n\n\t\t\t\t_calculateMorphedAttributeData(\n\t\t\t\t\tobject,\n\t\t\t\t\tnormalAttribute,\n\t\t\t\t\tmorphNormal,\n\t\t\t\t\tmorphTargetsRelative,\n\t\t\t\t\ta, b, c,\n\t\t\t\t\tmodifiedNormal\n\t\t\t\t);\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\tconst morphedPositionAttribute = new Float32BufferAttribute( modifiedPosition, 3 );\n\tconst morphedNormalAttribute = new Float32BufferAttribute( modifiedNormal, 3 );\n\n\treturn {\n\n\t\tpositionAttribute: positionAttribute,\n\t\tnormalAttribute: normalAttribute,\n\t\tmorphedPositionAttribute: morphedPositionAttribute,\n\t\tmorphedNormalAttribute: morphedNormalAttribute\n\n\t};\n\n}\n\n/**\n * Merges the {@link BufferGeometry#groups} for the given geometry.\n *\n * @param {BufferGeometry} geometry - The geometry to modify.\n * @return {BufferGeometry} - The updated geometry\n */\nfunction mergeGroups( geometry ) {\n\n\tif ( geometry.groups.length === 0 ) {\n\n\t\tconsole.warn( 'THREE.BufferGeometryUtils.mergeGroups(): No groups are defined. Nothing to merge.' );\n\t\treturn geometry;\n\n\t}\n\n\tlet groups = geometry.groups;\n\n\t// sort groups by material index\n\n\tgroups = groups.sort( ( a, b ) => {\n\n\t\tif ( a.materialIndex !== b.materialIndex ) return a.materialIndex - b.materialIndex;\n\n\t\treturn a.start - b.start;\n\n\t} );\n\n\t// create index for non-indexed geometries\n\n\tif ( geometry.getIndex() === null ) {\n\n\t\tconst positionAttribute = geometry.getAttribute( 'position' );\n\t\tconst indices = [];\n\n\t\tfor ( let i = 0; i < positionAttribute.count; i += 3 ) {\n\n\t\t\tindices.push( i, i + 1, i + 2 );\n\n\t\t}\n\n\t\tgeometry.setIndex( indices );\n\n\t}\n\n\t// sort index\n\n\tconst index = geometry.getIndex();\n\n\tconst newIndices = [];\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tconst groupStart = group.start;\n\t\tconst groupLength = groupStart + group.count;\n\n\t\tfor ( let j = groupStart; j < groupLength; j ++ ) {\n\n\t\t\tnewIndices.push( index.getX( j ) );\n\n\t\t}\n\n\t}\n\n\tgeometry.dispose(); // Required to force buffer recreation\n\tgeometry.setIndex( newIndices );\n\n\t// update groups indices\n\n\tlet start = 0;\n\n\tfor ( let i = 0; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tgroup.start = start;\n\t\tstart += group.count;\n\n\t}\n\n\t// merge groups\n\n\tlet currentGroup = groups[ 0 ];\n\n\tgeometry.groups = [ currentGroup ];\n\n\tfor ( let i = 1; i < groups.length; i ++ ) {\n\n\t\tconst group = groups[ i ];\n\n\t\tif ( currentGroup.materialIndex === group.materialIndex ) {\n\n\t\t\tcurrentGroup.count += group.count;\n\n\t\t} else {\n\n\t\t\tcurrentGroup = group;\n\t\t\tgeometry.groups.push( currentGroup );\n\n\t\t}\n\n\t}\n\n\treturn geometry;\n\n}\n\n/**\n * Modifies the supplied geometry if it is non-indexed, otherwise creates a new,\n * non-indexed geometry. Returns the geometry with smooth normals everywhere except\n * faces that meet at an angle greater than the crease angle.\n *\n * @param {BufferGeometry} geometry - The geometry to modify.\n * @param {number} [creaseAngle=Math.PI/3] - The crease angle in radians.\n * @return {BufferGeometry} - The updated geometry\n */\nfunction toCreasedNormals( geometry, creaseAngle = Math.PI / 3 /* 60 degrees */ ) {\n\n\tconst creaseDot = Math.cos( creaseAngle );\n\tconst hashMultiplier = ( 1 + 1e-10 ) * 1e2;\n\n\t// reusable vectors\n\tconst verts = [ new Vector3(), new Vector3(), new Vector3() ];\n\tconst tempVec1 = new Vector3();\n\tconst tempVec2 = new Vector3();\n\tconst tempNorm = new Vector3();\n\tconst tempNorm2 = new Vector3();\n\n\t// hashes a vector\n\tfunction hashVertex( v ) {\n\n\t\tconst x = ~ ~ ( v.x * hashMultiplier );\n\t\tconst y = ~ ~ ( v.y * hashMultiplier );\n\t\tconst z = ~ ~ ( v.z * hashMultiplier );\n\t\treturn `${x},${y},${z}`;\n\n\t}\n\n\t// BufferGeometry.toNonIndexed() warns if the geometry is non-indexed\n\t// and returns the original geometry\n\tconst resultGeometry = geometry.index ? geometry.toNonIndexed() : geometry;\n\tconst posAttr = resultGeometry.attributes.position;\n\tconst vertexMap = {};\n\n\t// find all the normals shared by commonly located vertices\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\t// add the normal to the map for all vertices\n\t\tconst normal = new Vector3().crossVectors( tempVec1, tempVec2 ).normalize();\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tif ( ! ( hash in vertexMap ) ) {\n\n\t\t\t\tvertexMap[ hash ] = [];\n\n\t\t\t}\n\n\t\t\tvertexMap[ hash ].push( normal );\n\n\t\t}\n\n\t}\n\n\t// average normals from all vertices that share a common location if they are within the\n\t// provided crease threshold\n\tconst normalArray = new Float32Array( posAttr.count * 3 );\n\tconst normAttr = new BufferAttribute( normalArray, 3, false );\n\tfor ( let i = 0, l = posAttr.count / 3; i < l; i ++ ) {\n\n\t\t// get the face normal for this vertex\n\t\tconst i3 = 3 * i;\n\t\tconst a = verts[ 0 ].fromBufferAttribute( posAttr, i3 + 0 );\n\t\tconst b = verts[ 1 ].fromBufferAttribute( posAttr, i3 + 1 );\n\t\tconst c = verts[ 2 ].fromBufferAttribute( posAttr, i3 + 2 );\n\n\t\ttempVec1.subVectors( c, b );\n\t\ttempVec2.subVectors( a, b );\n\n\t\ttempNorm.crossVectors( tempVec1, tempVec2 ).normalize();\n\n\t\t// average all normals that meet the threshold and set the normal value\n\t\tfor ( let n = 0; n < 3; n ++ ) {\n\n\t\t\tconst vert = verts[ n ];\n\t\t\tconst hash = hashVertex( vert );\n\t\t\tconst otherNormals = vertexMap[ hash ];\n\t\t\ttempNorm2.set( 0, 0, 0 );\n\n\t\t\tfor ( let k = 0, lk = otherNormals.length; k < lk; k ++ ) {\n\n\t\t\t\tconst otherNorm = otherNormals[ k ];\n\t\t\t\tif ( tempNorm.dot( otherNorm ) > creaseDot ) {\n\n\t\t\t\t\ttempNorm2.add( otherNorm );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\ttempNorm2.normalize();\n\t\t\tnormAttr.setXYZ( i3 + n, tempNorm2.x, tempNorm2.y, tempNorm2.z );\n\n\t\t}\n\n\t}\n\n\tresultGeometry.setAttribute( 'normal', normAttr );\n\treturn resultGeometry;\n\n}\n\nexport {\n\tcomputeMikkTSpaceTangents,\n\tmergeGeometries,\n\tmergeAttributes,\n\tdeepCloneAttribute,\n\tdeinterleaveAttribute,\n\tdeinterleaveGeometry,\n\tinterleaveAttributes,\n\testimateBytesUsed,\n\tmergeVertices,\n\ttoTrianglesDrawMode,\n\tcomputeMorphedAttributes,\n\tmergeGroups,\n\ttoCreasedNormals\n};\n","import {\n\tAnimationClip,\n\tBone,\n\tBox3,\n\tBufferAttribute,\n\tBufferGeometry,\n\tClampToEdgeWrapping,\n\tColor,\n\tColorManagement,\n\tDirectionalLight,\n\tDoubleSide,\n\tFileLoader,\n\tFrontSide,\n\tGroup,\n\tImageBitmapLoader,\n\tInstancedMesh,\n\tInterleavedBuffer,\n\tInterleavedBufferAttribute,\n\tInterpolant,\n\tInterpolateDiscrete,\n\tInterpolateLinear,\n\tLine,\n\tLineBasicMaterial,\n\tLineLoop,\n\tLineSegments,\n\tLinearFilter,\n\tLinearMipmapLinearFilter,\n\tLinearMipmapNearestFilter,\n\tLinearSRGBColorSpace,\n\tLoader,\n\tLoaderUtils,\n\tMaterial,\n\tMathUtils,\n\tMatrix4,\n\tMesh,\n\tMeshBasicMaterial,\n\tMeshPhysicalMaterial,\n\tMeshStandardMaterial,\n\tMirroredRepeatWrapping,\n\tNearestFilter,\n\tNearestMipmapLinearFilter,\n\tNearestMipmapNearestFilter,\n\tNumberKeyframeTrack,\n\tObject3D,\n\tOrthographicCamera,\n\tPerspectiveCamera,\n\tPointLight,\n\tPoints,\n\tPointsMaterial,\n\tPropertyBinding,\n\tQuaternion,\n\tQuaternionKeyframeTrack,\n\tRepeatWrapping,\n\tSkeleton,\n\tSkinnedMesh,\n\tSphere,\n\tSpotLight,\n\tTexture,\n\tTextureLoader,\n\tTriangleFanDrawMode,\n\tTriangleStripDrawMode,\n\tVector2,\n\tVector3,\n\tVectorKeyframeTrack,\n\tSRGBColorSpace,\n\tInstancedBufferAttribute\n} from 'three';\nimport { toTrianglesDrawMode } from '../utils/BufferGeometryUtils.js';\n\n/**\n * A loader for the glTF 2.0 format.\n *\n * [glTF](https://www.khronos.org/gltf/} (GL Transmission Format) is an [open format specification]{@link https://github.com/KhronosGroup/glTF/tree/main/specification/2.0)\n * for efficient delivery and loading of 3D content. Assets may be provided either in JSON (.gltf) or binary (.glb)\n * format. External files store textures (.jpg, .png) and additional binary data (.bin). A glTF asset may deliver\n * one or more scenes, including meshes, materials, textures, skins, skeletons, morph targets, animations, lights,\n * and/or cameras.\n *\n * `GLTFLoader` uses {@link ImageBitmapLoader} whenever possible. Be advised that image bitmaps are not\n * automatically GC-collected when they are no longer referenced, and they require special handling during\n * the disposal process.\n *\n * `GLTFLoader` supports the following glTF 2.0 extensions:\n * - KHR_draco_mesh_compression\n * - KHR_materials_clearcoat\n * - KHR_materials_dispersion\n * - KHR_materials_ior\n * - KHR_materials_specular\n * - KHR_materials_transmission\n * - KHR_materials_iridescence\n * - KHR_materials_unlit\n * - KHR_materials_volume\n * - KHR_mesh_quantization\n * - KHR_lights_punctual\n * - KHR_texture_basisu\n * - KHR_texture_transform\n * - EXT_texture_webp\n * - EXT_meshopt_compression\n * - EXT_mesh_gpu_instancing\n *\n * The following glTF 2.0 extension is supported by an external user plugin:\n * - [KHR_materials_variants](https://github.com/takahirox/three-gltf-extensions)\n * - [MSFT_texture_dds](https://github.com/takahirox/three-gltf-extensions)\n * - [KHR_animation_pointer](https://github.com/needle-tools/three-animation-pointer)\n * - [NEEDLE_progressive](https://github.com/needle-tools/gltf-progressive)\n *\n * ```js\n * const loader = new GLTFLoader();\n *\n * // Optional: Provide a DRACOLoader instance to decode compressed mesh data\n * const dracoLoader = new DRACOLoader();\n * dracoLoader.setDecoderPath( '/examples/jsm/libs/draco/' );\n * loader.setDRACOLoader( dracoLoader );\n *\n * const gltf = await loader.loadAsync( 'models/gltf/duck/duck.gltf' );\n * scene.add( gltf.scene );\n * ```\n *\n * @augments Loader\n * @three_import import { GLTFLoader } from 'three/addons/loaders/GLTFLoader.js';\n */\nclass GLTFLoader extends Loader {\n\n\t/**\n\t * Constructs a new glTF loader.\n\t *\n\t * @param {LoadingManager} [manager] - The loading manager.\n\t */\n\tconstructor( manager ) {\n\n\t\tsuper( manager );\n\n\t\tthis.dracoLoader = null;\n\t\tthis.ktx2Loader = null;\n\t\tthis.meshoptDecoder = null;\n\n\t\tthis.pluginCallbacks = [];\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsClearcoatExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsDispersionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureBasisUExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureWebPExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFTextureAVIFExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSheenExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsTransmissionExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsVolumeExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIorExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsEmissiveStrengthExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsSpecularExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsIridescenceExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsAnisotropyExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMaterialsBumpExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFLightsExtension( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshoptCompression( parser );\n\n\t\t} );\n\n\t\tthis.register( function ( parser ) {\n\n\t\t\treturn new GLTFMeshGpuInstancing( parser );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Starts loading from the given URL and passes the loaded glTF asset\n\t * to the `onLoad()` callback.\n\t *\n\t * @param {string} url - The path/URL of the file to be loaded. This can also be a data URI.\n\t * @param {function(GLTFLoader~LoadObject)} onLoad - Executed when the loading process has been finished.\n\t * @param {onProgressCallback} onProgress - Executed while the loading is in progress.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t */\n\tload( url, onLoad, onProgress, onError ) {\n\n\t\tconst scope = this;\n\n\t\tlet resourcePath;\n\n\t\tif ( this.resourcePath !== '' ) {\n\n\t\t\tresourcePath = this.resourcePath;\n\n\t\t} else if ( this.path !== '' ) {\n\n\t\t\t// If a base path is set, resources will be relative paths from that plus the relative path of the gltf file\n\t\t\t// Example  path = 'https://my-cnd-server.com/', url = 'assets/models/model.gltf'\n\t\t\t// resourcePath = 'https://my-cnd-server.com/assets/models/'\n\t\t\t// referenced resource 'model.bin' will be loaded from 'https://my-cnd-server.com/assets/models/model.bin'\n\t\t\t// referenced resource '../textures/texture.png' will be loaded from 'https://my-cnd-server.com/assets/textures/texture.png'\n\t\t\tconst relativeUrl = LoaderUtils.extractUrlBase( url );\n\t\t\tresourcePath = LoaderUtils.resolveURL( relativeUrl, this.path );\n\n\t\t} else {\n\n\t\t\tresourcePath = LoaderUtils.extractUrlBase( url );\n\n\t\t}\n\n\t\t// Tells the LoadingManager to track an extra item, which resolves after\n\t\t// the model is fully loaded. This means the count of items loaded will\n\t\t// be incorrect, but ensures manager.onLoad() does not fire early.\n\t\tthis.manager.itemStart( url );\n\n\t\tconst _onError = function ( e ) {\n\n\t\t\tif ( onError ) {\n\n\t\t\t\tonError( e );\n\n\t\t\t} else {\n\n\t\t\t\tconsole.error( e );\n\n\t\t\t}\n\n\t\t\tscope.manager.itemError( url );\n\t\t\tscope.manager.itemEnd( url );\n\n\t\t};\n\n\t\tconst loader = new FileLoader( this.manager );\n\n\t\tloader.setPath( this.path );\n\t\tloader.setResponseType( 'arraybuffer' );\n\t\tloader.setRequestHeader( this.requestHeader );\n\t\tloader.setWithCredentials( this.withCredentials );\n\n\t\tloader.load( url, function ( data ) {\n\n\t\t\ttry {\n\n\t\t\t\tscope.parse( data, resourcePath, function ( gltf ) {\n\n\t\t\t\t\tonLoad( gltf );\n\n\t\t\t\t\tscope.manager.itemEnd( url );\n\n\t\t\t\t}, _onError );\n\n\t\t\t} catch ( e ) {\n\n\t\t\t\t_onError( e );\n\n\t\t\t}\n\n\t\t}, onProgress, _onError );\n\n\t}\n\n\t/**\n\t * Sets the given Draco loader to this loader. Required for decoding assets\n\t * compressed with the `KHR_draco_mesh_compression` extension.\n\t *\n\t * @param {DRACOLoader} dracoLoader - The Draco loader to set.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tsetDRACOLoader( dracoLoader ) {\n\n\t\tthis.dracoLoader = dracoLoader;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Sets the given KTX2 loader to this loader. Required for loading KTX2\n\t * compressed textures.\n\t *\n\t * @param {KTX2Loader} ktx2Loader - The KTX2 loader to set.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tsetKTX2Loader( ktx2Loader ) {\n\n\t\tthis.ktx2Loader = ktx2Loader;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Sets the given meshopt decoder. Required for decoding assets\n\t * compressed with the `EXT_meshopt_compression` extension.\n\t *\n\t * @param {Object} meshoptDecoder - The meshopt decoder to set.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tsetMeshoptDecoder( meshoptDecoder ) {\n\n\t\tthis.meshoptDecoder = meshoptDecoder;\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Registers a plugin callback. This API is internally used to implement the various\n\t * glTF extensions but can also used by third-party code to add additional logic\n\t * to the loader.\n\t *\n\t * @param {function(parser:GLTFParser)} callback - The callback function to register.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) === - 1 ) {\n\n\t\t\tthis.pluginCallbacks.push( callback );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Unregisters a plugin callback.\n\t *\n\t * @param {Function} callback - The callback function to unregister.\n\t * @return {GLTFLoader} A reference to this loader.\n\t */\n\tunregister( callback ) {\n\n\t\tif ( this.pluginCallbacks.indexOf( callback ) !== - 1 ) {\n\n\t\t\tthis.pluginCallbacks.splice( this.pluginCallbacks.indexOf( callback ), 1 );\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t * Parses the given FBX data and returns the resulting group.\n\t *\n\t * @param {string|ArrayBuffer} data - The raw glTF data.\n\t * @param {string} path - The URL base path.\n\t * @param {function(GLTFLoader~LoadObject)} onLoad - Executed when the loading process has been finished.\n\t * @param {onErrorCallback} onError - Executed when errors occur.\n\t */\n\tparse( data, path, onLoad, onError ) {\n\n\t\tlet json;\n\t\tconst extensions = {};\n\t\tconst plugins = {};\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tif ( typeof data === 'string' ) {\n\n\t\t\tjson = JSON.parse( data );\n\n\t\t} else if ( data instanceof ArrayBuffer ) {\n\n\t\t\tconst magic = textDecoder.decode( new Uint8Array( data, 0, 4 ) );\n\n\t\t\tif ( magic === BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\t\ttry {\n\n\t\t\t\t\textensions[ EXTENSIONS.KHR_BINARY_GLTF ] = new GLTFBinaryExtension( data );\n\n\t\t\t\t} catch ( error ) {\n\n\t\t\t\t\tif ( onError ) onError( error );\n\t\t\t\t\treturn;\n\n\t\t\t\t}\n\n\t\t\t\tjson = JSON.parse( extensions[ EXTENSIONS.KHR_BINARY_GLTF ].content );\n\n\t\t\t} else {\n\n\t\t\t\tjson = JSON.parse( textDecoder.decode( data ) );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tjson = data;\n\n\t\t}\n\n\t\tif ( json.asset === undefined || json.asset.version[ 0 ] < 2 ) {\n\n\t\t\tif ( onError ) onError( new Error( 'THREE.GLTFLoader: Unsupported asset. glTF versions >=2.0 are supported.' ) );\n\t\t\treturn;\n\n\t\t}\n\n\t\tconst parser = new GLTFParser( json, {\n\n\t\t\tpath: path || this.resourcePath || '',\n\t\t\tcrossOrigin: this.crossOrigin,\n\t\t\trequestHeader: this.requestHeader,\n\t\t\tmanager: this.manager,\n\t\t\tktx2Loader: this.ktx2Loader,\n\t\t\tmeshoptDecoder: this.meshoptDecoder\n\n\t\t} );\n\n\t\tparser.fileLoader.setRequestHeader( this.requestHeader );\n\n\t\tfor ( let i = 0; i < this.pluginCallbacks.length; i ++ ) {\n\n\t\t\tconst plugin = this.pluginCallbacks[ i ]( parser );\n\n\t\t\tif ( ! plugin.name ) console.error( 'THREE.GLTFLoader: Invalid plugin found: missing name' );\n\n\t\t\tplugins[ plugin.name ] = plugin;\n\n\t\t\t// Workaround to avoid determining as unknown extension\n\t\t\t// in addUnknownExtensionsToUserData().\n\t\t\t// Remove this workaround if we move all the existing\n\t\t\t// extension handlers to plugin system\n\t\t\textensions[ plugin.name ] = true;\n\n\t\t}\n\n\t\tif ( json.extensionsUsed ) {\n\n\t\t\tfor ( let i = 0; i < json.extensionsUsed.length; ++ i ) {\n\n\t\t\t\tconst extensionName = json.extensionsUsed[ i ];\n\t\t\t\tconst extensionsRequired = json.extensionsRequired || [];\n\n\t\t\t\tswitch ( extensionName ) {\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MATERIALS_UNLIT:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMaterialsUnlitExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_DRACO_MESH_COMPRESSION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFDracoMeshCompressionExtension( json, this.dracoLoader );\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_TEXTURE_TRANSFORM:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFTextureTransformExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase EXTENSIONS.KHR_MESH_QUANTIZATION:\n\t\t\t\t\t\textensions[ extensionName ] = new GLTFMeshQuantizationExtension();\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\n\t\t\t\t\t\tif ( extensionsRequired.indexOf( extensionName ) >= 0 && plugins[ extensionName ] === undefined ) {\n\n\t\t\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Unknown extension \"' + extensionName + '\".' );\n\n\t\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\tparser.setExtensions( extensions );\n\t\tparser.setPlugins( plugins );\n\t\tparser.parse( onLoad, onError );\n\n\t}\n\n\t/**\n\t * Async version of {@link GLTFLoader#parse}.\n\t *\n\t * @async\n\t * @param {string|ArrayBuffer} data - The raw glTF data.\n\t * @param {string} path - The URL base path.\n\t * @return {Promise<GLTFLoader~LoadObject>} A Promise that resolves with the loaded glTF when the parsing has been finished.\n\t */\n\tparseAsync( data, path ) {\n\n\t\tconst scope = this;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tscope.parse( data, path, resolve, reject );\n\n\t\t} );\n\n\t}\n\n}\n\n/* GLTFREGISTRY */\n\nfunction GLTFRegistry() {\n\n\tlet objects = {};\n\n\treturn\t{\n\n\t\tget: function ( key ) {\n\n\t\t\treturn objects[ key ];\n\n\t\t},\n\n\t\tadd: function ( key, object ) {\n\n\t\t\tobjects[ key ] = object;\n\n\t\t},\n\n\t\tremove: function ( key ) {\n\n\t\t\tdelete objects[ key ];\n\n\t\t},\n\n\t\tremoveAll: function () {\n\n\t\t\tobjects = {};\n\n\t\t}\n\n\t};\n\n}\n\n/*********************************/\n/********** EXTENSIONS ***********/\n/*********************************/\n\nconst EXTENSIONS = {\n\tKHR_BINARY_GLTF: 'KHR_binary_glTF',\n\tKHR_DRACO_MESH_COMPRESSION: 'KHR_draco_mesh_compression',\n\tKHR_LIGHTS_PUNCTUAL: 'KHR_lights_punctual',\n\tKHR_MATERIALS_CLEARCOAT: 'KHR_materials_clearcoat',\n\tKHR_MATERIALS_DISPERSION: 'KHR_materials_dispersion',\n\tKHR_MATERIALS_IOR: 'KHR_materials_ior',\n\tKHR_MATERIALS_SHEEN: 'KHR_materials_sheen',\n\tKHR_MATERIALS_SPECULAR: 'KHR_materials_specular',\n\tKHR_MATERIALS_TRANSMISSION: 'KHR_materials_transmission',\n\tKHR_MATERIALS_IRIDESCENCE: 'KHR_materials_iridescence',\n\tKHR_MATERIALS_ANISOTROPY: 'KHR_materials_anisotropy',\n\tKHR_MATERIALS_UNLIT: 'KHR_materials_unlit',\n\tKHR_MATERIALS_VOLUME: 'KHR_materials_volume',\n\tKHR_TEXTURE_BASISU: 'KHR_texture_basisu',\n\tKHR_TEXTURE_TRANSFORM: 'KHR_texture_transform',\n\tKHR_MESH_QUANTIZATION: 'KHR_mesh_quantization',\n\tKHR_MATERIALS_EMISSIVE_STRENGTH: 'KHR_materials_emissive_strength',\n\tEXT_MATERIALS_BUMP: 'EXT_materials_bump',\n\tEXT_TEXTURE_WEBP: 'EXT_texture_webp',\n\tEXT_TEXTURE_AVIF: 'EXT_texture_avif',\n\tEXT_MESHOPT_COMPRESSION: 'EXT_meshopt_compression',\n\tEXT_MESH_GPU_INSTANCING: 'EXT_mesh_gpu_instancing'\n};\n\n/**\n * Punctual Lights Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_lights_punctual\n *\n * @private\n */\nclass GLTFLightsExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_LIGHTS_PUNCTUAL;\n\n\t\t// Object3D instance caches\n\t\tthis.cache = { refs: {}, uses: {} };\n\n\t}\n\n\t_markDefs() {\n\n\t\tconst parser = this.parser;\n\t\tconst nodeDefs = this.parser.json.nodes || [];\n\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.extensions\n\t\t\t\t\t&& nodeDef.extensions[ this.name ]\n\t\t\t\t\t&& nodeDef.extensions[ this.name ].light !== undefined ) {\n\n\t\t\t\tparser._addNodeRef( this.cache, nodeDef.extensions[ this.name ].light );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t_loadLight( lightIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst cacheKey = 'light:' + lightIndex;\n\t\tlet dependency = parser.cache.get( cacheKey );\n\n\t\tif ( dependency ) return dependency;\n\n\t\tconst json = parser.json;\n\t\tconst extensions = ( json.extensions && json.extensions[ this.name ] ) || {};\n\t\tconst lightDefs = extensions.lights || [];\n\t\tconst lightDef = lightDefs[ lightIndex ];\n\t\tlet lightNode;\n\n\t\tconst color = new Color( 0xffffff );\n\n\t\tif ( lightDef.color !== undefined ) color.setRGB( lightDef.color[ 0 ], lightDef.color[ 1 ], lightDef.color[ 2 ], LinearSRGBColorSpace );\n\n\t\tconst range = lightDef.range !== undefined ? lightDef.range : 0;\n\n\t\tswitch ( lightDef.type ) {\n\n\t\t\tcase 'directional':\n\t\t\t\tlightNode = new DirectionalLight( color );\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tcase 'point':\n\t\t\t\tlightNode = new PointLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\tbreak;\n\n\t\t\tcase 'spot':\n\t\t\t\tlightNode = new SpotLight( color );\n\t\t\t\tlightNode.distance = range;\n\t\t\t\t// Handle spotlight properties.\n\t\t\t\tlightDef.spot = lightDef.spot || {};\n\t\t\t\tlightDef.spot.innerConeAngle = lightDef.spot.innerConeAngle !== undefined ? lightDef.spot.innerConeAngle : 0;\n\t\t\t\tlightDef.spot.outerConeAngle = lightDef.spot.outerConeAngle !== undefined ? lightDef.spot.outerConeAngle : Math.PI / 4.0;\n\t\t\t\tlightNode.angle = lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.penumbra = 1.0 - lightDef.spot.innerConeAngle / lightDef.spot.outerConeAngle;\n\t\t\t\tlightNode.target.position.set( 0, 0, - 1 );\n\t\t\t\tlightNode.add( lightNode.target );\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Unexpected light type: ' + lightDef.type );\n\n\t\t}\n\n\t\t// Some lights (e.g. spot) default to a position other than the origin. Reset the position\n\t\t// here, because node-level parsing will only override position if explicitly specified.\n\t\tlightNode.position.set( 0, 0, 0 );\n\n\t\tassignExtrasToUserData( lightNode, lightDef );\n\n\t\tif ( lightDef.intensity !== undefined ) lightNode.intensity = lightDef.intensity;\n\n\t\tlightNode.name = parser.createUniqueName( lightDef.name || ( 'light_' + lightIndex ) );\n\n\t\tdependency = Promise.resolve( lightNode );\n\n\t\tparser.cache.add( cacheKey, dependency );\n\n\t\treturn dependency;\n\n\t}\n\n\tgetDependency( type, index ) {\n\n\t\tif ( type !== 'light' ) return;\n\n\t\treturn this._loadLight( index );\n\n\t}\n\n\tcreateNodeAttachment( nodeIndex ) {\n\n\t\tconst self = this;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\t\tconst lightDef = ( nodeDef.extensions && nodeDef.extensions[ this.name ] ) || {};\n\t\tconst lightIndex = lightDef.light;\n\n\t\tif ( lightIndex === undefined ) return null;\n\n\t\treturn this._loadLight( lightIndex ).then( function ( light ) {\n\n\t\t\treturn parser._getNodeRef( self.cache, lightIndex, light );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Unlit Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_unlit\n *\n * @private\n */\nclass GLTFMaterialsUnlitExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_UNLIT;\n\n\t}\n\n\tgetMaterialType() {\n\n\t\treturn MeshBasicMaterial;\n\n\t}\n\n\textendParams( materialParams, materialDef, parser ) {\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\tmaterialParams.opacity = 1.0;\n\n\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness;\n\n\t\tif ( metallicRoughness ) {\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Emissive Strength Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/blob/5768b3ce0ef32bc39cdf1bef10b948586635ead3/extensions/2.0/Khronos/KHR_materials_emissive_strength/README.md\n *\n * @private\n */\nclass GLTFMaterialsEmissiveStrengthExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_EMISSIVE_STRENGTH;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst emissiveStrength = materialDef.extensions[ this.name ].emissiveStrength;\n\n\t\tif ( emissiveStrength !== undefined ) {\n\n\t\t\tmaterialParams.emissiveIntensity = emissiveStrength;\n\n\t\t}\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Clearcoat Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_clearcoat\n *\n * @private\n */\nclass GLTFMaterialsClearcoatExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_CLEARCOAT;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.clearcoatFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoat = extension.clearcoatFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatMap', extension.clearcoatTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.clearcoatRoughness = extension.clearcoatRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.clearcoatRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatRoughnessMap', extension.clearcoatRoughnessTexture ) );\n\n\t\t}\n\n\t\tif ( extension.clearcoatNormalTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'clearcoatNormalMap', extension.clearcoatNormalTexture ) );\n\n\t\t\tif ( extension.clearcoatNormalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = extension.clearcoatNormalTexture.scale;\n\n\t\t\t\tmaterialParams.clearcoatNormalScale = new Vector2( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials dispersion Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_dispersion\n *\n * @private\n */\nclass GLTFMaterialsDispersionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_DISPERSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.dispersion = extension.dispersion !== undefined ? extension.dispersion : 0;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Iridescence Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_iridescence\n *\n * @private\n */\nclass GLTFMaterialsIridescenceExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IRIDESCENCE;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.iridescenceFactor !== undefined ) {\n\n\t\t\tmaterialParams.iridescence = extension.iridescenceFactor;\n\n\t\t}\n\n\t\tif ( extension.iridescenceTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceMap', extension.iridescenceTexture ) );\n\n\t\t}\n\n\t\tif ( extension.iridescenceIor !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceIOR = extension.iridescenceIor;\n\n\t\t}\n\n\t\tif ( materialParams.iridescenceThicknessRange === undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange = [ 100, 400 ];\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMinimum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 0 ] = extension.iridescenceThicknessMinimum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessMaximum !== undefined ) {\n\n\t\t\tmaterialParams.iridescenceThicknessRange[ 1 ] = extension.iridescenceThicknessMaximum;\n\n\t\t}\n\n\t\tif ( extension.iridescenceThicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'iridescenceThicknessMap', extension.iridescenceThicknessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Sheen Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/main/extensions/2.0/Khronos/KHR_materials_sheen\n *\n * @private\n */\nclass GLTFMaterialsSheenExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SHEEN;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tmaterialParams.sheenColor = new Color( 0, 0, 0 );\n\t\tmaterialParams.sheenRoughness = 0;\n\t\tmaterialParams.sheen = 1;\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.sheenColorFactor !== undefined ) {\n\n\t\t\tconst colorFactor = extension.sheenColorFactor;\n\t\t\tmaterialParams.sheenColor.setRGB( colorFactor[ 0 ], colorFactor[ 1 ], colorFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessFactor !== undefined ) {\n\n\t\t\tmaterialParams.sheenRoughness = extension.sheenRoughnessFactor;\n\n\t\t}\n\n\t\tif ( extension.sheenColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenColorMap', extension.sheenColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\tif ( extension.sheenRoughnessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'sheenRoughnessMap', extension.sheenRoughnessTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Transmission Materials Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_transmission\n * Draft: https://github.com/KhronosGroup/glTF/pull/1698\n *\n * @private\n */\nclass GLTFMaterialsTransmissionExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_TRANSMISSION;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.transmissionFactor !== undefined ) {\n\n\t\t\tmaterialParams.transmission = extension.transmissionFactor;\n\n\t\t}\n\n\t\tif ( extension.transmissionTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'transmissionMap', extension.transmissionTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials Volume Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_volume\n *\n * @private\n */\nclass GLTFMaterialsVolumeExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_VOLUME;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.thickness = extension.thicknessFactor !== undefined ? extension.thicknessFactor : 0;\n\n\t\tif ( extension.thicknessTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'thicknessMap', extension.thicknessTexture ) );\n\n\t\t}\n\n\t\tmaterialParams.attenuationDistance = extension.attenuationDistance || Infinity;\n\n\t\tconst colorArray = extension.attenuationColor || [ 1, 1, 1 ];\n\t\tmaterialParams.attenuationColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials ior Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_ior\n *\n * @private\n */\nclass GLTFMaterialsIorExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_IOR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.ior = extension.ior !== undefined ? extension.ior : 1.5;\n\n\t\treturn Promise.resolve();\n\n\t}\n\n}\n\n/**\n * Materials specular Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_specular\n *\n * @private\n */\nclass GLTFMaterialsSpecularExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_SPECULAR;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.specularIntensity = extension.specularFactor !== undefined ? extension.specularFactor : 1.0;\n\n\t\tif ( extension.specularTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularIntensityMap', extension.specularTexture ) );\n\n\t\t}\n\n\t\tconst colorArray = extension.specularColorFactor || [ 1, 1, 1 ];\n\t\tmaterialParams.specularColor = new Color().setRGB( colorArray[ 0 ], colorArray[ 1 ], colorArray[ 2 ], LinearSRGBColorSpace );\n\n\t\tif ( extension.specularColorTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'specularColorMap', extension.specularColorTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n\n/**\n * Materials bump Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/EXT_materials_bump\n *\n * @private\n */\nclass GLTFMaterialsBumpExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_MATERIALS_BUMP;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tmaterialParams.bumpScale = extension.bumpFactor !== undefined ? extension.bumpFactor : 1.0;\n\n\t\tif ( extension.bumpTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'bumpMap', extension.bumpTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * Materials anisotropy Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_materials_anisotropy\n *\n * @private\n */\nclass GLTFMaterialsAnisotropyExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_MATERIALS_ANISOTROPY;\n\n\t}\n\n\tgetMaterialType( materialIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) return null;\n\n\t\treturn MeshPhysicalMaterial;\n\n\t}\n\n\textendMaterialParams( materialIndex, materialParams ) {\n\n\t\tconst parser = this.parser;\n\t\tconst materialDef = parser.json.materials[ materialIndex ];\n\n\t\tif ( ! materialDef.extensions || ! materialDef.extensions[ this.name ] ) {\n\n\t\t\treturn Promise.resolve();\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tconst extension = materialDef.extensions[ this.name ];\n\n\t\tif ( extension.anisotropyStrength !== undefined ) {\n\n\t\t\tmaterialParams.anisotropy = extension.anisotropyStrength;\n\n\t\t}\n\n\t\tif ( extension.anisotropyRotation !== undefined ) {\n\n\t\t\tmaterialParams.anisotropyRotation = extension.anisotropyRotation;\n\n\t\t}\n\n\t\tif ( extension.anisotropyTexture !== undefined ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'anisotropyMap', extension.anisotropyTexture ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n}\n\n/**\n * BasisU Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_basisu\n *\n * @private\n */\nclass GLTFTextureBasisUExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_BASISU;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ this.name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ this.name ];\n\t\tconst loader = parser.options.ktx2Loader;\n\n\t\tif ( ! loader ) {\n\n\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setKTX2Loader must be called before loading KTX2 textures' );\n\n\t\t\t} else {\n\n\t\t\t\t// Assumes that the extension is optional and that a fallback texture is present\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * WebP Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_webp\n *\n * @private\n */\nclass GLTFTextureWebPExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_WEBP;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * AVIF Texture Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_texture_avif\n *\n * @private\n */\nclass GLTFTextureAVIFExtension {\n\n\tconstructor( parser ) {\n\n\t\tthis.parser = parser;\n\t\tthis.name = EXTENSIONS.EXT_TEXTURE_AVIF;\n\n\t}\n\n\tloadTexture( textureIndex ) {\n\n\t\tconst name = this.name;\n\t\tconst parser = this.parser;\n\t\tconst json = parser.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\n\t\tif ( ! textureDef.extensions || ! textureDef.extensions[ name ] ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst extension = textureDef.extensions[ name ];\n\t\tconst source = json.images[ extension.source ];\n\n\t\tlet loader = parser.textureLoader;\n\t\tif ( source.uri ) {\n\n\t\t\tconst handler = parser.options.manager.getHandler( source.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn parser.loadTextureImage( textureIndex, extension.source, loader );\n\n\t}\n\n}\n\n/**\n * meshopt BufferView Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_meshopt_compression\n *\n * @private\n */\nclass GLTFMeshoptCompression {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESHOPT_COMPRESSION;\n\t\tthis.parser = parser;\n\n\t}\n\n\tloadBufferView( index ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst bufferView = json.bufferViews[ index ];\n\n\t\tif ( bufferView.extensions && bufferView.extensions[ this.name ] ) {\n\n\t\t\tconst extensionDef = bufferView.extensions[ this.name ];\n\n\t\t\tconst buffer = this.parser.getDependency( 'buffer', extensionDef.buffer );\n\t\t\tconst decoder = this.parser.options.meshoptDecoder;\n\n\t\t\tif ( ! decoder || ! decoder.supported ) {\n\n\t\t\t\tif ( json.extensionsRequired && json.extensionsRequired.indexOf( this.name ) >= 0 ) {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: setMeshoptDecoder must be called before loading compressed files' );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Assumes that the extension is optional and that fallback buffer data is present\n\t\t\t\t\treturn null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn buffer.then( function ( res ) {\n\n\t\t\t\tconst byteOffset = extensionDef.byteOffset || 0;\n\t\t\t\tconst byteLength = extensionDef.byteLength || 0;\n\n\t\t\t\tconst count = extensionDef.count;\n\t\t\t\tconst stride = extensionDef.byteStride;\n\n\t\t\t\tconst source = new Uint8Array( res, byteOffset, byteLength );\n\n\t\t\t\tif ( decoder.decodeGltfBufferAsync ) {\n\n\t\t\t\t\treturn decoder.decodeGltfBufferAsync( count, stride, source, extensionDef.mode, extensionDef.filter ).then( function ( res ) {\n\n\t\t\t\t\t\treturn res.buffer;\n\n\t\t\t\t\t} );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Support for MeshoptDecoder 0.18 or earlier, without decodeGltfBufferAsync\n\t\t\t\t\treturn decoder.ready.then( function () {\n\n\t\t\t\t\t\tconst result = new ArrayBuffer( count * stride );\n\t\t\t\t\t\tdecoder.decodeGltfBuffer( new Uint8Array( result ), count, stride, source, extensionDef.mode, extensionDef.filter );\n\t\t\t\t\t\treturn result;\n\n\t\t\t\t\t} );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * GPU Instancing Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Vendor/EXT_mesh_gpu_instancing\n *\n * @private\n */\nclass GLTFMeshGpuInstancing {\n\n\tconstructor( parser ) {\n\n\t\tthis.name = EXTENSIONS.EXT_MESH_GPU_INSTANCING;\n\t\tthis.parser = parser;\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.parser.json;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( ! nodeDef.extensions || ! nodeDef.extensions[ this.name ] ||\n\t\t\tnodeDef.mesh === undefined ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tconst meshDef = json.meshes[ nodeDef.mesh ];\n\n\t\t// No Points or Lines + Instancing support yet\n\n\t\tfor ( const primitive of meshDef.primitives ) {\n\n\t\t\tif ( primitive.mode !== WEBGL_CONSTANTS.TRIANGLES &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_STRIP &&\n\t\t\t\t primitive.mode !== WEBGL_CONSTANTS.TRIANGLE_FAN &&\n\t\t\t\t primitive.mode !== undefined ) {\n\n\t\t\t\treturn null;\n\n\t\t\t}\n\n\t\t}\n\n\t\tconst extensionDef = nodeDef.extensions[ this.name ];\n\t\tconst attributesDef = extensionDef.attributes;\n\n\t\t// @TODO: Can we support InstancedMesh + SkinnedMesh?\n\n\t\tconst pending = [];\n\t\tconst attributes = {};\n\n\t\tfor ( const key in attributesDef ) {\n\n\t\t\tpending.push( this.parser.getDependency( 'accessor', attributesDef[ key ] ).then( accessor => {\n\n\t\t\t\tattributes[ key ] = accessor;\n\t\t\t\treturn attributes[ key ];\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tif ( pending.length < 1 ) {\n\n\t\t\treturn null;\n\n\t\t}\n\n\t\tpending.push( this.parser.createNodeMesh( nodeIndex ) );\n\n\t\treturn Promise.all( pending ).then( results => {\n\n\t\t\tconst nodeObject = results.pop();\n\t\t\tconst meshes = nodeObject.isGroup ? nodeObject.children : [ nodeObject ];\n\t\t\tconst count = results[ 0 ].count; // All attribute counts should be same\n\t\t\tconst instancedMeshes = [];\n\n\t\t\tfor ( const mesh of meshes ) {\n\n\t\t\t\t// Temporal variables\n\t\t\t\tconst m = new Matrix4();\n\t\t\t\tconst p = new Vector3();\n\t\t\t\tconst q = new Quaternion();\n\t\t\t\tconst s = new Vector3( 1, 1, 1 );\n\n\t\t\t\tconst instancedMesh = new InstancedMesh( mesh.geometry, mesh.material, count );\n\n\t\t\t\tfor ( let i = 0; i < count; i ++ ) {\n\n\t\t\t\t\tif ( attributes.TRANSLATION ) {\n\n\t\t\t\t\t\tp.fromBufferAttribute( attributes.TRANSLATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.ROTATION ) {\n\n\t\t\t\t\t\tq.fromBufferAttribute( attributes.ROTATION, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( attributes.SCALE ) {\n\n\t\t\t\t\t\ts.fromBufferAttribute( attributes.SCALE, i );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tinstancedMesh.setMatrixAt( i, m.compose( p, q, s ) );\n\n\t\t\t\t}\n\n\t\t\t\t// Add instance attributes to the geometry, excluding TRS.\n\t\t\t\tfor ( const attributeName in attributes ) {\n\n\t\t\t\t\tif ( attributeName === '_COLOR_0' ) {\n\n\t\t\t\t\t\tconst attr = attributes[ attributeName ];\n\t\t\t\t\t\tinstancedMesh.instanceColor = new InstancedBufferAttribute( attr.array, attr.itemSize, attr.normalized );\n\n\t\t\t\t\t} else if ( attributeName !== 'TRANSLATION' &&\n\t\t\t\t\t\t attributeName !== 'ROTATION' &&\n\t\t\t\t\t\t attributeName !== 'SCALE' ) {\n\n\t\t\t\t\t\tmesh.geometry.setAttribute( attributeName, attributes[ attributeName ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\t// Just in case\n\t\t\t\tObject3D.prototype.copy.call( instancedMesh, mesh );\n\n\t\t\t\tthis.parser.assignFinalMaterial( instancedMesh );\n\n\t\t\t\tinstancedMeshes.push( instancedMesh );\n\n\t\t\t}\n\n\t\t\tif ( nodeObject.isGroup ) {\n\n\t\t\t\tnodeObject.clear();\n\n\t\t\t\tnodeObject.add( ... instancedMeshes );\n\n\t\t\t\treturn nodeObject;\n\n\t\t\t}\n\n\t\t\treturn instancedMeshes[ 0 ];\n\n\t\t} );\n\n\t}\n\n}\n\n/* BINARY EXTENSION */\nconst BINARY_EXTENSION_HEADER_MAGIC = 'glTF';\nconst BINARY_EXTENSION_HEADER_LENGTH = 12;\nconst BINARY_EXTENSION_CHUNK_TYPES = { JSON: 0x4E4F534A, BIN: 0x004E4942 };\n\nclass GLTFBinaryExtension {\n\n\tconstructor( data ) {\n\n\t\tthis.name = EXTENSIONS.KHR_BINARY_GLTF;\n\t\tthis.content = null;\n\t\tthis.body = null;\n\n\t\tconst headerView = new DataView( data, 0, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tconst textDecoder = new TextDecoder();\n\n\t\tthis.header = {\n\t\t\tmagic: textDecoder.decode( new Uint8Array( data.slice( 0, 4 ) ) ),\n\t\t\tversion: headerView.getUint32( 4, true ),\n\t\t\tlength: headerView.getUint32( 8, true )\n\t\t};\n\n\t\tif ( this.header.magic !== BINARY_EXTENSION_HEADER_MAGIC ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported glTF-Binary header.' );\n\n\t\t} else if ( this.header.version < 2.0 ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Legacy binary file detected.' );\n\n\t\t}\n\n\t\tconst chunkContentsLength = this.header.length - BINARY_EXTENSION_HEADER_LENGTH;\n\t\tconst chunkView = new DataView( data, BINARY_EXTENSION_HEADER_LENGTH );\n\t\tlet chunkIndex = 0;\n\n\t\twhile ( chunkIndex < chunkContentsLength ) {\n\n\t\t\tconst chunkLength = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tconst chunkType = chunkView.getUint32( chunkIndex, true );\n\t\t\tchunkIndex += 4;\n\n\t\t\tif ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.JSON ) {\n\n\t\t\t\tconst contentArray = new Uint8Array( data, BINARY_EXTENSION_HEADER_LENGTH + chunkIndex, chunkLength );\n\t\t\t\tthis.content = textDecoder.decode( contentArray );\n\n\t\t\t} else if ( chunkType === BINARY_EXTENSION_CHUNK_TYPES.BIN ) {\n\n\t\t\t\tconst byteOffset = BINARY_EXTENSION_HEADER_LENGTH + chunkIndex;\n\t\t\t\tthis.body = data.slice( byteOffset, byteOffset + chunkLength );\n\n\t\t\t}\n\n\t\t\t// Clients must ignore chunks with unknown types.\n\n\t\t\tchunkIndex += chunkLength;\n\n\t\t}\n\n\t\tif ( this.content === null ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: JSON content not found.' );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * DRACO Mesh Compression Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_draco_mesh_compression\n *\n * @private\n */\nclass GLTFDracoMeshCompressionExtension {\n\n\tconstructor( json, dracoLoader ) {\n\n\t\tif ( ! dracoLoader ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: No DRACOLoader instance provided.' );\n\n\t\t}\n\n\t\tthis.name = EXTENSIONS.KHR_DRACO_MESH_COMPRESSION;\n\t\tthis.json = json;\n\t\tthis.dracoLoader = dracoLoader;\n\t\tthis.dracoLoader.preload();\n\n\t}\n\n\tdecodePrimitive( primitive, parser ) {\n\n\t\tconst json = this.json;\n\t\tconst dracoLoader = this.dracoLoader;\n\t\tconst bufferViewIndex = primitive.extensions[ this.name ].bufferView;\n\t\tconst gltfAttributeMap = primitive.extensions[ this.name ].attributes;\n\t\tconst threeAttributeMap = {};\n\t\tconst attributeNormalizedMap = {};\n\t\tconst attributeTypeMap = {};\n\n\t\tfor ( const attributeName in gltfAttributeMap ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tthreeAttributeMap[ threeAttributeName ] = gltfAttributeMap[ attributeName ];\n\n\t\t}\n\n\t\tfor ( const attributeName in primitive.attributes ) {\n\n\t\t\tconst threeAttributeName = ATTRIBUTES[ attributeName ] || attributeName.toLowerCase();\n\n\t\t\tif ( gltfAttributeMap[ attributeName ] !== undefined ) {\n\n\t\t\t\tconst accessorDef = json.accessors[ primitive.attributes[ attributeName ] ];\n\t\t\t\tconst componentType = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t\tattributeTypeMap[ threeAttributeName ] = componentType.name;\n\t\t\t\tattributeNormalizedMap[ threeAttributeName ] = accessorDef.normalized === true;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn parser.getDependency( 'bufferView', bufferViewIndex ).then( function ( bufferView ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tdracoLoader.decodeDracoFile( bufferView, function ( geometry ) {\n\n\t\t\t\t\tfor ( const attributeName in geometry.attributes ) {\n\n\t\t\t\t\t\tconst attribute = geometry.attributes[ attributeName ];\n\t\t\t\t\t\tconst normalized = attributeNormalizedMap[ attributeName ];\n\n\t\t\t\t\t\tif ( normalized !== undefined ) attribute.normalized = normalized;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tresolve( geometry );\n\n\t\t\t\t}, threeAttributeMap, attributeTypeMap, LinearSRGBColorSpace, reject );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n}\n\n/**\n * Texture Transform Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_texture_transform\n *\n * @private\n */\nclass GLTFTextureTransformExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_TEXTURE_TRANSFORM;\n\n\t}\n\n\textendTexture( texture, transform ) {\n\n\t\tif ( ( transform.texCoord === undefined || transform.texCoord === texture.channel )\n\t\t\t&& transform.offset === undefined\n\t\t\t&& transform.rotation === undefined\n\t\t\t&& transform.scale === undefined ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21819.\n\t\t\treturn texture;\n\n\t\t}\n\n\t\ttexture = texture.clone();\n\n\t\tif ( transform.texCoord !== undefined ) {\n\n\t\t\ttexture.channel = transform.texCoord;\n\n\t\t}\n\n\t\tif ( transform.offset !== undefined ) {\n\n\t\t\ttexture.offset.fromArray( transform.offset );\n\n\t\t}\n\n\t\tif ( transform.rotation !== undefined ) {\n\n\t\t\ttexture.rotation = transform.rotation;\n\n\t\t}\n\n\t\tif ( transform.scale !== undefined ) {\n\n\t\t\ttexture.repeat.fromArray( transform.scale );\n\n\t\t}\n\n\t\ttexture.needsUpdate = true;\n\n\t\treturn texture;\n\n\t}\n\n}\n\n/**\n * Mesh Quantization Extension\n *\n * Specification: https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization\n *\n * @private\n */\nclass GLTFMeshQuantizationExtension {\n\n\tconstructor() {\n\n\t\tthis.name = EXTENSIONS.KHR_MESH_QUANTIZATION;\n\n\t}\n\n}\n\n/*********************************/\n/********** INTERPOLATION ********/\n/*********************************/\n\n// Spline Interpolation\n// Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#appendix-c-spline-interpolation\nclass GLTFCubicSplineInterpolant extends Interpolant {\n\n\tconstructor( parameterPositions, sampleValues, sampleSize, resultBuffer ) {\n\n\t\tsuper( parameterPositions, sampleValues, sampleSize, resultBuffer );\n\n\t}\n\n\tcopySampleValue_( index ) {\n\n\t\t// Copies a sample value to the result buffer. See description of glTF\n\t\t// CUBICSPLINE values layout in interpolate_() function below.\n\n\t\tconst result = this.resultBuffer,\n\t\t\tvalues = this.sampleValues,\n\t\t\tvalueSize = this.valueSize,\n\t\t\toffset = index * valueSize * 3 + valueSize;\n\n\t\tfor ( let i = 0; i !== valueSize; i ++ ) {\n\n\t\t\tresult[ i ] = values[ offset + i ];\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = this.resultBuffer;\n\t\tconst values = this.sampleValues;\n\t\tconst stride = this.valueSize;\n\n\t\tconst stride2 = stride * 2;\n\t\tconst stride3 = stride * 3;\n\n\t\tconst td = t1 - t0;\n\n\t\tconst p = ( t - t0 ) / td;\n\t\tconst pp = p * p;\n\t\tconst ppp = pp * p;\n\n\t\tconst offset1 = i1 * stride3;\n\t\tconst offset0 = offset1 - stride3;\n\n\t\tconst s2 = - 2 * ppp + 3 * pp;\n\t\tconst s3 = ppp - pp;\n\t\tconst s0 = 1 - s2;\n\t\tconst s1 = s3 - pp + p;\n\n\t\t// Layout of keyframe output values for CUBICSPLINE animations:\n\t\t//   [ inTangent_1, splineVertex_1, outTangent_1, inTangent_2, splineVertex_2, ... ]\n\t\tfor ( let i = 0; i !== stride; i ++ ) {\n\n\t\t\tconst p0 = values[ offset0 + i + stride ]; // splineVertex_k\n\t\t\tconst m0 = values[ offset0 + i + stride2 ] * td; // outTangent_k * (t_k+1 - t_k)\n\t\t\tconst p1 = values[ offset1 + i + stride ]; // splineVertex_k+1\n\t\t\tconst m1 = values[ offset1 + i ] * td; // inTangent_k+1 * (t_k+1 - t_k)\n\n\t\t\tresult[ i ] = s0 * p0 + s1 * m0 + s2 * p1 + s3 * m1;\n\n\t\t}\n\n\t\treturn result;\n\n\t}\n\n}\n\nconst _quaternion = new Quaternion();\n\nclass GLTFCubicSplineQuaternionInterpolant extends GLTFCubicSplineInterpolant {\n\n\tinterpolate_( i1, t0, t, t1 ) {\n\n\t\tconst result = super.interpolate_( i1, t0, t, t1 );\n\n\t\t_quaternion.fromArray( result ).normalize().toArray( result );\n\n\t\treturn result;\n\n\t}\n\n}\n\n\n/*********************************/\n/********** INTERNALS ************/\n/*********************************/\n\n/* CONSTANTS */\n\nconst WEBGL_CONSTANTS = {\n\tFLOAT: 5126,\n\t//FLOAT_MAT2: 35674,\n\tFLOAT_MAT3: 35675,\n\tFLOAT_MAT4: 35676,\n\tFLOAT_VEC2: 35664,\n\tFLOAT_VEC3: 35665,\n\tFLOAT_VEC4: 35666,\n\tLINEAR: 9729,\n\tREPEAT: 10497,\n\tSAMPLER_2D: 35678,\n\tPOINTS: 0,\n\tLINES: 1,\n\tLINE_LOOP: 2,\n\tLINE_STRIP: 3,\n\tTRIANGLES: 4,\n\tTRIANGLE_STRIP: 5,\n\tTRIANGLE_FAN: 6,\n\tUNSIGNED_BYTE: 5121,\n\tUNSIGNED_SHORT: 5123\n};\n\nconst WEBGL_COMPONENT_TYPES = {\n\t5120: Int8Array,\n\t5121: Uint8Array,\n\t5122: Int16Array,\n\t5123: Uint16Array,\n\t5125: Uint32Array,\n\t5126: Float32Array\n};\n\nconst WEBGL_FILTERS = {\n\t9728: NearestFilter,\n\t9729: LinearFilter,\n\t9984: NearestMipmapNearestFilter,\n\t9985: LinearMipmapNearestFilter,\n\t9986: NearestMipmapLinearFilter,\n\t9987: LinearMipmapLinearFilter\n};\n\nconst WEBGL_WRAPPINGS = {\n\t33071: ClampToEdgeWrapping,\n\t33648: MirroredRepeatWrapping,\n\t10497: RepeatWrapping\n};\n\nconst WEBGL_TYPE_SIZES = {\n\t'SCALAR': 1,\n\t'VEC2': 2,\n\t'VEC3': 3,\n\t'VEC4': 4,\n\t'MAT2': 4,\n\t'MAT3': 9,\n\t'MAT4': 16\n};\n\nconst ATTRIBUTES = {\n\tPOSITION: 'position',\n\tNORMAL: 'normal',\n\tTANGENT: 'tangent',\n\tTEXCOORD_0: 'uv',\n\tTEXCOORD_1: 'uv1',\n\tTEXCOORD_2: 'uv2',\n\tTEXCOORD_3: 'uv3',\n\tCOLOR_0: 'color',\n\tWEIGHTS_0: 'skinWeight',\n\tJOINTS_0: 'skinIndex',\n};\n\nconst PATH_PROPERTIES = {\n\tscale: 'scale',\n\ttranslation: 'position',\n\trotation: 'quaternion',\n\tweights: 'morphTargetInfluences'\n};\n\nconst INTERPOLATION = {\n\tCUBICSPLINE: undefined, // We use a custom interpolant (GLTFCubicSplineInterpolation) for CUBICSPLINE tracks. Each\n\t\t                        // keyframe track will be initialized with a default interpolation type, then modified.\n\tLINEAR: InterpolateLinear,\n\tSTEP: InterpolateDiscrete\n};\n\nconst ALPHA_MODES = {\n\tOPAQUE: 'OPAQUE',\n\tMASK: 'MASK',\n\tBLEND: 'BLEND'\n};\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#default-material\n *\n * @private\n * @param {Object<string, Material>} cache\n * @return {Material}\n */\nfunction createDefaultMaterial( cache ) {\n\n\tif ( cache[ 'DefaultMaterial' ] === undefined ) {\n\n\t\tcache[ 'DefaultMaterial' ] = new MeshStandardMaterial( {\n\t\t\tcolor: 0xFFFFFF,\n\t\t\temissive: 0x000000,\n\t\t\tmetalness: 1,\n\t\t\troughness: 1,\n\t\t\ttransparent: false,\n\t\t\tdepthTest: true,\n\t\t\tside: FrontSide\n\t\t} );\n\n\t}\n\n\treturn cache[ 'DefaultMaterial' ];\n\n}\n\nfunction addUnknownExtensionsToUserData( knownExtensions, object, objectDef ) {\n\n\t// Add unknown glTF extensions to an object's userData.\n\n\tfor ( const name in objectDef.extensions ) {\n\n\t\tif ( knownExtensions[ name ] === undefined ) {\n\n\t\t\tobject.userData.gltfExtensions = object.userData.gltfExtensions || {};\n\t\t\tobject.userData.gltfExtensions[ name ] = objectDef.extensions[ name ];\n\n\t\t}\n\n\t}\n\n}\n\n/**\n *\n * @private\n * @param {Object3D|Material|BufferGeometry|Object|AnimationClip} object\n * @param {GLTF.definition} gltfDef\n */\nfunction assignExtrasToUserData( object, gltfDef ) {\n\n\tif ( gltfDef.extras !== undefined ) {\n\n\t\tif ( typeof gltfDef.extras === 'object' ) {\n\n\t\t\tObject.assign( object.userData, gltfDef.extras );\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Ignoring primitive type .extras, ' + gltfDef.extras );\n\n\t\t}\n\n\t}\n\n}\n\n/**\n * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#morph-targets\n *\n * @private\n * @param {BufferGeometry} geometry\n * @param {Array<GLTF.Target>} targets\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addMorphTargets( geometry, targets, parser ) {\n\n\tlet hasMorphPosition = false;\n\tlet hasMorphNormal = false;\n\tlet hasMorphColor = false;\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( target.POSITION !== undefined ) hasMorphPosition = true;\n\t\tif ( target.NORMAL !== undefined ) hasMorphNormal = true;\n\t\tif ( target.COLOR_0 !== undefined ) hasMorphColor = true;\n\n\t\tif ( hasMorphPosition && hasMorphNormal && hasMorphColor ) break;\n\n\t}\n\n\tif ( ! hasMorphPosition && ! hasMorphNormal && ! hasMorphColor ) return Promise.resolve( geometry );\n\n\tconst pendingPositionAccessors = [];\n\tconst pendingNormalAccessors = [];\n\tconst pendingColorAccessors = [];\n\n\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\tconst target = targets[ i ];\n\n\t\tif ( hasMorphPosition ) {\n\n\t\t\tconst pendingAccessor = target.POSITION !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.POSITION )\n\t\t\t\t: geometry.attributes.position;\n\n\t\t\tpendingPositionAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphNormal ) {\n\n\t\t\tconst pendingAccessor = target.NORMAL !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.NORMAL )\n\t\t\t\t: geometry.attributes.normal;\n\n\t\t\tpendingNormalAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t\tif ( hasMorphColor ) {\n\n\t\t\tconst pendingAccessor = target.COLOR_0 !== undefined\n\t\t\t\t? parser.getDependency( 'accessor', target.COLOR_0 )\n\t\t\t\t: geometry.attributes.color;\n\n\t\t\tpendingColorAccessors.push( pendingAccessor );\n\n\t\t}\n\n\t}\n\n\treturn Promise.all( [\n\t\tPromise.all( pendingPositionAccessors ),\n\t\tPromise.all( pendingNormalAccessors ),\n\t\tPromise.all( pendingColorAccessors )\n\t] ).then( function ( accessors ) {\n\n\t\tconst morphPositions = accessors[ 0 ];\n\t\tconst morphNormals = accessors[ 1 ];\n\t\tconst morphColors = accessors[ 2 ];\n\n\t\tif ( hasMorphPosition ) geometry.morphAttributes.position = morphPositions;\n\t\tif ( hasMorphNormal ) geometry.morphAttributes.normal = morphNormals;\n\t\tif ( hasMorphColor ) geometry.morphAttributes.color = morphColors;\n\t\tgeometry.morphTargetsRelative = true;\n\n\t\treturn geometry;\n\n\t} );\n\n}\n\n/**\n *\n * @private\n * @param {Mesh} mesh\n * @param {GLTF.Mesh} meshDef\n */\nfunction updateMorphTargets( mesh, meshDef ) {\n\n\tmesh.updateMorphTargets();\n\n\tif ( meshDef.weights !== undefined ) {\n\n\t\tfor ( let i = 0, il = meshDef.weights.length; i < il; i ++ ) {\n\n\t\t\tmesh.morphTargetInfluences[ i ] = meshDef.weights[ i ];\n\n\t\t}\n\n\t}\n\n\t// .extras has user-defined data, so check that .extras.targetNames is an array.\n\tif ( meshDef.extras && Array.isArray( meshDef.extras.targetNames ) ) {\n\n\t\tconst targetNames = meshDef.extras.targetNames;\n\n\t\tif ( mesh.morphTargetInfluences.length === targetNames.length ) {\n\n\t\t\tmesh.morphTargetDictionary = {};\n\n\t\t\tfor ( let i = 0, il = targetNames.length; i < il; i ++ ) {\n\n\t\t\t\tmesh.morphTargetDictionary[ targetNames[ i ] ] = i;\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Invalid extras.targetNames length. Ignoring names.' );\n\n\t\t}\n\n\t}\n\n}\n\nfunction createPrimitiveKey( primitiveDef ) {\n\n\tlet geometryKey;\n\n\tconst dracoExtension = primitiveDef.extensions && primitiveDef.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ];\n\n\tif ( dracoExtension ) {\n\n\t\tgeometryKey = 'draco:' + dracoExtension.bufferView\n\t\t\t\t+ ':' + dracoExtension.indices\n\t\t\t\t+ ':' + createAttributesKey( dracoExtension.attributes );\n\n\t} else {\n\n\t\tgeometryKey = primitiveDef.indices + ':' + createAttributesKey( primitiveDef.attributes ) + ':' + primitiveDef.mode;\n\n\t}\n\n\tif ( primitiveDef.targets !== undefined ) {\n\n\t\tfor ( let i = 0, il = primitiveDef.targets.length; i < il; i ++ ) {\n\n\t\t\tgeometryKey += ':' + createAttributesKey( primitiveDef.targets[ i ] );\n\n\t\t}\n\n\t}\n\n\treturn geometryKey;\n\n}\n\nfunction createAttributesKey( attributes ) {\n\n\tlet attributesKey = '';\n\n\tconst keys = Object.keys( attributes ).sort();\n\n\tfor ( let i = 0, il = keys.length; i < il; i ++ ) {\n\n\t\tattributesKey += keys[ i ] + ':' + attributes[ keys[ i ] ] + ';';\n\n\t}\n\n\treturn attributesKey;\n\n}\n\nfunction getNormalizedComponentScale( constructor ) {\n\n\t// Reference:\n\t// https://github.com/KhronosGroup/glTF/tree/master/extensions/2.0/Khronos/KHR_mesh_quantization#encoding-quantized-data\n\n\tswitch ( constructor ) {\n\n\t\tcase Int8Array:\n\t\t\treturn 1 / 127;\n\n\t\tcase Uint8Array:\n\t\t\treturn 1 / 255;\n\n\t\tcase Int16Array:\n\t\t\treturn 1 / 32767;\n\n\t\tcase Uint16Array:\n\t\t\treturn 1 / 65535;\n\n\t\tdefault:\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Unsupported normalized accessor component type.' );\n\n\t}\n\n}\n\nfunction getImageURIMimeType( uri ) {\n\n\tif ( uri.search( /\\.jpe?g($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/jpeg/ ) === 0 ) return 'image/jpeg';\n\tif ( uri.search( /\\.webp($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/webp/ ) === 0 ) return 'image/webp';\n\tif ( uri.search( /\\.ktx2($|\\?)/i ) > 0 || uri.search( /^data\\:image\\/ktx2/ ) === 0 ) return 'image/ktx2';\n\n\treturn 'image/png';\n\n}\n\nconst _identityMatrix = new Matrix4();\n\n/* GLTF PARSER */\n\nclass GLTFParser {\n\n\tconstructor( json = {}, options = {} ) {\n\n\t\tthis.json = json;\n\t\tthis.extensions = {};\n\t\tthis.plugins = {};\n\t\tthis.options = options;\n\n\t\t// loader object cache\n\t\tthis.cache = new GLTFRegistry();\n\n\t\t// associations between Three.js objects and glTF elements\n\t\tthis.associations = new Map();\n\n\t\t// BufferGeometry caching\n\t\tthis.primitiveCache = {};\n\n\t\t// Node cache\n\t\tthis.nodeCache = {};\n\n\t\t// Object3D instance caches\n\t\tthis.meshCache = { refs: {}, uses: {} };\n\t\tthis.cameraCache = { refs: {}, uses: {} };\n\t\tthis.lightCache = { refs: {}, uses: {} };\n\n\t\tthis.sourceCache = {};\n\t\tthis.textureCache = {};\n\n\t\t// Track node names, to ensure no duplicates\n\t\tthis.nodeNamesUsed = {};\n\n\t\t// Use an ImageBitmapLoader if imageBitmaps are supported. Moves much of the\n\t\t// expensive work of uploading a texture to the GPU off the main thread.\n\n\t\tlet isSafari = false;\n\t\tlet safariVersion = - 1;\n\t\tlet isFirefox = false;\n\t\tlet firefoxVersion = - 1;\n\n\t\tif ( typeof navigator !== 'undefined' ) {\n\n\t\t\tconst userAgent = navigator.userAgent;\n\n\t\t\tisSafari = /^((?!chrome|android).)*safari/i.test( userAgent ) === true;\n\t\t\tconst safariMatch = userAgent.match( /Version\\/(\\d+)/ );\n\t\t\tsafariVersion = isSafari && safariMatch ? parseInt( safariMatch[ 1 ], 10 ) : - 1;\n\n\t\t\tisFirefox = userAgent.indexOf( 'Firefox' ) > - 1;\n\t\t\tfirefoxVersion = isFirefox ? userAgent.match( /Firefox\\/([0-9]+)\\./ )[ 1 ] : - 1;\n\n\t\t}\n\n\t\tif ( typeof createImageBitmap === 'undefined' || ( isSafari && safariVersion < 17 ) || ( isFirefox && firefoxVersion < 98 ) ) {\n\n\t\t\tthis.textureLoader = new TextureLoader( this.options.manager );\n\n\t\t} else {\n\n\t\t\tthis.textureLoader = new ImageBitmapLoader( this.options.manager );\n\n\t\t}\n\n\t\tthis.textureLoader.setCrossOrigin( this.options.crossOrigin );\n\t\tthis.textureLoader.setRequestHeader( this.options.requestHeader );\n\n\t\tthis.fileLoader = new FileLoader( this.options.manager );\n\t\tthis.fileLoader.setResponseType( 'arraybuffer' );\n\n\t\tif ( this.options.crossOrigin === 'use-credentials' ) {\n\n\t\t\tthis.fileLoader.setWithCredentials( true );\n\n\t\t}\n\n\t}\n\n\tsetExtensions( extensions ) {\n\n\t\tthis.extensions = extensions;\n\n\t}\n\n\tsetPlugins( plugins ) {\n\n\t\tthis.plugins = plugins;\n\n\t}\n\n\tparse( onLoad, onError ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\t// Clear the loader cache\n\t\tthis.cache.removeAll();\n\t\tthis.nodeCache = {};\n\n\t\t// Mark the special nodes/meshes in json for efficient parse\n\t\tthis._invokeAll( function ( ext ) {\n\n\t\t\treturn ext._markDefs && ext._markDefs();\n\n\t\t} );\n\n\t\tPromise.all( this._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.beforeRoot && ext.beforeRoot();\n\n\t\t} ) ).then( function () {\n\n\t\t\treturn Promise.all( [\n\n\t\t\t\tparser.getDependencies( 'scene' ),\n\t\t\t\tparser.getDependencies( 'animation' ),\n\t\t\t\tparser.getDependencies( 'camera' ),\n\n\t\t\t] );\n\n\t\t} ).then( function ( dependencies ) {\n\n\t\t\tconst result = {\n\t\t\t\tscene: dependencies[ 0 ][ json.scene || 0 ],\n\t\t\t\tscenes: dependencies[ 0 ],\n\t\t\t\tanimations: dependencies[ 1 ],\n\t\t\t\tcameras: dependencies[ 2 ],\n\t\t\t\tasset: json.asset,\n\t\t\t\tparser: parser,\n\t\t\t\tuserData: {}\n\t\t\t};\n\n\t\t\taddUnknownExtensionsToUserData( extensions, result, json );\n\n\t\t\tassignExtrasToUserData( result, json );\n\n\t\t\treturn Promise.all( parser._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.afterRoot && ext.afterRoot( result );\n\n\t\t\t} ) ).then( function () {\n\n\t\t\t\tfor ( const scene of result.scenes ) {\n\n\t\t\t\t\tscene.updateMatrixWorld();\n\n\t\t\t\t}\n\n\t\t\t\tonLoad( result );\n\n\t\t\t} );\n\n\t\t} ).catch( onError );\n\n\t}\n\n\t/**\n\t * Marks the special nodes/meshes in json for efficient parse.\n\t *\n\t * @private\n\t */\n\t_markDefs() {\n\n\t\tconst nodeDefs = this.json.nodes || [];\n\t\tconst skinDefs = this.json.skins || [];\n\t\tconst meshDefs = this.json.meshes || [];\n\n\t\t// Nothing in the node definition indicates whether it is a Bone or an\n\t\t// Object3D. Use the skins' joint references to mark bones.\n\t\tfor ( let skinIndex = 0, skinLength = skinDefs.length; skinIndex < skinLength; skinIndex ++ ) {\n\n\t\t\tconst joints = skinDefs[ skinIndex ].joints;\n\n\t\t\tfor ( let i = 0, il = joints.length; i < il; i ++ ) {\n\n\t\t\t\tnodeDefs[ joints[ i ] ].isBone = true;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// Iterate over all nodes, marking references to shared resources,\n\t\t// as well as skeleton joints.\n\t\tfor ( let nodeIndex = 0, nodeLength = nodeDefs.length; nodeIndex < nodeLength; nodeIndex ++ ) {\n\n\t\t\tconst nodeDef = nodeDefs[ nodeIndex ];\n\n\t\t\tif ( nodeDef.mesh !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.meshCache, nodeDef.mesh );\n\n\t\t\t\t// Nothing in the mesh definition indicates whether it is\n\t\t\t\t// a SkinnedMesh or Mesh. Use the node's mesh reference\n\t\t\t\t// to mark SkinnedMesh if node has skin.\n\t\t\t\tif ( nodeDef.skin !== undefined ) {\n\n\t\t\t\t\tmeshDefs[ nodeDef.mesh ].isSkinnedMesh = true;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\t\tthis._addNodeRef( this.cameraCache, nodeDef.camera );\n\n\t\t\t}\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Counts references to shared node / Object3D resources. These resources\n\t * can be reused, or \"instantiated\", at multiple nodes in the scene\n\t * hierarchy. Mesh, Camera, and Light instances are instantiated and must\n\t * be marked. Non-scenegraph resources (like Materials, Geometries, and\n\t * Textures) can be reused directly and are not marked here.\n\t *\n\t * Example: CesiumMilkTruck sample model reuses \"Wheel\" meshes.\n\t *\n\t * @private\n\t * @param {Object} cache\n\t * @param {Object3D} index\n\t */\n\t_addNodeRef( cache, index ) {\n\n\t\tif ( index === undefined ) return;\n\n\t\tif ( cache.refs[ index ] === undefined ) {\n\n\t\t\tcache.refs[ index ] = cache.uses[ index ] = 0;\n\n\t\t}\n\n\t\tcache.refs[ index ] ++;\n\n\t}\n\n\t/**\n\t * Returns a reference to a shared resource, cloning it if necessary.\n\t *\n\t * @private\n\t * @param {Object} cache\n\t * @param {number} index\n\t * @param {Object} object\n\t * @return {Object}\n\t */\n\t_getNodeRef( cache, index, object ) {\n\n\t\tif ( cache.refs[ index ] <= 1 ) return object;\n\n\t\tconst ref = object.clone();\n\n\t\t// Propagates mappings to the cloned object, prevents mappings on the\n\t\t// original object from being lost.\n\t\tconst updateMappings = ( original, clone ) => {\n\n\t\t\tconst mappings = this.associations.get( original );\n\t\t\tif ( mappings != null ) {\n\n\t\t\t\tthis.associations.set( clone, mappings );\n\n\t\t\t}\n\n\t\t\tfor ( const [ i, child ] of original.children.entries() ) {\n\n\t\t\t\tupdateMappings( child, clone.children[ i ] );\n\n\t\t\t}\n\n\t\t};\n\n\t\tupdateMappings( object, ref );\n\n\t\tref.name += '_instance_' + ( cache.uses[ index ] ++ );\n\n\t\treturn ref;\n\n\t}\n\n\t_invokeOne( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.push( this );\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) return result;\n\n\t\t}\n\n\t\treturn null;\n\n\t}\n\n\t_invokeAll( func ) {\n\n\t\tconst extensions = Object.values( this.plugins );\n\t\textensions.unshift( this );\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0; i < extensions.length; i ++ ) {\n\n\t\t\tconst result = func( extensions[ i ] );\n\n\t\t\tif ( result ) pending.push( result );\n\n\t\t}\n\n\t\treturn pending;\n\n\t}\n\n\t/**\n\t * Requests the specified dependency asynchronously, with caching.\n\t *\n\t * @private\n\t * @param {string} type\n\t * @param {number} index\n\t * @return {Promise<Object3D|Material|Texture|AnimationClip|ArrayBuffer|Object>}\n\t */\n\tgetDependency( type, index ) {\n\n\t\tconst cacheKey = type + ':' + index;\n\t\tlet dependency = this.cache.get( cacheKey );\n\n\t\tif ( ! dependency ) {\n\n\t\t\tswitch ( type ) {\n\n\t\t\t\tcase 'scene':\n\t\t\t\t\tdependency = this.loadScene( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'node':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadNode && ext.loadNode( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'mesh':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMesh && ext.loadMesh( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'accessor':\n\t\t\t\t\tdependency = this.loadAccessor( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'bufferView':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadBufferView && ext.loadBufferView( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'buffer':\n\t\t\t\t\tdependency = this.loadBuffer( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'material':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadMaterial && ext.loadMaterial( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'texture':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadTexture && ext.loadTexture( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'skin':\n\t\t\t\t\tdependency = this.loadSkin( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'animation':\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext.loadAnimation && ext.loadAnimation( index );\n\n\t\t\t\t\t} );\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase 'camera':\n\t\t\t\t\tdependency = this.loadCamera( index );\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tdependency = this._invokeOne( function ( ext ) {\n\n\t\t\t\t\t\treturn ext != this && ext.getDependency && ext.getDependency( type, index );\n\n\t\t\t\t\t} );\n\n\t\t\t\t\tif ( ! dependency ) {\n\n\t\t\t\t\t\tthrow new Error( 'Unknown type: ' + type );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\tthis.cache.add( cacheKey, dependency );\n\n\t\t}\n\n\t\treturn dependency;\n\n\t}\n\n\t/**\n\t * Requests all dependencies of the specified type asynchronously, with caching.\n\t *\n\t * @private\n\t * @param {string} type\n\t * @return {Promise<Array<Object>>}\n\t */\n\tgetDependencies( type ) {\n\n\t\tlet dependencies = this.cache.get( type );\n\n\t\tif ( ! dependencies ) {\n\n\t\t\tconst parser = this;\n\t\t\tconst defs = this.json[ type + ( type === 'mesh' ? 'es' : 's' ) ] || [];\n\n\t\t\tdependencies = Promise.all( defs.map( function ( def, index ) {\n\n\t\t\t\treturn parser.getDependency( type, index );\n\n\t\t\t} ) );\n\n\t\t\tthis.cache.add( type, dependencies );\n\n\t\t}\n\n\t\treturn dependencies;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t *\n\t * @private\n\t * @param {number} bufferIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBuffer( bufferIndex ) {\n\n\t\tconst bufferDef = this.json.buffers[ bufferIndex ];\n\t\tconst loader = this.fileLoader;\n\n\t\tif ( bufferDef.type && bufferDef.type !== 'arraybuffer' ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: ' + bufferDef.type + ' buffer type is not supported.' );\n\n\t\t}\n\n\t\t// If present, GLB container is required to be the first buffer.\n\t\tif ( bufferDef.uri === undefined && bufferIndex === 0 ) {\n\n\t\t\treturn Promise.resolve( this.extensions[ EXTENSIONS.KHR_BINARY_GLTF ].body );\n\n\t\t}\n\n\t\tconst options = this.options;\n\n\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\tloader.load( LoaderUtils.resolveURL( bufferDef.uri, options.path ), resolve, undefined, function () {\n\n\t\t\t\treject( new Error( 'THREE.GLTFLoader: Failed to load buffer \"' + bufferDef.uri + '\".' ) );\n\n\t\t\t} );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#buffers-and-buffer-views\n\t *\n\t * @private\n\t * @param {number} bufferViewIndex\n\t * @return {Promise<ArrayBuffer>}\n\t */\n\tloadBufferView( bufferViewIndex ) {\n\n\t\tconst bufferViewDef = this.json.bufferViews[ bufferViewIndex ];\n\n\t\treturn this.getDependency( 'buffer', bufferViewDef.buffer ).then( function ( buffer ) {\n\n\t\t\tconst byteLength = bufferViewDef.byteLength || 0;\n\t\t\tconst byteOffset = bufferViewDef.byteOffset || 0;\n\t\t\treturn buffer.slice( byteOffset, byteOffset + byteLength );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#accessors\n\t *\n\t * @private\n\t * @param {number} accessorIndex\n\t * @return {Promise<BufferAttribute|InterleavedBufferAttribute>}\n\t */\n\tloadAccessor( accessorIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst accessorDef = this.json.accessors[ accessorIndex ];\n\n\t\tif ( accessorDef.bufferView === undefined && accessorDef.sparse === undefined ) {\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\t\t\tconst normalized = accessorDef.normalized === true;\n\n\t\t\tconst array = new TypedArray( accessorDef.count * itemSize );\n\t\t\treturn Promise.resolve( new BufferAttribute( array, itemSize, normalized ) );\n\n\t\t}\n\n\t\tconst pendingBufferViews = [];\n\n\t\tif ( accessorDef.bufferView !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.bufferView ) );\n\n\t\t} else {\n\n\t\t\tpendingBufferViews.push( null );\n\n\t\t}\n\n\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.indices.bufferView ) );\n\t\t\tpendingBufferViews.push( this.getDependency( 'bufferView', accessorDef.sparse.values.bufferView ) );\n\n\t\t}\n\n\t\treturn Promise.all( pendingBufferViews ).then( function ( bufferViews ) {\n\n\t\t\tconst bufferView = bufferViews[ 0 ];\n\n\t\t\tconst itemSize = WEBGL_TYPE_SIZES[ accessorDef.type ];\n\t\t\tconst TypedArray = WEBGL_COMPONENT_TYPES[ accessorDef.componentType ];\n\n\t\t\t// For VEC3: itemSize is 3, elementBytes is 4, itemBytes is 12.\n\t\t\tconst elementBytes = TypedArray.BYTES_PER_ELEMENT;\n\t\t\tconst itemBytes = elementBytes * itemSize;\n\t\t\tconst byteOffset = accessorDef.byteOffset || 0;\n\t\t\tconst byteStride = accessorDef.bufferView !== undefined ? json.bufferViews[ accessorDef.bufferView ].byteStride : undefined;\n\t\t\tconst normalized = accessorDef.normalized === true;\n\t\t\tlet array, bufferAttribute;\n\n\t\t\t// The buffer is not interleaved if the stride is the item size in bytes.\n\t\t\tif ( byteStride && byteStride !== itemBytes ) {\n\n\t\t\t\t// Each \"slice\" of the buffer, as defined by 'count' elements of 'byteStride' bytes, gets its own InterleavedBuffer\n\t\t\t\t// This makes sure that IBA.count reflects accessor.count properly\n\t\t\t\tconst ibSlice = Math.floor( byteOffset / byteStride );\n\t\t\t\tconst ibCacheKey = 'InterleavedBuffer:' + accessorDef.bufferView + ':' + accessorDef.componentType + ':' + ibSlice + ':' + accessorDef.count;\n\t\t\t\tlet ib = parser.cache.get( ibCacheKey );\n\n\t\t\t\tif ( ! ib ) {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, ibSlice * byteStride, accessorDef.count * byteStride / elementBytes );\n\n\t\t\t\t\t// Integer parameters to IB/IBA are in array elements, not bytes.\n\t\t\t\t\tib = new InterleavedBuffer( array, byteStride / elementBytes );\n\n\t\t\t\t\tparser.cache.add( ibCacheKey, ib );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new InterleavedBufferAttribute( ib, itemSize, ( byteOffset % byteStride ) / elementBytes, normalized );\n\n\t\t\t} else {\n\n\t\t\t\tif ( bufferView === null ) {\n\n\t\t\t\t\tarray = new TypedArray( accessorDef.count * itemSize );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tarray = new TypedArray( bufferView, byteOffset, accessorDef.count * itemSize );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute = new BufferAttribute( array, itemSize, normalized );\n\n\t\t\t}\n\n\t\t\t// https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#sparse-accessors\n\t\t\tif ( accessorDef.sparse !== undefined ) {\n\n\t\t\t\tconst itemSizeIndices = WEBGL_TYPE_SIZES.SCALAR;\n\t\t\t\tconst TypedArrayIndices = WEBGL_COMPONENT_TYPES[ accessorDef.sparse.indices.componentType ];\n\n\t\t\t\tconst byteOffsetIndices = accessorDef.sparse.indices.byteOffset || 0;\n\t\t\t\tconst byteOffsetValues = accessorDef.sparse.values.byteOffset || 0;\n\n\t\t\t\tconst sparseIndices = new TypedArrayIndices( bufferViews[ 1 ], byteOffsetIndices, accessorDef.sparse.count * itemSizeIndices );\n\t\t\t\tconst sparseValues = new TypedArray( bufferViews[ 2 ], byteOffsetValues, accessorDef.sparse.count * itemSize );\n\n\t\t\t\tif ( bufferView !== null ) {\n\n\t\t\t\t\t// Avoid modifying the original ArrayBuffer, if the bufferView wasn't initialized with zeroes.\n\t\t\t\t\tbufferAttribute = new BufferAttribute( bufferAttribute.array.slice(), bufferAttribute.itemSize, bufferAttribute.normalized );\n\n\t\t\t\t}\n\n\t\t\t\t// Ignore normalized since we copy from sparse\n\t\t\t\tbufferAttribute.normalized = false;\n\n\t\t\t\tfor ( let i = 0, il = sparseIndices.length; i < il; i ++ ) {\n\n\t\t\t\t\tconst index = sparseIndices[ i ];\n\n\t\t\t\t\tbufferAttribute.setX( index, sparseValues[ i * itemSize ] );\n\t\t\t\t\tif ( itemSize >= 2 ) bufferAttribute.setY( index, sparseValues[ i * itemSize + 1 ] );\n\t\t\t\t\tif ( itemSize >= 3 ) bufferAttribute.setZ( index, sparseValues[ i * itemSize + 2 ] );\n\t\t\t\t\tif ( itemSize >= 4 ) bufferAttribute.setW( index, sparseValues[ i * itemSize + 3 ] );\n\t\t\t\t\tif ( itemSize >= 5 ) throw new Error( 'THREE.GLTFLoader: Unsupported itemSize in sparse BufferAttribute.' );\n\n\t\t\t\t}\n\n\t\t\t\tbufferAttribute.normalized = normalized;\n\n\t\t\t}\n\n\t\t\treturn bufferAttribute;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#textures\n\t *\n\t * @private\n\t * @param {number} textureIndex\n\t * @return {Promise<?Texture>}\n\t */\n\tloadTexture( textureIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceIndex = textureDef.source;\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tlet loader = this.textureLoader;\n\n\t\tif ( sourceDef.uri ) {\n\n\t\t\tconst handler = options.manager.getHandler( sourceDef.uri );\n\t\t\tif ( handler !== null ) loader = handler;\n\n\t\t}\n\n\t\treturn this.loadTextureImage( textureIndex, sourceIndex, loader );\n\n\t}\n\n\tloadTextureImage( textureIndex, sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\n\t\tconst textureDef = json.textures[ textureIndex ];\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst cacheKey = ( sourceDef.uri || sourceDef.bufferView ) + ':' + textureDef.sampler;\n\n\t\tif ( this.textureCache[ cacheKey ] ) {\n\n\t\t\t// See https://github.com/mrdoob/three.js/issues/21559.\n\t\t\treturn this.textureCache[ cacheKey ];\n\n\t\t}\n\n\t\tconst promise = this.loadImageSource( sourceIndex, loader ).then( function ( texture ) {\n\n\t\t\ttexture.flipY = false;\n\n\t\t\ttexture.name = textureDef.name || sourceDef.name || '';\n\n\t\t\tif ( texture.name === '' && typeof sourceDef.uri === 'string' && sourceDef.uri.startsWith( 'data:image/' ) === false ) {\n\n\t\t\t\ttexture.name = sourceDef.uri;\n\n\t\t\t}\n\n\t\t\tconst samplers = json.samplers || {};\n\t\t\tconst sampler = samplers[ textureDef.sampler ] || {};\n\n\t\t\ttexture.magFilter = WEBGL_FILTERS[ sampler.magFilter ] || LinearFilter;\n\t\t\ttexture.minFilter = WEBGL_FILTERS[ sampler.minFilter ] || LinearMipmapLinearFilter;\n\t\t\ttexture.wrapS = WEBGL_WRAPPINGS[ sampler.wrapS ] || RepeatWrapping;\n\t\t\ttexture.wrapT = WEBGL_WRAPPINGS[ sampler.wrapT ] || RepeatWrapping;\n\t\t\ttexture.generateMipmaps = ! texture.isCompressedTexture && texture.minFilter !== NearestFilter && texture.minFilter !== LinearFilter;\n\n\t\t\tparser.associations.set( texture, { textures: textureIndex } );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function () {\n\n\t\t\treturn null;\n\n\t\t} );\n\n\t\tthis.textureCache[ cacheKey ] = promise;\n\n\t\treturn promise;\n\n\t}\n\n\tloadImageSource( sourceIndex, loader ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst options = this.options;\n\n\t\tif ( this.sourceCache[ sourceIndex ] !== undefined ) {\n\n\t\t\treturn this.sourceCache[ sourceIndex ].then( ( texture ) => texture.clone() );\n\n\t\t}\n\n\t\tconst sourceDef = json.images[ sourceIndex ];\n\n\t\tconst URL = self.URL || self.webkitURL;\n\n\t\tlet sourceURI = sourceDef.uri || '';\n\t\tlet isObjectURL = false;\n\n\t\tif ( sourceDef.bufferView !== undefined ) {\n\n\t\t\t// Load binary image data from bufferView, if provided.\n\n\t\t\tsourceURI = parser.getDependency( 'bufferView', sourceDef.bufferView ).then( function ( bufferView ) {\n\n\t\t\t\tisObjectURL = true;\n\t\t\t\tconst blob = new Blob( [ bufferView ], { type: sourceDef.mimeType } );\n\t\t\t\tsourceURI = URL.createObjectURL( blob );\n\t\t\t\treturn sourceURI;\n\n\t\t\t} );\n\n\t\t} else if ( sourceDef.uri === undefined ) {\n\n\t\t\tthrow new Error( 'THREE.GLTFLoader: Image ' + sourceIndex + ' is missing URI and bufferView' );\n\n\t\t}\n\n\t\tconst promise = Promise.resolve( sourceURI ).then( function ( sourceURI ) {\n\n\t\t\treturn new Promise( function ( resolve, reject ) {\n\n\t\t\t\tlet onLoad = resolve;\n\n\t\t\t\tif ( loader.isImageBitmapLoader === true ) {\n\n\t\t\t\t\tonLoad = function ( imageBitmap ) {\n\n\t\t\t\t\t\tconst texture = new Texture( imageBitmap );\n\t\t\t\t\t\ttexture.needsUpdate = true;\n\n\t\t\t\t\t\tresolve( texture );\n\n\t\t\t\t\t};\n\n\t\t\t\t}\n\n\t\t\t\tloader.load( LoaderUtils.resolveURL( sourceURI, options.path ), onLoad, undefined, reject );\n\n\t\t\t} );\n\n\t\t} ).then( function ( texture ) {\n\n\t\t\t// Clean up resources and configure Texture.\n\n\t\t\tif ( isObjectURL === true ) {\n\n\t\t\t\tURL.revokeObjectURL( sourceURI );\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( texture, sourceDef );\n\n\t\t\ttexture.userData.mimeType = sourceDef.mimeType || getImageURIMimeType( sourceDef.uri );\n\n\t\t\treturn texture;\n\n\t\t} ).catch( function ( error ) {\n\n\t\t\tconsole.error( 'THREE.GLTFLoader: Couldn\\'t load texture', sourceURI );\n\t\t\tthrow error;\n\n\t\t} );\n\n\t\tthis.sourceCache[ sourceIndex ] = promise;\n\t\treturn promise;\n\n\t}\n\n\t/**\n\t * Asynchronously assigns a texture to the given material parameters.\n\t *\n\t * @private\n\t * @param {Object} materialParams\n\t * @param {string} mapName\n\t * @param {Object} mapDef\n\t * @param {string} [colorSpace]\n\t * @return {Promise<Texture>}\n\t */\n\tassignTexture( materialParams, mapName, mapDef, colorSpace ) {\n\n\t\tconst parser = this;\n\n\t\treturn this.getDependency( 'texture', mapDef.index ).then( function ( texture ) {\n\n\t\t\tif ( ! texture ) return null;\n\n\t\t\tif ( mapDef.texCoord !== undefined && mapDef.texCoord > 0 ) {\n\n\t\t\t\ttexture = texture.clone();\n\t\t\t\ttexture.channel = mapDef.texCoord;\n\n\t\t\t}\n\n\t\t\tif ( parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] ) {\n\n\t\t\t\tconst transform = mapDef.extensions !== undefined ? mapDef.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ] : undefined;\n\n\t\t\t\tif ( transform ) {\n\n\t\t\t\t\tconst gltfReference = parser.associations.get( texture );\n\t\t\t\t\ttexture = parser.extensions[ EXTENSIONS.KHR_TEXTURE_TRANSFORM ].extendTexture( texture, transform );\n\t\t\t\t\tparser.associations.set( texture, gltfReference );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( colorSpace !== undefined ) {\n\n\t\t\t\ttexture.colorSpace = colorSpace;\n\n\t\t\t}\n\n\t\t\tmaterialParams[ mapName ] = texture;\n\n\t\t\treturn texture;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Assigns final material to a Mesh, Line, or Points instance. The instance\n\t * already has a material (generated from the glTF material options alone)\n\t * but reuse of the same glTF material may require multiple threejs materials\n\t * to accommodate different primitive types, defines, etc. New materials will\n\t * be created if necessary, and reused from a cache.\n\t *\n\t * @private\n\t * @param {Object3D} mesh Mesh, Line, or Points instance.\n\t */\n\tassignFinalMaterial( mesh ) {\n\n\t\tconst geometry = mesh.geometry;\n\t\tlet material = mesh.material;\n\n\t\tconst useDerivativeTangents = geometry.attributes.tangent === undefined;\n\t\tconst useVertexColors = geometry.attributes.color !== undefined;\n\t\tconst useFlatShading = geometry.attributes.normal === undefined;\n\n\t\tif ( mesh.isPoints ) {\n\n\t\t\tconst cacheKey = 'PointsMaterial:' + material.uuid;\n\n\t\t\tlet pointsMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! pointsMaterial ) {\n\n\t\t\t\tpointsMaterial = new PointsMaterial();\n\t\t\t\tMaterial.prototype.copy.call( pointsMaterial, material );\n\t\t\t\tpointsMaterial.color.copy( material.color );\n\t\t\t\tpointsMaterial.map = material.map;\n\t\t\t\tpointsMaterial.sizeAttenuation = false; // glTF spec says points should be 1px\n\n\t\t\t\tthis.cache.add( cacheKey, pointsMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = pointsMaterial;\n\n\t\t} else if ( mesh.isLine ) {\n\n\t\t\tconst cacheKey = 'LineBasicMaterial:' + material.uuid;\n\n\t\t\tlet lineMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! lineMaterial ) {\n\n\t\t\t\tlineMaterial = new LineBasicMaterial();\n\t\t\t\tMaterial.prototype.copy.call( lineMaterial, material );\n\t\t\t\tlineMaterial.color.copy( material.color );\n\t\t\t\tlineMaterial.map = material.map;\n\n\t\t\t\tthis.cache.add( cacheKey, lineMaterial );\n\n\t\t\t}\n\n\t\t\tmaterial = lineMaterial;\n\n\t\t}\n\n\t\t// Clone the material if it will be modified\n\t\tif ( useDerivativeTangents || useVertexColors || useFlatShading ) {\n\n\t\t\tlet cacheKey = 'ClonedMaterial:' + material.uuid + ':';\n\n\t\t\tif ( useDerivativeTangents ) cacheKey += 'derivative-tangents:';\n\t\t\tif ( useVertexColors ) cacheKey += 'vertex-colors:';\n\t\t\tif ( useFlatShading ) cacheKey += 'flat-shading:';\n\n\t\t\tlet cachedMaterial = this.cache.get( cacheKey );\n\n\t\t\tif ( ! cachedMaterial ) {\n\n\t\t\t\tcachedMaterial = material.clone();\n\n\t\t\t\tif ( useVertexColors ) cachedMaterial.vertexColors = true;\n\t\t\t\tif ( useFlatShading ) cachedMaterial.flatShading = true;\n\n\t\t\t\tif ( useDerivativeTangents ) {\n\n\t\t\t\t\t// https://github.com/mrdoob/three.js/issues/11438#issuecomment-507003995\n\t\t\t\t\tif ( cachedMaterial.normalScale ) cachedMaterial.normalScale.y *= - 1;\n\t\t\t\t\tif ( cachedMaterial.clearcoatNormalScale ) cachedMaterial.clearcoatNormalScale.y *= - 1;\n\n\t\t\t\t}\n\n\t\t\t\tthis.cache.add( cacheKey, cachedMaterial );\n\n\t\t\t\tthis.associations.set( cachedMaterial, this.associations.get( material ) );\n\n\t\t\t}\n\n\t\t\tmaterial = cachedMaterial;\n\n\t\t}\n\n\t\tmesh.material = material;\n\n\t}\n\n\tgetMaterialType( /* materialIndex */ ) {\n\n\t\treturn MeshStandardMaterial;\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#materials\n\t *\n\t * @private\n\t * @param {number} materialIndex\n\t * @return {Promise<Material>}\n\t */\n\tloadMaterial( materialIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst materialDef = json.materials[ materialIndex ];\n\n\t\tlet materialType;\n\t\tconst materialParams = {};\n\t\tconst materialExtensions = materialDef.extensions || {};\n\n\t\tconst pending = [];\n\n\t\tif ( materialExtensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ] ) {\n\n\t\t\tconst kmuExtension = extensions[ EXTENSIONS.KHR_MATERIALS_UNLIT ];\n\t\t\tmaterialType = kmuExtension.getMaterialType();\n\t\t\tpending.push( kmuExtension.extendParams( materialParams, materialDef, parser ) );\n\n\t\t} else {\n\n\t\t\t// Specification:\n\t\t\t// https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#metallic-roughness-material\n\n\t\t\tconst metallicRoughness = materialDef.pbrMetallicRoughness || {};\n\n\t\t\tmaterialParams.color = new Color( 1.0, 1.0, 1.0 );\n\t\t\tmaterialParams.opacity = 1.0;\n\n\t\t\tif ( Array.isArray( metallicRoughness.baseColorFactor ) ) {\n\n\t\t\t\tconst array = metallicRoughness.baseColorFactor;\n\n\t\t\t\tmaterialParams.color.setRGB( array[ 0 ], array[ 1 ], array[ 2 ], LinearSRGBColorSpace );\n\t\t\t\tmaterialParams.opacity = array[ 3 ];\n\n\t\t\t}\n\n\t\t\tif ( metallicRoughness.baseColorTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'map', metallicRoughness.baseColorTexture, SRGBColorSpace ) );\n\n\t\t\t}\n\n\t\t\tmaterialParams.metalness = metallicRoughness.metallicFactor !== undefined ? metallicRoughness.metallicFactor : 1.0;\n\t\t\tmaterialParams.roughness = metallicRoughness.roughnessFactor !== undefined ? metallicRoughness.roughnessFactor : 1.0;\n\n\t\t\tif ( metallicRoughness.metallicRoughnessTexture !== undefined ) {\n\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'metalnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\t\t\t\tpending.push( parser.assignTexture( materialParams, 'roughnessMap', metallicRoughness.metallicRoughnessTexture ) );\n\n\t\t\t}\n\n\t\t\tmaterialType = this._invokeOne( function ( ext ) {\n\n\t\t\t\treturn ext.getMaterialType && ext.getMaterialType( materialIndex );\n\n\t\t\t} );\n\n\t\t\tpending.push( Promise.all( this._invokeAll( function ( ext ) {\n\n\t\t\t\treturn ext.extendMaterialParams && ext.extendMaterialParams( materialIndex, materialParams );\n\n\t\t\t} ) ) );\n\n\t\t}\n\n\t\tif ( materialDef.doubleSided === true ) {\n\n\t\t\tmaterialParams.side = DoubleSide;\n\n\t\t}\n\n\t\tconst alphaMode = materialDef.alphaMode || ALPHA_MODES.OPAQUE;\n\n\t\tif ( alphaMode === ALPHA_MODES.BLEND ) {\n\n\t\t\tmaterialParams.transparent = true;\n\n\t\t\t// See: https://github.com/mrdoob/three.js/issues/17706\n\t\t\tmaterialParams.depthWrite = false;\n\n\t\t} else {\n\n\t\t\tmaterialParams.transparent = false;\n\n\t\t\tif ( alphaMode === ALPHA_MODES.MASK ) {\n\n\t\t\t\tmaterialParams.alphaTest = materialDef.alphaCutoff !== undefined ? materialDef.alphaCutoff : 0.5;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.normalTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'normalMap', materialDef.normalTexture ) );\n\n\t\t\tmaterialParams.normalScale = new Vector2( 1, 1 );\n\n\t\t\tif ( materialDef.normalTexture.scale !== undefined ) {\n\n\t\t\t\tconst scale = materialDef.normalTexture.scale;\n\n\t\t\t\tmaterialParams.normalScale.set( scale, scale );\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.occlusionTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'aoMap', materialDef.occlusionTexture ) );\n\n\t\t\tif ( materialDef.occlusionTexture.strength !== undefined ) {\n\n\t\t\t\tmaterialParams.aoMapIntensity = materialDef.occlusionTexture.strength;\n\n\t\t\t}\n\n\t\t}\n\n\t\tif ( materialDef.emissiveFactor !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tconst emissiveFactor = materialDef.emissiveFactor;\n\t\t\tmaterialParams.emissive = new Color().setRGB( emissiveFactor[ 0 ], emissiveFactor[ 1 ], emissiveFactor[ 2 ], LinearSRGBColorSpace );\n\n\t\t}\n\n\t\tif ( materialDef.emissiveTexture !== undefined && materialType !== MeshBasicMaterial ) {\n\n\t\t\tpending.push( parser.assignTexture( materialParams, 'emissiveMap', materialDef.emissiveTexture, SRGBColorSpace ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function () {\n\n\t\t\tconst material = new materialType( materialParams );\n\n\t\t\tif ( materialDef.name ) material.name = materialDef.name;\n\n\t\t\tassignExtrasToUserData( material, materialDef );\n\n\t\t\tparser.associations.set( material, { materials: materialIndex } );\n\n\t\t\tif ( materialDef.extensions ) addUnknownExtensionsToUserData( extensions, material, materialDef );\n\n\t\t\treturn material;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * When Object3D instances are targeted by animation, they need unique names.\n\t *\n\t * @private\n\t * @param {string} originalName\n\t * @return {string}\n\t */\n\tcreateUniqueName( originalName ) {\n\n\t\tconst sanitizedName = PropertyBinding.sanitizeNodeName( originalName || '' );\n\n\t\tif ( sanitizedName in this.nodeNamesUsed ) {\n\n\t\t\treturn sanitizedName + '_' + ( ++ this.nodeNamesUsed[ sanitizedName ] );\n\n\t\t} else {\n\n\t\t\tthis.nodeNamesUsed[ sanitizedName ] = 0;\n\n\t\t\treturn sanitizedName;\n\n\t\t}\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#geometry\n\t *\n\t * Creates BufferGeometries from primitives.\n\t *\n\t * @private\n\t * @param {Array<GLTF.Primitive>} primitives\n\t * @return {Promise<Array<BufferGeometry>>}\n\t */\n\tloadGeometries( primitives ) {\n\n\t\tconst parser = this;\n\t\tconst extensions = this.extensions;\n\t\tconst cache = this.primitiveCache;\n\n\t\tfunction createDracoPrimitive( primitive ) {\n\n\t\t\treturn extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ]\n\t\t\t\t.decodePrimitive( primitive, parser )\n\t\t\t\t.then( function ( geometry ) {\n\n\t\t\t\t\treturn addPrimitiveAttributes( geometry, primitive, parser );\n\n\t\t\t\t} );\n\n\t\t}\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst primitive = primitives[ i ];\n\t\t\tconst cacheKey = createPrimitiveKey( primitive );\n\n\t\t\t// See if we've already created this geometry\n\t\t\tconst cached = cache[ cacheKey ];\n\n\t\t\tif ( cached ) {\n\n\t\t\t\t// Use the cached geometry if it exists\n\t\t\t\tpending.push( cached.promise );\n\n\t\t\t} else {\n\n\t\t\t\tlet geometryPromise;\n\n\t\t\t\tif ( primitive.extensions && primitive.extensions[ EXTENSIONS.KHR_DRACO_MESH_COMPRESSION ] ) {\n\n\t\t\t\t\t// Use DRACO geometry if available\n\t\t\t\t\tgeometryPromise = createDracoPrimitive( primitive );\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// Otherwise create a new geometry\n\t\t\t\t\tgeometryPromise = addPrimitiveAttributes( new BufferGeometry(), primitive, parser );\n\n\t\t\t\t}\n\n\t\t\t\t// Cache this geometry\n\t\t\t\tcache[ cacheKey ] = { primitive: primitive, promise: geometryPromise };\n\n\t\t\t\tpending.push( geometryPromise );\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn Promise.all( pending );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/blob/master/specification/2.0/README.md#meshes\n\t *\n\t * @private\n\t * @param {number} meshIndex\n\t * @return {Promise<Group|Mesh|SkinnedMesh|Line|Points>}\n\t */\n\tloadMesh( meshIndex ) {\n\n\t\tconst parser = this;\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\n\t\tconst meshDef = json.meshes[ meshIndex ];\n\t\tconst primitives = meshDef.primitives;\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = primitives.length; i < il; i ++ ) {\n\n\t\t\tconst material = primitives[ i ].material === undefined\n\t\t\t\t? createDefaultMaterial( this.cache )\n\t\t\t\t: this.getDependency( 'material', primitives[ i ].material );\n\n\t\t\tpending.push( material );\n\n\t\t}\n\n\t\tpending.push( parser.loadGeometries( primitives ) );\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst materials = results.slice( 0, results.length - 1 );\n\t\t\tconst geometries = results[ results.length - 1 ];\n\n\t\t\tconst meshes = [];\n\n\t\t\tfor ( let i = 0, il = geometries.length; i < il; i ++ ) {\n\n\t\t\t\tconst geometry = geometries[ i ];\n\t\t\t\tconst primitive = primitives[ i ];\n\n\t\t\t\t// 1. create Mesh\n\n\t\t\t\tlet mesh;\n\n\t\t\t\tconst material = materials[ i ];\n\n\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLES ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ||\n\t\t\t\t\t\tprimitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ||\n\t\t\t\t\t\tprimitive.mode === undefined ) {\n\n\t\t\t\t\t// .isSkinnedMesh isn't in glTF spec. See ._markDefs()\n\t\t\t\t\tmesh = meshDef.isSkinnedMesh === true\n\t\t\t\t\t\t? new SkinnedMesh( geometry, material )\n\t\t\t\t\t\t: new Mesh( geometry, material );\n\n\t\t\t\t\tif ( mesh.isSkinnedMesh === true ) {\n\n\t\t\t\t\t\t// normalize skin weights to fix malformed assets (see #15319)\n\t\t\t\t\t\tmesh.normalizeSkinWeights();\n\n\t\t\t\t\t}\n\n\t\t\t\t\tif ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_STRIP ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleStripDrawMode );\n\n\t\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.TRIANGLE_FAN ) {\n\n\t\t\t\t\t\tmesh.geometry = toTrianglesDrawMode( mesh.geometry, TriangleFanDrawMode );\n\n\t\t\t\t\t}\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINES ) {\n\n\t\t\t\t\tmesh = new LineSegments( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_STRIP ) {\n\n\t\t\t\t\tmesh = new Line( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.LINE_LOOP ) {\n\n\t\t\t\t\tmesh = new LineLoop( geometry, material );\n\n\t\t\t\t} else if ( primitive.mode === WEBGL_CONSTANTS.POINTS ) {\n\n\t\t\t\t\tmesh = new Points( geometry, material );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tthrow new Error( 'THREE.GLTFLoader: Primitive mode unsupported: ' + primitive.mode );\n\n\t\t\t\t}\n\n\t\t\t\tif ( Object.keys( mesh.geometry.morphAttributes ).length > 0 ) {\n\n\t\t\t\t\tupdateMorphTargets( mesh, meshDef );\n\n\t\t\t\t}\n\n\t\t\t\tmesh.name = parser.createUniqueName( meshDef.name || ( 'mesh_' + meshIndex ) );\n\n\t\t\t\tassignExtrasToUserData( mesh, meshDef );\n\n\t\t\t\tif ( primitive.extensions ) addUnknownExtensionsToUserData( extensions, mesh, primitive );\n\n\t\t\t\tparser.assignFinalMaterial( mesh );\n\n\t\t\t\tmeshes.push( mesh );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tparser.associations.set( meshes[ i ], {\n\t\t\t\t\tmeshes: meshIndex,\n\t\t\t\t\tprimitives: i\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tif ( meshes.length === 1 ) {\n\n\t\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, meshes[ 0 ], meshDef );\n\n\t\t\t\treturn meshes[ 0 ];\n\n\t\t\t}\n\n\t\t\tconst group = new Group();\n\n\t\t\tif ( meshDef.extensions ) addUnknownExtensionsToUserData( extensions, group, meshDef );\n\n\t\t\tparser.associations.set( group, { meshes: meshIndex } );\n\n\t\t\tfor ( let i = 0, il = meshes.length; i < il; i ++ ) {\n\n\t\t\t\tgroup.add( meshes[ i ] );\n\n\t\t\t}\n\n\t\t\treturn group;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#cameras\n\t *\n\t * @private\n\t * @param {number} cameraIndex\n\t * @return {Promise<Camera>|undefined}\n\t */\n\tloadCamera( cameraIndex ) {\n\n\t\tlet camera;\n\t\tconst cameraDef = this.json.cameras[ cameraIndex ];\n\t\tconst params = cameraDef[ cameraDef.type ];\n\n\t\tif ( ! params ) {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing camera parameters.' );\n\t\t\treturn;\n\n\t\t}\n\n\t\tif ( cameraDef.type === 'perspective' ) {\n\n\t\t\tcamera = new PerspectiveCamera( MathUtils.radToDeg( params.yfov ), params.aspectRatio || 1, params.znear || 1, params.zfar || 2e6 );\n\n\t\t} else if ( cameraDef.type === 'orthographic' ) {\n\n\t\t\tcamera = new OrthographicCamera( - params.xmag, params.xmag, params.ymag, - params.ymag, params.znear, params.zfar );\n\n\t\t}\n\n\t\tif ( cameraDef.name ) camera.name = this.createUniqueName( cameraDef.name );\n\n\t\tassignExtrasToUserData( camera, cameraDef );\n\n\t\treturn Promise.resolve( camera );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#skins\n\t *\n\t * @private\n\t * @param {number} skinIndex\n\t * @return {Promise<Skeleton>}\n\t */\n\tloadSkin( skinIndex ) {\n\n\t\tconst skinDef = this.json.skins[ skinIndex ];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = skinDef.joints.length; i < il; i ++ ) {\n\n\t\t\tpending.push( this._loadNodeShallow( skinDef.joints[ i ] ) );\n\n\t\t}\n\n\t\tif ( skinDef.inverseBindMatrices !== undefined ) {\n\n\t\t\tpending.push( this.getDependency( 'accessor', skinDef.inverseBindMatrices ) );\n\n\t\t} else {\n\n\t\t\tpending.push( null );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( results ) {\n\n\t\t\tconst inverseBindMatrices = results.pop();\n\t\t\tconst jointNodes = results;\n\n\t\t\t// Note that bones (joint nodes) may or may not be in the\n\t\t\t// scene graph at this time.\n\n\t\t\tconst bones = [];\n\t\t\tconst boneInverses = [];\n\n\t\t\tfor ( let i = 0, il = jointNodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst jointNode = jointNodes[ i ];\n\n\t\t\t\tif ( jointNode ) {\n\n\t\t\t\t\tbones.push( jointNode );\n\n\t\t\t\t\tconst mat = new Matrix4();\n\n\t\t\t\t\tif ( inverseBindMatrices !== null ) {\n\n\t\t\t\t\t\tmat.fromArray( inverseBindMatrices.array, i * 16 );\n\n\t\t\t\t\t}\n\n\t\t\t\t\tboneInverses.push( mat );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Joint \"%s\" could not be found.', skinDef.joints[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn new Skeleton( bones, boneInverses );\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#animations\n\t *\n\t * @private\n\t * @param {number} animationIndex\n\t * @return {Promise<AnimationClip>}\n\t */\n\tloadAnimation( animationIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst animationDef = json.animations[ animationIndex ];\n\t\tconst animationName = animationDef.name ? animationDef.name : 'animation_' + animationIndex;\n\n\t\tconst pendingNodes = [];\n\t\tconst pendingInputAccessors = [];\n\t\tconst pendingOutputAccessors = [];\n\t\tconst pendingSamplers = [];\n\t\tconst pendingTargets = [];\n\n\t\tfor ( let i = 0, il = animationDef.channels.length; i < il; i ++ ) {\n\n\t\t\tconst channel = animationDef.channels[ i ];\n\t\t\tconst sampler = animationDef.samplers[ channel.sampler ];\n\t\t\tconst target = channel.target;\n\t\t\tconst name = target.node;\n\t\t\tconst input = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.input ] : sampler.input;\n\t\t\tconst output = animationDef.parameters !== undefined ? animationDef.parameters[ sampler.output ] : sampler.output;\n\n\t\t\tif ( target.node === undefined ) continue;\n\n\t\t\tpendingNodes.push( this.getDependency( 'node', name ) );\n\t\t\tpendingInputAccessors.push( this.getDependency( 'accessor', input ) );\n\t\t\tpendingOutputAccessors.push( this.getDependency( 'accessor', output ) );\n\t\t\tpendingSamplers.push( sampler );\n\t\t\tpendingTargets.push( target );\n\n\t\t}\n\n\t\treturn Promise.all( [\n\n\t\t\tPromise.all( pendingNodes ),\n\t\t\tPromise.all( pendingInputAccessors ),\n\t\t\tPromise.all( pendingOutputAccessors ),\n\t\t\tPromise.all( pendingSamplers ),\n\t\t\tPromise.all( pendingTargets )\n\n\t\t] ).then( function ( dependencies ) {\n\n\t\t\tconst nodes = dependencies[ 0 ];\n\t\t\tconst inputAccessors = dependencies[ 1 ];\n\t\t\tconst outputAccessors = dependencies[ 2 ];\n\t\t\tconst samplers = dependencies[ 3 ];\n\t\t\tconst targets = dependencies[ 4 ];\n\n\t\t\tconst tracks = [];\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tconst node = nodes[ i ];\n\t\t\t\tconst inputAccessor = inputAccessors[ i ];\n\t\t\t\tconst outputAccessor = outputAccessors[ i ];\n\t\t\t\tconst sampler = samplers[ i ];\n\t\t\t\tconst target = targets[ i ];\n\n\t\t\t\tif ( node === undefined ) continue;\n\n\t\t\t\tif ( node.updateMatrix ) {\n\n\t\t\t\t\tnode.updateMatrix();\n\n\t\t\t\t}\n\n\t\t\t\tconst createdTracks = parser._createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target );\n\n\t\t\t\tif ( createdTracks ) {\n\n\t\t\t\t\tfor ( let k = 0; k < createdTracks.length; k ++ ) {\n\n\t\t\t\t\t\ttracks.push( createdTracks[ k ] );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tconst animation = new AnimationClip( animationName, undefined, tracks );\n\n\t\t\tassignExtrasToUserData( animation, animationDef );\n\n\t\t\treturn animation;\n\n\t\t} );\n\n\t}\n\n\tcreateNodeMesh( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tif ( nodeDef.mesh === undefined ) return null;\n\n\t\treturn parser.getDependency( 'mesh', nodeDef.mesh ).then( function ( mesh ) {\n\n\t\t\tconst node = parser._getNodeRef( parser.meshCache, nodeDef.mesh, mesh );\n\n\t\t\t// if weights are provided on the node, override weights on the mesh.\n\t\t\tif ( nodeDef.weights !== undefined ) {\n\n\t\t\t\tnode.traverse( function ( o ) {\n\n\t\t\t\t\tif ( ! o.isMesh ) return;\n\n\t\t\t\t\tfor ( let i = 0, il = nodeDef.weights.length; i < il; i ++ ) {\n\n\t\t\t\t\t\to.morphTargetInfluences[ i ] = nodeDef.weights[ i ];\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#nodes-and-hierarchy\n\t *\n\t * @private\n\t * @param {number} nodeIndex\n\t * @return {Promise<Object3D>}\n\t */\n\tloadNode( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst parser = this;\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\tconst nodePending = parser._loadNodeShallow( nodeIndex );\n\n\t\tconst childPending = [];\n\t\tconst childrenDef = nodeDef.children || [];\n\n\t\tfor ( let i = 0, il = childrenDef.length; i < il; i ++ ) {\n\n\t\t\tchildPending.push( parser.getDependency( 'node', childrenDef[ i ] ) );\n\n\t\t}\n\n\t\tconst skeletonPending = nodeDef.skin === undefined\n\t\t\t? Promise.resolve( null )\n\t\t\t: parser.getDependency( 'skin', nodeDef.skin );\n\n\t\treturn Promise.all( [\n\t\t\tnodePending,\n\t\t\tPromise.all( childPending ),\n\t\t\tskeletonPending\n\t\t] ).then( function ( results ) {\n\n\t\t\tconst node = results[ 0 ];\n\t\t\tconst children = results[ 1 ];\n\t\t\tconst skeleton = results[ 2 ];\n\n\t\t\tif ( skeleton !== null ) {\n\n\t\t\t\t// This full traverse should be fine because\n\t\t\t\t// child glTF nodes have not been added to this node yet.\n\t\t\t\tnode.traverse( function ( mesh ) {\n\n\t\t\t\t\tif ( ! mesh.isSkinnedMesh ) return;\n\n\t\t\t\t\tmesh.bind( skeleton, _identityMatrix );\n\n\t\t\t\t} );\n\n\t\t\t}\n\n\t\t\tfor ( let i = 0, il = children.length; i < il; i ++ ) {\n\n\t\t\t\tnode.add( children[ i ] );\n\n\t\t\t}\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t}\n\n\t// ._loadNodeShallow() parses a single node.\n\t// skin and child nodes are created and added in .loadNode() (no '_' prefix).\n\t_loadNodeShallow( nodeIndex ) {\n\n\t\tconst json = this.json;\n\t\tconst extensions = this.extensions;\n\t\tconst parser = this;\n\n\t\t// This method is called from .loadNode() and .loadSkin().\n\t\t// Cache a node to avoid duplication.\n\n\t\tif ( this.nodeCache[ nodeIndex ] !== undefined ) {\n\n\t\t\treturn this.nodeCache[ nodeIndex ];\n\n\t\t}\n\n\t\tconst nodeDef = json.nodes[ nodeIndex ];\n\n\t\t// reserve node's name before its dependencies, so the root has the intended name.\n\t\tconst nodeName = nodeDef.name ? parser.createUniqueName( nodeDef.name ) : '';\n\n\t\tconst pending = [];\n\n\t\tconst meshPromise = parser._invokeOne( function ( ext ) {\n\n\t\t\treturn ext.createNodeMesh && ext.createNodeMesh( nodeIndex );\n\n\t\t} );\n\n\t\tif ( meshPromise ) {\n\n\t\t\tpending.push( meshPromise );\n\n\t\t}\n\n\t\tif ( nodeDef.camera !== undefined ) {\n\n\t\t\tpending.push( parser.getDependency( 'camera', nodeDef.camera ).then( function ( camera ) {\n\n\t\t\t\treturn parser._getNodeRef( parser.cameraCache, nodeDef.camera, camera );\n\n\t\t\t} ) );\n\n\t\t}\n\n\t\tparser._invokeAll( function ( ext ) {\n\n\t\t\treturn ext.createNodeAttachment && ext.createNodeAttachment( nodeIndex );\n\n\t\t} ).forEach( function ( promise ) {\n\n\t\t\tpending.push( promise );\n\n\t\t} );\n\n\t\tthis.nodeCache[ nodeIndex ] = Promise.all( pending ).then( function ( objects ) {\n\n\t\t\tlet node;\n\n\t\t\t// .isBone isn't in glTF spec. See ._markDefs\n\t\t\tif ( nodeDef.isBone === true ) {\n\n\t\t\t\tnode = new Bone();\n\n\t\t\t} else if ( objects.length > 1 ) {\n\n\t\t\t\tnode = new Group();\n\n\t\t\t} else if ( objects.length === 1 ) {\n\n\t\t\t\tnode = objects[ 0 ];\n\n\t\t\t} else {\n\n\t\t\t\tnode = new Object3D();\n\n\t\t\t}\n\n\t\t\tif ( node !== objects[ 0 ] ) {\n\n\t\t\t\tfor ( let i = 0, il = objects.length; i < il; i ++ ) {\n\n\t\t\t\t\tnode.add( objects[ i ] );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( nodeDef.name ) {\n\n\t\t\t\tnode.userData.name = nodeDef.name;\n\t\t\t\tnode.name = nodeName;\n\n\t\t\t}\n\n\t\t\tassignExtrasToUserData( node, nodeDef );\n\n\t\t\tif ( nodeDef.extensions ) addUnknownExtensionsToUserData( extensions, node, nodeDef );\n\n\t\t\tif ( nodeDef.matrix !== undefined ) {\n\n\t\t\t\tconst matrix = new Matrix4();\n\t\t\t\tmatrix.fromArray( nodeDef.matrix );\n\t\t\t\tnode.applyMatrix4( matrix );\n\n\t\t\t} else {\n\n\t\t\t\tif ( nodeDef.translation !== undefined ) {\n\n\t\t\t\t\tnode.position.fromArray( nodeDef.translation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.rotation !== undefined ) {\n\n\t\t\t\t\tnode.quaternion.fromArray( nodeDef.rotation );\n\n\t\t\t\t}\n\n\t\t\t\tif ( nodeDef.scale !== undefined ) {\n\n\t\t\t\t\tnode.scale.fromArray( nodeDef.scale );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\tif ( ! parser.associations.has( node ) ) {\n\n\t\t\t\tparser.associations.set( node, {} );\n\n\t\t\t} else if ( nodeDef.mesh !== undefined && parser.meshCache.refs[ nodeDef.mesh ] > 1 ) {\n\n\t\t\t\tconst mapping = parser.associations.get( node );\n\t\t\t\tparser.associations.set( node, { ...mapping } );\n\n\t\t\t}\n\n\t\t\tparser.associations.get( node ).nodes = nodeIndex;\n\n\t\t\treturn node;\n\n\t\t} );\n\n\t\treturn this.nodeCache[ nodeIndex ];\n\n\t}\n\n\t/**\n\t * Specification: https://github.com/KhronosGroup/glTF/tree/master/specification/2.0#scenes\n\t *\n\t * @private\n\t * @param {number} sceneIndex\n\t * @return {Promise<Group>}\n\t */\n\tloadScene( sceneIndex ) {\n\n\t\tconst extensions = this.extensions;\n\t\tconst sceneDef = this.json.scenes[ sceneIndex ];\n\t\tconst parser = this;\n\n\t\t// Loader returns Group, not Scene.\n\t\t// See: https://github.com/mrdoob/three.js/issues/18342#issuecomment-578981172\n\t\tconst scene = new Group();\n\t\tif ( sceneDef.name ) scene.name = parser.createUniqueName( sceneDef.name );\n\n\t\tassignExtrasToUserData( scene, sceneDef );\n\n\t\tif ( sceneDef.extensions ) addUnknownExtensionsToUserData( extensions, scene, sceneDef );\n\n\t\tconst nodeIds = sceneDef.nodes || [];\n\n\t\tconst pending = [];\n\n\t\tfor ( let i = 0, il = nodeIds.length; i < il; i ++ ) {\n\n\t\t\tpending.push( parser.getDependency( 'node', nodeIds[ i ] ) );\n\n\t\t}\n\n\t\treturn Promise.all( pending ).then( function ( nodes ) {\n\n\t\t\tfor ( let i = 0, il = nodes.length; i < il; i ++ ) {\n\n\t\t\t\tscene.add( nodes[ i ] );\n\n\t\t\t}\n\n\t\t\t// Removes dangling associations, associations that reference a node that\n\t\t\t// didn't make it into the scene.\n\t\t\tconst reduceAssociations = ( node ) => {\n\n\t\t\t\tconst reducedAssociations = new Map();\n\n\t\t\t\tfor ( const [ key, value ] of parser.associations ) {\n\n\t\t\t\t\tif ( key instanceof Material || key instanceof Texture ) {\n\n\t\t\t\t\t\treducedAssociations.set( key, value );\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tnode.traverse( ( node ) => {\n\n\t\t\t\t\tconst mappings = parser.associations.get( node );\n\n\t\t\t\t\tif ( mappings != null ) {\n\n\t\t\t\t\t\treducedAssociations.set( node, mappings );\n\n\t\t\t\t\t}\n\n\t\t\t\t} );\n\n\t\t\t\treturn reducedAssociations;\n\n\t\t\t};\n\n\t\t\tparser.associations = reduceAssociations( scene );\n\n\t\t\treturn scene;\n\n\t\t} );\n\n\t}\n\n\t_createAnimationTracks( node, inputAccessor, outputAccessor, sampler, target ) {\n\n\t\tconst tracks = [];\n\n\t\tconst targetName = node.name ? node.name : node.uuid;\n\t\tconst targetNames = [];\n\n\t\tif ( PATH_PROPERTIES[ target.path ] === PATH_PROPERTIES.weights ) {\n\n\t\t\tnode.traverse( function ( object ) {\n\n\t\t\t\tif ( object.morphTargetInfluences ) {\n\n\t\t\t\t\ttargetNames.push( object.name ? object.name : object.uuid );\n\n\t\t\t\t}\n\n\t\t\t} );\n\n\t\t} else {\n\n\t\t\ttargetNames.push( targetName );\n\n\t\t}\n\n\t\tlet TypedKeyframeTrack;\n\n\t\tswitch ( PATH_PROPERTIES[ target.path ] ) {\n\n\t\t\tcase PATH_PROPERTIES.weights:\n\n\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.rotation:\n\n\t\t\t\tTypedKeyframeTrack = QuaternionKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tcase PATH_PROPERTIES.translation:\n\t\t\tcase PATH_PROPERTIES.scale:\n\n\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\n\t\t\t\tswitch ( outputAccessor.itemSize ) {\n\n\t\t\t\t\tcase 1:\n\t\t\t\t\t\tTypedKeyframeTrack = NumberKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\tcase 2:\n\t\t\t\t\tcase 3:\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tTypedKeyframeTrack = VectorKeyframeTrack;\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\tconst interpolation = sampler.interpolation !== undefined ? INTERPOLATION[ sampler.interpolation ] : InterpolateLinear;\n\n\n\t\tconst outputArray = this._getArrayFromAccessor( outputAccessor );\n\n\t\tfor ( let j = 0, jl = targetNames.length; j < jl; j ++ ) {\n\n\t\t\tconst track = new TypedKeyframeTrack(\n\t\t\t\ttargetNames[ j ] + '.' + PATH_PROPERTIES[ target.path ],\n\t\t\t\tinputAccessor.array,\n\t\t\t\toutputArray,\n\t\t\t\tinterpolation\n\t\t\t);\n\n\t\t\t// Override interpolation with custom factory method.\n\t\t\tif ( sampler.interpolation === 'CUBICSPLINE' ) {\n\n\t\t\t\tthis._createCubicSplineTrackInterpolant( track );\n\n\t\t\t}\n\n\t\t\ttracks.push( track );\n\n\t\t}\n\n\t\treturn tracks;\n\n\t}\n\n\t_getArrayFromAccessor( accessor ) {\n\n\t\tlet outputArray = accessor.array;\n\n\t\tif ( accessor.normalized ) {\n\n\t\t\tconst scale = getNormalizedComponentScale( outputArray.constructor );\n\t\t\tconst scaled = new Float32Array( outputArray.length );\n\n\t\t\tfor ( let j = 0, jl = outputArray.length; j < jl; j ++ ) {\n\n\t\t\t\tscaled[ j ] = outputArray[ j ] * scale;\n\n\t\t\t}\n\n\t\t\toutputArray = scaled;\n\n\t\t}\n\n\t\treturn outputArray;\n\n\t}\n\n\t_createCubicSplineTrackInterpolant( track ) {\n\n\t\ttrack.createInterpolant = function InterpolantFactoryMethodGLTFCubicSpline( result ) {\n\n\t\t\t// A CUBICSPLINE keyframe in glTF has three output values for each input value,\n\t\t\t// representing inTangent, splineVertex, and outTangent. As a result, track.getValueSize()\n\t\t\t// must be divided by three to get the interpolant's sampleSize argument.\n\n\t\t\tconst interpolantType = ( this instanceof QuaternionKeyframeTrack ) ? GLTFCubicSplineQuaternionInterpolant : GLTFCubicSplineInterpolant;\n\n\t\t\treturn new interpolantType( this.times, this.values, this.getValueSize() / 3, result );\n\n\t\t};\n\n\t\t// Mark as CUBICSPLINE. `track.getInterpolation()` doesn't support custom interpolants.\n\t\ttrack.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline = true;\n\n\t}\n\n}\n\n/**\n *\n * @private\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n */\nfunction computeBounds( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst box = new Box3();\n\n\tif ( attributes.POSITION !== undefined ) {\n\n\t\tconst accessor = parser.json.accessors[ attributes.POSITION ];\n\n\t\tconst min = accessor.min;\n\t\tconst max = accessor.max;\n\n\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\tbox.set(\n\t\t\t\tnew Vector3( min[ 0 ], min[ 1 ], min[ 2 ] ),\n\t\t\t\tnew Vector3( max[ 0 ], max[ 1 ], max[ 2 ] )\n\t\t\t);\n\n\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\tbox.min.multiplyScalar( boxScale );\n\t\t\t\tbox.max.multiplyScalar( boxScale );\n\n\t\t\t}\n\n\t\t} else {\n\n\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\treturn;\n\n\t\t}\n\n\t} else {\n\n\t\treturn;\n\n\t}\n\n\tconst targets = primitiveDef.targets;\n\n\tif ( targets !== undefined ) {\n\n\t\tconst maxDisplacement = new Vector3();\n\t\tconst vector = new Vector3();\n\n\t\tfor ( let i = 0, il = targets.length; i < il; i ++ ) {\n\n\t\t\tconst target = targets[ i ];\n\n\t\t\tif ( target.POSITION !== undefined ) {\n\n\t\t\t\tconst accessor = parser.json.accessors[ target.POSITION ];\n\t\t\t\tconst min = accessor.min;\n\t\t\t\tconst max = accessor.max;\n\n\t\t\t\t// glTF requires 'min' and 'max', but VRM (which extends glTF) currently ignores that requirement.\n\n\t\t\t\tif ( min !== undefined && max !== undefined ) {\n\n\t\t\t\t\t// we need to get max of absolute components because target weight is [-1,1]\n\t\t\t\t\tvector.setX( Math.max( Math.abs( min[ 0 ] ), Math.abs( max[ 0 ] ) ) );\n\t\t\t\t\tvector.setY( Math.max( Math.abs( min[ 1 ] ), Math.abs( max[ 1 ] ) ) );\n\t\t\t\t\tvector.setZ( Math.max( Math.abs( min[ 2 ] ), Math.abs( max[ 2 ] ) ) );\n\n\n\t\t\t\t\tif ( accessor.normalized ) {\n\n\t\t\t\t\t\tconst boxScale = getNormalizedComponentScale( WEBGL_COMPONENT_TYPES[ accessor.componentType ] );\n\t\t\t\t\t\tvector.multiplyScalar( boxScale );\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// Note: this assumes that the sum of all weights is at most 1. This isn't quite correct - it's more conservative\n\t\t\t\t\t// to assume that each target can have a max weight of 1. However, for some use cases - notably, when morph targets\n\t\t\t\t\t// are used to implement key-frame animations and as such only two are active at a time - this results in very large\n\t\t\t\t\t// boxes. So for now we make a box that's sometimes a touch too small but is hopefully mostly of reasonable size.\n\t\t\t\t\tmaxDisplacement.max( vector );\n\n\t\t\t\t} else {\n\n\t\t\t\t\tconsole.warn( 'THREE.GLTFLoader: Missing min/max properties for accessor POSITION.' );\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t}\n\n\t\t// As per comment above this box isn't conservative, but has a reasonable size for a very large number of morph targets.\n\t\tbox.expandByVector( maxDisplacement );\n\n\t}\n\n\tgeometry.boundingBox = box;\n\n\tconst sphere = new Sphere();\n\n\tbox.getCenter( sphere.center );\n\tsphere.radius = box.min.distanceTo( box.max ) / 2;\n\n\tgeometry.boundingSphere = sphere;\n\n}\n\n/**\n *\n * @private\n * @param {BufferGeometry} geometry\n * @param {GLTF.Primitive} primitiveDef\n * @param {GLTFParser} parser\n * @return {Promise<BufferGeometry>}\n */\nfunction addPrimitiveAttributes( geometry, primitiveDef, parser ) {\n\n\tconst attributes = primitiveDef.attributes;\n\n\tconst pending = [];\n\n\tfunction assignAttributeAccessor( accessorIndex, attributeName ) {\n\n\t\treturn parser.getDependency( 'accessor', accessorIndex )\n\t\t\t.then( function ( accessor ) {\n\n\t\t\t\tgeometry.setAttribute( attributeName, accessor );\n\n\t\t\t} );\n\n\t}\n\n\tfor ( const gltfAttributeName in attributes ) {\n\n\t\tconst threeAttributeName = ATTRIBUTES[ gltfAttributeName ] || gltfAttributeName.toLowerCase();\n\n\t\t// Skip attributes already provided by e.g. Draco extension.\n\t\tif ( threeAttributeName in geometry.attributes ) continue;\n\n\t\tpending.push( assignAttributeAccessor( attributes[ gltfAttributeName ], threeAttributeName ) );\n\n\t}\n\n\tif ( primitiveDef.indices !== undefined && ! geometry.index ) {\n\n\t\tconst accessor = parser.getDependency( 'accessor', primitiveDef.indices ).then( function ( accessor ) {\n\n\t\t\tgeometry.setIndex( accessor );\n\n\t\t} );\n\n\t\tpending.push( accessor );\n\n\t}\n\n\tif ( ColorManagement.workingColorSpace !== LinearSRGBColorSpace && 'COLOR_0' in attributes ) {\n\n\t\tconsole.warn( `THREE.GLTFLoader: Converting vertex colors from \"srgb-linear\" to \"${ColorManagement.workingColorSpace}\" not supported.` );\n\n\t}\n\n\tassignExtrasToUserData( geometry, primitiveDef );\n\n\tcomputeBounds( geometry, primitiveDef, parser );\n\n\treturn Promise.all( pending ).then( function () {\n\n\t\treturn primitiveDef.targets !== undefined\n\t\t\t? addMorphTargets( geometry, primitiveDef.targets, parser )\n\t\t\t: geometry;\n\n\t} );\n\n}\n\n/**\n * Loader result of `GLTFLoader`.\n *\n * @typedef {Object} GLTFLoader~LoadObject\n * @property {Array<AnimationClip>} animations - An array of animation clips.\n * @property {Object} asset - Meta data about the loaded asset.\n * @property {Array<Camera>} cameras - An array of cameras.\n * @property {GLTFParser} parser - A reference to the internal parser.\n * @property {Group} scene - The default scene.\n * @property {Array<Group>} scenes - glTF assets might define multiple scenes.\n * @property {Object} userData - Additional data.\n **/\n\nexport { GLTFLoader };\n","/**\r\n* This file holds configurable parameters of the game.\r\n*\r\n*/\r\n\r\nconst CONFIG = {\r\n\tAUDIO: {\r\n\t\tVOLUME_IMPACT: 0.2 // volume\r\n\t},\r\n\tPLAYER: {\r\n\t\tBOUNDING_RADIUS: 0.5, // meter\r\n\t\tDYING_TIME: 3, // seconds\r\n\t\tHEAD_HEIGHT: 1.7, // meter\r\n\t\tMAX_HEALTH: 100, // health points\r\n\t\tMAX_SPEED: 6 // meter/seconds\r\n\t},\r\n\tCONTROLS: {\r\n\t\tLOOKING_SPEED: 2, // unitless\r\n\t\tBRAKING_POWER: 10, // unitless\r\n\t\tHEAD_MOVEMENT: 1.2, // unitless\r\n\t\tWEAPON_MOVEMENT: 1.2, // unitless\r\n\t\tACCELERATION: 60 // unitless\r\n\t},\r\n\tHEALTH_PACK: {\r\n\t\tHEALTH: 50, // health\r\n\t\tRESPAWN_TIME: 10, // seconds\r\n\t\tRADIUS: 1 // world units\r\n\t},\r\n\tBOT: {\r\n\t\tMOVEMENT: {\r\n\t\t\tMAX_SPEED: 3, // meter/seconds\r\n\t\t\tDODGE_SIZE: 4 // meter\r\n\t\t},\r\n\t\tGOAL: {\r\n\t\t\tUPDATE_FREQUENCY: 5, // number per seconds\r\n\t\t\tITEM_VISIBILITY_UPDATE_FREQUENCY: 1 // number per seconds\r\n\t\t},\r\n\t\tMEMORY: {\r\n\t\t\tSPAN: 20 // seconds\r\n\t\t},\r\n\t\tNAVIGATION: {\r\n\t\t\tNEXT_WAYPOINT_DISTANCE: 0.5, // meter\r\n\t\t\tARRIVE_DECELERATION: 2, // unitless\r\n\t\t\tARRIVE_TOLERANCE: 1, // meter\r\n\t\t\tPATH_RADIUS: 0.1, // meter\r\n\t\t\tONPATH_WEIGHT: 1 // unitless\r\n\t\t},\r\n\t\tTARGET_SYSTEM: {\r\n\t\t\tUPDATE_FREQUENCY: 5 // number per seconds\r\n\t\t},\r\n\t\tVISION: {\r\n\t\t\tUPDATE_FREQUENCY: 5, // number per seconds\r\n\t\t\tFOV: 140, // degrees\r\n\t\t\tRANGE: 40 // meter\r\n\t\t},\r\n\t\tWEAPON: {\r\n\t\t\tUPDATE_FREQUENCY: 4, // number per seconds\r\n\t\t\tREACTION_TIME: 1, // seconds\r\n\t\t\tAIM_ACCURACY: 3, // meter\r\n\t\t\tCHANGE_COST: 0.5, // desirability\r\n\t\t\tNOISE_MAX_DISTANCE: 100 // meter\r\n\t\t},\r\n\t\tBOUNDING_RADIUS: 0.5, // meter\r\n\t\tCOUNT: 3, // number\r\n\t\tHEAD_HEIGHT: 1.5, // meter\r\n\t\tMAX_HEALTH: 100, // health points\r\n\t\tDYING_TIME: 3, // seconds\r\n\t\tSEARCH_FOR_ATTACKER_TIME: 3, // seconds\r\n\t\tMIN_ITEM_RANGE: 2, // meter\r\n\t\tMAX_ITEM_RANGE: 25, // meter\r\n\t\tIGNORE_ITEMS_TIMEOUT: 30, // seconds\r\n\t\tGOAL_ARBITRATION_FREQUENCY: 5, // number per seconds\r\n\t},\r\n\tBLASTER: {\r\n\t\tROUNDS_LEFT: 12, // number\r\n\t\tROUNDS_PER_CLIP: 12, // number\r\n\t\tAMMO: 48, // number\r\n\t\tMAX_AMMO: 48, // number\r\n\t\tSHOT_TIME: 0.4, // seconds\r\n\t\tRELOAD_TIME: 1.6, // seconds\r\n\t\tMUZZLE_TIME: 0.04, // seconds\r\n\t\tEQUIP_TIME: 0.5, // seconds\r\n\t\tHIDE_TIME: 0.5, // seconds\r\n\t\tSPREAD: 0.01, // unitless\r\n\t\tRESPAWN_TIME: 10, // seconds\r\n\t\tRADIUS: 1, // world units\r\n\r\n\t},\r\n\tSHOTGUN: {\r\n\t\tROUNDS_LEFT: 6, // number\r\n\t\tROUNDS_PER_CLIP: 6, // number\r\n\t\tAMMO: 24, // number\r\n\t\tMAX_AMMO: 24, // number\r\n\t\tSHOT_TIME: 1.2, // seconds\r\n\t\tRELOAD_TIME: 1.6, // seconds\r\n\t\tSHOT_RELOAD_TIME: 0.5, // seconds\r\n\t\tMUZZLE_TIME: 0.04, // seconds\r\n\t\tEQUIP_TIME: 1, // seconds\r\n\t\tHIDE_TIME: 1, // seconds\r\n\t\tSPREAD: 0.05, // unitless\r\n\t\tBULLETS_PER_SHOT: 6, // number\r\n\t\tRESPAWN_TIME: 10, // seconds\r\n\t\tRADIUS: 1, // world units\r\n\r\n\t},\r\n\tASSAULT_RIFLE: {\r\n\t\tROUNDS_LEFT: 30, // number\r\n\t\tROUNDS_PER_CLIP: 30, // number\r\n\t\tAMMO: 90, // number\r\n\t\tMAX_AMMO: 90, // number\r\n\t\tSHOT_TIME: 0.2, // seconds\r\n\t\tRELOAD_TIME: 1.6, // seconds\r\n\t\tMUZZLE_TIME: 0.04, // seconds\r\n\t\tEQUIP_TIME: 1, // seconds\r\n\t\tHIDE_TIME: 1, // seconds\r\n\t\tSPREAD: 0.01, // unitless\r\n\t\tRESPAWN_TIME: 10, // seconds\r\n\t\tRADIUS: 1, // world units\r\n\r\n\t},\r\n\tBULLET: {\r\n\t\tMAX_SPEED: 400, // meter/seconds\r\n\t\tLIFETIME: 1, // seconds\r\n\t\tDAMAGE: 20 // health points\r\n\t},\r\n\tUI: {\r\n\t\tCROSSHAIRS: {\r\n\t\t\tHIT_TIME: 0.3, // seconds\r\n\t\t\tOPACITY: 0.5, // number\r\n\t\t\tSCALE: 40 // number\r\n\t\t},\r\n\t\tDAMAGE_INDICATOR: {\r\n\t\t\tOPACITY: 0.5, // number\r\n\t\t\tSCALE: 256, // number\r\n\t\t\tTIME: 0.5, //seconds\r\n\t\t},\r\n\t\tFRAGS: {\r\n\t\t\tTIME: 5, // seconds\r\n\t\t}\r\n\t},\r\n\tNAVMESH: {\r\n\t\tHEIGHT_CHANGE_FACTOR: 0.2 // unitless\r\n\t}\r\n};\r\n\r\nexport { CONFIG };\r\n","import { LoadingManager, AnimationLoader, AudioLoader, TextureLoader, Mesh, AnimationClip, Texture } from 'three';\r\nimport { Sprite, SpriteMaterial, DoubleSide, AudioListener, PositionalAudio } from 'three';\r\nimport { LineSegments, LineBasicMaterial, MeshBasicMaterial, MeshStandardMaterial, BufferGeometry, Vector3, PlaneGeometry, BufferAttribute } from 'three';\r\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\r\nimport { NavMeshLoader, CostTable } from 'yuka';\r\nimport { CONFIG } from './Config';\r\n\r\n/**\r\n* Class for representing the global asset manager. It is responsible\r\n* for loading and parsing all assets from the backend and provide\r\n* the result in a series of maps.\r\n*\r\n*/\r\nclass AssetManager {\r\n\r\n\tpublic loadingManager: LoadingManager;\r\n\tpublic animationLoader: AnimationLoader;\r\n\tpublic audioLoader: AudioLoader;\r\n\tpublic textureLoader: TextureLoader;\r\n\tpublic gltfLoader: GLTFLoader;\r\n\tpublic navMeshLoader: NavMeshLoader;\r\n\r\n\tpublic listener: AudioListener;\r\n\r\n\tpublic animations: Map<string, AnimationClip>;\r\n\tpublic audios: Map<string, PositionalAudio>;\r\n\tpublic configs: Map<string, any>;\r\n\tpublic models: Map<string, any>;\r\n\tpublic textures: Map<string, Texture>;\r\n\r\n\tpublic navMesh: any;\r\n\tpublic costTable: any;\r\n\r\n\t/**\r\n\t* Constructs a new asset manager with the given values.\r\n\t*/\r\n\tconstructor() {\r\n\r\n\t\tthis.loadingManager = new LoadingManager();\r\n\r\n\t\tthis.animationLoader = new AnimationLoader(this.loadingManager);\r\n\t\tthis.audioLoader = new AudioLoader(this.loadingManager);\r\n\t\tthis.textureLoader = new TextureLoader(this.loadingManager);\r\n\t\tthis.gltfLoader = new GLTFLoader(this.loadingManager);\r\n\t\tthis.navMeshLoader = new NavMeshLoader();\r\n\r\n\t\tthis.listener = new AudioListener();\r\n\r\n\t\tthis.animations = new Map();\r\n\t\tthis.audios = new Map();\r\n\t\tthis.configs = new Map();\r\n\t\tthis.models = new Map();\r\n\t\tthis.textures = new Map();\r\n\r\n\t\tthis.navMesh = null;\r\n\t\tthis.costTable = null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Initializes the asset manager. All assets are prepared so they\r\n\t* can be used by the game.\r\n\t*\r\n\t* @return {Promise} Resolves when all assets are ready.\r\n\t*/\r\n\tinit() {\r\n\r\n\t\tthis._loadAnimations();\r\n\t\tthis._loadAudios();\r\n\t\tthis._loadConfigs();\r\n\t\tthis._loadModels();\r\n\t\tthis._loadTextures();\r\n\t\tthis._loadNavMesh();\r\n\r\n\t\treturn new Promise((resolve) => {\r\n\r\n\t\t\tthis.loadingManager.onLoad = () => {\r\n\r\n\t\t\t\tresolve(undefined);\r\n\r\n\t\t\t};\r\n\r\n\t\t});\r\n\r\n\t}\r\n\r\n\r\n\t/**\r\n\t* Clones a positional audio.\r\n\t*\r\n\t* @param {PositionalAudio} source - A positional audio.\r\n\t* @return {PositionalAudio} A clone of the given audio.\r\n\t*/\r\n\tcloneAudio(source: PositionalAudio): PositionalAudio {\r\n\r\n\t\tconst audio = new PositionalAudio(source.listener);\r\n\t\taudio.buffer = source.buffer;\r\n\r\n\t\treturn audio;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Loads all external animations from the backend.\r\n\t*\r\n\t* @return {AssetManager} A reference to this asset manager.\r\n\t*/\r\n\t_loadAnimations() {\r\n\r\n\t\tconst animationLoader = this.animationLoader;\r\n\r\n\t\t// player\r\n\r\n\t\tanimationLoader.load('./assets/animations/player.json', (clips) => {\r\n\r\n\t\t\tfor (const clip of clips) {\r\n\r\n\t\t\t\tthis.animations.set(clip.name, clip);\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// blaster\r\n\r\n\t\tanimationLoader.load('./assets/animations/blaster.json', (clips) => {\r\n\r\n\t\t\tfor (const clip of clips) {\r\n\r\n\t\t\t\tthis.animations.set(clip.name, clip);\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// shotgun\r\n\r\n\t\tanimationLoader.load('./assets/animations/shotgun.json', (clips) => {\r\n\r\n\t\t\tfor (const clip of clips) {\r\n\r\n\t\t\t\tthis.animations.set(clip.name, clip);\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// assault rifle\r\n\r\n\t\tanimationLoader.load('./assets/animations/assaultRifle.json', (clips) => {\r\n\r\n\t\t\tfor (const clip of clips) {\r\n\r\n\t\t\t\tthis.animations.set(clip.name, clip);\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Loads all audios from the backend.\r\n\t*\r\n\t* @return {AssetManager} A reference to this asset manager.\r\n\t*/\r\n\t_loadAudios() {\r\n\r\n\t\tconst audioLoader = this.audioLoader;\r\n\t\tconst audios = this.audios;\r\n\t\tconst listener = this.listener;\r\n\r\n\t\tconst blasterShot = new PositionalAudio(listener);\r\n\t\tblasterShot.matrixAutoUpdate = false;\r\n\r\n\t\tconst shotgunShot = new PositionalAudio(listener);\r\n\t\tshotgunShot.matrixAutoUpdate = false;\r\n\r\n\t\tconst assaultRifleShot = new PositionalAudio(listener);\r\n\t\tassaultRifleShot.matrixAutoUpdate = false;\r\n\r\n\t\tconst reload = new PositionalAudio(listener);\r\n\t\treload.matrixAutoUpdate = false;\r\n\r\n\t\tconst shotgunShotReload = new PositionalAudio(listener);\r\n\t\tshotgunShotReload.matrixAutoUpdate = false;\r\n\r\n\t\tconst step1 = new PositionalAudio(listener);\r\n\t\tstep1.matrixAutoUpdate = false;\r\n\r\n\t\tconst step2 = new PositionalAudio(listener);\r\n\t\tstep2.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact1 = new PositionalAudio(listener);\r\n\t\timpact1.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact1.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact2 = new PositionalAudio(listener);\r\n\t\timpact2.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact2.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact3 = new PositionalAudio(listener);\r\n\t\timpact3.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact3.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact4 = new PositionalAudio(listener);\r\n\t\timpact4.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact4.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact5 = new PositionalAudio(listener);\r\n\t\timpact5.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact5.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact6 = new PositionalAudio(listener);\r\n\t\timpact6.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact6.matrixAutoUpdate = false;\r\n\r\n\t\tconst impact7 = new PositionalAudio(listener);\r\n\t\timpact7.setVolume(CONFIG.AUDIO.VOLUME_IMPACT);\r\n\t\timpact7.matrixAutoUpdate = false;\r\n\r\n\t\tconst health = new PositionalAudio(listener);\r\n\t\thealth.matrixAutoUpdate = false;\r\n\r\n\t\tconst ammo = new PositionalAudio(listener);\r\n\t\tammo.matrixAutoUpdate = false;\r\n\r\n\t\taudioLoader.load('./assets/audio/sfx/weapons/blaster_shot.ogg', buffer => blasterShot.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/weapons/shotgun_shot.ogg', buffer => shotgunShot.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/weapons/assault_rifle_shot.ogg', buffer => assaultRifleShot.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/weapons/reload.ogg', buffer => reload.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/weapons/shotgun_shot_reload.ogg', buffer => shotgunShotReload.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/player/step1.ogg', buffer => step1.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/player/step2.ogg', buffer => step2.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact1.ogg', buffer => impact1.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact2.ogg', buffer => impact2.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact3.ogg', buffer => impact3.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact4.ogg', buffer => impact4.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact5.ogg', buffer => impact5.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact6.ogg', buffer => impact6.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/impacts/impact7.ogg', buffer => impact7.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/ui/health.ogg', buffer => health.setBuffer(buffer));\r\n\t\taudioLoader.load('./assets/audio/sfx/ui/ammo.ogg', buffer => ammo.setBuffer(buffer));\r\n\r\n\t\taudios.set('blaster_shot', blasterShot);\r\n\t\taudios.set('shotgun_shot', shotgunShot);\r\n\t\taudios.set('assault_rifle_shot', assaultRifleShot);\r\n\t\taudios.set('reload', reload);\r\n\t\taudios.set('shotgun_shot_reload', shotgunShotReload);\r\n\t\taudios.set('step1', step1);\r\n\t\taudios.set('step2', step2);\r\n\t\taudios.set('impact1', impact1);\r\n\t\taudios.set('impact2', impact2);\r\n\t\taudios.set('impact3', impact3);\r\n\t\taudios.set('impact4', impact4);\r\n\t\taudios.set('impact5', impact5);\r\n\t\taudios.set('impact6', impact6);\r\n\t\taudios.set('impact7', impact7);\r\n\t\taudios.set('health', health);\r\n\t\taudios.set('ammo', ammo);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Loads all configurations from the backend.\r\n\t*\r\n\t* @return {AssetManager} A reference to this asset manager.\r\n\t*/\r\n\t_loadConfigs() {\r\n\r\n\t\tconst loadingManager = this.loadingManager;\r\n\t\tconst configs = this.configs;\r\n\r\n\t\t// level config\r\n\r\n\t\tloadingManager.itemStart('levelConfig');\r\n\r\n\t\tfetch('./assets/data/config/level.json')\r\n\t\t\t.then(response => {\r\n\r\n\t\t\t\treturn response.json();\r\n\r\n\t\t\t})\r\n\t\t\t.then(json => {\r\n\r\n\t\t\t\tconfigs.set('level', json);\r\n\r\n\t\t\t\tloadingManager.itemEnd('levelConfig');\r\n\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Loads all models from the backend.\r\n\t*\r\n\t* @return {AssetManager} A reference to this asset manager.\r\n\t*/\r\n\t_loadModels() {\r\n\r\n\t\tconst gltfLoader = this.gltfLoader;\r\n\t\tconst textureLoader = this.textureLoader;\r\n\t\tconst models = this.models;\r\n\t\tconst animations = this.animations;\r\n\r\n\t\t// shadow for soldiers\r\n\r\n\t\tconst shadowTexture = textureLoader.load('./assets/textures/environment/shadow.png');\r\n\t\tconst planeGeometry = new PlaneGeometry();\r\n\t\tconst planeMaterial = new MeshBasicMaterial({ map: shadowTexture, transparent: true, opacity: 0.4 });\r\n\r\n\t\tconst shadowPlane = new Mesh(planeGeometry, planeMaterial);\r\n\t\tshadowPlane.position.set(0, 0.05, 0);\r\n\t\tshadowPlane.rotation.set(- Math.PI * 0.5, 0, 0);\r\n\t\tshadowPlane.scale.multiplyScalar(2);\r\n\t\tshadowPlane.matrixAutoUpdate = false;\r\n\t\tshadowPlane.updateMatrix();\r\n\r\n\t\t// soldier\r\n\r\n\t\tgltfLoader.load('./assets/models/characters/soldier.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.animations = gltf.animations;\r\n\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tif (object instanceof Mesh) {\r\n\r\n\t\t\t\t\tobject.material.side = DoubleSide;\r\n\t\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\trenderComponent.add(shadowPlane);\r\n\r\n\t\t\tmodels.set('soldier', renderComponent);\r\n\r\n\t\t\tfor (let animation of gltf.animations) {\r\n\r\n\t\t\t\tanimations.set(animation.name, animation);\r\n\r\n\t\t\t}\r\n\r\n\t\t});\r\n\r\n\t\t// level\r\n\r\n\t\tgltfLoader.load('./assets/models/environment/level.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t// Apply enhanced gray gradient material with procedural detail\r\n\r\n\t\tconst mesh = renderComponent.getObjectByName('level') as Mesh;\r\n\t\tif (mesh && mesh.material) {\r\n\t\t\tconst oldMaterial = mesh.material as MeshBasicMaterial;\r\n\t\t\t\r\n\t\t\t// Simple pseudo-random function for noise\r\n\t\t\tconst hash = (x: number, y: number, z: number) => {\r\n\t\t\t\tconst p = Math.sin(x * 12.9898 + y * 78.233 + z * 45.164) * 43758.5453;\r\n\t\t\t\treturn p - Math.floor(p);\r\n\t\t\t};\r\n\t\t\t\r\n\t\t\t// Add vertex colors with enhanced gradient and detail\r\n\t\t\tconst geometry = mesh.geometry;\r\n\t\t\t\r\n\t\t\t// Always regenerate colors (remove old if exists)\r\n\t\t\tconst positions = geometry.attributes.position;\r\n\t\t\tconst normals = geometry.attributes.normal;\r\n\t\t\tconst colors = new Float32Array(positions.count * 3);\r\n\t\t\t\r\n\t\t\t// Find bounds for gradient\r\n\t\t\tlet minY = Infinity, maxY = -Infinity;\r\n\t\t\tlet minX = Infinity, maxX = -Infinity;\r\n\t\t\tlet minZ = Infinity, maxZ = -Infinity;\r\n\t\t\t\r\n\t\t\tfor (let i = 0; i < positions.count; i++) {\r\n\t\t\t\tconst x = positions.getX(i);\r\n\t\t\t\tconst y = positions.getY(i);\r\n\t\t\t\tconst z = positions.getZ(i);\r\n\t\t\t\tif (y < minY) minY = y;\r\n\t\t\t\tif (y > maxY) maxY = y;\r\n\t\t\t\tif (x < minX) minX = x;\r\n\t\t\t\tif (x > maxX) maxX = x;\r\n\t\t\t\tif (z < minZ) minZ = z;\r\n\t\t\t\tif (z > maxZ) maxZ = z;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tconst rangeY = maxY - minY;\r\n\t\t\t\r\n\t\t\t// Apply enhanced gradient with multiple factors\r\n\t\t\tfor (let i = 0; i < positions.count; i++) {\r\n\t\t\t\tconst x = positions.getX(i);\r\n\t\t\t\tconst y = positions.getY(i);\r\n\t\t\t\tconst z = positions.getZ(i);\r\n\t\t\t\t\r\n\t\t\t\t// Height-based gradient (0.2 to 0.8)\r\n\t\t\t\tconst normalizedY = (y - minY) / rangeY;\r\n\t\t\t\tlet grayValue = 0.2 + normalizedY * 0.6;\r\n\t\t\t\t\r\n\t\t\t\t// Add procedural noise for texture detail (subtle)\r\n\t\t\t\tconst noise = hash(x * 0.1, y * 0.1, z * 0.1);\r\n\t\t\t\tgrayValue += (noise - 0.5) * 0.08;\r\n\t\t\t\t\r\n\t\t\t\t// Add ambient occlusion-like darkening near edges/corners\r\n\t\t\t\tif (normals) {\r\n\t\t\t\t\tconst ny = normals.getY(i);\r\n\t\t\t\t\t\r\n\t\t\t\t\t// Darken based on normal orientation (occluded areas)\r\n\t\t\t\t\tconst occlusion = (ny + 1) * 0.5; // Up-facing surfaces are lighter\r\n\t\t\t\t\tgrayValue *= 0.7 + occlusion * 0.3;\r\n\t\t\t\t}\r\n\t\t\t\t\r\n\t\t\t\t// Add subtle variation based on position\r\n\t\t\t\tconst posNoise = hash(x * 0.05, y * 0.05, z * 0.05);\r\n\t\t\t\tgrayValue += (posNoise - 0.5) * 0.05;\r\n\t\t\t\t\r\n\t\t\t\t// Clamp values\r\n\t\t\t\tgrayValue = Math.max(0.15, Math.min(0.85, grayValue));\r\n\t\t\t\t\r\n\t\t\t\t// Slight color tint for more interesting look\r\n\t\t\t\tcolors[i * 3] = grayValue * 0.98;     // R (slightly less red)\r\n\t\t\t\tcolors[i * 3 + 1] = grayValue;        // G\r\n\t\t\t\tcolors[i * 3 + 2] = grayValue * 1.02; // B (slightly more blue)\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tgeometry.setAttribute('color', new BufferAttribute(colors, 3));\r\n\t\t\t\r\n\t\t\t// Use MeshStandardMaterial for PBR rendering\r\n\t\t\tconst newMaterial = new MeshStandardMaterial({\r\n\t\t\t\tvertexColors: true,\r\n\t\t\t\tcolor: 0xffffff,\r\n\t\t\t\troughness: 0.9,      // Slightly rough for concrete-like appearance\r\n\t\t\t\tmetalness: 0.0,      // Non-metallic\r\n\t\t\t\tflatShading: false,  // Smooth shading\r\n\t\t\t\tenvMapIntensity: 0.3 // Subtle environment reflections\r\n\t\t\t});\r\n\t\t\t\r\n\t\t\tmesh.material = newMaterial;\r\n\t\t\toldMaterial.dispose();\r\n\t\t}\r\n\r\n\t\tmodels.set('level', renderComponent);\r\n\r\n\t});\r\n\r\n\t// blaster, high poly\r\n\r\n\tgltfLoader.load('./assets/models/weapons/blaster_high.glb', (gltf) => {\r\n\r\n\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('blaster_high', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// blaster, low poly\r\n\r\n\t\tgltfLoader.load('./assets/models/weapons/blaster_low.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('blaster_low', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// shotgun, high poly\r\n\r\n\t\tgltfLoader.load('./assets/models/weapons/shotgun_high.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('shotgun_high', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// shotgun, low poly\r\n\r\n\t\tgltfLoader.load('./assets/models/weapons/shotgun_low.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('shotgun_low', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// assault rifle, high poly\r\n\r\n\t\tgltfLoader.load('./assets/models/weapons/assaultRifle_high.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('assaultRifle_high', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// assault rifle, low poly\r\n\r\n\t\tgltfLoader.load('./assets/models/weapons/assaultRifle_low.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('assaultRifle_low', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// health pack\r\n\r\n\t\tgltfLoader.load('./assets/models/props/healthPack.glb', (gltf) => {\r\n\r\n\t\t\tconst renderComponent = gltf.scene;\r\n\t\t\trenderComponent.matrixAutoUpdate = false;\r\n\t\t\trenderComponent.updateMatrix();\r\n\r\n\t\t\trenderComponent.traverse((object) => {\r\n\r\n\t\t\t\tobject.matrixAutoUpdate = false;\r\n\t\t\t\tobject.updateMatrix();\r\n\r\n\t\t\t});\r\n\r\n\t\t\tmodels.set('healthPack', renderComponent);\r\n\r\n\t\t});\r\n\r\n\t\t// muzzle sprite\r\n\r\n\t\tconst muzzleTexture = textureLoader.load('./assets/textures/effects/muzzle.png');\r\n\t\tmuzzleTexture.matrixAutoUpdate = false;\r\n\r\n\t\tconst muzzleMaterial = new SpriteMaterial({ map: muzzleTexture });\r\n\t\tconst muzzle = new Sprite(muzzleMaterial);\r\n\t\tmuzzle.matrixAutoUpdate = false;\r\n\t\tmuzzle.visible = false;\r\n\r\n\t\tmodels.set('muzzle', muzzle);\r\n\r\n\t\t// bullet line\r\n\r\n\t\tconst bulletLineGeometry = new BufferGeometry();\r\n\t\tconst bulletLineMaterial = new LineBasicMaterial({ color: 0xfbf8e6 });\r\n\r\n\t\tbulletLineGeometry.setFromPoints([new Vector3(), new Vector3(0, 0, - 1)]);\r\n\r\n\t\tconst bulletLine = new LineSegments(bulletLineGeometry, bulletLineMaterial);\r\n\t\tbulletLine.matrixAutoUpdate = false;\r\n\r\n\t\tmodels.set('bulletLine', bulletLine);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Loads all textures from the backend.\r\n\t*\r\n\t* @return {AssetManager} A reference to this asset manager.\r\n\t*/\r\n\t_loadTextures() {\r\n\r\n\t\tconst textureLoader = this.textureLoader;\r\n\r\n\t\tlet texture = textureLoader.load('./assets/textures/ui/crosshairs.png');\r\n\t\ttexture.matrixAutoUpdate = false;\r\n\t\tthis.textures.set('crosshairs', texture);\r\n\r\n\t\ttexture = textureLoader.load('./assets/textures/ui/damageIndicatorFront.png');\r\n\t\ttexture.matrixAutoUpdate = false;\r\n\t\tthis.textures.set('damageIndicatorFront', texture);\r\n\r\n\t\ttexture = textureLoader.load('./assets/textures/ui/damageIndicatorRight.png');\r\n\t\ttexture.matrixAutoUpdate = false;\r\n\t\tthis.textures.set('damageIndicatorRight', texture);\r\n\r\n\t\ttexture = textureLoader.load('./assets/textures/ui/damageIndicatorLeft.png');\r\n\t\ttexture.matrixAutoUpdate = false;\r\n\t\tthis.textures.set('damageIndicatorLeft', texture);\r\n\r\n\t\ttexture = textureLoader.load('./assets/textures/ui/damageIndicatorBack.png');\r\n\t\ttexture.matrixAutoUpdate = false;\r\n\t\tthis.textures.set('damageIndicatorBack', texture);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Loads the navigation mesh from the backend.\r\n\t*\r\n\t* @return {AssetManager} A reference to this asset manager.\r\n\t*/\r\n\t_loadNavMesh() {\r\n\r\n\t\tconst navMeshLoader = this.navMeshLoader;\r\n\t\tconst loadingManager = this.loadingManager;\r\n\r\n\t\tloadingManager.itemStart('navmesh');\r\n\r\n\t\tnavMeshLoader.load('./assets/data/navmeshes/navmesh.glb').then((navMesh) => {\r\n\r\n\t\t\tthis.navMesh = navMesh;\r\n\r\n\t\t\tloadingManager.itemEnd('navmesh');\r\n\r\n\t\t});\r\n\r\n\t\t//\r\n\r\n\t\tloadingManager.itemStart('costTable');\r\n\r\n\t\tfetch('./assets/data/navmeshes/costTable.json')\r\n\t\t\t.then(response => {\r\n\r\n\t\t\t\treturn response.json();\r\n\r\n\t\t\t})\r\n\t\t\t.then(json => {\r\n\r\n\t\t\t\tthis.costTable = new CostTable().fromJSON(json);\r\n\r\n\t\t\t\tloadingManager.itemEnd('costTable');\r\n\r\n\t\t\t});\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { AssetManager };\r\n","import { GameEntity } from 'yuka';\r\n\r\n/**\r\n* A game entity which represents a collectable item.\r\n*\r\n*/\r\nclass Item extends GameEntity {\r\n\r\n\tpublic currentTime: number;\r\n\tpublic nextSpawnTime: number;\r\n\tpublic respawnTime: number;\r\n\tpublic type: any;\r\n\tpublic currentRegion: any;\r\n\tpublic _audio: any;\r\n\r\n\t/**\r\n\t* Constructs a new item.\r\n\t*/\r\n\tconstructor(itemType: any, respawnTime: number) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.canActivateTrigger = false;\r\n\r\n\t\tthis.currentTime = 0;\r\n\t\tthis.nextSpawnTime = Infinity;\r\n\t\tthis.respawnTime = respawnTime;\r\n\r\n\t\tthis.type = itemType;\r\n\r\n\t\tthis.currentRegion = null;\r\n\r\n\t\t//\r\n\r\n\t\tthis._audio = null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Prepares the respawn of this item.\r\n\t*\r\n\t* @return {Item} A reference to this game entity.\r\n\t*/\r\n\tprepareRespawn() {\r\n\r\n\t\tthis.active = false;\r\n\t\t(this as any)._renderComponent.visible = false;\r\n\r\n\t\t//\r\n\r\n\t\tconst audio = this._audio;\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t//\r\n\r\n\t\tthis.nextSpawnTime = this.currentTime + this.respawnTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Finishes the respawn of this item.\r\n\t*\r\n\t* @return {Item} A reference to this game entity.\r\n\t*/\r\n\tfinishRespawn() {\r\n\r\n\t\tthis.active = true;\r\n\t\t(this as any)._renderComponent.visible = true;\r\n\r\n\t\tthis.nextSpawnTime = Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Abstract method that has to be implemented by all concrete item types. It is\r\n\t* typically executed by a trigger.\r\n\t*\r\n\t* @param {GameEntity} entity - The entity that receives this item.\r\n\t* @return {Item} A reference to this item.\r\n\t*/\r\n\taddItemToEntity(_entity: any): void { }\r\n\r\n}\r\n\r\nexport { Item };\r\n","export const WEAPON_TYPES_BLASTER = 1;\r\nexport const WEAPON_TYPES_SHOTGUN = 2;\r\nexport const WEAPON_TYPES_ASSAULT_RIFLE = 3;\r\nexport const WEAPON_STATUS_READY = 4;\r\nexport const WEAPON_STATUS_SHOT = 5;\r\nexport const WEAPON_STATUS_RELOAD = 6;\r\nexport const WEAPON_STATUS_EMPTY = 7;\r\nexport const WEAPON_STATUS_OUT_OF_AMMO = 8;\r\nexport const WEAPON_STATUS_EQUIP = 9;\r\nexport const WEAPON_STATUS_HIDE = 10;\r\nexport const WEAPON_STATUS_UNREADY = 11;\r\nexport const STATUS_ALIVE = 12;\r\nexport const STATUS_DYING = 13;\r\nexport const STATUS_DEAD = 14;\r\nexport const HEALTH_PACK = 15;\r\nexport const MESSAGE_HIT = 'HIT';\r\nexport const MESSAGE_DEAD = 'DEAD';\r\n","import { CONFIG } from '../core/Config.js';\r\nimport { Item } from './Item.js';\r\nimport { HEALTH_PACK } from '../core/Constants.js';\r\n\r\n/**\r\n* A game entity which represents a collectable health pack.\r\n*/\r\nclass HealthPack extends Item {\r\n\r\n\tpublic health: number;\r\n\r\n\t/**\r\n\t* Constructs a new health pack.\r\n\t*/\r\n\tconstructor() {\r\n\r\n\t\tsuper(HEALTH_PACK, CONFIG.HEALTH_PACK.RESPAWN_TIME);\r\n\r\n\t\t/**\r\n\t\t* The amount of health which the health pack gives when it's collected.\r\n\t\t* @type {Number}\r\n\t\t*/\r\n\t\tthis.health = CONFIG.HEALTH_PACK.HEALTH;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Adds the health to the given entity.\r\n\t*\r\n\t* @param {GameEntity} entity - The entity that receives this item.\r\n\t* @return {HealthPack} A reference to this item.\r\n\t*/\r\n\taddItemToEntity(entity: any): this {\r\n\r\n\t\tentity.addHealth(this.health); // we assume .addHealth() is implemented by the game entity\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { HealthPack };\r\n","import { Trigger } from 'yuka';\r\n\r\n/**\r\n* Gives an entity an item if it touches the trigger region.\r\n*/\r\nclass ItemGiver extends Trigger {\r\n\r\n\tpublic item: any;\r\n\r\n\t/**\r\n\t* Constructs a new trigger with the given values.\r\n\t*\r\n\t* @param {TriggerRegion} region - The region of the trigger.\r\n\t* @param {Item} item - The item.\r\n\t*/\r\n\tconstructor(region: any, item: any) {\r\n\r\n\t\tsuper(region);\r\n\r\n\t\t/**\r\n\t\t* The item of the trigger.\r\n\t\t* @type {Item}\r\n\t\t*/\r\n\t\tthis.item = item;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* This method is called when the trigger should execute its action.\r\n\t*\r\n\t* @param {GameEntity} entity - The entity that touched the trigger region.\r\n\t* @return {Trigger} A reference to this trigger.\r\n\t*/\r\n\texecute(entity: any) {\r\n\r\n\t\tconst item = this.item;\r\n\r\n\t\t// deactivate trigger since it's only executed once\r\n\r\n\t\tthis.active = false;\r\n\r\n\t\t// add item to entity\r\n\r\n\t\titem.addItemToEntity(entity);\r\n\r\n\t\t// prepare respawn\r\n\r\n\t\titem.prepareRespawn();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\nexport { ItemGiver };\r\n","import { LineSegments, Sprite, SpriteMaterial, LineBasicMaterial, CanvasTexture, BufferGeometry, Float32BufferAttribute } from 'three';\r\nimport { Mesh, Group, MeshBasicMaterial, CylinderGeometry, SphereGeometry } from 'three';\r\n\r\n/**\r\n* Class with various helper methods.\r\n*/\r\nclass SceneUtils {\r\n\r\n\t/**\r\n\t* Clones a skinned mesh. This method is necessary since three.js\r\n\t* does not yet support cloning of skinned meshes in the core.\r\n\t*\r\n\t* @param {SkinnedMesh} source - The skinned mesh to clone.\r\n\t* @return {SkinnedMesh} The cloned skinned mesh.\r\n\t*/\r\n\tstatic cloneWithSkinning(source: any) {\r\n\r\n\t\t// see https://github.com/mrdoob/three.js/pull/14494\r\n\r\n\t\tconst cloneLookup = new Map();\r\n\r\n\t\tconst clone = source.clone();\r\n\r\n\t\tparallelTraverse(source, clone, (sourceNode: any, clonedNode: any) => {\r\n\r\n\t\t\tcloneLookup.set(sourceNode, clonedNode);\r\n\r\n\t\t});\r\n\r\n\t\tsource.traverse(function (sourceMesh: any) {\r\n\r\n\t\t\tif (!sourceMesh.isSkinnedMesh) return;\r\n\r\n\t\t\tconst sourceBones = sourceMesh.skeleton.bones;\r\n\t\t\tconst clonedMesh = cloneLookup.get(sourceMesh);\r\n\r\n\t\t\tclonedMesh.skeleton = sourceMesh.skeleton.clone();\r\n\r\n\t\t\tclonedMesh.skeleton.bones = sourceBones.map((sourceBone: any) => {\r\n\r\n\t\t\t\tif (!cloneLookup.has(sourceBone)) {\r\n\r\n\t\t\t\t\tthrow new Error('SceneUtils: Required bones are not descendants of the given object.');\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn cloneLookup.get(sourceBone);\r\n\r\n\t\t\t});\r\n\r\n\t\t\tclonedMesh.bind(clonedMesh.skeleton, sourceMesh.bindMatrix);\r\n\r\n\t\t});\r\n\r\n\t\treturn clone;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a label that visualizes the UUID of a game entity.\r\n\t*\r\n\t* @param {String} uuid - The UUID to visualize.\r\n\t* @return {Sprite} The label.\r\n\t*/\r\n\tstatic createUUIDLabel(uuid: string) {\r\n\r\n\t\tconst canvas = document.createElement('canvas');\r\n\t\tconst context = canvas.getContext('2d')!;\r\n\r\n\t\tcanvas.width = 512;\r\n\t\tcanvas.height = 64;\r\n\r\n\t\tcontext.fillStyle = '#ee0808';\r\n\t\tcontext.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n\t\tcontext.fillStyle = '#ffffff';\r\n\t\tcontext.font = '24px Arial';\r\n\t\tcontext.textAlign = 'center';\r\n\t\tcontext.textBaseline = 'middle';\r\n\t\tcontext.fillText(uuid, canvas.width / 2, canvas.height / 2);\r\n\r\n\t\tconst texture = new CanvasTexture(canvas);\r\n\t\tconst material = new SpriteMaterial({ map: texture });\r\n\r\n\t\tconst sprite = new Sprite(material);\r\n\r\n\t\tsprite.scale.set(4, 0.5, 1);\r\n\r\n\t\treturn sprite;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a helper that visualizes the hitbox of an enemy.\r\n\t*\r\n\t* @param {AABB} hitbox - The hitbox to visualize.\r\n\t* @return {LineSegments} The helper.\r\n\t*/\r\n\tstatic createHitboxHelper(hitbox: any) {\r\n\r\n\t\tvar indices = [0, 1, 1, 2, 2, 3, 3, 0, 4, 5, 5, 6, 6, 7, 7, 4, 0, 4, 1, 5, 2, 6, 3, 7];\r\n\t\tvar positions = [1, 1, 1, - 1, 1, 1, - 1, - 1, 1, 1, - 1, 1, 1, 1, - 1, - 1, 1, - 1, - 1, - 1, - 1, 1, - 1, - 1];\r\n\r\n\t\tvar geometry = new BufferGeometry();\r\n\r\n\t\tgeometry.setIndex(indices);\r\n\t\tgeometry.setAttribute('position', new Float32BufferAttribute(positions, 3));\r\n\r\n\t\tconst lines = new LineSegments(geometry, new LineBasicMaterial({ color: 0xffffff }));\r\n\t\tlines.matrixAutoUpdate = false;\r\n\r\n\t\thitbox.getCenter(lines.position);\r\n\t\thitbox.getSize(lines.scale);\r\n\t\tlines.scale.multiplyScalar(0.5);\r\n\t\tlines.updateMatrix();\r\n\r\n\t\treturn lines;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates helper points to visualize the spawning points of the game.\r\n\t *\r\n\t * @param {Array} spawnPoints - An array of spawn points to visualize.\r\n\t * @return {Group} The helper.\r\n\t */\r\n\tstatic createSpawnPointHelper(spawnPoints: any[]) {\r\n\r\n\t\tconst group = new Group();\r\n\t\tgroup.matrixAutoUpdate = false;\r\n\r\n\t\tconst nodeColor = 0xff0000;\r\n\t\tconst nodeMaterial = new MeshBasicMaterial({ color: nodeColor });\r\n\t\tconst nodeGeometry = new CylinderGeometry(0.2, 0.2, 0.5);\r\n\t\tnodeGeometry.translate(0, 0.25, 0);\r\n\r\n\t\tfor (let i = 0, l = spawnPoints.length; i < l; i++) {\r\n\r\n\t\t\tconst nodeMesh = new Mesh(nodeGeometry, nodeMaterial);\r\n\t\t\tnodeMesh.position.copy(spawnPoints[i].position);\r\n\r\n\t\t\tnodeMesh.matrixAutoUpdate = false;\r\n\t\t\tnodeMesh.updateMatrix();\r\n\r\n\t\t\tgroup.add(nodeMesh);\r\n\r\n\t\t}\r\n\r\n\t\tgroup.visible = false;\r\n\r\n\t\treturn group;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Creates a trigger helper in order to visualize the position and\r\n\t * trigger region.\r\n\t *\r\n\t * @param {Trigger} trigger - The trigger.\r\n\t * @return {Group} The helper.\r\n\t */\r\n\tstatic createTriggerHelper(trigger: any) {\r\n\r\n\t\t// assuming trigger.region is of type SphericalTriggerRegion\r\n\r\n\t\tconst triggerGeometry = new SphereGeometry(trigger.region.radius, 16, 16);\r\n\t\tconst triggerMaterial = new MeshBasicMaterial({ color: 0x6083c2, wireframe: true });\r\n\r\n\t\tconst triggerMesh = new Mesh(triggerGeometry, triggerMaterial);\r\n\t\ttriggerMesh.matrixAutoUpdate = false;\r\n\t\ttriggerMesh.visible = false;\r\n\r\n\t\treturn triggerMesh;\r\n\r\n\t}\r\n\r\n}\r\n\r\n//\r\n\r\nfunction parallelTraverse(a: any, b: any, callback: any) {\r\n\r\n\tcallback(a, b);\r\n\r\n\tfor (let i = 0; i < a.children.length; i++) {\r\n\r\n\t\tparallelTraverse(a.children[i], b.children[i], callback);\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { SceneUtils };\r\n","import { Item } from './Item.js';\r\n\r\n/**\r\n* A game entity which represents a collectable weapon item.\r\n*/\r\nclass WeaponItem extends Item {\r\n\r\n\tpublic ammo: number;\r\n\r\n\t/**\r\n\t* Constructs a new weapon item.\r\n\t*\r\n\t* @param {Number} type - The weapon type.\r\n\t* @param {Number} respawnTime - The respawn time.\r\n\t* @param {Number} ammo - The amount of ammo.\r\n\t*/\r\n\tconstructor(type: number, respawnTime: number, ammo: number) {\r\n\r\n\t\tsuper(type, respawnTime);\r\n\r\n\t\t/**\r\n\t\t* The amount of ammo which the weapon gives when it's collected.\r\n\t\t* @type {Number}\r\n\t\t*/\r\n\t\tthis.ammo = ammo;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Adds the weapon to the given entity.\r\n\t*\r\n\t* @param {GameEntity} entity - The entity that receives this item.\r\n\t* @return {WeaponItem} A reference to this item.\r\n\t*/\r\n\taddItemToEntity(entity: any): this {\r\n\r\n\t\tentity.addWeapon(this.type); // we assume .addWeapon() is implemented by the game entity\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { WeaponItem };\r\n","import { SphericalTriggerRegion, Vector3 } from 'yuka';\r\nimport { HealthPack } from '../entities/HealthPack.js';\r\nimport { ItemGiver } from '../triggers/ItemGiver.js';\r\nimport { SceneUtils } from '../utils/SceneUtils.js';\r\nimport { HEALTH_PACK, WEAPON_TYPES_ASSAULT_RIFLE, WEAPON_TYPES_BLASTER, WEAPON_TYPES_SHOTGUN } from './Constants.js';\r\nimport { WeaponItem } from '../entities/WeaponItem.js';\r\nimport { CONFIG } from './Config.js';\r\n\r\n/**\r\n* This class is responsible for (re)spawning enemies.\r\n*\r\n*/\r\nclass SpawningManager {\r\n\r\n\tpublic world: any;\r\n\tpublic spawningPoints: Array<any>;\r\n\tpublic itemTriggerMap: Map<any, any>;\r\n\tpublic healthPacks: Array<any>;\r\n\tpublic healthPackSpawningPoints: Array<any>;\r\n\tpublic blasters: Array<any>;\r\n\tpublic blasterSpawningPoints: Array<any>;\r\n\tpublic shotguns: Array<any>;\r\n\tpublic shotgunSpawningPoints: Array<any>;\r\n\tpublic assaultRilfles: Array<any>;\r\n\tpublic assaultRilflesSpawningPoints: Array<any>;\r\n\r\n\t/**\r\n\t* Constructor to create a new SpawningManager.\r\n\t*\r\n\t* @param {World} world - A reference to the world.\r\n\t*/\r\n\tconstructor(world: any) {\r\n\r\n\t\tthis.world = world;\r\n\r\n\t\t// spawning points for competitors\r\n\r\n\t\tthis.spawningPoints = new Array();\r\n\r\n\t\t// items\r\n\r\n\t\tthis.itemTriggerMap = new Map(); // for mapping item -> trigger\r\n\r\n\t\t// health packs\r\n\r\n\t\tthis.healthPacks = new Array();\r\n\t\tthis.healthPackSpawningPoints = new Array();\r\n\r\n\t\t// weapons\r\n\r\n\t\tthis.blasters = new Array();\r\n\t\tthis.blasterSpawningPoints = new Array();\r\n\r\n\t\tthis.shotguns = new Array();\r\n\t\tthis.shotgunSpawningPoints = new Array();\r\n\r\n\t\tthis.assaultRilfles = new Array();\r\n\t\tthis.assaultRilflesSpawningPoints = new Array();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of this manager. Called per simluation step.\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tupdate(delta: number): this {\r\n\r\n\t\tthis.updateItemList(this.healthPacks, delta);\r\n\t\tthis.updateItemList(this.blasters, delta);\r\n\t\tthis.updateItemList(this.shotguns, delta);\r\n\t\tthis.updateItemList(this.assaultRilfles, delta);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates the given item list.\r\n\t*\r\n\t* @param {Array} itemsList - A list of items.\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tupdateItemList(itemsList: any[], delta: number): this {\r\n\r\n\t\t// check if a respawn is necessary\r\n\r\n\t\tfor (let i = 0, il = itemsList.length; i < il; i++) {\r\n\r\n\t\t\tconst item = itemsList[i];\r\n\r\n\t\t\titem.currentTime += delta;\r\n\r\n\t\t\tif (item.currentTime >= item.nextSpawnTime) {\r\n\r\n\t\t\t\tthis._respawnItem(item);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns an array with items of the given type.\r\n\t*\r\n\t* @param {Number} type - The requested item type.\r\n\t* @return {Array} An array with items (game entities).\r\n\t*/\r\n\tgetItemList(type: number): any[] | null {\r\n\r\n\t\tlet itemList = null;\r\n\r\n\t\tswitch (type) {\r\n\r\n\t\t\tcase HEALTH_PACK:\r\n\t\t\t\titemList = this.healthPacks;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase WEAPON_TYPES_BLASTER:\r\n\t\t\t\titemList = this.blasters;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase WEAPON_TYPES_SHOTGUN:\r\n\t\t\t\titemList = this.shotguns;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\r\n\t\t\t\titemList = this.assaultRilfles;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tdefault:\r\n\t\t\t\tconsole.error('DIVE.SpawningManager: Invalid item type:', type);\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\treturn itemList;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Respawns the given competitor.\r\n\t*\r\n\t* @param {GameEntity} competitor - The entity to respawn.\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\trespawnCompetitor(competitor: any): this {\r\n\r\n\t\tconst spawnPoint = this.getSpawnPoint(competitor);\r\n\r\n\t\tcompetitor.position.copy(spawnPoint.position);\r\n\t\tcompetitor.rotation.fromEuler(spawnPoint.rotation.x, spawnPoint.rotation.y, spawnPoint.rotation.z);\r\n\r\n\t\tif (competitor.isPlayer) competitor.head.rotation.set(0, 0, 0, 1);\r\n\r\n\t\t// Initialize the current region for navMesh-based collision\r\n\t\tif (this.world.navMesh) {\r\n\t\t\tcompetitor.currentRegion = this.world.navMesh.getRegionForPoint(competitor.position, 1);\r\n\t\t\tcompetitor.previousPosition.copy(competitor.position);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Gets a suitable respawn point for the given enemy.\r\n\t*\r\n\t* @param {Enemy} enemy - The enemy for which a suitable point is searched.\r\n\t* @returns {Vector3} The spawning point.\r\n\t*/\r\n\tgetSpawnPoint(enemy: any): any {\r\n\r\n\t\tconst spawningPoints = this.spawningPoints;\r\n\t\tconst competitors = this.world.competitors;\r\n\r\n\t\tlet maxDistance = - Infinity;\r\n\t\tlet bestSpawningPoint = null;\r\n\r\n\t\t// searching for the spawning point furthest away from an enemy\r\n\r\n\t\tfor (let i = 0, il = spawningPoints.length; i < il; i++) {\r\n\r\n\t\t\tconst spawningPoint = spawningPoints[i];\r\n\r\n\t\t\tlet closestDistance = Infinity;\r\n\r\n\t\t\tfor (let j = 0, jl = competitors.length; j < jl; j++) {\r\n\r\n\t\t\t\tconst competitor = competitors[j];\r\n\r\n\t\t\t\tif (competitor !== enemy) {\r\n\r\n\t\t\t\t\tconst distance = spawningPoint.position.squaredDistanceTo(competitor.position);\r\n\r\n\t\t\t\t\tif (distance < closestDistance) {\r\n\r\n\t\t\t\t\t\tclosestDistance = distance;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t\tif (closestDistance > maxDistance) {\r\n\r\n\t\t\t\tmaxDistance = closestDistance;\r\n\t\t\t\tbestSpawningPoint = spawningPoint;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn bestSpawningPoint;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the spawning manager.\r\n\t*\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tinit(): this {\r\n\r\n\t\tthis.initSpawningPoints();\r\n\t\tthis.initHealthPacks();\r\n\t\tthis.initWeapons();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the spawning points from the parsed configuration file.\r\n\t*\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tinitSpawningPoints(): this {\r\n\r\n\t\tconst levelConfig = this.world.assetManager.configs.get('level');\r\n\r\n\t\tfor (const spawningPoint of levelConfig.competitorSpawningPoints) {\r\n\r\n\t\t\tconst position = spawningPoint.position;\r\n\t\t\tconst rotation = spawningPoint.rotation;\r\n\r\n\t\t\tthis.spawningPoints.push({\r\n\t\t\t\tposition: new Vector3().fromArray(position),\r\n\t\t\t\trotation: { x: rotation[0], y: rotation[1], z: rotation[2] } // euler angles\r\n\t\t\t});\r\n\r\n\t\t}\r\n\r\n\t\tfor (const spawningPoint of levelConfig.healthPackSpawningPoints) {\r\n\r\n\t\t\tthis.healthPackSpawningPoints.push(new Vector3().fromArray(spawningPoint));\r\n\r\n\t\t}\r\n\r\n\t\tfor (const spawningPoint of levelConfig.shotgunSpawningPoints) {\r\n\r\n\t\t\tthis.shotgunSpawningPoints.push(new Vector3().fromArray(spawningPoint));\r\n\r\n\t\t}\r\n\r\n\t\tfor (const spawningPoint of levelConfig.assaultRilflesSpawningPoints) {\r\n\r\n\t\t\tthis.assaultRilflesSpawningPoints.push(new Vector3().fromArray(spawningPoint));\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the collectable health packs.\r\n\t*\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tinitHealthPacks(): this {\r\n\r\n\t\tconst world = this.world;\r\n\t\tconst assetManager = world.assetManager;\r\n\r\n\t\tfor (let spawningPoint of this.healthPackSpawningPoints) {\r\n\r\n\t\t\t// health pack entity\r\n\r\n\t\t\tconst healthPack = new HealthPack();\r\n\t\t\thealthPack.position.copy(spawningPoint);\r\n\r\n\t\t\tconst renderComponent = world.assetManager.models.get('healthPack').clone();\r\n\t\t\trenderComponent.position.copy(healthPack.position);\r\n\t\t\thealthPack.setRenderComponent(renderComponent, sync);\r\n\r\n\t\t\tthis.healthPacks.push(healthPack);\r\n\t\t\tworld.add(healthPack);\r\n\r\n\t\t\t// navigation\r\n\r\n\t\t\thealthPack.currentRegion = world.navMesh.getRegionForPoint(healthPack.position, 1);\r\n\r\n\t\t\t// audio\r\n\r\n\t\t\tconst audio = assetManager.cloneAudio(assetManager.audios.get('health'));\r\n\t\t\thealthPack._audio = audio;\r\n\t\t\trenderComponent.add(audio);\r\n\r\n\t\t\t// trigger\r\n\r\n\t\t\tthis.createTrigger(healthPack, CONFIG.HEALTH_PACK.RADIUS);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the collectable weapons.\r\n\t*\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tinitWeapons(): this {\r\n\r\n\t\tconst world = this.world;\r\n\t\tconst assetManager = world.assetManager;\r\n\r\n\t\tfor (let spawningPoint of this.blasterSpawningPoints) {\r\n\r\n\t\t\t// blaster item\r\n\r\n\t\t\tconst blasterItem = new WeaponItem(WEAPON_TYPES_BLASTER, CONFIG.BLASTER.RESPAWN_TIME, CONFIG.BLASTER.AMMO);\r\n\t\t\tblasterItem.position.copy(spawningPoint);\r\n\r\n\t\t\tconst renderComponent = assetManager.models.get('blaster_low').clone();\r\n\t\t\trenderComponent.position.copy(blasterItem.position);\r\n\t\t\tblasterItem.setRenderComponent(renderComponent, sync);\r\n\r\n\t\t\tthis.blasters.push(blasterItem);\r\n\t\t\tworld.add(blasterItem);\r\n\r\n\t\t\t// navigation\r\n\r\n\t\t\tblasterItem.currentRegion = world.navMesh.getRegionForPoint(blasterItem.position, 1);\r\n\r\n\t\t\t// audio\r\n\r\n\t\t\tconst audio = assetManager.cloneAudio(assetManager.audios.get('ammo'));\r\n\t\t\tblasterItem._audio = audio;\r\n\t\t\taudio.setVolume(0.5);\r\n\t\t\trenderComponent.add(audio);\r\n\r\n\t\t\t// trigger\r\n\r\n\t\t\tthis.createTrigger(blasterItem, CONFIG.BLASTER.RADIUS);\r\n\r\n\t\t}\r\n\r\n\t\tfor (let spawningPoint of this.shotgunSpawningPoints) {\r\n\r\n\t\t\t// shotgun item\r\n\r\n\t\t\tconst shotgunItem = new WeaponItem(WEAPON_TYPES_SHOTGUN, CONFIG.SHOTGUN.RESPAWN_TIME, CONFIG.SHOTGUN.AMMO);\r\n\t\t\tshotgunItem.position.copy(spawningPoint);\r\n\r\n\t\t\tconst renderComponent = assetManager.models.get('shotgun_low').clone();\r\n\t\t\trenderComponent.position.copy(shotgunItem.position);\r\n\t\t\tshotgunItem.setRenderComponent(renderComponent, sync);\r\n\r\n\t\t\tthis.shotguns.push(shotgunItem);\r\n\t\t\tworld.add(shotgunItem);\r\n\r\n\t\t\t// navigation\r\n\r\n\t\t\tshotgunItem.currentRegion = world.navMesh.getRegionForPoint(shotgunItem.position, 1);\r\n\r\n\t\t\t// audio\r\n\r\n\t\t\tconst audio = assetManager.cloneAudio(assetManager.audios.get('ammo'));\r\n\t\t\tshotgunItem._audio = audio;\r\n\t\t\taudio.setVolume(0.5);\r\n\t\t\trenderComponent.add(audio);\r\n\r\n\t\t\t// trigger\r\n\r\n\t\t\tthis.createTrigger(shotgunItem, CONFIG.SHOTGUN.RADIUS);\r\n\r\n\t\t}\r\n\r\n\t\tfor (let spawningPoint of this.assaultRilflesSpawningPoints) {\r\n\r\n\t\t\t// assault rifle item\r\n\r\n\t\t\tconst assaultRilfleItem = new WeaponItem(WEAPON_TYPES_ASSAULT_RIFLE, CONFIG.ASSAULT_RIFLE.RESPAWN_TIME, CONFIG.ASSAULT_RIFLE.AMMO);\r\n\t\t\tassaultRilfleItem.position.copy(spawningPoint);\r\n\r\n\t\t\tconst renderComponent = assetManager.models.get('assaultRifle_low').clone();\r\n\t\t\trenderComponent.position.copy(assaultRilfleItem.position);\r\n\t\t\tassaultRilfleItem.setRenderComponent(renderComponent, sync);\r\n\r\n\t\t\tthis.assaultRilfles.push(assaultRilfleItem);\r\n\t\t\tthis.world.add(assaultRilfleItem);\r\n\r\n\t\t\t// navigation\r\n\r\n\t\t\tassaultRilfleItem.currentRegion = world.navMesh.getRegionForPoint(assaultRilfleItem.position, 1);\r\n\r\n\t\t\t// audio\r\n\r\n\t\t\tconst audio = assetManager.cloneAudio(assetManager.audios.get('ammo'));\r\n\t\t\taudio.setVolume(0.5);\r\n\t\t\tassaultRilfleItem._audio = audio;\r\n\t\t\trenderComponent.add(audio);\r\n\r\n\t\t\t// trigger\r\n\r\n\t\t\tthis.createTrigger(assaultRilfleItem, CONFIG.ASSAULT_RIFLE.RADIUS);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a trigger for the given item.\r\n\t*\r\n\t* @param {Item} item - The collectable item.\r\n\t* @param {Number} radius - The radius of the trigger.\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\tcreateTrigger(item: any, radius: number): this {\r\n\r\n\t\tconst sphericalTriggerRegion = new SphericalTriggerRegion(radius);\r\n\r\n\t\tconst trigger = new ItemGiver(sphericalTriggerRegion, item);\r\n\t\titem.add(trigger);\r\n\r\n\t\tthis.itemTriggerMap.set(item, trigger);\r\n\r\n\t\t// debugging\r\n\r\n\t\tif (this.world.debug) {\r\n\r\n\t\t\tconst triggerHelper = SceneUtils.createTriggerHelper(trigger);\r\n\t\t\ttrigger.setRenderComponent(triggerHelper, sync);\r\n\r\n\t\t\tthis.world.helpers.itemHelpers.push(triggerHelper);\r\n\t\t\tthis.world.scene.add(triggerHelper);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Respawns the given item.\r\n\t*\r\n\t* @return {SpawningManager} A reference to this spawning manager.\r\n\t*/\r\n\t_respawnItem(item: any): this {\r\n\r\n\t\t// reactivate trigger\r\n\r\n\t\tconst trigger = this.itemTriggerMap.get(item);\r\n\t\ttrigger.active = true;\r\n\r\n\t\t// reactivate item\r\n\r\n\t\titem.finishRespawn();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\nexport { SpawningManager };\r\n\r\n// used to sync Yuka Game Entities with three.js objects\r\n\r\nfunction sync(entity: any, renderComponent: any): void {\r\n\r\n\trenderComponent.matrix.copy(entity.worldMatrix);\r\n\r\n}\r\n","/**\n * dat-gui JavaScript Controller Library\n * https://github.com/dataarts/dat.gui\n *\n * Copyright 2011 Data Arts Team, Google Creative Lab\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n */\n\nfunction ___$insertStyle(css) {\n  if (!css) {\n    return;\n  }\n  if (typeof window === 'undefined') {\n    return;\n  }\n\n  var style = document.createElement('style');\n\n  style.setAttribute('type', 'text/css');\n  style.innerHTML = css;\n  document.head.appendChild(style);\n\n  return css;\n}\n\nfunction colorToString (color, forceCSSHex) {\n  var colorFormat = color.__state.conversionName.toString();\n  var r = Math.round(color.r);\n  var g = Math.round(color.g);\n  var b = Math.round(color.b);\n  var a = color.a;\n  var h = Math.round(color.h);\n  var s = color.s.toFixed(1);\n  var v = color.v.toFixed(1);\n  if (forceCSSHex || colorFormat === 'THREE_CHAR_HEX' || colorFormat === 'SIX_CHAR_HEX') {\n    var str = color.hex.toString(16);\n    while (str.length < 6) {\n      str = '0' + str;\n    }\n    return '#' + str;\n  } else if (colorFormat === 'CSS_RGB') {\n    return 'rgb(' + r + ',' + g + ',' + b + ')';\n  } else if (colorFormat === 'CSS_RGBA') {\n    return 'rgba(' + r + ',' + g + ',' + b + ',' + a + ')';\n  } else if (colorFormat === 'HEX') {\n    return '0x' + color.hex.toString(16);\n  } else if (colorFormat === 'RGB_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ']';\n  } else if (colorFormat === 'RGBA_ARRAY') {\n    return '[' + r + ',' + g + ',' + b + ',' + a + ']';\n  } else if (colorFormat === 'RGB_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + '}';\n  } else if (colorFormat === 'RGBA_OBJ') {\n    return '{r:' + r + ',g:' + g + ',b:' + b + ',a:' + a + '}';\n  } else if (colorFormat === 'HSV_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + '}';\n  } else if (colorFormat === 'HSVA_OBJ') {\n    return '{h:' + h + ',s:' + s + ',v:' + v + ',a:' + a + '}';\n  }\n  return 'unknown format';\n}\n\nvar ARR_EACH = Array.prototype.forEach;\nvar ARR_SLICE = Array.prototype.slice;\nvar Common = {\n  BREAK: {},\n  extend: function extend(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (!this.isUndefined(obj[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  defaults: function defaults(target) {\n    this.each(ARR_SLICE.call(arguments, 1), function (obj) {\n      var keys = this.isObject(obj) ? Object.keys(obj) : [];\n      keys.forEach(function (key) {\n        if (this.isUndefined(target[key])) {\n          target[key] = obj[key];\n        }\n      }.bind(this));\n    }, this);\n    return target;\n  },\n  compose: function compose() {\n    var toCall = ARR_SLICE.call(arguments);\n    return function () {\n      var args = ARR_SLICE.call(arguments);\n      for (var i = toCall.length - 1; i >= 0; i--) {\n        args = [toCall[i].apply(this, args)];\n      }\n      return args[0];\n    };\n  },\n  each: function each(obj, itr, scope) {\n    if (!obj) {\n      return;\n    }\n    if (ARR_EACH && obj.forEach && obj.forEach === ARR_EACH) {\n      obj.forEach(itr, scope);\n    } else if (obj.length === obj.length + 0) {\n      var key = void 0;\n      var l = void 0;\n      for (key = 0, l = obj.length; key < l; key++) {\n        if (key in obj && itr.call(scope, obj[key], key) === this.BREAK) {\n          return;\n        }\n      }\n    } else {\n      for (var _key in obj) {\n        if (itr.call(scope, obj[_key], _key) === this.BREAK) {\n          return;\n        }\n      }\n    }\n  },\n  defer: function defer(fnc) {\n    setTimeout(fnc, 0);\n  },\n  debounce: function debounce(func, threshold, callImmediately) {\n    var timeout = void 0;\n    return function () {\n      var obj = this;\n      var args = arguments;\n      function delayed() {\n        timeout = null;\n        if (!callImmediately) func.apply(obj, args);\n      }\n      var callNow = callImmediately || !timeout;\n      clearTimeout(timeout);\n      timeout = setTimeout(delayed, threshold);\n      if (callNow) {\n        func.apply(obj, args);\n      }\n    };\n  },\n  toArray: function toArray(obj) {\n    if (obj.toArray) return obj.toArray();\n    return ARR_SLICE.call(obj);\n  },\n  isUndefined: function isUndefined(obj) {\n    return obj === undefined;\n  },\n  isNull: function isNull(obj) {\n    return obj === null;\n  },\n  isNaN: function (_isNaN) {\n    function isNaN(_x) {\n      return _isNaN.apply(this, arguments);\n    }\n    isNaN.toString = function () {\n      return _isNaN.toString();\n    };\n    return isNaN;\n  }(function (obj) {\n    return isNaN(obj);\n  }),\n  isArray: Array.isArray || function (obj) {\n    return obj.constructor === Array;\n  },\n  isObject: function isObject(obj) {\n    return obj === Object(obj);\n  },\n  isNumber: function isNumber(obj) {\n    return obj === obj + 0;\n  },\n  isString: function isString(obj) {\n    return obj === obj + '';\n  },\n  isBoolean: function isBoolean(obj) {\n    return obj === false || obj === true;\n  },\n  isFunction: function isFunction(obj) {\n    return obj instanceof Function;\n  }\n};\n\nvar INTERPRETATIONS = [\n{\n  litmus: Common.isString,\n  conversions: {\n    THREE_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9])([A-F0-9])([A-F0-9])$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString() + test[1].toString() + test[2].toString() + test[2].toString() + test[3].toString() + test[3].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    SIX_CHAR_HEX: {\n      read: function read(original) {\n        var test = original.match(/^#([A-F0-9]{6})$/i);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'HEX',\n          hex: parseInt('0x' + test[1].toString(), 0)\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGB: {\n      read: function read(original) {\n        var test = original.match(/^rgb\\(\\s*(\\S+)\\s*,\\s*(\\S+)\\s*,\\s*(\\S+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3])\n        };\n      },\n      write: colorToString\n    },\n    CSS_RGBA: {\n      read: function read(original) {\n        var test = original.match(/^rgba\\(\\s*(\\S+)\\s*,\\s*(\\S+)\\s*,\\s*(\\S+)\\s*,\\s*(\\S+)\\s*\\)/);\n        if (test === null) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: parseFloat(test[1]),\n          g: parseFloat(test[2]),\n          b: parseFloat(test[3]),\n          a: parseFloat(test[4])\n        };\n      },\n      write: colorToString\n    }\n  }\n},\n{\n  litmus: Common.isNumber,\n  conversions: {\n    HEX: {\n      read: function read(original) {\n        return {\n          space: 'HEX',\n          hex: original,\n          conversionName: 'HEX'\n        };\n      },\n      write: function write(color) {\n        return color.hex;\n      }\n    }\n  }\n},\n{\n  litmus: Common.isArray,\n  conversions: {\n    RGB_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 3) {\n          return false;\n        }\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b];\n      }\n    },\n    RGBA_ARRAY: {\n      read: function read(original) {\n        if (original.length !== 4) return false;\n        return {\n          space: 'RGB',\n          r: original[0],\n          g: original[1],\n          b: original[2],\n          a: original[3]\n        };\n      },\n      write: function write(color) {\n        return [color.r, color.g, color.b, color.a];\n      }\n    }\n  }\n},\n{\n  litmus: Common.isObject,\n  conversions: {\n    RGBA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b) && Common.isNumber(original.a)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b,\n          a: color.a\n        };\n      }\n    },\n    RGB_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.r) && Common.isNumber(original.g) && Common.isNumber(original.b)) {\n          return {\n            space: 'RGB',\n            r: original.r,\n            g: original.g,\n            b: original.b\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          r: color.r,\n          g: color.g,\n          b: color.b\n        };\n      }\n    },\n    HSVA_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v) && Common.isNumber(original.a)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v,\n            a: original.a\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v,\n          a: color.a\n        };\n      }\n    },\n    HSV_OBJ: {\n      read: function read(original) {\n        if (Common.isNumber(original.h) && Common.isNumber(original.s) && Common.isNumber(original.v)) {\n          return {\n            space: 'HSV',\n            h: original.h,\n            s: original.s,\n            v: original.v\n          };\n        }\n        return false;\n      },\n      write: function write(color) {\n        return {\n          h: color.h,\n          s: color.s,\n          v: color.v\n        };\n      }\n    }\n  }\n}];\nvar result = void 0;\nvar toReturn = void 0;\nvar interpret = function interpret() {\n  toReturn = false;\n  var original = arguments.length > 1 ? Common.toArray(arguments) : arguments[0];\n  Common.each(INTERPRETATIONS, function (family) {\n    if (family.litmus(original)) {\n      Common.each(family.conversions, function (conversion, conversionName) {\n        result = conversion.read(original);\n        if (toReturn === false && result !== false) {\n          toReturn = result;\n          result.conversionName = conversionName;\n          result.conversion = conversion;\n          return Common.BREAK;\n        }\n      });\n      return Common.BREAK;\n    }\n  });\n  return toReturn;\n};\n\nvar tmpComponent = void 0;\nvar ColorMath = {\n  hsv_to_rgb: function hsv_to_rgb(h, s, v) {\n    var hi = Math.floor(h / 60) % 6;\n    var f = h / 60 - Math.floor(h / 60);\n    var p = v * (1.0 - s);\n    var q = v * (1.0 - f * s);\n    var t = v * (1.0 - (1.0 - f) * s);\n    var c = [[v, t, p], [q, v, p], [p, v, t], [p, q, v], [t, p, v], [v, p, q]][hi];\n    return {\n      r: c[0] * 255,\n      g: c[1] * 255,\n      b: c[2] * 255\n    };\n  },\n  rgb_to_hsv: function rgb_to_hsv(r, g, b) {\n    var min = Math.min(r, g, b);\n    var max = Math.max(r, g, b);\n    var delta = max - min;\n    var h = void 0;\n    var s = void 0;\n    if (max !== 0) {\n      s = delta / max;\n    } else {\n      return {\n        h: NaN,\n        s: 0,\n        v: 0\n      };\n    }\n    if (r === max) {\n      h = (g - b) / delta;\n    } else if (g === max) {\n      h = 2 + (b - r) / delta;\n    } else {\n      h = 4 + (r - g) / delta;\n    }\n    h /= 6;\n    if (h < 0) {\n      h += 1;\n    }\n    return {\n      h: h * 360,\n      s: s,\n      v: max / 255\n    };\n  },\n  rgb_to_hex: function rgb_to_hex(r, g, b) {\n    var hex = this.hex_with_component(0, 2, r);\n    hex = this.hex_with_component(hex, 1, g);\n    hex = this.hex_with_component(hex, 0, b);\n    return hex;\n  },\n  component_from_hex: function component_from_hex(hex, componentIndex) {\n    return hex >> componentIndex * 8 & 0xFF;\n  },\n  hex_with_component: function hex_with_component(hex, componentIndex, value) {\n    return value << (tmpComponent = componentIndex * 8) | hex & ~(0xFF << tmpComponent);\n  }\n};\n\nvar _typeof = typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\" ? function (obj) {\n  return typeof obj;\n} : function (obj) {\n  return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar classCallCheck = function (instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n};\n\nvar createClass = function () {\n  function defineProperties(target, props) {\n    for (var i = 0; i < props.length; i++) {\n      var descriptor = props[i];\n      descriptor.enumerable = descriptor.enumerable || false;\n      descriptor.configurable = true;\n      if (\"value\" in descriptor) descriptor.writable = true;\n      Object.defineProperty(target, descriptor.key, descriptor);\n    }\n  }\n\n  return function (Constructor, protoProps, staticProps) {\n    if (protoProps) defineProperties(Constructor.prototype, protoProps);\n    if (staticProps) defineProperties(Constructor, staticProps);\n    return Constructor;\n  };\n}();\n\n\n\n\n\n\n\nvar get = function get(object, property, receiver) {\n  if (object === null) object = Function.prototype;\n  var desc = Object.getOwnPropertyDescriptor(object, property);\n\n  if (desc === undefined) {\n    var parent = Object.getPrototypeOf(object);\n\n    if (parent === null) {\n      return undefined;\n    } else {\n      return get(parent, property, receiver);\n    }\n  } else if (\"value\" in desc) {\n    return desc.value;\n  } else {\n    var getter = desc.get;\n\n    if (getter === undefined) {\n      return undefined;\n    }\n\n    return getter.call(receiver);\n  }\n};\n\nvar inherits = function (subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function, not \" + typeof superClass);\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      enumerable: false,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;\n};\n\n\n\n\n\n\n\n\n\n\n\nvar possibleConstructorReturn = function (self, call) {\n  if (!self) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return call && (typeof call === \"object\" || typeof call === \"function\") ? call : self;\n};\n\nvar Color = function () {\n  function Color() {\n    classCallCheck(this, Color);\n    this.__state = interpret.apply(this, arguments);\n    if (this.__state === false) {\n      throw new Error('Failed to interpret color arguments');\n    }\n    this.__state.a = this.__state.a || 1;\n  }\n  createClass(Color, [{\n    key: 'toString',\n    value: function toString() {\n      return colorToString(this);\n    }\n  }, {\n    key: 'toHexString',\n    value: function toHexString() {\n      return colorToString(this, true);\n    }\n  }, {\n    key: 'toOriginal',\n    value: function toOriginal() {\n      return this.__state.conversion.write(this);\n    }\n  }]);\n  return Color;\n}();\nfunction defineRGBComponent(target, component, componentHexIndex) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'RGB') {\n        return this.__state[component];\n      }\n      Color.recalculateRGB(this, component, componentHexIndex);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'RGB') {\n        Color.recalculateRGB(this, component, componentHexIndex);\n        this.__state.space = 'RGB';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nfunction defineHSVComponent(target, component) {\n  Object.defineProperty(target, component, {\n    get: function get$$1() {\n      if (this.__state.space === 'HSV') {\n        return this.__state[component];\n      }\n      Color.recalculateHSV(this);\n      return this.__state[component];\n    },\n    set: function set$$1(v) {\n      if (this.__state.space !== 'HSV') {\n        Color.recalculateHSV(this);\n        this.__state.space = 'HSV';\n      }\n      this.__state[component] = v;\n    }\n  });\n}\nColor.recalculateRGB = function (color, component, componentHexIndex) {\n  if (color.__state.space === 'HEX') {\n    color.__state[component] = ColorMath.component_from_hex(color.__state.hex, componentHexIndex);\n  } else if (color.__state.space === 'HSV') {\n    Common.extend(color.__state, ColorMath.hsv_to_rgb(color.__state.h, color.__state.s, color.__state.v));\n  } else {\n    throw new Error('Corrupted color state');\n  }\n};\nColor.recalculateHSV = function (color) {\n  var result = ColorMath.rgb_to_hsv(color.r, color.g, color.b);\n  Common.extend(color.__state, {\n    s: result.s,\n    v: result.v\n  });\n  if (!Common.isNaN(result.h)) {\n    color.__state.h = result.h;\n  } else if (Common.isUndefined(color.__state.h)) {\n    color.__state.h = 0;\n  }\n};\nColor.COMPONENTS = ['r', 'g', 'b', 'h', 's', 'v', 'hex', 'a'];\ndefineRGBComponent(Color.prototype, 'r', 2);\ndefineRGBComponent(Color.prototype, 'g', 1);\ndefineRGBComponent(Color.prototype, 'b', 0);\ndefineHSVComponent(Color.prototype, 'h');\ndefineHSVComponent(Color.prototype, 's');\ndefineHSVComponent(Color.prototype, 'v');\nObject.defineProperty(Color.prototype, 'a', {\n  get: function get$$1() {\n    return this.__state.a;\n  },\n  set: function set$$1(v) {\n    this.__state.a = v;\n  }\n});\nObject.defineProperty(Color.prototype, 'hex', {\n  get: function get$$1() {\n    if (this.__state.space !== 'HEX') {\n      this.__state.hex = ColorMath.rgb_to_hex(this.r, this.g, this.b);\n      this.__state.space = 'HEX';\n    }\n    return this.__state.hex;\n  },\n  set: function set$$1(v) {\n    this.__state.space = 'HEX';\n    this.__state.hex = v;\n  }\n});\n\nvar Controller = function () {\n  function Controller(object, property) {\n    classCallCheck(this, Controller);\n    this.initialValue = object[property];\n    this.domElement = document.createElement('div');\n    this.object = object;\n    this.property = property;\n    this.__onChange = undefined;\n    this.__onFinishChange = undefined;\n  }\n  createClass(Controller, [{\n    key: 'onChange',\n    value: function onChange(fnc) {\n      this.__onChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'onFinishChange',\n    value: function onFinishChange(fnc) {\n      this.__onFinishChange = fnc;\n      return this;\n    }\n  }, {\n    key: 'setValue',\n    value: function setValue(newValue) {\n      this.object[this.property] = newValue;\n      if (this.__onChange) {\n        this.__onChange.call(this, newValue);\n      }\n      this.updateDisplay();\n      return this;\n    }\n  }, {\n    key: 'getValue',\n    value: function getValue() {\n      return this.object[this.property];\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      return this;\n    }\n  }, {\n    key: 'isModified',\n    value: function isModified() {\n      return this.initialValue !== this.getValue();\n    }\n  }]);\n  return Controller;\n}();\n\nvar EVENT_MAP = {\n  HTMLEvents: ['change'],\n  MouseEvents: ['click', 'mousemove', 'mousedown', 'mouseup', 'mouseover'],\n  KeyboardEvents: ['keydown']\n};\nvar EVENT_MAP_INV = {};\nCommon.each(EVENT_MAP, function (v, k) {\n  Common.each(v, function (e) {\n    EVENT_MAP_INV[e] = k;\n  });\n});\nvar CSS_VALUE_PIXELS = /(\\d+(\\.\\d+)?)px/;\nfunction cssValueToPixels(val) {\n  if (val === '0' || Common.isUndefined(val)) {\n    return 0;\n  }\n  var match = val.match(CSS_VALUE_PIXELS);\n  if (!Common.isNull(match)) {\n    return parseFloat(match[1]);\n  }\n  return 0;\n}\nvar dom = {\n  makeSelectable: function makeSelectable(elem, selectable) {\n    if (elem === undefined || elem.style === undefined) return;\n    elem.onselectstart = selectable ? function () {\n      return false;\n    } : function () {};\n    elem.style.MozUserSelect = selectable ? 'auto' : 'none';\n    elem.style.KhtmlUserSelect = selectable ? 'auto' : 'none';\n    elem.unselectable = selectable ? 'on' : 'off';\n  },\n  makeFullscreen: function makeFullscreen(elem, hor, vert) {\n    var vertical = vert;\n    var horizontal = hor;\n    if (Common.isUndefined(horizontal)) {\n      horizontal = true;\n    }\n    if (Common.isUndefined(vertical)) {\n      vertical = true;\n    }\n    elem.style.position = 'absolute';\n    if (horizontal) {\n      elem.style.left = 0;\n      elem.style.right = 0;\n    }\n    if (vertical) {\n      elem.style.top = 0;\n      elem.style.bottom = 0;\n    }\n  },\n  fakeEvent: function fakeEvent(elem, eventType, pars, aux) {\n    var params = pars || {};\n    var className = EVENT_MAP_INV[eventType];\n    if (!className) {\n      throw new Error('Event type ' + eventType + ' not supported.');\n    }\n    var evt = document.createEvent(className);\n    switch (className) {\n      case 'MouseEvents':\n        {\n          var clientX = params.x || params.clientX || 0;\n          var clientY = params.y || params.clientY || 0;\n          evt.initMouseEvent(eventType, params.bubbles || false, params.cancelable || true, window, params.clickCount || 1, 0,\n          0,\n          clientX,\n          clientY,\n          false, false, false, false, 0, null);\n          break;\n        }\n      case 'KeyboardEvents':\n        {\n          var init = evt.initKeyboardEvent || evt.initKeyEvent;\n          Common.defaults(params, {\n            cancelable: true,\n            ctrlKey: false,\n            altKey: false,\n            shiftKey: false,\n            metaKey: false,\n            keyCode: undefined,\n            charCode: undefined\n          });\n          init(eventType, params.bubbles || false, params.cancelable, window, params.ctrlKey, params.altKey, params.shiftKey, params.metaKey, params.keyCode, params.charCode);\n          break;\n        }\n      default:\n        {\n          evt.initEvent(eventType, params.bubbles || false, params.cancelable || true);\n          break;\n        }\n    }\n    Common.defaults(evt, aux);\n    elem.dispatchEvent(evt);\n  },\n  bind: function bind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.addEventListener) {\n      elem.addEventListener(event, func, bool);\n    } else if (elem.attachEvent) {\n      elem.attachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  unbind: function unbind(elem, event, func, newBool) {\n    var bool = newBool || false;\n    if (elem.removeEventListener) {\n      elem.removeEventListener(event, func, bool);\n    } else if (elem.detachEvent) {\n      elem.detachEvent('on' + event, func);\n    }\n    return dom;\n  },\n  addClass: function addClass(elem, className) {\n    if (elem.className === undefined) {\n      elem.className = className;\n    } else if (elem.className !== className) {\n      var classes = elem.className.split(/ +/);\n      if (classes.indexOf(className) === -1) {\n        classes.push(className);\n        elem.className = classes.join(' ').replace(/^\\s+/, '').replace(/\\s+$/, '');\n      }\n    }\n    return dom;\n  },\n  removeClass: function removeClass(elem, className) {\n    if (className) {\n      if (elem.className === className) {\n        elem.removeAttribute('class');\n      } else {\n        var classes = elem.className.split(/ +/);\n        var index = classes.indexOf(className);\n        if (index !== -1) {\n          classes.splice(index, 1);\n          elem.className = classes.join(' ');\n        }\n      }\n    } else {\n      elem.className = undefined;\n    }\n    return dom;\n  },\n  hasClass: function hasClass(elem, className) {\n    return new RegExp('(?:^|\\\\s+)' + className + '(?:\\\\s+|$)').test(elem.className) || false;\n  },\n  getWidth: function getWidth(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-left-width']) + cssValueToPixels(style['border-right-width']) + cssValueToPixels(style['padding-left']) + cssValueToPixels(style['padding-right']) + cssValueToPixels(style.width);\n  },\n  getHeight: function getHeight(elem) {\n    var style = getComputedStyle(elem);\n    return cssValueToPixels(style['border-top-width']) + cssValueToPixels(style['border-bottom-width']) + cssValueToPixels(style['padding-top']) + cssValueToPixels(style['padding-bottom']) + cssValueToPixels(style.height);\n  },\n  getOffset: function getOffset(el) {\n    var elem = el;\n    var offset = { left: 0, top: 0 };\n    if (elem.offsetParent) {\n      do {\n        offset.left += elem.offsetLeft;\n        offset.top += elem.offsetTop;\n        elem = elem.offsetParent;\n      } while (elem);\n    }\n    return offset;\n  },\n  isActive: function isActive(elem) {\n    return elem === document.activeElement && (elem.type || elem.href);\n  }\n};\n\nvar BooleanController = function (_Controller) {\n  inherits(BooleanController, _Controller);\n  function BooleanController(object, property) {\n    classCallCheck(this, BooleanController);\n    var _this2 = possibleConstructorReturn(this, (BooleanController.__proto__ || Object.getPrototypeOf(BooleanController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__prev = _this2.getValue();\n    _this2.__checkbox = document.createElement('input');\n    _this2.__checkbox.setAttribute('type', 'checkbox');\n    function onChange() {\n      _this.setValue(!_this.__prev);\n    }\n    dom.bind(_this2.__checkbox, 'change', onChange, false);\n    _this2.domElement.appendChild(_this2.__checkbox);\n    _this2.updateDisplay();\n    return _this2;\n  }\n  createClass(BooleanController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      this.__prev = this.getValue();\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (this.getValue() === true) {\n        this.__checkbox.setAttribute('checked', 'checked');\n        this.__checkbox.checked = true;\n        this.__prev = true;\n      } else {\n        this.__checkbox.checked = false;\n        this.__prev = false;\n      }\n      return get(BooleanController.prototype.__proto__ || Object.getPrototypeOf(BooleanController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return BooleanController;\n}(Controller);\n\nvar OptionController = function (_Controller) {\n  inherits(OptionController, _Controller);\n  function OptionController(object, property, opts) {\n    classCallCheck(this, OptionController);\n    var _this2 = possibleConstructorReturn(this, (OptionController.__proto__ || Object.getPrototypeOf(OptionController)).call(this, object, property));\n    var options = opts;\n    var _this = _this2;\n    _this2.__select = document.createElement('select');\n    if (Common.isArray(options)) {\n      var map = {};\n      Common.each(options, function (element) {\n        map[element] = element;\n      });\n      options = map;\n    }\n    Common.each(options, function (value, key) {\n      var opt = document.createElement('option');\n      opt.innerHTML = key;\n      opt.setAttribute('value', value);\n      _this.__select.appendChild(opt);\n    });\n    _this2.updateDisplay();\n    dom.bind(_this2.__select, 'change', function () {\n      var desiredValue = this.options[this.selectedIndex].value;\n      _this.setValue(desiredValue);\n    });\n    _this2.domElement.appendChild(_this2.__select);\n    return _this2;\n  }\n  createClass(OptionController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var toReturn = get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'setValue', this).call(this, v);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n      return toReturn;\n    }\n  }, {\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (dom.isActive(this.__select)) return this;\n      this.__select.value = this.getValue();\n      return get(OptionController.prototype.__proto__ || Object.getPrototypeOf(OptionController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return OptionController;\n}(Controller);\n\nvar StringController = function (_Controller) {\n  inherits(StringController, _Controller);\n  function StringController(object, property) {\n    classCallCheck(this, StringController);\n    var _this2 = possibleConstructorReturn(this, (StringController.__proto__ || Object.getPrototypeOf(StringController)).call(this, object, property));\n    var _this = _this2;\n    function onChange() {\n      _this.setValue(_this.__input.value);\n    }\n    function onBlur() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'keyup', onChange);\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        this.blur();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(StringController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      if (!dom.isActive(this.__input)) {\n        this.__input.value = this.getValue();\n      }\n      return get(StringController.prototype.__proto__ || Object.getPrototypeOf(StringController.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return StringController;\n}(Controller);\n\nfunction numDecimals(x) {\n  var _x = x.toString();\n  if (_x.indexOf('.') > -1) {\n    return _x.length - _x.indexOf('.') - 1;\n  }\n  return 0;\n}\nvar NumberController = function (_Controller) {\n  inherits(NumberController, _Controller);\n  function NumberController(object, property, params) {\n    classCallCheck(this, NumberController);\n    var _this = possibleConstructorReturn(this, (NumberController.__proto__ || Object.getPrototypeOf(NumberController)).call(this, object, property));\n    var _params = params || {};\n    _this.__min = _params.min;\n    _this.__max = _params.max;\n    _this.__step = _params.step;\n    if (Common.isUndefined(_this.__step)) {\n      if (_this.initialValue === 0) {\n        _this.__impliedStep = 1;\n      } else {\n        _this.__impliedStep = Math.pow(10, Math.floor(Math.log(Math.abs(_this.initialValue)) / Math.LN10)) / 10;\n      }\n    } else {\n      _this.__impliedStep = _this.__step;\n    }\n    _this.__precision = numDecimals(_this.__impliedStep);\n    return _this;\n  }\n  createClass(NumberController, [{\n    key: 'setValue',\n    value: function setValue(v) {\n      var _v = v;\n      if (this.__min !== undefined && _v < this.__min) {\n        _v = this.__min;\n      } else if (this.__max !== undefined && _v > this.__max) {\n        _v = this.__max;\n      }\n      if (this.__step !== undefined && _v % this.__step !== 0) {\n        _v = Math.round(_v / this.__step) * this.__step;\n      }\n      return get(NumberController.prototype.__proto__ || Object.getPrototypeOf(NumberController.prototype), 'setValue', this).call(this, _v);\n    }\n  }, {\n    key: 'min',\n    value: function min(minValue) {\n      this.__min = minValue;\n      return this;\n    }\n  }, {\n    key: 'max',\n    value: function max(maxValue) {\n      this.__max = maxValue;\n      return this;\n    }\n  }, {\n    key: 'step',\n    value: function step(stepValue) {\n      this.__step = stepValue;\n      this.__impliedStep = stepValue;\n      this.__precision = numDecimals(stepValue);\n      return this;\n    }\n  }]);\n  return NumberController;\n}(Controller);\n\nfunction roundToDecimal(value, decimals) {\n  var tenTo = Math.pow(10, decimals);\n  return Math.round(value * tenTo) / tenTo;\n}\nvar NumberControllerBox = function (_NumberController) {\n  inherits(NumberControllerBox, _NumberController);\n  function NumberControllerBox(object, property, params) {\n    classCallCheck(this, NumberControllerBox);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerBox.__proto__ || Object.getPrototypeOf(NumberControllerBox)).call(this, object, property, params));\n    _this2.__truncationSuspended = false;\n    var _this = _this2;\n    var prevY = void 0;\n    function onChange() {\n      var attempted = parseFloat(_this.__input.value);\n      if (!Common.isNaN(attempted)) {\n        _this.setValue(attempted);\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onBlur() {\n      onFinish();\n    }\n    function onMouseDrag(e) {\n      var diff = prevY - e.clientY;\n      _this.setValue(_this.getValue() + diff * _this.__impliedStep);\n      prevY = e.clientY;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      onFinish();\n    }\n    function onMouseDown(e) {\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      prevY = e.clientY;\n    }\n    _this2.__input = document.createElement('input');\n    _this2.__input.setAttribute('type', 'text');\n    dom.bind(_this2.__input, 'change', onChange);\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__input, 'mousedown', onMouseDown);\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        _this.__truncationSuspended = true;\n        this.blur();\n        _this.__truncationSuspended = false;\n        onFinish();\n      }\n    });\n    _this2.updateDisplay();\n    _this2.domElement.appendChild(_this2.__input);\n    return _this2;\n  }\n  createClass(NumberControllerBox, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      this.__input.value = this.__truncationSuspended ? this.getValue() : roundToDecimal(this.getValue(), this.__precision);\n      return get(NumberControllerBox.prototype.__proto__ || Object.getPrototypeOf(NumberControllerBox.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerBox;\n}(NumberController);\n\nfunction map(v, i1, i2, o1, o2) {\n  return o1 + (o2 - o1) * ((v - i1) / (i2 - i1));\n}\nvar NumberControllerSlider = function (_NumberController) {\n  inherits(NumberControllerSlider, _NumberController);\n  function NumberControllerSlider(object, property, min, max, step) {\n    classCallCheck(this, NumberControllerSlider);\n    var _this2 = possibleConstructorReturn(this, (NumberControllerSlider.__proto__ || Object.getPrototypeOf(NumberControllerSlider)).call(this, object, property, { min: min, max: max, step: step }));\n    var _this = _this2;\n    _this2.__background = document.createElement('div');\n    _this2.__foreground = document.createElement('div');\n    dom.bind(_this2.__background, 'mousedown', onMouseDown);\n    dom.bind(_this2.__background, 'touchstart', onTouchStart);\n    dom.addClass(_this2.__background, 'slider');\n    dom.addClass(_this2.__foreground, 'slider-fg');\n    function onMouseDown(e) {\n      document.activeElement.blur();\n      dom.bind(window, 'mousemove', onMouseDrag);\n      dom.bind(window, 'mouseup', onMouseUp);\n      onMouseDrag(e);\n    }\n    function onMouseDrag(e) {\n      e.preventDefault();\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(e.clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n      return false;\n    }\n    function onMouseUp() {\n      dom.unbind(window, 'mousemove', onMouseDrag);\n      dom.unbind(window, 'mouseup', onMouseUp);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    function onTouchStart(e) {\n      if (e.touches.length !== 1) {\n        return;\n      }\n      dom.bind(window, 'touchmove', onTouchMove);\n      dom.bind(window, 'touchend', onTouchEnd);\n      onTouchMove(e);\n    }\n    function onTouchMove(e) {\n      var clientX = e.touches[0].clientX;\n      var bgRect = _this.__background.getBoundingClientRect();\n      _this.setValue(map(clientX, bgRect.left, bgRect.right, _this.__min, _this.__max));\n    }\n    function onTouchEnd() {\n      dom.unbind(window, 'touchmove', onTouchMove);\n      dom.unbind(window, 'touchend', onTouchEnd);\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.getValue());\n      }\n    }\n    _this2.updateDisplay();\n    _this2.__background.appendChild(_this2.__foreground);\n    _this2.domElement.appendChild(_this2.__background);\n    return _this2;\n  }\n  createClass(NumberControllerSlider, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var pct = (this.getValue() - this.__min) / (this.__max - this.__min);\n      this.__foreground.style.width = pct * 100 + '%';\n      return get(NumberControllerSlider.prototype.__proto__ || Object.getPrototypeOf(NumberControllerSlider.prototype), 'updateDisplay', this).call(this);\n    }\n  }]);\n  return NumberControllerSlider;\n}(NumberController);\n\nvar FunctionController = function (_Controller) {\n  inherits(FunctionController, _Controller);\n  function FunctionController(object, property, text) {\n    classCallCheck(this, FunctionController);\n    var _this2 = possibleConstructorReturn(this, (FunctionController.__proto__ || Object.getPrototypeOf(FunctionController)).call(this, object, property));\n    var _this = _this2;\n    _this2.__button = document.createElement('div');\n    _this2.__button.innerHTML = text === undefined ? 'Fire' : text;\n    dom.bind(_this2.__button, 'click', function (e) {\n      e.preventDefault();\n      _this.fire();\n      return false;\n    });\n    dom.addClass(_this2.__button, 'button');\n    _this2.domElement.appendChild(_this2.__button);\n    return _this2;\n  }\n  createClass(FunctionController, [{\n    key: 'fire',\n    value: function fire() {\n      if (this.__onChange) {\n        this.__onChange.call(this);\n      }\n      this.getValue().call(this.object);\n      if (this.__onFinishChange) {\n        this.__onFinishChange.call(this, this.getValue());\n      }\n    }\n  }]);\n  return FunctionController;\n}(Controller);\n\nvar ColorController = function (_Controller) {\n  inherits(ColorController, _Controller);\n  function ColorController(object, property) {\n    classCallCheck(this, ColorController);\n    var _this2 = possibleConstructorReturn(this, (ColorController.__proto__ || Object.getPrototypeOf(ColorController)).call(this, object, property));\n    _this2.__color = new Color(_this2.getValue());\n    _this2.__temp = new Color(0);\n    var _this = _this2;\n    _this2.domElement = document.createElement('div');\n    dom.makeSelectable(_this2.domElement, false);\n    _this2.__selector = document.createElement('div');\n    _this2.__selector.className = 'selector';\n    _this2.__saturation_field = document.createElement('div');\n    _this2.__saturation_field.className = 'saturation-field';\n    _this2.__field_knob = document.createElement('div');\n    _this2.__field_knob.className = 'field-knob';\n    _this2.__field_knob_border = '2px solid ';\n    _this2.__hue_knob = document.createElement('div');\n    _this2.__hue_knob.className = 'hue-knob';\n    _this2.__hue_field = document.createElement('div');\n    _this2.__hue_field.className = 'hue-field';\n    _this2.__input = document.createElement('input');\n    _this2.__input.type = 'text';\n    _this2.__input_textShadow = '0 1px 1px ';\n    dom.bind(_this2.__input, 'keydown', function (e) {\n      if (e.keyCode === 13) {\n        onBlur.call(this);\n      }\n    });\n    dom.bind(_this2.__input, 'blur', onBlur);\n    dom.bind(_this2.__selector, 'mousedown', function () {\n      dom.addClass(this, 'drag').bind(window, 'mouseup', function () {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    dom.bind(_this2.__selector, 'touchstart', function () {\n      dom.addClass(this, 'drag').bind(window, 'touchend', function () {\n        dom.removeClass(_this.__selector, 'drag');\n      });\n    });\n    var valueField = document.createElement('div');\n    Common.extend(_this2.__selector.style, {\n      width: '122px',\n      height: '102px',\n      padding: '3px',\n      backgroundColor: '#222',\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.3)'\n    });\n    Common.extend(_this2.__field_knob.style, {\n      position: 'absolute',\n      width: '12px',\n      height: '12px',\n      border: _this2.__field_knob_border + (_this2.__color.v < 0.5 ? '#fff' : '#000'),\n      boxShadow: '0px 1px 3px rgba(0,0,0,0.5)',\n      borderRadius: '12px',\n      zIndex: 1\n    });\n    Common.extend(_this2.__hue_knob.style, {\n      position: 'absolute',\n      width: '15px',\n      height: '2px',\n      borderRight: '4px solid #fff',\n      zIndex: 1\n    });\n    Common.extend(_this2.__saturation_field.style, {\n      width: '100px',\n      height: '100px',\n      border: '1px solid #555',\n      marginRight: '3px',\n      display: 'inline-block',\n      cursor: 'pointer'\n    });\n    Common.extend(valueField.style, {\n      width: '100%',\n      height: '100%',\n      background: 'none'\n    });\n    linearGradient(valueField, 'top', 'rgba(0,0,0,0)', '#000');\n    Common.extend(_this2.__hue_field.style, {\n      width: '15px',\n      height: '100px',\n      border: '1px solid #555',\n      cursor: 'ns-resize',\n      position: 'absolute',\n      top: '3px',\n      right: '3px'\n    });\n    hueGradient(_this2.__hue_field);\n    Common.extend(_this2.__input.style, {\n      outline: 'none',\n      textAlign: 'center',\n      color: '#fff',\n      border: 0,\n      fontWeight: 'bold',\n      textShadow: _this2.__input_textShadow + 'rgba(0,0,0,0.7)'\n    });\n    dom.bind(_this2.__saturation_field, 'mousedown', fieldDown);\n    dom.bind(_this2.__saturation_field, 'touchstart', fieldDown);\n    dom.bind(_this2.__field_knob, 'mousedown', fieldDown);\n    dom.bind(_this2.__field_knob, 'touchstart', fieldDown);\n    dom.bind(_this2.__hue_field, 'mousedown', fieldDownH);\n    dom.bind(_this2.__hue_field, 'touchstart', fieldDownH);\n    function fieldDown(e) {\n      setSV(e);\n      dom.bind(window, 'mousemove', setSV);\n      dom.bind(window, 'touchmove', setSV);\n      dom.bind(window, 'mouseup', fieldUpSV);\n      dom.bind(window, 'touchend', fieldUpSV);\n    }\n    function fieldDownH(e) {\n      setH(e);\n      dom.bind(window, 'mousemove', setH);\n      dom.bind(window, 'touchmove', setH);\n      dom.bind(window, 'mouseup', fieldUpH);\n      dom.bind(window, 'touchend', fieldUpH);\n    }\n    function fieldUpSV() {\n      dom.unbind(window, 'mousemove', setSV);\n      dom.unbind(window, 'touchmove', setSV);\n      dom.unbind(window, 'mouseup', fieldUpSV);\n      dom.unbind(window, 'touchend', fieldUpSV);\n      onFinish();\n    }\n    function fieldUpH() {\n      dom.unbind(window, 'mousemove', setH);\n      dom.unbind(window, 'touchmove', setH);\n      dom.unbind(window, 'mouseup', fieldUpH);\n      dom.unbind(window, 'touchend', fieldUpH);\n      onFinish();\n    }\n    function onBlur() {\n      var i = interpret(this.value);\n      if (i !== false) {\n        _this.__color.__state = i;\n        _this.setValue(_this.__color.toOriginal());\n      } else {\n        this.value = _this.__color.toString();\n      }\n    }\n    function onFinish() {\n      if (_this.__onFinishChange) {\n        _this.__onFinishChange.call(_this, _this.__color.toOriginal());\n      }\n    }\n    _this2.__saturation_field.appendChild(valueField);\n    _this2.__selector.appendChild(_this2.__field_knob);\n    _this2.__selector.appendChild(_this2.__saturation_field);\n    _this2.__selector.appendChild(_this2.__hue_field);\n    _this2.__hue_field.appendChild(_this2.__hue_knob);\n    _this2.domElement.appendChild(_this2.__input);\n    _this2.domElement.appendChild(_this2.__selector);\n    _this2.updateDisplay();\n    function setSV(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__saturation_field.getBoundingClientRect();\n      var _ref = e.touches && e.touches[0] || e,\n          clientX = _ref.clientX,\n          clientY = _ref.clientY;\n      var s = (clientX - fieldRect.left) / (fieldRect.right - fieldRect.left);\n      var v = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (v > 1) {\n        v = 1;\n      } else if (v < 0) {\n        v = 0;\n      }\n      if (s > 1) {\n        s = 1;\n      } else if (s < 0) {\n        s = 0;\n      }\n      _this.__color.v = v;\n      _this.__color.s = s;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    function setH(e) {\n      if (e.type.indexOf('touch') === -1) {\n        e.preventDefault();\n      }\n      var fieldRect = _this.__hue_field.getBoundingClientRect();\n      var _ref2 = e.touches && e.touches[0] || e,\n          clientY = _ref2.clientY;\n      var h = 1 - (clientY - fieldRect.top) / (fieldRect.bottom - fieldRect.top);\n      if (h > 1) {\n        h = 1;\n      } else if (h < 0) {\n        h = 0;\n      }\n      _this.__color.h = h * 360;\n      _this.setValue(_this.__color.toOriginal());\n      return false;\n    }\n    return _this2;\n  }\n  createClass(ColorController, [{\n    key: 'updateDisplay',\n    value: function updateDisplay() {\n      var i = interpret(this.getValue());\n      if (i !== false) {\n        var mismatch = false;\n        Common.each(Color.COMPONENTS, function (component) {\n          if (!Common.isUndefined(i[component]) && !Common.isUndefined(this.__color.__state[component]) && i[component] !== this.__color.__state[component]) {\n            mismatch = true;\n            return {};\n          }\n        }, this);\n        if (mismatch) {\n          Common.extend(this.__color.__state, i);\n        }\n      }\n      Common.extend(this.__temp.__state, this.__color.__state);\n      this.__temp.a = 1;\n      var flip = this.__color.v < 0.5 || this.__color.s > 0.5 ? 255 : 0;\n      var _flip = 255 - flip;\n      Common.extend(this.__field_knob.style, {\n        marginLeft: 100 * this.__color.s - 7 + 'px',\n        marginTop: 100 * (1 - this.__color.v) - 7 + 'px',\n        backgroundColor: this.__temp.toHexString(),\n        border: this.__field_knob_border + 'rgb(' + flip + ',' + flip + ',' + flip + ')'\n      });\n      this.__hue_knob.style.marginTop = (1 - this.__color.h / 360) * 100 + 'px';\n      this.__temp.s = 1;\n      this.__temp.v = 1;\n      linearGradient(this.__saturation_field, 'left', '#fff', this.__temp.toHexString());\n      this.__input.value = this.__color.toString();\n      Common.extend(this.__input.style, {\n        backgroundColor: this.__color.toHexString(),\n        color: 'rgb(' + flip + ',' + flip + ',' + flip + ')',\n        textShadow: this.__input_textShadow + 'rgba(' + _flip + ',' + _flip + ',' + _flip + ',.7)'\n      });\n    }\n  }]);\n  return ColorController;\n}(Controller);\nvar vendors = ['-moz-', '-o-', '-webkit-', '-ms-', ''];\nfunction linearGradient(elem, x, a, b) {\n  elem.style.background = '';\n  Common.each(vendors, function (vendor) {\n    elem.style.cssText += 'background: ' + vendor + 'linear-gradient(' + x + ', ' + a + ' 0%, ' + b + ' 100%); ';\n  });\n}\nfunction hueGradient(elem) {\n  elem.style.background = '';\n  elem.style.cssText += 'background: -moz-linear-gradient(top,  #ff0000 0%, #ff00ff 17%, #0000ff 34%, #00ffff 50%, #00ff00 67%, #ffff00 84%, #ff0000 100%);';\n  elem.style.cssText += 'background: -webkit-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -o-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: -ms-linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n  elem.style.cssText += 'background: linear-gradient(top,  #ff0000 0%,#ff00ff 17%,#0000ff 34%,#00ffff 50%,#00ff00 67%,#ffff00 84%,#ff0000 100%);';\n}\n\nvar css = {\n  load: function load(url, indoc) {\n    var doc = indoc || document;\n    var link = doc.createElement('link');\n    link.type = 'text/css';\n    link.rel = 'stylesheet';\n    link.href = url;\n    doc.getElementsByTagName('head')[0].appendChild(link);\n  },\n  inject: function inject(cssContent, indoc) {\n    var doc = indoc || document;\n    var injected = document.createElement('style');\n    injected.type = 'text/css';\n    injected.innerHTML = cssContent;\n    var head = doc.getElementsByTagName('head')[0];\n    try {\n      head.appendChild(injected);\n    } catch (e) {\n    }\n  }\n};\n\nvar saveDialogContents = \"<div id=\\\"dg-save\\\" class=\\\"dg dialogue\\\">\\n\\n  Here's the new load parameter for your <code>GUI</code>'s constructor:\\n\\n  <textarea id=\\\"dg-new-constructor\\\"></textarea>\\n\\n  <div id=\\\"dg-save-locally\\\">\\n\\n    <input id=\\\"dg-local-storage\\\" type=\\\"checkbox\\\"/> Automatically save\\n    values to <code>localStorage</code> on exit.\\n\\n    <div id=\\\"dg-local-explain\\\">The values saved to <code>localStorage</code> will\\n      override those passed to <code>dat.GUI</code>'s constructor. This makes it\\n      easier to work incrementally, but <code>localStorage</code> is fragile,\\n      and your friends may not see the same values you do.\\n\\n    </div>\\n\\n  </div>\\n\\n</div>\";\n\nvar ControllerFactory = function ControllerFactory(object, property) {\n  var initialValue = object[property];\n  if (Common.isArray(arguments[2]) || Common.isObject(arguments[2])) {\n    return new OptionController(object, property, arguments[2]);\n  }\n  if (Common.isNumber(initialValue)) {\n    if (Common.isNumber(arguments[2]) && Common.isNumber(arguments[3])) {\n      if (Common.isNumber(arguments[4])) {\n        return new NumberControllerSlider(object, property, arguments[2], arguments[3], arguments[4]);\n      }\n      return new NumberControllerSlider(object, property, arguments[2], arguments[3]);\n    }\n    if (Common.isNumber(arguments[4])) {\n      return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3], step: arguments[4] });\n    }\n    return new NumberControllerBox(object, property, { min: arguments[2], max: arguments[3] });\n  }\n  if (Common.isString(initialValue)) {\n    return new StringController(object, property);\n  }\n  if (Common.isFunction(initialValue)) {\n    return new FunctionController(object, property, '');\n  }\n  if (Common.isBoolean(initialValue)) {\n    return new BooleanController(object, property);\n  }\n  return null;\n};\n\nfunction requestAnimationFrame(callback) {\n  setTimeout(callback, 1000 / 60);\n}\nvar requestAnimationFrame$1 = window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame || requestAnimationFrame;\n\nvar CenteredDiv = function () {\n  function CenteredDiv() {\n    classCallCheck(this, CenteredDiv);\n    this.backgroundElement = document.createElement('div');\n    Common.extend(this.backgroundElement.style, {\n      backgroundColor: 'rgba(0,0,0,0.8)',\n      top: 0,\n      left: 0,\n      display: 'none',\n      zIndex: '1000',\n      opacity: 0,\n      WebkitTransition: 'opacity 0.2s linear',\n      transition: 'opacity 0.2s linear'\n    });\n    dom.makeFullscreen(this.backgroundElement);\n    this.backgroundElement.style.position = 'fixed';\n    this.domElement = document.createElement('div');\n    Common.extend(this.domElement.style, {\n      position: 'fixed',\n      display: 'none',\n      zIndex: '1001',\n      opacity: 0,\n      WebkitTransition: '-webkit-transform 0.2s ease-out, opacity 0.2s linear',\n      transition: 'transform 0.2s ease-out, opacity 0.2s linear'\n    });\n    document.body.appendChild(this.backgroundElement);\n    document.body.appendChild(this.domElement);\n    var _this = this;\n    dom.bind(this.backgroundElement, 'click', function () {\n      _this.hide();\n    });\n  }\n  createClass(CenteredDiv, [{\n    key: 'show',\n    value: function show() {\n      var _this = this;\n      this.backgroundElement.style.display = 'block';\n      this.domElement.style.display = 'block';\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n      this.layout();\n      Common.defer(function () {\n        _this.backgroundElement.style.opacity = 1;\n        _this.domElement.style.opacity = 1;\n        _this.domElement.style.webkitTransform = 'scale(1)';\n      });\n    }\n  }, {\n    key: 'hide',\n    value: function hide() {\n      var _this = this;\n      var hide = function hide() {\n        _this.domElement.style.display = 'none';\n        _this.backgroundElement.style.display = 'none';\n        dom.unbind(_this.domElement, 'webkitTransitionEnd', hide);\n        dom.unbind(_this.domElement, 'transitionend', hide);\n        dom.unbind(_this.domElement, 'oTransitionEnd', hide);\n      };\n      dom.bind(this.domElement, 'webkitTransitionEnd', hide);\n      dom.bind(this.domElement, 'transitionend', hide);\n      dom.bind(this.domElement, 'oTransitionEnd', hide);\n      this.backgroundElement.style.opacity = 0;\n      this.domElement.style.opacity = 0;\n      this.domElement.style.webkitTransform = 'scale(1.1)';\n    }\n  }, {\n    key: 'layout',\n    value: function layout() {\n      this.domElement.style.left = window.innerWidth / 2 - dom.getWidth(this.domElement) / 2 + 'px';\n      this.domElement.style.top = window.innerHeight / 2 - dom.getHeight(this.domElement) / 2 + 'px';\n    }\n  }]);\n  return CenteredDiv;\n}();\n\nvar styleSheet = ___$insertStyle(\".dg ul{list-style:none;margin:0;padding:0;width:100%;clear:both}.dg.ac{position:fixed;top:0;left:0;right:0;height:0;z-index:0}.dg:not(.ac) .main{overflow:hidden}.dg.main{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear}.dg.main.taller-than-window{overflow-y:auto}.dg.main.taller-than-window .close-button{opacity:1;margin-top:-1px;border-top:1px solid #2c2c2c}.dg.main ul.closed .close-button{opacity:1 !important}.dg.main:hover .close-button,.dg.main .close-button.drag{opacity:1}.dg.main .close-button{-webkit-transition:opacity .1s linear;-o-transition:opacity .1s linear;-moz-transition:opacity .1s linear;transition:opacity .1s linear;border:0;line-height:19px;height:20px;cursor:pointer;text-align:center;background-color:#000}.dg.main .close-button.close-top{position:relative}.dg.main .close-button.close-bottom{position:absolute}.dg.main .close-button:hover{background-color:#111}.dg.a{float:right;margin-right:15px;overflow-y:visible}.dg.a.has-save>ul.close-top{margin-top:0}.dg.a.has-save>ul.close-bottom{margin-top:27px}.dg.a.has-save>ul.closed{margin-top:0}.dg.a .save-row{top:0;z-index:1002}.dg.a .save-row.close-top{position:relative}.dg.a .save-row.close-bottom{position:fixed}.dg li{-webkit-transition:height .1s ease-out;-o-transition:height .1s ease-out;-moz-transition:height .1s ease-out;transition:height .1s ease-out;-webkit-transition:overflow .1s linear;-o-transition:overflow .1s linear;-moz-transition:overflow .1s linear;transition:overflow .1s linear}.dg li:not(.folder){cursor:auto;height:27px;line-height:27px;padding:0 4px 0 5px}.dg li.folder{padding:0;border-left:4px solid rgba(0,0,0,0)}.dg li.title{cursor:pointer;margin-left:-4px}.dg .closed li:not(.title),.dg .closed ul li,.dg .closed ul li>*{height:0;overflow:hidden;border:0}.dg .cr{clear:both;padding-left:3px;height:27px;overflow:hidden}.dg .property-name{cursor:default;float:left;clear:left;width:40%;overflow:hidden;text-overflow:ellipsis}.dg .cr.function .property-name{width:100%}.dg .c{float:left;width:60%;position:relative}.dg .c input[type=text]{border:0;margin-top:4px;padding:3px;width:100%;float:right}.dg .has-slider input[type=text]{width:30%;margin-left:0}.dg .slider{float:left;width:66%;margin-left:-5px;margin-right:0;height:19px;margin-top:4px}.dg .slider-fg{height:100%}.dg .c input[type=checkbox]{margin-top:7px}.dg .c select{margin-top:5px}.dg .cr.function,.dg .cr.function .property-name,.dg .cr.function *,.dg .cr.boolean,.dg .cr.boolean *{cursor:pointer}.dg .cr.color{overflow:visible}.dg .selector{display:none;position:absolute;margin-left:-9px;margin-top:23px;z-index:10}.dg .c:hover .selector,.dg .selector.drag{display:block}.dg li.save-row{padding:0}.dg li.save-row .button{display:inline-block;padding:0px 6px}.dg.dialogue{background-color:#222;width:460px;padding:15px;font-size:13px;line-height:15px}#dg-new-constructor{padding:10px;color:#222;font-family:Monaco, monospace;font-size:10px;border:0;resize:none;box-shadow:inset 1px 1px 1px #888;word-wrap:break-word;margin:12px 0;display:block;width:440px;overflow-y:scroll;height:100px;position:relative}#dg-local-explain{display:none;font-size:11px;line-height:17px;border-radius:3px;background-color:#333;padding:8px;margin-top:10px}#dg-local-explain code{font-size:10px}#dat-gui-save-locally{display:none}.dg{color:#eee;font:11px 'Lucida Grande', sans-serif;text-shadow:0 -1px 0 #111}.dg.main::-webkit-scrollbar{width:5px;background:#1a1a1a}.dg.main::-webkit-scrollbar-corner{height:0;display:none}.dg.main::-webkit-scrollbar-thumb{border-radius:5px;background:#676767}.dg li:not(.folder){background:#1a1a1a;border-bottom:1px solid #2c2c2c}.dg li.save-row{line-height:25px;background:#dad5cb;border:0}.dg li.save-row select{margin-left:5px;width:108px}.dg li.save-row .button{margin-left:5px;margin-top:1px;border-radius:2px;font-size:9px;line-height:7px;padding:4px 4px 5px 4px;background:#c5bdad;color:#fff;text-shadow:0 1px 0 #b0a58f;box-shadow:0 -1px 0 #b0a58f;cursor:pointer}.dg li.save-row .button.gears{background:#c5bdad url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAsAAAANCAYAAAB/9ZQ7AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAQJJREFUeNpiYKAU/P//PwGIC/ApCABiBSAW+I8AClAcgKxQ4T9hoMAEUrxx2QSGN6+egDX+/vWT4e7N82AMYoPAx/evwWoYoSYbACX2s7KxCxzcsezDh3evFoDEBYTEEqycggWAzA9AuUSQQgeYPa9fPv6/YWm/Acx5IPb7ty/fw+QZblw67vDs8R0YHyQhgObx+yAJkBqmG5dPPDh1aPOGR/eugW0G4vlIoTIfyFcA+QekhhHJhPdQxbiAIguMBTQZrPD7108M6roWYDFQiIAAv6Aow/1bFwXgis+f2LUAynwoIaNcz8XNx3Dl7MEJUDGQpx9gtQ8YCueB+D26OECAAQDadt7e46D42QAAAABJRU5ErkJggg==) 2px 1px no-repeat;height:7px;width:8px}.dg li.save-row .button:hover{background-color:#bab19e;box-shadow:0 -1px 0 #b0a58f}.dg li.folder{border-bottom:0}.dg li.title{padding-left:16px;background:#000 url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlI+hKgFxoCgAOw==) 6px 10px no-repeat;cursor:pointer;border-bottom:1px solid rgba(255,255,255,0.2)}.dg .closed li.title{background-image:url(data:image/gif;base64,R0lGODlhBQAFAJEAAP////Pz8////////yH5BAEAAAIALAAAAAAFAAUAAAIIlGIWqMCbWAEAOw==)}.dg .cr.boolean{border-left:3px solid #806787}.dg .cr.color{border-left:3px solid}.dg .cr.function{border-left:3px solid #e61d5f}.dg .cr.number{border-left:3px solid #2FA1D6}.dg .cr.number input[type=text]{color:#2FA1D6}.dg .cr.string{border-left:3px solid #1ed36f}.dg .cr.string input[type=text]{color:#1ed36f}.dg .cr.function:hover,.dg .cr.boolean:hover{background:#111}.dg .c input[type=text]{background:#303030;outline:none}.dg .c input[type=text]:hover{background:#3c3c3c}.dg .c input[type=text]:focus{background:#494949;color:#fff}.dg .c .slider{background:#303030;cursor:ew-resize}.dg .c .slider-fg{background:#2FA1D6;max-width:100%}.dg .c .slider:hover{background:#3c3c3c}.dg .c .slider:hover .slider-fg{background:#44abda}\\n\");\n\ncss.inject(styleSheet);\nvar CSS_NAMESPACE = 'dg';\nvar HIDE_KEY_CODE = 72;\nvar CLOSE_BUTTON_HEIGHT = 20;\nvar DEFAULT_DEFAULT_PRESET_NAME = 'Default';\nvar SUPPORTS_LOCAL_STORAGE = function () {\n  try {\n    return !!window.localStorage;\n  } catch (e) {\n    return false;\n  }\n}();\nvar SAVE_DIALOGUE = void 0;\nvar autoPlaceVirgin = true;\nvar autoPlaceContainer = void 0;\nvar hide = false;\nvar hideableGuis = [];\nvar GUI = function GUI(pars) {\n  var _this = this;\n  var params = pars || {};\n  this.domElement = document.createElement('div');\n  this.__ul = document.createElement('ul');\n  this.domElement.appendChild(this.__ul);\n  dom.addClass(this.domElement, CSS_NAMESPACE);\n  this.__folders = {};\n  this.__controllers = [];\n  this.__rememberedObjects = [];\n  this.__rememberedObjectIndecesToControllers = [];\n  this.__listening = [];\n  params = Common.defaults(params, {\n    closeOnTop: false,\n    autoPlace: true,\n    width: GUI.DEFAULT_WIDTH\n  });\n  params = Common.defaults(params, {\n    resizable: params.autoPlace,\n    hideable: params.autoPlace\n  });\n  if (!Common.isUndefined(params.load)) {\n    if (params.preset) {\n      params.load.preset = params.preset;\n    }\n  } else {\n    params.load = { preset: DEFAULT_DEFAULT_PRESET_NAME };\n  }\n  if (Common.isUndefined(params.parent) && params.hideable) {\n    hideableGuis.push(this);\n  }\n  params.resizable = Common.isUndefined(params.parent) && params.resizable;\n  if (params.autoPlace && Common.isUndefined(params.scrollable)) {\n    params.scrollable = true;\n  }\n  var useLocalStorage = SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(this, 'isLocal')) === 'true';\n  var saveToLocalStorage = void 0;\n  var titleRow = void 0;\n  Object.defineProperties(this,\n  {\n    parent: {\n      get: function get$$1() {\n        return params.parent;\n      }\n    },\n    scrollable: {\n      get: function get$$1() {\n        return params.scrollable;\n      }\n    },\n    autoPlace: {\n      get: function get$$1() {\n        return params.autoPlace;\n      }\n    },\n    closeOnTop: {\n      get: function get$$1() {\n        return params.closeOnTop;\n      }\n    },\n    preset: {\n      get: function get$$1() {\n        if (_this.parent) {\n          return _this.getRoot().preset;\n        }\n        return params.load.preset;\n      },\n      set: function set$$1(v) {\n        if (_this.parent) {\n          _this.getRoot().preset = v;\n        } else {\n          params.load.preset = v;\n        }\n        setPresetSelectIndex(this);\n        _this.revert();\n      }\n    },\n    width: {\n      get: function get$$1() {\n        return params.width;\n      },\n      set: function set$$1(v) {\n        params.width = v;\n        setWidth(_this, v);\n      }\n    },\n    name: {\n      get: function get$$1() {\n        return params.name;\n      },\n      set: function set$$1(v) {\n        params.name = v;\n        if (titleRow) {\n          titleRow.innerHTML = params.name;\n        }\n      }\n    },\n    closed: {\n      get: function get$$1() {\n        return params.closed;\n      },\n      set: function set$$1(v) {\n        params.closed = v;\n        if (params.closed) {\n          dom.addClass(_this.__ul, GUI.CLASS_CLOSED);\n        } else {\n          dom.removeClass(_this.__ul, GUI.CLASS_CLOSED);\n        }\n        this.onResize();\n        if (_this.__closeButton) {\n          _this.__closeButton.innerHTML = v ? GUI.TEXT_OPEN : GUI.TEXT_CLOSED;\n        }\n      }\n    },\n    load: {\n      get: function get$$1() {\n        return params.load;\n      }\n    },\n    useLocalStorage: {\n      get: function get$$1() {\n        return useLocalStorage;\n      },\n      set: function set$$1(bool) {\n        if (SUPPORTS_LOCAL_STORAGE) {\n          useLocalStorage = bool;\n          if (bool) {\n            dom.bind(window, 'unload', saveToLocalStorage);\n          } else {\n            dom.unbind(window, 'unload', saveToLocalStorage);\n          }\n          localStorage.setItem(getLocalStorageHash(_this, 'isLocal'), bool);\n        }\n      }\n    }\n  });\n  if (Common.isUndefined(params.parent)) {\n    this.closed = params.closed || false;\n    dom.addClass(this.domElement, GUI.CLASS_MAIN);\n    dom.makeSelectable(this.domElement, false);\n    if (SUPPORTS_LOCAL_STORAGE) {\n      if (useLocalStorage) {\n        _this.useLocalStorage = true;\n        var savedGui = localStorage.getItem(getLocalStorageHash(this, 'gui'));\n        if (savedGui) {\n          params.load = JSON.parse(savedGui);\n        }\n      }\n    }\n    this.__closeButton = document.createElement('div');\n    this.__closeButton.innerHTML = GUI.TEXT_CLOSED;\n    dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BUTTON);\n    if (params.closeOnTop) {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_TOP);\n      this.domElement.insertBefore(this.__closeButton, this.domElement.childNodes[0]);\n    } else {\n      dom.addClass(this.__closeButton, GUI.CLASS_CLOSE_BOTTOM);\n      this.domElement.appendChild(this.__closeButton);\n    }\n    dom.bind(this.__closeButton, 'click', function () {\n      _this.closed = !_this.closed;\n    });\n  } else {\n    if (params.closed === undefined) {\n      params.closed = true;\n    }\n    var titleRowName = document.createTextNode(params.name);\n    dom.addClass(titleRowName, 'controller-name');\n    titleRow = addRow(_this, titleRowName);\n    var onClickTitle = function onClickTitle(e) {\n      e.preventDefault();\n      _this.closed = !_this.closed;\n      return false;\n    };\n    dom.addClass(this.__ul, GUI.CLASS_CLOSED);\n    dom.addClass(titleRow, 'title');\n    dom.bind(titleRow, 'click', onClickTitle);\n    if (!params.closed) {\n      this.closed = false;\n    }\n  }\n  if (params.autoPlace) {\n    if (Common.isUndefined(params.parent)) {\n      if (autoPlaceVirgin) {\n        autoPlaceContainer = document.createElement('div');\n        dom.addClass(autoPlaceContainer, CSS_NAMESPACE);\n        dom.addClass(autoPlaceContainer, GUI.CLASS_AUTO_PLACE_CONTAINER);\n        document.body.appendChild(autoPlaceContainer);\n        autoPlaceVirgin = false;\n      }\n      autoPlaceContainer.appendChild(this.domElement);\n      dom.addClass(this.domElement, GUI.CLASS_AUTO_PLACE);\n    }\n    if (!this.parent) {\n      setWidth(_this, params.width);\n    }\n  }\n  this.__resizeHandler = function () {\n    _this.onResizeDebounced();\n  };\n  dom.bind(window, 'resize', this.__resizeHandler);\n  dom.bind(this.__ul, 'webkitTransitionEnd', this.__resizeHandler);\n  dom.bind(this.__ul, 'transitionend', this.__resizeHandler);\n  dom.bind(this.__ul, 'oTransitionEnd', this.__resizeHandler);\n  this.onResize();\n  if (params.resizable) {\n    addResizeHandle(this);\n  }\n  saveToLocalStorage = function saveToLocalStorage() {\n    if (SUPPORTS_LOCAL_STORAGE && localStorage.getItem(getLocalStorageHash(_this, 'isLocal')) === 'true') {\n      localStorage.setItem(getLocalStorageHash(_this, 'gui'), JSON.stringify(_this.getSaveObject()));\n    }\n  };\n  this.saveToLocalStorageIfPossible = saveToLocalStorage;\n  function resetWidth() {\n    var root = _this.getRoot();\n    root.width += 1;\n    Common.defer(function () {\n      root.width -= 1;\n    });\n  }\n  if (!params.parent) {\n    resetWidth();\n  }\n};\nGUI.toggleHide = function () {\n  hide = !hide;\n  Common.each(hideableGuis, function (gui) {\n    gui.domElement.style.display = hide ? 'none' : '';\n  });\n};\nGUI.CLASS_AUTO_PLACE = 'a';\nGUI.CLASS_AUTO_PLACE_CONTAINER = 'ac';\nGUI.CLASS_MAIN = 'main';\nGUI.CLASS_CONTROLLER_ROW = 'cr';\nGUI.CLASS_TOO_TALL = 'taller-than-window';\nGUI.CLASS_CLOSED = 'closed';\nGUI.CLASS_CLOSE_BUTTON = 'close-button';\nGUI.CLASS_CLOSE_TOP = 'close-top';\nGUI.CLASS_CLOSE_BOTTOM = 'close-bottom';\nGUI.CLASS_DRAG = 'drag';\nGUI.DEFAULT_WIDTH = 245;\nGUI.TEXT_CLOSED = 'Close Controls';\nGUI.TEXT_OPEN = 'Open Controls';\nGUI._keydownHandler = function (e) {\n  if (document.activeElement.type !== 'text' && (e.which === HIDE_KEY_CODE || e.keyCode === HIDE_KEY_CODE)) {\n    GUI.toggleHide();\n  }\n};\ndom.bind(window, 'keydown', GUI._keydownHandler, false);\nCommon.extend(GUI.prototype,\n{\n  add: function add(object, property) {\n    return _add(this, object, property, {\n      factoryArgs: Array.prototype.slice.call(arguments, 2)\n    });\n  },\n  addColor: function addColor(object, property) {\n    return _add(this, object, property, {\n      color: true\n    });\n  },\n  remove: function remove(controller) {\n    this.__ul.removeChild(controller.__li);\n    this.__controllers.splice(this.__controllers.indexOf(controller), 1);\n    var _this = this;\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  destroy: function destroy() {\n    if (this.parent) {\n      throw new Error('Only the root GUI should be removed with .destroy(). ' + 'For subfolders, use gui.removeFolder(folder) instead.');\n    }\n    if (this.autoPlace) {\n      autoPlaceContainer.removeChild(this.domElement);\n    }\n    var _this = this;\n    Common.each(this.__folders, function (subfolder) {\n      _this.removeFolder(subfolder);\n    });\n    dom.unbind(window, 'keydown', GUI._keydownHandler, false);\n    removeListeners(this);\n  },\n  addFolder: function addFolder(name) {\n    if (this.__folders[name] !== undefined) {\n      throw new Error('You already have a folder in this GUI by the' + ' name \"' + name + '\"');\n    }\n    var newGuiParams = { name: name, parent: this };\n    newGuiParams.autoPlace = this.autoPlace;\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[name]) {\n      newGuiParams.closed = this.load.folders[name].closed;\n      newGuiParams.load = this.load.folders[name];\n    }\n    var gui = new GUI(newGuiParams);\n    this.__folders[name] = gui;\n    var li = addRow(this, gui.domElement);\n    dom.addClass(li, 'folder');\n    return gui;\n  },\n  removeFolder: function removeFolder(folder) {\n    this.__ul.removeChild(folder.domElement.parentElement);\n    delete this.__folders[folder.name];\n    if (this.load &&\n    this.load.folders &&\n    this.load.folders[folder.name]) {\n      delete this.load.folders[folder.name];\n    }\n    removeListeners(folder);\n    var _this = this;\n    Common.each(folder.__folders, function (subfolder) {\n      folder.removeFolder(subfolder);\n    });\n    Common.defer(function () {\n      _this.onResize();\n    });\n  },\n  open: function open() {\n    this.closed = false;\n  },\n  close: function close() {\n    this.closed = true;\n  },\n  hide: function hide() {\n    this.domElement.style.display = 'none';\n  },\n  show: function show() {\n    this.domElement.style.display = '';\n  },\n  onResize: function onResize() {\n    var root = this.getRoot();\n    if (root.scrollable) {\n      var top = dom.getOffset(root.__ul).top;\n      var h = 0;\n      Common.each(root.__ul.childNodes, function (node) {\n        if (!(root.autoPlace && node === root.__save_row)) {\n          h += dom.getHeight(node);\n        }\n      });\n      if (window.innerHeight - top - CLOSE_BUTTON_HEIGHT < h) {\n        dom.addClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = window.innerHeight - top - CLOSE_BUTTON_HEIGHT + 'px';\n      } else {\n        dom.removeClass(root.domElement, GUI.CLASS_TOO_TALL);\n        root.__ul.style.height = 'auto';\n      }\n    }\n    if (root.__resize_handle) {\n      Common.defer(function () {\n        root.__resize_handle.style.height = root.__ul.offsetHeight + 'px';\n      });\n    }\n    if (root.__closeButton) {\n      root.__closeButton.style.width = root.width + 'px';\n    }\n  },\n  onResizeDebounced: Common.debounce(function () {\n    this.onResize();\n  }, 50),\n  remember: function remember() {\n    if (Common.isUndefined(SAVE_DIALOGUE)) {\n      SAVE_DIALOGUE = new CenteredDiv();\n      SAVE_DIALOGUE.domElement.innerHTML = saveDialogContents;\n    }\n    if (this.parent) {\n      throw new Error('You can only call remember on a top level GUI.');\n    }\n    var _this = this;\n    Common.each(Array.prototype.slice.call(arguments), function (object) {\n      if (_this.__rememberedObjects.length === 0) {\n        addSaveMenu(_this);\n      }\n      if (_this.__rememberedObjects.indexOf(object) === -1) {\n        _this.__rememberedObjects.push(object);\n      }\n    });\n    if (this.autoPlace) {\n      setWidth(this, this.width);\n    }\n  },\n  getRoot: function getRoot() {\n    var gui = this;\n    while (gui.parent) {\n      gui = gui.parent;\n    }\n    return gui;\n  },\n  getSaveObject: function getSaveObject() {\n    var toReturn = this.load;\n    toReturn.closed = this.closed;\n    if (this.__rememberedObjects.length > 0) {\n      toReturn.preset = this.preset;\n      if (!toReturn.remembered) {\n        toReturn.remembered = {};\n      }\n      toReturn.remembered[this.preset] = getCurrentPreset(this);\n    }\n    toReturn.folders = {};\n    Common.each(this.__folders, function (element, key) {\n      toReturn.folders[key] = element.getSaveObject();\n    });\n    return toReturn;\n  },\n  save: function save() {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n    }\n    this.load.remembered[this.preset] = getCurrentPreset(this);\n    markPresetModified(this, false);\n    this.saveToLocalStorageIfPossible();\n  },\n  saveAs: function saveAs(presetName) {\n    if (!this.load.remembered) {\n      this.load.remembered = {};\n      this.load.remembered[DEFAULT_DEFAULT_PRESET_NAME] = getCurrentPreset(this, true);\n    }\n    this.load.remembered[presetName] = getCurrentPreset(this);\n    this.preset = presetName;\n    addPresetOption(this, presetName, true);\n    this.saveToLocalStorageIfPossible();\n  },\n  revert: function revert(gui) {\n    Common.each(this.__controllers, function (controller) {\n      if (!this.getRoot().load.remembered) {\n        controller.setValue(controller.initialValue);\n      } else {\n        recallSavedValue(gui || this.getRoot(), controller);\n      }\n      if (controller.__onFinishChange) {\n        controller.__onFinishChange.call(controller, controller.getValue());\n      }\n    }, this);\n    Common.each(this.__folders, function (folder) {\n      folder.revert(folder);\n    });\n    if (!gui) {\n      markPresetModified(this.getRoot(), false);\n    }\n  },\n  listen: function listen(controller) {\n    var init = this.__listening.length === 0;\n    this.__listening.push(controller);\n    if (init) {\n      updateDisplays(this.__listening);\n    }\n  },\n  updateDisplay: function updateDisplay() {\n    Common.each(this.__controllers, function (controller) {\n      controller.updateDisplay();\n    });\n    Common.each(this.__folders, function (folder) {\n      folder.updateDisplay();\n    });\n  }\n});\nfunction addRow(gui, newDom, liBefore) {\n  var li = document.createElement('li');\n  if (newDom) {\n    li.appendChild(newDom);\n  }\n  if (liBefore) {\n    gui.__ul.insertBefore(li, liBefore);\n  } else {\n    gui.__ul.appendChild(li);\n  }\n  gui.onResize();\n  return li;\n}\nfunction removeListeners(gui) {\n  dom.unbind(window, 'resize', gui.__resizeHandler);\n  if (gui.saveToLocalStorageIfPossible) {\n    dom.unbind(window, 'unload', gui.saveToLocalStorageIfPossible);\n  }\n}\nfunction markPresetModified(gui, modified) {\n  var opt = gui.__preset_select[gui.__preset_select.selectedIndex];\n  if (modified) {\n    opt.innerHTML = opt.value + '*';\n  } else {\n    opt.innerHTML = opt.value;\n  }\n}\nfunction augmentController(gui, li, controller) {\n  controller.__li = li;\n  controller.__gui = gui;\n  Common.extend(controller, {\n    options: function options(_options) {\n      if (arguments.length > 1) {\n        var nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: nextSibling,\n          factoryArgs: [Common.toArray(arguments)]\n        });\n      }\n      if (Common.isArray(_options) || Common.isObject(_options)) {\n        var _nextSibling = controller.__li.nextElementSibling;\n        controller.remove();\n        return _add(gui, controller.object, controller.property, {\n          before: _nextSibling,\n          factoryArgs: [_options]\n        });\n      }\n    },\n    name: function name(_name) {\n      controller.__li.firstElementChild.firstElementChild.innerHTML = _name;\n      return controller;\n    },\n    listen: function listen() {\n      controller.__gui.listen(controller);\n      return controller;\n    },\n    remove: function remove() {\n      controller.__gui.remove(controller);\n      return controller;\n    }\n  });\n  if (controller instanceof NumberControllerSlider) {\n    var box = new NumberControllerBox(controller.object, controller.property, { min: controller.__min, max: controller.__max, step: controller.__step });\n    Common.each(['updateDisplay', 'onChange', 'onFinishChange', 'step', 'min', 'max'], function (method) {\n      var pc = controller[method];\n      var pb = box[method];\n      controller[method] = box[method] = function () {\n        var args = Array.prototype.slice.call(arguments);\n        pb.apply(box, args);\n        return pc.apply(controller, args);\n      };\n    });\n    dom.addClass(li, 'has-slider');\n    controller.domElement.insertBefore(box.domElement, controller.domElement.firstElementChild);\n  } else if (controller instanceof NumberControllerBox) {\n    var r = function r(returned) {\n      if (Common.isNumber(controller.__min) && Common.isNumber(controller.__max)) {\n        var oldName = controller.__li.firstElementChild.firstElementChild.innerHTML;\n        var wasListening = controller.__gui.__listening.indexOf(controller) > -1;\n        controller.remove();\n        var newController = _add(gui, controller.object, controller.property, {\n          before: controller.__li.nextElementSibling,\n          factoryArgs: [controller.__min, controller.__max, controller.__step]\n        });\n        newController.name(oldName);\n        if (wasListening) newController.listen();\n        return newController;\n      }\n      return returned;\n    };\n    controller.min = Common.compose(r, controller.min);\n    controller.max = Common.compose(r, controller.max);\n  } else if (controller instanceof BooleanController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__checkbox, 'click');\n    });\n    dom.bind(controller.__checkbox, 'click', function (e) {\n      e.stopPropagation();\n    });\n  } else if (controller instanceof FunctionController) {\n    dom.bind(li, 'click', function () {\n      dom.fakeEvent(controller.__button, 'click');\n    });\n    dom.bind(li, 'mouseover', function () {\n      dom.addClass(controller.__button, 'hover');\n    });\n    dom.bind(li, 'mouseout', function () {\n      dom.removeClass(controller.__button, 'hover');\n    });\n  } else if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n    controller.updateDisplay = Common.compose(function (val) {\n      li.style.borderLeftColor = controller.__color.toString();\n      return val;\n    }, controller.updateDisplay);\n    controller.updateDisplay();\n  }\n  controller.setValue = Common.compose(function (val) {\n    if (gui.getRoot().__preset_select && controller.isModified()) {\n      markPresetModified(gui.getRoot(), true);\n    }\n    return val;\n  }, controller.setValue);\n}\nfunction recallSavedValue(gui, controller) {\n  var root = gui.getRoot();\n  var matchedIndex = root.__rememberedObjects.indexOf(controller.object);\n  if (matchedIndex !== -1) {\n    var controllerMap = root.__rememberedObjectIndecesToControllers[matchedIndex];\n    if (controllerMap === undefined) {\n      controllerMap = {};\n      root.__rememberedObjectIndecesToControllers[matchedIndex] = controllerMap;\n    }\n    controllerMap[controller.property] = controller;\n    if (root.load && root.load.remembered) {\n      var presetMap = root.load.remembered;\n      var preset = void 0;\n      if (presetMap[gui.preset]) {\n        preset = presetMap[gui.preset];\n      } else if (presetMap[DEFAULT_DEFAULT_PRESET_NAME]) {\n        preset = presetMap[DEFAULT_DEFAULT_PRESET_NAME];\n      } else {\n        return;\n      }\n      if (preset[matchedIndex] && preset[matchedIndex][controller.property] !== undefined) {\n        var value = preset[matchedIndex][controller.property];\n        controller.initialValue = value;\n        controller.setValue(value);\n      }\n    }\n  }\n}\nfunction _add(gui, object, property, params) {\n  if (object[property] === undefined) {\n    throw new Error('Object \"' + object + '\" has no property \"' + property + '\"');\n  }\n  var controller = void 0;\n  if (params.color) {\n    controller = new ColorController(object, property);\n  } else {\n    var factoryArgs = [object, property].concat(params.factoryArgs);\n    controller = ControllerFactory.apply(gui, factoryArgs);\n  }\n  if (params.before instanceof Controller) {\n    params.before = params.before.__li;\n  }\n  recallSavedValue(gui, controller);\n  dom.addClass(controller.domElement, 'c');\n  var name = document.createElement('span');\n  dom.addClass(name, 'property-name');\n  name.innerHTML = controller.property;\n  var container = document.createElement('div');\n  container.appendChild(name);\n  container.appendChild(controller.domElement);\n  var li = addRow(gui, container, params.before);\n  dom.addClass(li, GUI.CLASS_CONTROLLER_ROW);\n  if (controller instanceof ColorController) {\n    dom.addClass(li, 'color');\n  } else {\n    dom.addClass(li, _typeof(controller.getValue()));\n  }\n  augmentController(gui, li, controller);\n  gui.__controllers.push(controller);\n  return controller;\n}\nfunction getLocalStorageHash(gui, key) {\n  return document.location.href + '.' + key;\n}\nfunction addPresetOption(gui, name, setSelected) {\n  var opt = document.createElement('option');\n  opt.innerHTML = name;\n  opt.value = name;\n  gui.__preset_select.appendChild(opt);\n  if (setSelected) {\n    gui.__preset_select.selectedIndex = gui.__preset_select.length - 1;\n  }\n}\nfunction showHideExplain(gui, explain) {\n  explain.style.display = gui.useLocalStorage ? 'block' : 'none';\n}\nfunction addSaveMenu(gui) {\n  var div = gui.__save_row = document.createElement('li');\n  dom.addClass(gui.domElement, 'has-save');\n  gui.__ul.insertBefore(div, gui.__ul.firstChild);\n  dom.addClass(div, 'save-row');\n  var gears = document.createElement('span');\n  gears.innerHTML = '&nbsp;';\n  dom.addClass(gears, 'button gears');\n  var button = document.createElement('span');\n  button.innerHTML = 'Save';\n  dom.addClass(button, 'button');\n  dom.addClass(button, 'save');\n  var button2 = document.createElement('span');\n  button2.innerHTML = 'New';\n  dom.addClass(button2, 'button');\n  dom.addClass(button2, 'save-as');\n  var button3 = document.createElement('span');\n  button3.innerHTML = 'Revert';\n  dom.addClass(button3, 'button');\n  dom.addClass(button3, 'revert');\n  var select = gui.__preset_select = document.createElement('select');\n  if (gui.load && gui.load.remembered) {\n    Common.each(gui.load.remembered, function (value, key) {\n      addPresetOption(gui, key, key === gui.preset);\n    });\n  } else {\n    addPresetOption(gui, DEFAULT_DEFAULT_PRESET_NAME, false);\n  }\n  dom.bind(select, 'change', function () {\n    for (var index = 0; index < gui.__preset_select.length; index++) {\n      gui.__preset_select[index].innerHTML = gui.__preset_select[index].value;\n    }\n    gui.preset = this.value;\n  });\n  div.appendChild(select);\n  div.appendChild(gears);\n  div.appendChild(button);\n  div.appendChild(button2);\n  div.appendChild(button3);\n  if (SUPPORTS_LOCAL_STORAGE) {\n    var explain = document.getElementById('dg-local-explain');\n    var localStorageCheckBox = document.getElementById('dg-local-storage');\n    var saveLocally = document.getElementById('dg-save-locally');\n    saveLocally.style.display = 'block';\n    if (localStorage.getItem(getLocalStorageHash(gui, 'isLocal')) === 'true') {\n      localStorageCheckBox.setAttribute('checked', 'checked');\n    }\n    showHideExplain(gui, explain);\n    dom.bind(localStorageCheckBox, 'change', function () {\n      gui.useLocalStorage = !gui.useLocalStorage;\n      showHideExplain(gui, explain);\n    });\n  }\n  var newConstructorTextArea = document.getElementById('dg-new-constructor');\n  dom.bind(newConstructorTextArea, 'keydown', function (e) {\n    if (e.metaKey && (e.which === 67 || e.keyCode === 67)) {\n      SAVE_DIALOGUE.hide();\n    }\n  });\n  dom.bind(gears, 'click', function () {\n    newConstructorTextArea.innerHTML = JSON.stringify(gui.getSaveObject(), undefined, 2);\n    SAVE_DIALOGUE.show();\n    newConstructorTextArea.focus();\n    newConstructorTextArea.select();\n  });\n  dom.bind(button, 'click', function () {\n    gui.save();\n  });\n  dom.bind(button2, 'click', function () {\n    var presetName = prompt('Enter a new preset name.');\n    if (presetName) {\n      gui.saveAs(presetName);\n    }\n  });\n  dom.bind(button3, 'click', function () {\n    gui.revert();\n  });\n}\nfunction addResizeHandle(gui) {\n  var pmouseX = void 0;\n  gui.__resize_handle = document.createElement('div');\n  Common.extend(gui.__resize_handle.style, {\n    width: '6px',\n    marginLeft: '-3px',\n    height: '200px',\n    cursor: 'ew-resize',\n    position: 'absolute'\n  });\n  function drag(e) {\n    e.preventDefault();\n    gui.width += pmouseX - e.clientX;\n    gui.onResize();\n    pmouseX = e.clientX;\n    return false;\n  }\n  function dragStop() {\n    dom.removeClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.unbind(window, 'mousemove', drag);\n    dom.unbind(window, 'mouseup', dragStop);\n  }\n  function dragStart(e) {\n    e.preventDefault();\n    pmouseX = e.clientX;\n    dom.addClass(gui.__closeButton, GUI.CLASS_DRAG);\n    dom.bind(window, 'mousemove', drag);\n    dom.bind(window, 'mouseup', dragStop);\n    return false;\n  }\n  dom.bind(gui.__resize_handle, 'mousedown', dragStart);\n  dom.bind(gui.__closeButton, 'mousedown', dragStart);\n  gui.domElement.insertBefore(gui.__resize_handle, gui.domElement.firstElementChild);\n}\nfunction setWidth(gui, w) {\n  gui.domElement.style.width = w + 'px';\n  if (gui.__save_row && gui.autoPlace) {\n    gui.__save_row.style.width = w + 'px';\n  }\n  if (gui.__closeButton) {\n    gui.__closeButton.style.width = w + 'px';\n  }\n}\nfunction getCurrentPreset(gui, useInitialValues) {\n  var toReturn = {};\n  Common.each(gui.__rememberedObjects, function (val, index) {\n    var savedValues = {};\n    var controllerMap = gui.__rememberedObjectIndecesToControllers[index];\n    Common.each(controllerMap, function (controller, property) {\n      savedValues[property] = useInitialValues ? controller.initialValue : controller.getValue();\n    });\n    toReturn[index] = savedValues;\n  });\n  return toReturn;\n}\nfunction setPresetSelectIndex(gui) {\n  for (var index = 0; index < gui.__preset_select.length; index++) {\n    if (gui.__preset_select[index].value === gui.preset) {\n      gui.__preset_select.selectedIndex = index;\n    }\n  }\n}\nfunction updateDisplays(controllerArray) {\n  if (controllerArray.length !== 0) {\n    requestAnimationFrame$1.call(window, function () {\n      updateDisplays(controllerArray);\n    });\n  }\n  Common.each(controllerArray, function (c) {\n    c.updateDisplay();\n  });\n}\n\nvar color = {\n  Color: Color,\n  math: ColorMath,\n  interpret: interpret\n};\nvar controllers = {\n  Controller: Controller,\n  BooleanController: BooleanController,\n  OptionController: OptionController,\n  StringController: StringController,\n  NumberController: NumberController,\n  NumberControllerBox: NumberControllerBox,\n  NumberControllerSlider: NumberControllerSlider,\n  FunctionController: FunctionController,\n  ColorController: ColorController\n};\nvar dom$1 = { dom: dom };\nvar gui = { GUI: GUI };\nvar GUI$1 = GUI;\nvar index = {\n  color: color,\n  controllers: controllers,\n  dom: dom$1,\n  gui: gui,\n  GUI: GUI$1\n};\n\nexport { color, controllers, dom$1 as dom, gui, GUI$1 as GUI };\nexport default index;\n//# sourceMappingURL=dat.gui.module.js.map\n","import { OrthographicCamera, Scene, Sprite, SpriteMaterial } from 'three';\r\nimport { CONFIG } from './Config.js';\r\nimport * as DAT from 'dat.gui';\r\n\r\nconst PI25 = Math.PI * 0.25;\r\nconst PI75 = Math.PI * 0.75;\r\n\r\n/**\r\n* Used to manage the state of the user interface.\r\n*\r\n*/\r\nclass UIManager {\r\n\r\n\tpublic world: any;\r\n\tpublic currentTime: number;\r\n\tpublic hitIndicationTime: number;\r\n\tpublic endTimeHitIndication: number;\r\n\tpublic damageIndicationTime: number;\r\n\tpublic endTimeDamageIndicationFront: number;\r\n\tpublic endTimeDamageIndicationRight: number;\r\n\tpublic endTimeDamageIndicationLeft: number;\r\n\tpublic endTimeDamageIndicationBack: number;\r\n\tpublic fragMessages: Array<any>;\r\n\tpublic html: any;\r\n\tpublic sprites: any;\r\n\tpublic camera: any;\r\n\tpublic scene: any;\r\n\tpublic datGui: any;\r\n\tpublic debugParameter: any;\r\n\r\n\t/**\r\n\t* Constructs a new UI manager with the given values.\r\n\t*\r\n\t* @param {World} world - A reference to the world.\r\n\t*/\r\n\tconstructor(world: any) {\r\n\r\n\t\tthis.world = world;\r\n\t\tthis.currentTime = 0;\r\n\r\n\t\tthis.hitIndicationTime = CONFIG.UI.CROSSHAIRS.HIT_TIME;\r\n\t\tthis.endTimeHitIndication = Infinity;\r\n\r\n\t\tthis.damageIndicationTime = CONFIG.UI.DAMAGE_INDICATOR.TIME;\r\n\t\tthis.endTimeDamageIndicationFront = Infinity;\r\n\t\tthis.endTimeDamageIndicationRight = Infinity;\r\n\t\tthis.endTimeDamageIndicationLeft = Infinity;\r\n\t\tthis.endTimeDamageIndicationBack = Infinity;\r\n\t\tthis.fragMessages = new Array();\r\n\r\n\t\tthis.html = {\r\n\t\t\tloadingScreen: document.getElementById('loadingScreen'),\r\n\t\t\thudAmmo: document.getElementById('hudAmmo'),\r\n\t\t\thudHealth: document.getElementById('hudHealth'),\r\n\t\t\troundsLeft: document.getElementById('roundsLeft'),\r\n\t\t\tammo: document.getElementById('ammo'),\r\n\t\t\thealth: document.getElementById('health'),\r\n\t\t\thudFragList: document.getElementById('hudFragList'),\r\n\t\t\tfragList: document.getElementById('fragList'),\r\n\t\t};\r\n\r\n\t\tthis.sprites = {\r\n\t\t\tcrosshairs: null,\r\n\t\t\tfrontIndicator: null,\r\n\t\t\trightIndicator: null,\r\n\t\t\tleftIndicator: null,\r\n\t\t\tbackIndicator: null\r\n\t\t};\r\n\r\n\t\t// for rendering HUD sprites\r\n\r\n\t\tconst width = window.innerWidth;\r\n\t\tconst height = window.innerHeight;\r\n\r\n\t\tthis.camera = new OrthographicCamera(- width / 2, width / 2, height / 2, - height / 2, 1, 10);\r\n\t\tthis.camera.position.z = 10;\r\n\r\n\t\tthis.scene = new Scene();\r\n\r\n\t\t// debugging\r\n\r\n\t\tthis.datGui = null;\r\n\r\n\t\tthis.debugParameter = {\r\n\t\t\tshowRegions: false,\r\n\t\t\tshowAxes: false,\r\n\t\t\tshowPaths: false,\r\n\t\t\tshowGraph: false,\r\n\t\t\tshowSpawnPoints: false,\r\n\t\t\tshowUUIDHelpers: false,\r\n\t\t\tshowSkeletons: false,\r\n\t\t\tshowItemRadius: false,\r\n\t\t\tshowWireframe: false,\r\n\t\t\tshowSpatialIndex: false,\r\n\t\t\tenableFPSControls: () => {\r\n\r\n\t\t\t\tthis.world.fpsControls.connect();\r\n\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Initializes the UI manager.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tinit(): this {\r\n\r\n\t\tthis._buildFPSInterface();\r\n\r\n\t\t//\r\n\r\n\t\tconst world = this.world;\r\n\r\n\t\tif (world.debug === true) {\r\n\r\n\t\t\tconst gui = new DAT.GUI({ width: 300 });\r\n\t\t\tconst params = this.debugParameter;\r\n\r\n\t\t\t// nav mesh folder\r\n\r\n\t\t\tconst folderNavMesh = gui.addFolder('Navigation Mesh');\r\n\t\t\tfolderNavMesh.open();\r\n\r\n\t\t\tfolderNavMesh.add(params, 'showRegions').name('show convex regions').onChange((value) => {\r\n\r\n\t\t\t\tworld.helpers.convexRegionHelper.visible = value;\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderNavMesh.add(params, 'showSpatialIndex', 1, 30).name('show spatial index').onChange((value) => {\r\n\r\n\t\t\t\tworld.helpers.spatialIndexHelper.visible = value;\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderNavMesh.add(params, 'showPaths', 1, 30).name('show navigation paths').onChange((value) => {\r\n\r\n\t\t\t\tfor (const pathHelper of world.helpers.pathHelpers) {\r\n\r\n\t\t\t\t\tpathHelper.visible = value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderNavMesh.add(params, 'showGraph').name('show graph').onChange((value) => {\r\n\r\n\t\t\t\tworld.helpers.graphHelper.visible = value;\r\n\r\n\t\t\t});\r\n\r\n\t\t\t// world folder\r\n\r\n\t\t\tconst folderWorld = gui.addFolder('World');\r\n\t\t\tfolderWorld.open();\r\n\r\n\t\t\tfolderWorld.add(params, 'showAxes').name('show axes helper').onChange((value) => {\r\n\r\n\t\t\t\tworld.helpers.axesHelper.visible = value;\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderWorld.add(params, 'showSpawnPoints').name('show spawn points').onChange((value) => {\r\n\r\n\t\t\t\tworld.helpers.spawnHelpers.visible = value;\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderWorld.add(params, 'showItemRadius').name('show item radius').onChange((value) => {\r\n\r\n\t\t\t\tfor (const itemHelper of world.helpers.itemHelpers) {\r\n\r\n\t\t\t\t\titemHelper.visible = value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderWorld.add(params, 'showWireframe').name('show wireframe').onChange((value) => {\r\n\r\n\t\t\t\tconst levelMesh = this.world.scene.getObjectByName('level');\r\n\t\t\t\tlevelMesh.material.wireframe = value;\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderWorld.add(params, 'enableFPSControls').name('enable FPS controls');\r\n\r\n\t\t\t// enemy folder\r\n\r\n\t\t\tconst folderEnemy = gui.addFolder('Enemy');\r\n\t\t\tfolderEnemy.open();\r\n\r\n\t\t\tfolderEnemy.add(params, 'showUUIDHelpers', 1, 30).name('show UUID helpers').onChange((value) => {\r\n\r\n\t\t\t\tfor (const uuidHelper of world.helpers.uuidHelpers) {\r\n\r\n\t\t\t\t\tuuidHelper.visible = value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\tfolderEnemy.add(params, 'showSkeletons', 1, 30).name('show skeletons').onChange((value) => {\r\n\r\n\t\t\t\tfor (const skeletonHelper of world.helpers.skeletonHelpers) {\r\n\r\n\t\t\t\t\tskeletonHelper.visible = value;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t});\r\n\r\n\t\t\tgui.open();\r\n\r\n\t\t\tthis.datGui = gui;\r\n\r\n\t\t}\r\n\r\n\t\t// ensure to completely remove the loading screen from the DOM when it is not visible anymore\r\n\r\n\t\tthis.html.loadingScreen.addEventListener('transitionend', (event: any) => {\r\n\r\n\t\t\tevent.target.remove();\r\n\t\t\tthis.html.loadingScreen = null;\r\n\r\n\t\t});\r\n\r\n\t\t// start to fade out the loading screen\r\n\r\n\t\tthis.html.loadingScreen.classList.add('fade-out');\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of this manager. Called each simulation step.\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tupdate(delta: number): this {\r\n\r\n\t\tthis.currentTime += delta;\r\n\r\n\t\tif (this.currentTime >= this.endTimeHitIndication) {\r\n\r\n\t\t\tthis.hideHitIndication();\r\n\r\n\t\t}\r\n\r\n\t\t// damage indicators\r\n\r\n\t\tif (this.currentTime >= this.endTimeDamageIndicationFront) {\r\n\r\n\t\t\tthis.sprites.frontIndicator.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\tif (this.currentTime >= this.endTimeDamageIndicationRight) {\r\n\r\n\t\t\tthis.sprites.rightIndicator.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\tif (this.currentTime >= this.endTimeDamageIndicationLeft) {\r\n\r\n\t\t\tthis.sprites.leftIndicator.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\tif (this.currentTime >= this.endTimeDamageIndicationBack) {\r\n\r\n\t\t\tthis.sprites.backIndicator.visible = false;\r\n\r\n\t\t}\r\n\r\n\t\t// frag list\r\n\r\n\t\tthis._updateFragList();\r\n\r\n\t\t// render UI\r\n\r\n\t\tthis._render();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Changes the style of the crosshairs in order to show a\r\n\t* sucessfull hit.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tshowHitIndication(): this {\r\n\r\n\t\tthis.sprites.crosshairs.material.color.set(0xff0000);\r\n\t\tthis.endTimeHitIndication = this.currentTime + this.hitIndicationTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Removes the hit indication of the crosshairs in order to show its\r\n\t* default state.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\thideHitIndication(): this {\r\n\r\n\t\tthis.sprites.crosshairs.material.color.set(0xffffff);\r\n\t\tthis.endTimeHitIndication = Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Shows radial elements around the crosshairs to visualize the attack direction\r\n\t* for a certain amount of time.\r\n\t*\r\n\t* @param {Number} angle - The angle that determines the radial element.\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tshowDamageIndication(angle: number): this {\r\n\r\n\t\tif (angle >= - PI25 && angle <= PI25) {\r\n\r\n\t\t\tthis.sprites.frontIndicator.visible = true;\r\n\t\t\tthis.endTimeDamageIndicationFront = this.currentTime + this.damageIndicationTime;\r\n\r\n\t\t} else if (angle > PI25 && angle <= PI75) {\r\n\r\n\t\t\tthis.sprites.rightIndicator.visible = true;\r\n\t\t\tthis.endTimeDamageIndicationRight = this.currentTime + this.damageIndicationTime;\r\n\r\n\t\t} else if (angle >= - PI75 && angle < - PI25) {\r\n\r\n\t\t\tthis.sprites.leftIndicator.visible = true;\r\n\t\t\tthis.endTimeDamageIndicationLeft = this.currentTime + this.damageIndicationTime;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.sprites.backIndicator.visible = true;\r\n\t\t\tthis.endTimeDamageIndicationBack = this.currentTime + this.damageIndicationTime;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Shows the FPS interface.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tshowFPSInterface(): this {\r\n\r\n\t\tthis.sprites.crosshairs.visible = true;\r\n\r\n\t\tthis.html.hudAmmo.classList.remove('hidden');\r\n\t\tthis.html.hudHealth.classList.remove('hidden');\r\n\r\n\t\tthis.updateAmmoStatus();\r\n\t\tthis.updateHealthStatus();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Hides the FPS interface.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\thideFPSInterface(): this {\r\n\r\n\t\tthis.html.hudAmmo.classList.add('hidden');\r\n\t\tthis.html.hudHealth.classList.add('hidden');\r\n\r\n\t\tthis.sprites.crosshairs.visible = false;\r\n\t\tthis.sprites.frontIndicator.visible = false;\r\n\t\tthis.sprites.rightIndicator.visible = false;\r\n\t\tthis.sprites.leftIndicator.visible = false;\r\n\t\tthis.sprites.backIndicator.visible = false;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Sets the size of the UI manager.\r\n\t*\r\n\t* @param {Number} width - The width in pixels.\r\n\t* @param {Number} height - The height in pixels.\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tsetSize(width: number, height: number): this {\r\n\r\n\t\tthis.camera.left = - width / 2;\r\n\t\tthis.camera.right = width / 2;\r\n\t\tthis.camera.top = height / 2;\r\n\t\tthis.camera.bottom = - height / 2;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Updates the UI element that displays the frags.\r\n\t *\r\n\t * @return {UIManager} A reference to this UI manager.\r\n\t */\r\n\t_updateFragList(): this {\r\n\r\n\t\tconst fragMessages = this.fragMessages;\r\n\r\n\t\t// check for expired messages (new messages are at the end of the array)\r\n\r\n\t\tfor (let i = (fragMessages.length - 1); i >= 0; i--) {\r\n\r\n\t\t\tconst message = fragMessages[i];\r\n\r\n\t\t\tif (this.currentTime >= message.endTime) {\r\n\r\n\t\t\t\tfragMessages.splice(i, 1);\r\n\r\n\t\t\t\t// remove the visual representation of the frag message\r\n\r\n\t\t\t\tconst fragList = this.html.fragList;\r\n\t\t\t\tfragList.removeChild(message.html);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// hide html element if there are no elements\r\n\r\n\t\tif (fragMessages.length === 0) {\r\n\r\n\t\t\tthis.html.hudFragList.classList.add('hidden');\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t * Adds a kill message to the kill message display.\r\n\t * @param {GameEntity} fragger - The fragger.\r\n\t * @param {GameEntity} victim - The defeated game entity.\r\n\t * @return {UIManager} A reference to this UI manager.\r\n\t */\r\n\taddFragMessage(fragger: any, victim: any): this {\r\n\r\n\t\t// make the list visible\r\n\r\n\t\tthis.html.hudFragList.classList.remove('hidden');\r\n\r\n\t\t// create the frag message\r\n\r\n\t\tconst string = fragger.name + ' fragged ' + victim.name;\r\n\r\n\t\tconst fraggerSpan = document.createElement('span');\r\n\t\tfraggerSpan.style.color = '#00ff00';\r\n\t\tfraggerSpan.textContent = fragger.name;\r\n\r\n\t\tconst middleSpan = document.createElement('span');\r\n\t\tmiddleSpan.textContent = ' fragged ';\r\n\r\n\t\tconst victimSpan = document.createElement('span');\r\n\t\tvictimSpan.style.color = '#ff0000';\r\n\t\tvictimSpan.textContent = victim.name;\r\n\r\n\t\t// create the respective HTML\r\n\r\n\t\tconst frag = document.createElement('li');\r\n\t\tfrag.appendChild(fraggerSpan);\r\n\t\tfrag.appendChild(middleSpan);\r\n\t\tfrag.appendChild(victimSpan);\r\n\r\n\t\t// save everything in a new message object\r\n\r\n\t\tconst fragMessage = {\r\n\t\t\ttext: string,\r\n\t\t\tendTime: this.currentTime + CONFIG.UI.FRAGS.TIME,\r\n\t\t\thtml: frag\r\n\t\t};\r\n\r\n\t\tthis.fragMessages.push(fragMessage);\r\n\r\n\t\t// append the HTML to the list\r\n\r\n\t\tconst fragList = this.html.fragList;\r\n\t\tfragList.appendChild(frag);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates the UI with current ammo data.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tupdateAmmoStatus(): this {\r\n\r\n\t\tconst player = this.world.player;\r\n\t\tconst weapon = player.weaponSystem.currentWeapon;\r\n\r\n\t\tif (weapon) {\r\n\t\t\tthis.html.roundsLeft.textContent = weapon.roundsLeft;\r\n\t\t\tthis.html.ammo.textContent = weapon.ammo;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates the UI with current health data.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tupdateHealthStatus(): this {\r\n\r\n\t\tconst player = this.world.player;\r\n\r\n\t\tthis.html.health.textContent = player.health;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Opens the debug interface.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\topenDebugUI(): this {\r\n\r\n\t\tthis.datGui.open();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Closes the debug interface.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\tcloseDebugUI(): this {\r\n\r\n\t\tthis.datGui.close();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates the UI-elements for the FPS view.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\t_buildFPSInterface(): this {\r\n\r\n\t\t// crosshairs\r\n\r\n\t\tconst crosshairsTexture = this.world.assetManager.textures.get('crosshairs');\r\n\t\tconst crosshairsMaterial = new SpriteMaterial({ map: crosshairsTexture, opacity: CONFIG.UI.CROSSHAIRS.OPACITY });\r\n\r\n\t\tconst crosshairs = new Sprite(crosshairsMaterial);\r\n\t\tcrosshairs.matrixAutoUpdate = false;\r\n\t\tcrosshairs.visible = false;\r\n\t\tcrosshairs.position.set(0, 0, 1);\r\n\t\tcrosshairs.scale.set(CONFIG.UI.CROSSHAIRS.SCALE, CONFIG.UI.CROSSHAIRS.SCALE, 1);\r\n\t\tcrosshairs.updateMatrix();\r\n\t\tthis.scene.add(crosshairs);\r\n\r\n\t\tthis.sprites.crosshairs = crosshairs;\r\n\r\n\t\t// damage indication\r\n\r\n\t\t// front\r\n\r\n\t\tconst frontIndicatorTexture = this.world.assetManager.textures.get('damageIndicatorFront');\r\n\t\tconst frontIndicatorMaterial = new SpriteMaterial({ map: frontIndicatorTexture, opacity: CONFIG.UI.DAMAGE_INDICATOR.OPACITY });\r\n\r\n\t\tconst frontIndicator = new Sprite(frontIndicatorMaterial);\r\n\t\tfrontIndicator.matrixAutoUpdate = false;\r\n\t\tfrontIndicator.visible = false;\r\n\t\tfrontIndicator.position.set(0, 0, 1);\r\n\t\tfrontIndicator.scale.set(CONFIG.UI.DAMAGE_INDICATOR.SCALE, CONFIG.UI.DAMAGE_INDICATOR.SCALE, 1);\r\n\t\tfrontIndicator.updateMatrix();\r\n\t\tthis.scene.add(frontIndicator);\r\n\r\n\t\tthis.sprites.frontIndicator = frontIndicator;\r\n\r\n\t\t// right\r\n\r\n\t\tconst rigthIndicatorTexture = this.world.assetManager.textures.get('damageIndicatorRight');\r\n\t\tconst rightIndicatorMaterial = new SpriteMaterial({ map: rigthIndicatorTexture, opacity: CONFIG.UI.DAMAGE_INDICATOR.OPACITY });\r\n\r\n\t\tconst rightIndicator = new Sprite(rightIndicatorMaterial);\r\n\t\trightIndicator.matrixAutoUpdate = false;\r\n\t\trightIndicator.visible = false;\r\n\t\trightIndicator.position.set(0, 0, 1);\r\n\t\trightIndicator.scale.set(CONFIG.UI.DAMAGE_INDICATOR.SCALE, CONFIG.UI.DAMAGE_INDICATOR.SCALE, 1);\r\n\t\trightIndicator.updateMatrix();\r\n\t\tthis.scene.add(rightIndicator);\r\n\r\n\t\tthis.sprites.rightIndicator = rightIndicator;\r\n\r\n\t\t// left\r\n\r\n\t\tconst leftIndicatorTexture = this.world.assetManager.textures.get('damageIndicatorLeft');\r\n\t\tconst leftIndicatorMaterial = new SpriteMaterial({ map: leftIndicatorTexture, opacity: CONFIG.UI.DAMAGE_INDICATOR.OPACITY });\r\n\r\n\t\tconst leftIndicator = new Sprite(leftIndicatorMaterial);\r\n\t\tleftIndicator.matrixAutoUpdate = false;\r\n\t\tleftIndicator.visible = false;\r\n\t\tleftIndicator.position.set(0, 0, 1);\r\n\t\tleftIndicator.scale.set(CONFIG.UI.DAMAGE_INDICATOR.SCALE, CONFIG.UI.DAMAGE_INDICATOR.SCALE, 1);\r\n\t\tleftIndicator.updateMatrix();\r\n\t\tthis.scene.add(leftIndicator);\r\n\r\n\t\tthis.sprites.leftIndicator = leftIndicator;\r\n\r\n\t\t// right\r\n\r\n\t\tconst backIndicatorTexture = this.world.assetManager.textures.get('damageIndicatorBack');\r\n\t\tconst backIndicatorMaterial = new SpriteMaterial({ map: backIndicatorTexture, opacity: CONFIG.UI.DAMAGE_INDICATOR.OPACITY });\r\n\r\n\t\tconst backIndicator = new Sprite(backIndicatorMaterial);\r\n\t\tbackIndicator.matrixAutoUpdate = false;\r\n\t\tbackIndicator.visible = false;\r\n\t\tbackIndicator.position.set(0, 0, 1);\r\n\t\tbackIndicator.scale.set(CONFIG.UI.DAMAGE_INDICATOR.SCALE, CONFIG.UI.DAMAGE_INDICATOR.SCALE, 1);\r\n\t\tbackIndicator.updateMatrix();\r\n\t\tthis.scene.add(backIndicator);\r\n\r\n\t\tthis.sprites.backIndicator = backIndicator;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Renders the HUD sprites. This is done after rendering the actual 3D scene.\r\n\t*\r\n\t* @return {UIManager} A reference to this UI manager.\r\n\t*/\r\n\t_render(): this {\r\n\r\n\t\tthis.world.renderer.clearDepth();\r\n\r\n\t\tthis.world.renderer.render(this.scene, this.camera);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { UIManager };\r\n","import { EventDispatcher, Vector3, Logger } from 'yuka';\r\nimport { WEAPON_TYPES_BLASTER, WEAPON_TYPES_SHOTGUN, WEAPON_TYPES_ASSAULT_RIFLE } from '../core/Constants';\r\nimport { CONFIG } from '../core/Config';\r\nimport { Player } from '../entities/Player';\r\n\r\nconst PI05 = Math.PI / 2;\r\nconst velocity = new Vector3();\r\n\r\nlet elapsed = 0;\r\n\r\nconst euler = { x: 0, y: 0, z: 0 };\r\n\r\n/**\r\n* Holds the implementation of the First-Person Controls.\r\n*/\r\nclass FirstPersonControls extends EventDispatcher {\r\n\r\n\tpublic owner: Player | null;\r\n\tpublic active: boolean;\r\n\tpublic movementX: number;\r\n\tpublic movementY: number;\r\n\tpublic lookingSpeed: number;\r\n\tpublic brakingPower: number;\r\n\tpublic headMovement: number;\r\n\tpublic weaponMovement: number;\r\n\tpublic input: any;\r\n\tpublic sounds: Map<string, any>;\r\n\r\n\t// RIFT-style movement enhancements\r\n\tpublic isSprinting: boolean;\r\n\tpublic sprintMultiplier: number;\r\n\r\n\tpublic _mouseDownHandler: any;\r\n\tpublic _mouseUpHandler: any;\r\n\tpublic _mouseMoveHandler: any;\r\n\tpublic _pointerlockChangeHandler: any;\r\n\tpublic _pointerlockErrorHandler: any;\r\n\tpublic _keyDownHandler: any;\r\n\tpublic _keyUpHandler: any;\r\n\tpublic _wheelHandler: any;\r\n\tpublic _contextMenuHandler: any;\r\n\r\n\t/**\r\n\t* Constructs a new first person controls.\r\n\t*\r\n\t* @param {Player} owner - A refernce to the player object.\r\n\t*/\r\n\tconstructor(owner: Player | null = null) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.owner = owner;\r\n\r\n\t\tthis.active = true;\r\n\r\n\t\tthis.movementX = 0; // mouse left/right\r\n\t\tthis.movementY = 0; // mouse up/down\r\n\r\n\t\tthis.lookingSpeed = CONFIG.CONTROLS.LOOKING_SPEED;\r\n\t\tthis.brakingPower = CONFIG.CONTROLS.BRAKING_POWER;\r\n\t\tthis.headMovement = CONFIG.CONTROLS.HEAD_MOVEMENT;\r\n\t\tthis.weaponMovement = CONFIG.CONTROLS.WEAPON_MOVEMENT;\r\n\r\n\t\t// RIFT-style movement\r\n\t\tthis.isSprinting = false;\r\n\t\tthis.sprintMultiplier = 1.6; // Sprint speed multiplier\r\n\r\n\t\tthis.input = {\r\n\t\t\tforward: false,\r\n\t\t\tbackward: false,\r\n\t\t\tright: false,\r\n\t\t\tleft: false,\r\n\t\t\tmouseDown: false,\r\n\t\t\tsprint: false,\r\n\t\t\tjump: false,\r\n\t\t\tcrouch: false\r\n\t\t};\r\n\r\n\t\tthis.sounds = new Map();\r\n\r\n\t\tthis._mouseDownHandler = onMouseDown.bind(this);\r\n\t\tthis._mouseUpHandler = onMouseUp.bind(this);\r\n\t\tthis._mouseMoveHandler = onMouseMove.bind(this);\r\n\t\tthis._pointerlockChangeHandler = onPointerlockChange.bind(this);\r\n\t\tthis._pointerlockErrorHandler = onPointerlockError.bind(this);\r\n\t\tthis._keyDownHandler = onKeyDown.bind(this);\r\n\t\tthis._keyUpHandler = onKeyUp.bind(this);\r\n\t\tthis._wheelHandler = onWheel.bind(this);\r\n\t\tthis._contextMenuHandler = onContextMenu.bind(this);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Connects the event listeners and activates the controls.\r\n\t*\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\tconnect() {\r\n\r\n\t\tdocument.addEventListener('mousedown', this._mouseDownHandler, false);\r\n\t\tdocument.addEventListener('mouseup', this._mouseUpHandler, false);\r\n\t\tdocument.addEventListener('mousemove', this._mouseMoveHandler, false);\r\n\t\tdocument.addEventListener('wheel', this._wheelHandler, false);\r\n\t\tdocument.addEventListener('pointerlockchange', this._pointerlockChangeHandler, false);\r\n\t\tdocument.addEventListener('pointerlockerror', this._pointerlockErrorHandler, false);\r\n\t\tdocument.addEventListener('keydown', this._keyDownHandler, false);\r\n\t\tdocument.addEventListener('keyup', this._keyUpHandler, false);\r\n\t\tdocument.addEventListener('contextmenu', this._contextMenuHandler, false);\r\n\r\n\t\t// Request pointer lock - may not be granted immediately if not from user gesture\r\n\t\tdocument.body.requestPointerLock().catch(err => {\r\n\t\t\tconsole.log('Pointer lock will be requested on first click:', err);\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Disconnects the event listeners and deactivates the controls.\r\n\t*\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\tdisconnect() {\r\n\r\n\t\tdocument.removeEventListener('mousedown', this._mouseDownHandler, false);\r\n\t\tdocument.removeEventListener('mouseup', this._mouseUpHandler, false);\r\n\t\tdocument.removeEventListener('mousemove', this._mouseMoveHandler, false);\r\n\t\tdocument.removeEventListener('wheel', this._wheelHandler, false);\r\n\t\tdocument.removeEventListener('pointerlockchange', this._pointerlockChangeHandler, false);\r\n\t\tdocument.removeEventListener('pointerlockerror', this._pointerlockErrorHandler, false);\r\n\t\tdocument.removeEventListener('keydown', this._keyDownHandler, false);\r\n\t\tdocument.removeEventListener('keyup', this._keyUpHandler, false);\r\n\t\tdocument.removeEventListener('contextmenu', this._contextMenuHandler, false);\r\n\r\n\t\tif (document.pointerLockElement === document.body) {\r\n\t\t\tdocument.exitPointerLock();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Ensures the controls reflect the current orientation of the owner. This method is\r\n\t* always used if the player's orientation is set manually. In this case, it's necessary\r\n\t* to adjust internal variables.\r\n\t*\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\tsync(): this {\r\n\r\n\t\tif (!this.owner) return this;\r\n\r\n\t\tthis.owner.rotation.toEuler(euler);\r\n\t\tthis.movementX = euler.y; // yaw\r\n\r\n\t\tthis.owner.head.rotation.toEuler(euler);\r\n\t\tthis.movementY = euler.x; // pitch\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Resets the controls (e.g. after a respawn).\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\treset() {\r\n\r\n\t\tthis.active = true;\r\n\r\n\t\tthis.movementX = 0;\r\n\t\tthis.movementY = 0;\r\n\r\n\t\tthis.input.forward = false;\r\n\t\tthis.input.backward = false;\r\n\t\tthis.input.right = false;\r\n\t\tthis.input.left = false;\r\n\t\tthis.input.mouseDown = false;\r\n\t\tthis.input.sprint = false;\r\n\r\n\t\tthis.isSprinting = false;\r\n\r\n\t\telapsed = 0;\r\n\t\tvelocity.set(0, 0, 0);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of this controls. Computes the current velocity and head bobbing\r\n\t* of the owner (player).\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\tupdate(delta: number): this {\r\n\r\n\t\tif (this.active && this.owner) {\r\n\r\n\t\t\tthis._updateVelocity(delta);\r\n\r\n\t\t\tconst speed = this.owner.getSpeed();\r\n\t\t\telapsed += delta * speed;\r\n\r\n\t\t\t// elapsed is used by the following two methods. it is scaled with the speed\r\n\t\t\t// to modulate the head bobbing and weapon movement\r\n\r\n\t\t\tthis._updateHead();\r\n\t\t\tthis._updateWeapon();\r\n\r\n\t\t\t// if the mouse is pressed and an automatic weapon is equipped\r\n\t\t\t// support automatic fire using RIFT weapon system\r\n\r\n\t\t\tif (this.input.mouseDown && this.owner) {\r\n\t\t\t\t// Check if using RIFT system and weapon is automatic\r\n\t\t\t\tif (this.owner.world.rift) {\r\n\t\t\t\t\tconst weaponConfig = this.owner.world.rift.weaponSystem.currentConfig;\r\n\t\t\t\t\tif (weaponConfig.automatic) {\r\n\t\t\t\t\t\tthis.owner.shoot();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (this.owner.isAutomaticWeaponUsed()) {\r\n\t\t\t\t\t// Fallback to old system\r\n\t\t\t\t\tthis.owner.shoot();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the current velocity of the owner (player).\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\t_updateVelocity(_delta: number): this {\r\n\r\n\t\tconst input = this.input;\r\n\r\n\t\t// RIFT-style sprint detection\r\n\t\tconst isMovingForward = input.forward && !input.backward;\r\n\t\tthis.isSprinting = input.sprint && isMovingForward;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the head bobbing of the owner (player).\r\n\t*\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\t_updateHead() {\r\n\t\t// Head bobbing is now handled by the Player entity (Rift physics)\r\n\t\treturn this;\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the movement of the current armed weapon.\r\n\t*\r\n\t* @return {FirstPersonControls} A reference to this instance.\r\n\t*/\r\n\t_updateWeapon() {\r\n\r\n\t\tconst owner = this.owner;\r\n\t\tif (!owner) return this;\r\n\r\n\t\tconst weaponContainer = owner.weaponContainer;\r\n\r\n\t\tconst motion = Math.sin(elapsed * this.weaponMovement);\r\n\r\n\t\tweaponContainer.position.x = motion * 0.005;\r\n\t\tweaponContainer.position.y = Math.abs(motion) * 0.002;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\n// event listeners\r\n\r\nfunction onMouseDown(this: FirstPersonControls, event: any) {\r\n\r\n\tif (this.active && event.which === 1) {\r\n\t\t\r\n\t\t// Ensure pointer is locked first\r\n\t\tif (document.pointerLockElement !== document.body) {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tdocument.body.requestPointerLock();\r\n\t\t\treturn; // Don't shoot on the lock-requesting click\r\n\t\t}\r\n\r\n\t\tevent.preventDefault();\r\n\t\tthis.input.mouseDown = true;\r\n\r\n\t\t// Always fire on first click for all weapons\r\n\t\tif (this.owner) {\r\n\t\t\tthis.owner.shoot();\r\n\t\t}\r\n\t}\r\n\r\n\t// Right mouse button - zoom/ADS (aim down sights)\r\n\tif (this.active && event.which === 3) {\r\n\t\tevent.preventDefault();\r\n\t\t\r\n\t\t// Ensure pointer is locked first\r\n\t\tif (document.pointerLockElement !== document.body) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t// Trigger zoom on via World's RIFT integration\r\n\t\tif (this.owner && this.owner.world && this.owner.world.rift) {\r\n\t\t\tthis.owner.world.rift.weaponSystem.setZoom(true);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nfunction onMouseUp(this: FirstPersonControls, event: any) {\r\n\r\n\tif (this.active && event.which === 1) {\r\n\t\tevent.preventDefault();\r\n\t\tthis.input.mouseDown = false;\r\n\t}\r\n\r\n\t// Right mouse button release - unzoom\r\n\tif (this.active && event.which === 3) {\r\n\t\tevent.preventDefault();\r\n\t\t\r\n\t\t// Trigger zoom off via World's RIFT integration\r\n\t\tif (this.owner && this.owner.world && this.owner.world.rift) {\r\n\t\t\tthis.owner.world.rift.weaponSystem.setZoom(false);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nfunction onMouseMove(this: FirstPersonControls, event: any) {\r\n\r\n\tif (this.active && document.pointerLockElement === document.body) {\r\n\r\n\t\t// Reduce sensitivity when zoomed for precision aiming\r\n\t\tlet sensitivityMultiplier = 1.0;\r\n\t\tif (this.owner && this.owner.world && this.owner.world.rift && this.owner.world.rift.weaponSystem.isZoomed) {\r\n\t\t\tsensitivityMultiplier = 0.3; // 30% sensitivity when scoped\r\n\t\t}\r\n\r\n\t\tthis.movementX -= event.movementX * 0.001 * this.lookingSpeed * sensitivityMultiplier;\r\n\t\tthis.movementY -= event.movementY * 0.001 * this.lookingSpeed * sensitivityMultiplier;\r\n\r\n\t\tthis.movementY = Math.max(- PI05, Math.min(PI05, this.movementY));\r\n\r\n\t\tif (this.owner) {\r\n\t\t\tthis.owner.rotation.fromEuler(0, this.movementX, 0); // yaw\r\n\t\t\tthis.owner.head.rotation.fromEuler(this.movementY, 0, 0); // pitch\r\n\r\n\t\t\t// Pass mouse movement to World for RIFT weapon system\r\n\t\t\tif (this.owner.world && this.owner.world.onMouseMove) {\r\n\t\t\t\tthis.owner.world.onMouseMove(event.movementX, event.movementY);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onPointerlockChange(this: FirstPersonControls) {\r\n\r\n\tconst isLocked = document.pointerLockElement === document.body;\r\n\r\n\tif (isLocked) {\r\n\r\n\t\tthis.dispatchEvent({ type: 'lock' });\r\n\r\n\t} else {\r\n\r\n\t\t// Do NOT disconnect, just dispatch unlock so UI can update\r\n\t\t// this.disconnect(); \r\n\r\n\t\tthis.dispatchEvent({ type: 'unlock' });\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onPointerlockError(this: FirstPersonControls) {\r\n\r\n\tLogger.warn('Dive.FirstPersonControls: Unable to use Pointer Lock API.');\r\n\r\n}\r\n\r\nfunction onKeyDown(this: FirstPersonControls, event: any) {\r\n\r\n\tif (this.active) {\r\n\r\n\t\tswitch (event.keyCode) {\r\n\r\n\t\t\tcase 38: // up\r\n\t\t\tcase 87: // w\r\n\t\t\t\tthis.input.forward = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 37: // left\r\n\t\t\tcase 65: // a\r\n\t\t\t\tthis.input.left = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 40: // down\r\n\t\t\tcase 83: // s\r\n\t\t\t\tthis.input.backward = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 39: // right\r\n\t\t\tcase 68: // d\r\n\t\t\t\tthis.input.right = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 16: // shift (sprint)\r\n\t\t\t\tthis.input.sprint = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 32: // space (jump)\r\n\t\t\t\tthis.input.jump = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 67: // c (crouch/slide)\r\n\t\t\tcase 17: // ctrl\r\n\t\t\t\tthis.input.crouch = true;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 82: // r\r\n\t\t\t\tif (!this.owner) break;\r\n\t\t\t\tthis.owner.reload();\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 49: // 1\r\n\t\t\tcase 50: // 2\r\n\t\t\tcase 51: // 3\r\n\t\t\tcase 52: // 4\r\n\t\t\tcase 53: // 5\r\n\t\t\tcase 54: // 6\r\n\t\t\tcase 55: // 7\r\n\t\t\tcase 56: // 8\r\n\t\t\tcase 57: // 9\r\n\t\t\t\tif (this.owner && this.owner.world.rift) {\r\n\t\t\t\t\tconst weaponIndex = event.keyCode - 49; // 0-8 for keys 1-9\r\n\t\t\t\t\tconst equippedWeapons = this.owner.world.rift.weaponSystem.getEquippedWeapons();\r\n\t\t\t\t\tif (weaponIndex < equippedWeapons.length) {\r\n\t\t\t\t\t\tthis.owner.world.rift.weaponSystem.switchWeapon(weaponIndex);\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Fallback to old system\r\n\t\t\t\t\tif (event.keyCode === 49 && this.owner) {\r\n\t\t\t\t\t\tthis.owner.changeWeapon(WEAPON_TYPES_BLASTER);\r\n\t\t\t\t\t} else if (event.keyCode === 50 && this.owner && this.owner.hasWeapon(WEAPON_TYPES_SHOTGUN)) {\r\n\t\t\t\t\t\tthis.owner.changeWeapon(WEAPON_TYPES_SHOTGUN);\r\n\t\t\t\t\t} else if (event.keyCode === 51 && this.owner && this.owner.hasWeapon(WEAPON_TYPES_ASSAULT_RIFLE)) {\r\n\t\t\t\t\t\tthis.owner.changeWeapon(WEAPON_TYPES_ASSAULT_RIFLE);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onKeyUp(this: FirstPersonControls, event: any) {\r\n\r\n\tif (this.active) {\r\n\r\n\t\tswitch (event.keyCode) {\r\n\r\n\t\t\tcase 38: // up\r\n\t\t\tcase 87: // w\r\n\t\t\t\tthis.input.forward = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 37: // left\r\n\t\t\tcase 65: // a\r\n\t\t\t\tthis.input.left = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 40: // down\r\n\t\t\tcase 83: // s\r\n\t\t\t\tthis.input.backward = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 39: // right\r\n\t\t\tcase 68: // d\r\n\t\t\t\tthis.input.right = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 16: // shift (sprint)\r\n\t\t\t\tthis.input.sprint = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 32: // space (jump)\r\n\t\t\t\tthis.input.jump = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase 67: // c (crouch/slide)\r\n\t\t\tcase 17: // ctrl\r\n\t\t\t\tthis.input.crouch = false;\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onWheel(this: FirstPersonControls, event: WheelEvent) {\r\n\r\n\tif (this.active && this.owner && this.owner.world.rift) {\r\n\r\n\t\tevent.preventDefault();\r\n\r\n\t\tconst direction = event.deltaY > 0 ? 1 : -1;\r\n\t\tthis.owner.world.rift.weaponSystem.scrollWeapon(direction);\r\n\r\n\t}\r\n\r\n}\r\n\r\nfunction onContextMenu(this: FirstPersonControls, event: Event) {\r\n\t// Prevent context menu from appearing on right-click (used for zoom/ADS)\r\n\tevent.preventDefault();\r\n}\r\n\r\nexport { FirstPersonControls };\r\n","import { LineSegments, Line, Mesh, Group } from 'three';\r\nimport { MeshBasicMaterial, LineBasicMaterial } from 'three';\r\nimport { BufferGeometry, Float32BufferAttribute, IcosahedronGeometry } from 'three';\r\nimport { Color } from 'three';\r\n\r\n/**\r\n* Class with various helpers in context of navigation meshes.\r\n*/\r\nclass NavMeshUtils {\r\n\r\n\t/**\r\n\t* Creates a helper that visualizes the convex regions of\r\n\t* a navigation mesh.\r\n\t*\r\n\t* @param {NavMesh} navMesh - The nav mesh.\r\n\t* @return {Mesh} The helper.\r\n\t*/\r\n\tstatic createConvexRegionHelper(navMesh: any) {\r\n\r\n\t\tconst regions = navMesh.regions;\r\n\r\n\t\tconst geometry = new BufferGeometry();\r\n\t\tconst material = new MeshBasicMaterial({ vertexColors: true, depthWrite: false, polygonOffset: true, polygonOffsetFactor: - 4 });\r\n\r\n\t\tconst mesh = new Mesh(geometry, material);\r\n\t\tmesh.matrixAutoUpdate = false;\r\n\t\tmesh.visible = false;\r\n\r\n\t\tconst positions = [];\r\n\t\tconst colors = [];\r\n\r\n\t\tconst color = new Color();\r\n\r\n\t\tfor (let region of regions) {\r\n\r\n\t\t\t// one color for each convex region\r\n\r\n\t\t\tcolor.setHex(Math.random() * 0xffffff);\r\n\r\n\t\t\t// count edges\r\n\r\n\t\t\tlet edge = region.edge;\r\n\t\t\tconst edges = [];\r\n\r\n\t\t\tdo {\r\n\r\n\t\t\t\tedges.push(edge);\r\n\r\n\t\t\t\tedge = edge.next;\r\n\r\n\t\t\t} while (edge !== region.edge);\r\n\r\n\t\t\t// triangulate\r\n\r\n\t\t\tconst triangleCount = (edges.length - 2);\r\n\r\n\t\t\tfor (let i = 1, l = triangleCount; i <= l; i++) {\r\n\r\n\t\t\t\tconst v1 = edges[0].vertex;\r\n\t\t\t\tconst v2 = edges[i + 0].vertex;\r\n\t\t\t\tconst v3 = edges[i + 1].vertex;\r\n\r\n\t\t\t\tpositions.push(v1.x, v1.y, v1.z);\r\n\t\t\t\tpositions.push(v2.x, v2.y, v2.z);\r\n\t\t\t\tpositions.push(v3.x, v3.y, v3.z);\r\n\r\n\t\t\t\tcolors.push(color.r, color.g, color.b);\r\n\t\t\t\tcolors.push(color.r, color.g, color.b);\r\n\t\t\t\tcolors.push(color.r, color.g, color.b);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.setAttribute('position', new Float32BufferAttribute(positions, 3));\r\n\t\tgeometry.setAttribute('color', new Float32BufferAttribute(colors, 3));\r\n\r\n\t\treturn mesh;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a helper that visualizes the navigation path of a game entity.\r\n\t* Note that the actual geometry is created at a later point since an instance\r\n\t* of this helper is reused for all paths of a game entity.\r\n\t*\r\n\t* @return {Line} The helper.\r\n\t*/\r\n\tstatic createPathHelper() {\r\n\r\n\t\tconst pathHelper = new Line(new BufferGeometry(), new LineBasicMaterial({ color: 0xff0000 }));\r\n\t\tpathHelper.matrixAutoUpdate = false;\r\n\t\tpathHelper.visible = false;\r\n\t\treturn pathHelper;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a helper that visualizes the navigation graph of a navigation mesh.\r\n\t*\r\n\t* @param {Graph} graph - The navigation graph.\r\n\t* @param {Number} nodeSize - The size of the visualized nodes.\r\n\t* @param {Number} nodeColor - The color of the visualized nodes.\r\n\t* @param {Number} edgeColor - The color of the visualized edges.\r\n\t* @return {Group} The helper.\r\n\t*/\r\n\tstatic createGraphHelper(graph: any, nodeSize = 1, nodeColor = 0x4e84c4, edgeColor = 0xffffff) {\r\n\r\n\t\tconst group = new Group();\r\n\t\tgroup.visible = false;\r\n\r\n\t\t// nodes\r\n\r\n\t\tconst nodeMaterial = new MeshBasicMaterial({ color: nodeColor });\r\n\t\tconst nodeGeometry = new IcosahedronGeometry(nodeSize, 2);\r\n\r\n\t\tconst nodes: any[] = [];\r\n\r\n\t\tgraph.getNodes(nodes);\r\n\r\n\t\tfor (let node of nodes) {\r\n\r\n\t\t\tconst nodeMesh = new Mesh(nodeGeometry, nodeMaterial);\r\n\t\t\tnodeMesh.position.copy(node.position);\r\n\t\t\tnodeMesh.userData.nodeIndex = node.index;\r\n\r\n\t\t\tnodeMesh.matrixAutoUpdate = false;\r\n\t\t\tnodeMesh.updateMatrix();\r\n\r\n\t\t\tgroup.add(nodeMesh);\r\n\r\n\t\t}\r\n\r\n\t\t// edges\r\n\r\n\t\tconst edgesGeometry = new BufferGeometry();\r\n\t\tconst position = [];\r\n\r\n\t\tconst edgesMaterial = new LineBasicMaterial({ color: edgeColor });\r\n\r\n\t\tconst edges: any[] = [];\r\n\r\n\t\tfor (let node of nodes) {\r\n\r\n\t\t\tgraph.getEdgesOfNode(node.index, edges);\r\n\r\n\t\t\tfor (let edge of edges) {\r\n\r\n\t\t\t\tconst fromNode = graph.getNode(edge.from);\r\n\t\t\t\tconst toNode = graph.getNode(edge.to);\r\n\r\n\t\t\t\tposition.push(fromNode.position.x, fromNode.position.y, fromNode.position.z);\r\n\t\t\t\tposition.push(toNode.position.x, toNode.position.y, toNode.position.z);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\tedgesGeometry.setAttribute('position', new Float32BufferAttribute(position, 3));\r\n\r\n\t\tconst lines = new LineSegments(edgesGeometry, edgesMaterial);\r\n\t\tlines.matrixAutoUpdate = false;\r\n\r\n\t\tgroup.add(lines);\r\n\r\n\t\treturn group;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a helper that visualizes the spatial index of a navigation mesh.\r\n\t*\r\n\t* @param {CellSpacePartitioning} spatialIndex - The spatial index.\r\n\t* @return {LineSegments} The helper.\r\n\t*/\r\n\tstatic createCellSpaceHelper(spatialIndex: any) {\r\n\r\n\t\tconst cells = spatialIndex.cells;\r\n\r\n\t\tconst geometry = new BufferGeometry();\r\n\t\tconst material = new LineBasicMaterial({ color: 0xff0000 });\r\n\r\n\t\tconst lines = new LineSegments(geometry, material);\r\n\t\tlines.visible = false;\r\n\t\tlines.matrixAutoUpdate = false;\r\n\r\n\t\tconst positions = [];\r\n\r\n\t\tfor (let i = 0, l = cells.length; i < l; i++) {\r\n\r\n\t\t\tconst cell = cells[i];\r\n\t\t\tconst min = cell.aabb.min;\r\n\t\t\tconst max = cell.aabb.max;\r\n\r\n\t\t\t// generate data for twelve lines segments\r\n\r\n\t\t\t// bottom lines\r\n\r\n\t\t\tpositions.push(min.x, min.y, min.z, max.x, min.y, min.z);\r\n\t\t\tpositions.push(min.x, min.y, min.z, min.x, min.y, max.z);\r\n\t\t\tpositions.push(max.x, min.y, max.z, max.x, min.y, min.z);\r\n\t\t\tpositions.push(max.x, min.y, max.z, min.x, min.y, max.z);\r\n\r\n\t\t\t// top lines\r\n\r\n\t\t\tpositions.push(min.x, max.y, min.z, max.x, max.y, min.z);\r\n\t\t\tpositions.push(min.x, max.y, min.z, min.x, max.y, max.z);\r\n\t\t\tpositions.push(max.x, max.y, max.z, max.x, max.y, min.z);\r\n\t\t\tpositions.push(max.x, max.y, max.z, min.x, max.y, max.z);\r\n\r\n\t\t\t// torso lines\r\n\r\n\t\t\tpositions.push(min.x, min.y, min.z, min.x, max.y, min.z);\r\n\t\t\tpositions.push(max.x, min.y, min.z, max.x, max.y, min.z);\r\n\t\t\tpositions.push(max.x, min.y, max.z, max.x, max.y, max.z);\r\n\t\t\tpositions.push(min.x, min.y, max.z, min.x, max.y, max.z);\r\n\r\n\t\t}\r\n\r\n\t\tgeometry.setAttribute('position', new Float32BufferAttribute(positions, 3));\r\n\r\n\t\treturn lines;\r\n\r\n\t}\r\n\r\n}\r\n\r\n\r\nexport { NavMeshUtils };\r\n","import { GameEntity, BVH } from 'yuka';\r\nimport { Object3D } from 'three';\r\n\r\n/**\r\n* Class for representing the level of this game.\r\n*\r\n*/\r\nclass Level extends GameEntity {\r\n\r\n\tpublic bvh: any;\r\n\r\n\t// Getter for protected _renderComponent from Yuka's GameEntity\r\n\tpublic get renderComponent(): Object3D | null {\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t\treturn (this as any)._renderComponent || null;\r\n\t}\r\n\r\n\t/**\r\n\t* Constructs a new level entity with the given values.\r\n\t*\r\n\t* @param {MeshGeometry} geometry - The geometry of this level.\r\n\t*/\r\n\tconstructor(geometry: any) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.bvh = new BVH().fromMeshGeometry(geometry);\r\n\t\tthis.canActivateTrigger = false;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Holds the implementation for the message handling of this game entity.\r\n\t*\r\n\t* @param {Telegram} telegram - The telegram with the message data.\r\n\t* @return {Boolean} Whether the message was processed or not.\r\n\t*/\r\n\thandleMessage() {\r\n\r\n\t\t// do nothing\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the intesection point if a projectile intersects with this entity.\r\n\t* If no intersection is detected, null is returned.\r\n\t*\r\n\t* @param {Ray} ray - The ray that defines the trajectory of this bullet.\r\n\t* @param {Vector3} intersectionPoint - The intersection point.\r\n\t* @return {Vector3} The intersection point.\r\n\t*/\r\n\tcheckProjectileIntersection(ray: any, intersectionPoint: any): any {\r\n\r\n\t\treturn ray.intersectBVH(this.bvh, intersectionPoint);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the intesection point if this entity lies within the given line of sight.\r\n\t* If no intersection is detected, null is returned.\r\n\t*\r\n\t* @param {Ray} ray - The ray that defines the line of sight.\r\n\t* @param {Vector3} intersectionPoint - The intersection point.\r\n\t* @return {Vector3} The intersection point.\r\n\t*/\r\n\tlineOfSightTest(ray: any, intersectionPoint: any): any {\r\n\r\n\t\treturn ray.intersectBVH(this.bvh, intersectionPoint);\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Level };\r\n","import { Goal } from 'yuka';\r\nimport { BufferGeometry } from 'three';\r\n\r\n/**\r\n* Sub-goal for seeking the defined destination point.\r\n*/\r\nclass FollowPathGoal extends Goal<any> {\r\n\r\n\tpublic to: any;\r\n\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.to = null;\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tconst owner = this.owner;\r\n\t\tconst path = owner.path;\r\n\r\n\t\t//\r\n\r\n\t\tif (path !== null) {\r\n\r\n\t\t\tif (owner.world.debug) {\r\n\r\n\t\t\t\t// update path helper\r\n\r\n\t\t\t\tconst pathHelper = owner.pathHelper;\r\n\r\n\t\t\t\tpathHelper.geometry.dispose();\r\n\t\t\t\tpathHelper.geometry = new BufferGeometry().setFromPoints(path);\r\n\t\t\t\tpathHelper.visible = owner.world.uiManager.debugParameter.showPaths;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// update path and steering\r\n\r\n\t\t\tconst followPathBehavior = owner.steering.behaviors[0];\r\n\t\t\tfollowPathBehavior.active = true;\r\n\t\t\tfollowPathBehavior.path.clear();\r\n\r\n\t\t\tconst onPathBehavior = owner.steering.behaviors[1];\r\n\t\t\tonPathBehavior.active = true;\r\n\r\n\t\t\tfor (let i = 0, l = path.length; i < l; i++) {\r\n\r\n\t\t\t\tconst waypoint = path[i];\r\n\r\n\t\t\t\tfollowPathBehavior.path.add(waypoint);\r\n\r\n\t\t\t}\r\n\r\n\t\t\t//\r\n\r\n\t\t\tthis.to = path[path.length - 1];\r\n\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.status = Goal.STATUS.FAILED;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tif (this.active()) {\r\n\r\n\t\t\tconst owner = this.owner;\r\n\r\n\t\t\tif (this.to !== null && owner.atPosition(this.to)) {\r\n\r\n\t\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\tconst followPathBehavior = owner.steering.behaviors[0];\r\n\t\tfollowPathBehavior.active = false;\r\n\r\n\t\tconst onPathBehavior = owner.steering.behaviors[1];\r\n\t\tonPathBehavior.active = false;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { FollowPathGoal };\r\n","import { Goal } from 'yuka';\r\n\r\n/**\r\n* Sub-goal for finding the next random location\r\n* on the map that the enemy is going to seek.\r\n*/\r\nclass FindPathGoal extends Goal<any> {\r\n\r\n\tpublic from: any;\r\n\tpublic to: any;\r\n\r\n\tconstructor(owner: any, from: any, to: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tconst owner = this.owner;\r\n\t\tconst pathPlanner = owner.world.pathPlanner;\r\n\r\n\t\towner.path = null; // reset previous path\r\n\r\n\t\t// perform async path finding\r\n\r\n\t\tpathPlanner.findPath(owner, this.from, this.to, onPathFound);\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\tif (owner.path) {\r\n\r\n\t\t\t// when a path was found, mark this goal as completed\r\n\r\n\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\n//\r\n\r\nfunction onPathFound(owner: any, path: any) {\r\n\r\n\towner.path = path;\r\n\r\n}\r\n\r\nexport { FindPathGoal };\r\n","import { Goal, CompositeGoal, Vector3 } from 'yuka';\r\nimport { FollowPathGoal } from './FollowPathGoal';\r\nimport { FindPathGoal } from './FindPathGoal';\r\n\r\n/**\r\n* Sub-goal for searching the current target of an enemy.\r\n*/\r\nclass HuntGoal extends CompositeGoal<any> {\r\n\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// seek to the last sensed position\r\n\r\n\t\tconst targetPosition = owner.targetSystem.getLastSensedPosition();\r\n\r\n\t\t// it's important to use path finding since there might be obstacle\r\n\t\t// between the current and target position\r\n\r\n\t\tconst from = new Vector3().copy(owner.position);\r\n\t\tconst to = new Vector3().copy(targetPosition);\r\n\r\n\t\t// setup subgoals\r\n\r\n\t\tthis.addSubgoal(new FindPathGoal(owner, from, to));\r\n\t\tthis.addSubgoal(new FollowPathGoal(owner));\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// hunting is not necessary if the target becomes visible again\r\n\r\n\t\tif (owner.targetSystem.isTargetShootable()) {\r\n\r\n\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.status = this.executeSubgoals();\r\n\r\n\t\t\t// if the enemy is at the last sensed position, forget about\r\n\t\t\t// the bot, update the target system and consider this goal as completed\r\n\r\n\t\t\tif (this.completed()) {\r\n\r\n\t\t\t\tconst target = owner.targetSystem.getTarget();\r\n\t\t\t\towner.removeEntityFromMemory(target);\r\n\t\t\t\towner.targetSystem.update();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.replanIfFailed();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { HuntGoal };\r\n","import { Goal, Vector3 } from 'yuka';\r\n\r\n/**\r\n* Sub-goal for seeking a target position.\r\n*/\r\nclass SeekToPositionGoal extends Goal<any> {\r\n\r\n\tpublic target: Vector3;\r\n\r\n\tconstructor(owner: any, target = new Vector3()) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.target = target;\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\tconst seekBehavior = owner.steering.behaviors[2];\r\n\t\tseekBehavior.target.copy(this.target);\r\n\t\tseekBehavior.active = true;\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tif (this.owner.atPosition(this.target)) {\r\n\r\n\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tconst seekBehavior = this.owner.steering.behaviors[2];\r\n\t\tseekBehavior.active = false;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { SeekToPositionGoal };\r\n","import { Goal, CompositeGoal, Vector3 } from 'yuka';\r\nimport { SeekToPositionGoal } from './SeekToPositionGoal';\r\n\r\nconst right = new Vector3(1, 0, 0);\r\nconst left = new Vector3(- 1, 0, 0);\r\n\r\n/**\r\n* Sub-goal which makes the enemy dodge from side to side.\r\n*/\r\nclass DodgeGoal extends CompositeGoal<any> {\r\n\r\n\tpublic right: boolean;\r\n\tpublic targetPosition: Vector3;\r\n\r\n\tconstructor(owner: any, right: boolean) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.right = right;\r\n\t\tthis.targetPosition = new Vector3();\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\tif (this.right) {\r\n\r\n\t\t\t// dodge to right as long as there is enough space\r\n\r\n\t\t\tif (owner.canMoveInDirection(right, this.targetPosition)) {\r\n\r\n\t\t\t\tthis.addSubgoal(new SeekToPositionGoal(owner, this.targetPosition));\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// no space anymore, now dodge to left\r\n\r\n\t\t\t\tthis.right = false;\r\n\t\t\t\tthis.status = Goal.STATUS.INACTIVE;\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// dodge to left as long as there is enough space\r\n\r\n\t\t\tif (owner.canMoveInDirection(left, this.targetPosition)) {\r\n\r\n\t\t\t\tthis.addSubgoal(new SeekToPositionGoal(owner, this.targetPosition));\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// no space anymore, now dodge to right\r\n\r\n\t\t\t\tthis.right = true;\r\n\t\t\t\tthis.status = Goal.STATUS.INACTIVE;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tif (this.active()) {\r\n\r\n\t\t\tconst owner = this.owner;\r\n\r\n\t\t\t// stop executing if the traget is not visible anymore\r\n\r\n\t\t\tif (owner.targetSystem.isTargetShootable() === false) {\r\n\r\n\t\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.status = this.executeSubgoals();\r\n\r\n\t\t\t\tthis.replanIfFailed();\r\n\r\n\t\t\t\t// if completed, set the status to inactive in order to repeat the goal\r\n\r\n\t\t\t\tif (this.completed()) this.status = Goal.STATUS.INACTIVE;\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { DodgeGoal };\r\n","import { Goal, CompositeGoal, Vector3 } from 'yuka';\r\nimport { FollowPathGoal } from './FollowPathGoal';\r\nimport { FindPathGoal } from './FindPathGoal';\r\n\r\n/**\r\n* Sub-goal for seeking the enemy's target during a battle.\r\n*/\r\nclass ChargeGoal extends CompositeGoal<any> {\r\n\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// seek to the current position of the target\r\n\r\n\t\tconst target = owner.targetSystem.getTarget();\r\n\r\n\t\t// it's important to use path finding since an enemy might be visible\r\n\t\t// but not directly reachable via a seek behavior because of an obstacle\r\n\r\n\t\tconst from = new Vector3().copy(owner.position);\r\n\t\tconst to = new Vector3().copy(target.position);\r\n\r\n\t\t// setup subgoals\r\n\r\n\t\tthis.addSubgoal(new FindPathGoal(owner, from, to));\r\n\t\tthis.addSubgoal(new FollowPathGoal(owner));\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\t// stop executing if the traget is not visible anymore\r\n\r\n\t\tif (this.owner.targetSystem.isTargetShootable() === false) {\r\n\r\n\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.status = this.executeSubgoals();\r\n\r\n\t\t\tthis.replanIfFailed();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ChargeGoal };\r\n","import { Goal, CompositeGoal, Vector3 } from 'yuka';\r\nimport { HuntGoal } from './HuntGoal';\r\nimport { DodgeGoal } from './DodgeGoal';\r\nimport { ChargeGoal } from './ChargeGoal';\r\n\r\nconst left = new Vector3(- 1, 0, 0);\r\nconst right = new Vector3(1, 0, 0);\r\nconst targetPosition = new Vector3();\r\n\r\n/**\r\n* Top-Level goal that is used to manage the attack on a target.\r\n*/\r\nclass AttackGoal extends CompositeGoal<any> {\r\n\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\t// if this goal is reactivated then there may be some existing subgoals that must be removed\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// if the enemy is able to shoot the target (there is line of sight between enemy and\r\n\t\t// target), then select a tactic to follow while shooting\r\n\r\n\t\tif (owner.targetSystem.isTargetShootable() === true) {\r\n\r\n\t\t\t// if the enemy has space to strafe then do so\r\n\r\n\t\t\tif (owner.canMoveInDirection(left, targetPosition)) {\r\n\r\n\t\t\t\tthis.addSubgoal(new DodgeGoal(owner, false));\r\n\r\n\t\t\t} else if (owner.canMoveInDirection(right, targetPosition)) {\r\n\r\n\t\t\t\tthis.addSubgoal(new DodgeGoal(owner, true));\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\t// if not able to strafe, charge at the target's position\r\n\r\n\t\t\t\tthis.addSubgoal(new ChargeGoal(owner));\r\n\r\n\t\t\t}\r\n\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// if the target is not visible, go hunt it\r\n\r\n\t\t\tthis.addSubgoal(new HuntGoal(owner));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\t// it is possible for a enemy's target to die while this goal is active so we\r\n\t\t// must test to make sure the enemy always has an active target\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\tif (owner.targetSystem.hasTarget() === false) {\r\n\r\n\t\t\tthis.status = Goal.STATUS.COMPLETED;\r\n\r\n\t\t} else {\r\n\r\n\t\t\tconst currentSubgoal = this.currentSubgoal();\r\n\t\t\tconst status = this.executeSubgoals();\r\n\r\n\t\t\tif (currentSubgoal instanceof DodgeGoal && currentSubgoal.inactive()) {\r\n\r\n\t\t\t\t// inactive dogde goals should be reactivated but without reactivating the enire attack goal\r\n\r\n\t\t\t\tthis.status = Goal.STATUS.ACTIVE;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.status = status;\r\n\r\n\t\t\t\tthis.replanIfFailed();\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { AttackGoal };\r\n","import { CONFIG } from './Config.js';\r\nimport { WEAPON_TYPES_BLASTER, WEAPON_TYPES_SHOTGUN, WEAPON_TYPES_ASSAULT_RIFLE } from './Constants.js';\r\nimport { MathUtils } from 'yuka';\r\n\r\nconst result = { distance: Infinity, item: null };\r\n\r\n/**\r\n* Class for calculating influencing factors in context of inference logic.\r\n*\r\n*/\r\nclass Feature {\r\n\r\n\t/**\r\n\t* Computes the total weapon score.\r\n\t*\r\n\t* @param {Enemy} enemy - The enemy this score is computed for.\r\n\t* @return {Number} The total weapon score.\r\n\t*/\r\n\tstatic totalWeaponStrength(enemy: any): number {\r\n\r\n\t\tconst weaponSystem = enemy.weaponSystem;\r\n\r\n\t\tconst ammoBlaster = weaponSystem.getRemainingAmmoForWeapon(WEAPON_TYPES_BLASTER);\r\n\t\tconst ammoShotgun = weaponSystem.getRemainingAmmoForWeapon(WEAPON_TYPES_SHOTGUN);\r\n\t\tconst ammoAssaultRifle = weaponSystem.getRemainingAmmoForWeapon(WEAPON_TYPES_ASSAULT_RIFLE);\r\n\r\n\t\tconst f1 = ammoBlaster / CONFIG.BLASTER.MAX_AMMO;\r\n\t\tconst f2 = ammoShotgun / CONFIG.SHOTGUN.MAX_AMMO;\r\n\t\tconst f3 = ammoAssaultRifle / CONFIG.ASSAULT_RIFLE.MAX_AMMO;\r\n\r\n\t\treturn (f1 + f2 + f3) / 3;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the individual weapon score.\r\n\t*\r\n\t* @param {Enemy} enemy - The enemy this score is computed for.\r\n\t* @param {Number} weaponType - The type of weapon.\r\n\t* @return {Number} The individual weapon score.\r\n\t*/\r\n\tstatic individualWeaponStrength(enemy: any, weaponType: number): number {\r\n\r\n\t\tconst weapon = enemy.weaponSystem.getWeapon(weaponType);\r\n\r\n\t\treturn (weapon) ? (weapon.ammo / weapon.maxAmmo) : 0;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the health score.\r\n\t*\r\n\t* @param {Enemy} enemy - The enemy this score is computed for.\r\n\t* @return {Number} The health score.\r\n\t*/\r\n\tstatic health(enemy: any): number {\r\n\r\n\t\treturn enemy.health / enemy.maxHealth;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes a score between 0 and 1 based on the bot's closeness to the given item.\r\n\t* The further the item, the higher the rating. If there is no item of the given type\r\n\t* present in the game world at the time this method is called the value returned is 1.\r\n\t*\r\n\t* @param {Enemy} enemy - The enemy this score is computed for.\r\n\t* @param {Number} itemType - The type of the item.\r\n\t* @return {Number} The distance score.\r\n\t*/\r\n\tstatic distanceToItem(enemy: any, itemType: number): number {\r\n\r\n\t\tlet score = 1;\r\n\r\n\t\tenemy.world.getClosestItem(enemy, itemType, result);\r\n\r\n\t\tif (result.item) {\r\n\r\n\t\t\tlet distance = result.distance;\r\n\r\n\t\t\tdistance = MathUtils.clamp(distance, CONFIG.BOT.MIN_ITEM_RANGE, CONFIG.BOT.MAX_ITEM_RANGE);\r\n\r\n\t\t\tscore = distance / CONFIG.BOT.MAX_ITEM_RANGE;\r\n\r\n\t\t}\r\n\r\n\t\treturn score;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Feature };\r\n","import { GoalEvaluator } from 'yuka';\r\nimport { AttackGoal } from '../goals/AttackGoal';\r\nimport { Feature } from '../core/Feature';\r\nimport { Enemy } from '../entities/Enemy';\r\n\r\n/**\r\n* Class for representing the attack goal evaluator. Can be used to compute a score that\r\n* represents the desirability of the respective top-level goal.\r\n*/\r\nclass AttackEvaluator extends GoalEvaluator<Enemy> {\r\n\r\n\tpublic tweaker: number;\r\n\r\n\t/**\r\n\t* Constructs a new attack goal evaluator.\r\n\t*\r\n\t* @param {Number} characterBias - Can be used to adjust the preferences of the enemy.\r\n\t*/\r\n\tconstructor(characterBias = 1) {\r\n\r\n\t\tsuper(characterBias);\r\n\r\n\t\tthis.tweaker = 1; // value used to tweak the desirability\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Calculates the desirability. It's a score between 0 and 1 representing the desirability\r\n\t* of a goal.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t* @return {Number} The desirability.\r\n\t*/\r\n\tcalculateDesirability(owner: Enemy) {\r\n\r\n\t\tlet desirability = 0;\r\n\r\n\t\tif (owner.targetSystem.hasTarget()) {\r\n\r\n\t\t\tdesirability = this.tweaker * Feature.totalWeaponStrength(owner) * Feature.health(owner);\r\n\r\n\t\t}\r\n\r\n\t\treturn desirability;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Executed if this goal evaluator produces the highest desirability.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t*/\r\n\tsetGoal(owner: Enemy) {\r\n\r\n\t\tconst currentSubgoal = owner.brain.currentSubgoal();\r\n\r\n\t\tif ((currentSubgoal instanceof AttackGoal) === false) {\r\n\r\n\t\t\towner.brain.clearSubgoals();\r\n\r\n\t\t\towner.brain.addSubgoal(new AttackGoal(owner));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { AttackEvaluator };\r\n","import { CompositeGoal, Vector3 } from 'yuka';\r\nimport { FollowPathGoal } from './FollowPathGoal';\r\nimport { FindPathGoal } from './FindPathGoal';\r\n\r\n\r\n/**\r\n* Top-Level goal that is used to manage the map exploration\r\n* of the enemy.\r\n*/\r\nclass ExploreGoal extends CompositeGoal<any> {\r\n\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// if this goal is reactivated then there may be some existing subgoals that must be removed\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t\t// compute random position on map\r\n\r\n\t\tconst region = owner.world.navMesh.getRandomRegion();\r\n\r\n\t\tconst from = new Vector3().copy(owner.position);\r\n\t\tconst to = new Vector3().copy(region.centroid);\r\n\r\n\t\t// setup subgoals\r\n\r\n\t\tthis.addSubgoal(new FindPathGoal(owner, from, to));\r\n\t\tthis.addSubgoal(new FollowPathGoal(owner));\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tthis.status = this.executeSubgoals();\r\n\r\n\t\tthis.replanIfFailed();\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ExploreGoal };\r\n","import { GoalEvaluator } from 'yuka';\r\nimport { ExploreGoal } from '../goals/ExploreGoal';\r\nimport { Enemy } from '../entities/Enemy';\r\n\r\n/**\r\n* Class for representing the explore goal evaluator. Can be used to compute a score that\r\n* represents the desirability of the respective top-level goal.\r\n*/\r\nclass ExploreEvaluator extends GoalEvaluator<Enemy> {\r\n\r\n\t/**\r\n\t* Constructs a new explore goal evaluator.\r\n\t*\r\n\t* @param {Number} characterBias - Can be used to adjust the preferences of the enemy.\r\n\t*/\r\n\tconstructor(characterBias = 1) {\r\n\r\n\t\tsuper(characterBias);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Calculates the desirability. It's a score between 0 and 1 representing the desirability\r\n\t* of a goal.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t* @return {Number} The desirability.\r\n\t*/\r\n\tcalculateDesirability( /* owner */) {\r\n\r\n\t\treturn 0.1;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Executed if this goal evaluator produces the highest desirability.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t*/\r\n\tsetGoal(owner: Enemy) {\r\n\r\n\t\tconst currentSubgoal = owner.brain.currentSubgoal();\r\n\r\n\t\tif ((currentSubgoal instanceof ExploreGoal) === false) {\r\n\r\n\t\t\towner.brain.clearSubgoals();\r\n\r\n\t\t\towner.brain.addSubgoal(new ExploreGoal(owner));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { ExploreEvaluator };\r\n","import { AABB, Vector3, Ray } from 'yuka';\r\nimport { Matrix4 } from 'three';\r\n\r\nconst rayBindSpace = new Ray();\r\n\r\n/**\r\n* Class for representing the bounds of an enemy. Its primary purpose is to avoid\r\n* expensive operations on the actual geometry of an enemy. Hence, intersection test\r\n* are perfomed with a simple hierarchy of AABBs.\r\n*/\r\nclass CharacterBounds {\r\n\r\n\tpublic owner: any;\r\n\tpublic _outerHitbox: AABB;\r\n\tpublic _outerHitboxDefinition: AABB;\r\n\tpublic _innerHitboxes: any[];\r\n\tpublic _cache: Map<any, any>;\r\n\r\n\t/**\r\n\t* Constructs a new level entity with the given values.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this instance.\r\n\t*/\r\n\tconstructor(owner: any) {\r\n\r\n\t\tthis.owner = owner;\r\n\r\n\t\t// the outer and topmost bounding volume. used in the first\r\n\t\t// phase of an intersection test\r\n\r\n\t\tthis._outerHitbox = new AABB();\r\n\t\tthis._outerHitboxDefinition = new AABB();\r\n\r\n\t\t// the inner bounding volumes are assigned to certain bones\r\n\r\n\t\tthis._innerHitboxes = [];\r\n\r\n\t\t// cache that holds the current bone's inverse matrices\r\n\r\n\t\tthis._cache = new Map();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the bounding volumes of this instance.\r\n\t*\r\n\t* @return {CharacterBounds} A reference to this instance.\r\n\t*/\r\n\tinit() {\r\n\r\n\t\tthis._outerHitboxDefinition.set(new Vector3(- 0.5, 0, - 0.5), new Vector3(0.5, 1.8, 0.5));\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// skeleton based AABBs\r\n\r\n\t\tconst renderComponent = owner._renderComponent;\r\n\t\tconst hitboxes = this._innerHitboxes;\r\n\r\n\t\t// ensure world matrices are up to date\r\n\r\n\t\trenderComponent.updateMatrixWorld(true);\r\n\r\n\t\t// head and torso\r\n\r\n\t\tconst headBone = renderComponent.getObjectByName('Armature_mixamorigHead');\r\n\t\tconst head = new AABB(new Vector3(- 0.1, 1.6, - 0.1), new Vector3(0.1, 1.8, 0.1));\r\n\t\tlet bindMatrix = new Matrix4().copy(headBone.matrixWorld);\r\n\t\tlet bindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: head, bone: headBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst spineBone = renderComponent.getObjectByName('Armature_mixamorigSpine1');\r\n\t\tconst spine = new AABB(new Vector3(- 0.2, 1, - 0.2), new Vector3(0.2, 1.6, 0.2));\r\n\t\tbindMatrix = new Matrix4().copy(spineBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: spine, bone: spineBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\t// arms\r\n\r\n\t\tconst rightArmBone = renderComponent.getObjectByName('Armature_mixamorigRightArm');\r\n\t\tconst rightArm = new AABB(new Vector3(- 0.4, 1.42, - 0.15), new Vector3(- 0.2, 1.58, 0.1));\r\n\t\tbindMatrix = new Matrix4().copy(rightArmBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: rightArm, bone: rightArmBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst rightForeArmBone = renderComponent.getObjectByName('Armature_mixamorigRightForeArm');\r\n\t\tconst rightForeArm = new AABB(new Vector3(- 0.8, 1.42, - 0.15), new Vector3(- 0.4, 1.55, 0.05));\r\n\t\tbindMatrix = new Matrix4().copy(rightForeArmBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: rightForeArm, bone: rightForeArmBone, bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst leftArmBone = renderComponent.getObjectByName('Armature_mixamorigLeftArm');\r\n\t\tconst leftArm = new AABB(new Vector3(0.2, 1.42, - 0.15), new Vector3(0.4, 1.58, 0.1));\r\n\t\tbindMatrix = new Matrix4().copy(leftArmBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: leftArm, bone: leftArmBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst leftForeArmBone = renderComponent.getObjectByName('Armature_mixamorigLeftForeArm');\r\n\t\tconst leftForeArm = new AABB(new Vector3(0.4, 1.42, - 0.15), new Vector3(0.8, 1.55, 0.05));\r\n\t\tbindMatrix = new Matrix4().copy(leftForeArmBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: leftForeArm, bone: leftForeArmBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\t// legs\r\n\r\n\t\tconst rightUpLegBone = renderComponent.getObjectByName('Armature_mixamorigRightUpLeg');\r\n\t\tconst rightUpLeg = new AABB(new Vector3(- 0.2, 0.6, - 0.15), new Vector3(0, 1, 0.15));\r\n\t\tbindMatrix = new Matrix4().copy(rightUpLegBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: rightUpLeg, bone: rightUpLegBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst rightLegBone = renderComponent.getObjectByName('Armature_mixamorigRightLeg');\r\n\t\tconst rightLeg = new AABB(new Vector3(- 0.2, 0, - 0.15), new Vector3(0, 0.6, 0.15));\r\n\t\tbindMatrix = new Matrix4().copy(rightLegBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: rightLeg, bone: rightLegBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst leftUpLegBone = renderComponent.getObjectByName('Armature_mixamorigLeftUpLeg');\r\n\t\tconst leftUpLeg = new AABB(new Vector3(0, 0.6, - 0.15), new Vector3(0.2, 1, 0.15));\r\n\t\tbindMatrix = new Matrix4().copy(leftUpLegBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: leftUpLeg, bone: leftUpLegBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\tconst leftLegBone = renderComponent.getObjectByName('Armature_mixamorigLeftLeg');\r\n\t\tconst leftLeg = new AABB(new Vector3(0, 0, - 0.15), new Vector3(0.2, 0.6, 0.15));\r\n\t\tbindMatrix = new Matrix4().copy(leftLegBone.matrixWorld);\r\n\t\tbindMatrixInverse = new Matrix4().copy(bindMatrix).invert();\r\n\t\thitboxes.push({ aabb: leftLeg, bone: leftLegBone, bindMatrix: bindMatrix, bindMatrixInverse: bindMatrixInverse });\r\n\r\n\t\t//\r\n\r\n\t\t// debugging the AABBs requires the skeleton the be in bind pose at the origin\r\n\r\n\t\t// for ( let i = 0, l = hitboxes.length; i < l; i ++ ) {\r\n\r\n\t\t// \tconst hitbox = hitboxes[ i ];\r\n\r\n\t\t// \tconst hitboxHelper = SceneUtils.createHitboxHelper( hitbox.aabb );\r\n\t\t// \tthis.owner.world.scene.add( hitboxHelper );\r\n\r\n\t\t// }\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates the outer bounding volume of this instance. Deeper bounding volumes\r\n\t* are only update if necessary.\r\n\t*\r\n\t* @return {CharacterBounds} A reference to this instance.\r\n\t*/\r\n\tupdate() {\r\n\r\n\t\tthis._outerHitbox.copy(this._outerHitboxDefinition).applyMatrix4(this.owner.worldMatrix);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the center point of this instance and stores it into the given vector.\r\n\t*\r\n\t* @param {Vector3} result - The result vector.\r\n\t* @return {Vector3} The result vector.\r\n\t*/\r\n\tgetCenter(center: any) {\r\n\r\n\t\treturn this._outerHitbox.getCenter(center);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the intesection point if the given ray hits one of the bounding volumes.\r\n\t* If no intersection is detected, null is returned.\r\n\t*\r\n\t* @param {Ray} ray - The ray.\r\n\t* @param {Vector3} intersectionPoint - The intersection point.\r\n\t* @return {Vector3} The intersection point.\r\n\t*/\r\n\tintersectRay(ray: any, intersectionPoint: any) {\r\n\r\n\t\t// first text outer hitbox\r\n\r\n\t\tif (ray.intersectAABB(this._outerHitbox, intersectionPoint)) {\r\n\r\n\t\t\t// now test with inner hitboxes\r\n\r\n\t\t\tconst hitboxes = this._innerHitboxes;\r\n\r\n\t\t\tfor (let i = 0, l = hitboxes.length; i < l; i++) {\r\n\r\n\t\t\t\tconst hitbox = hitboxes[i];\r\n\t\t\t\tconst bone = hitbox.bone;\r\n\r\n\t\t\t\tconst inverseBoneMatrix = this._getInverseBoneMatrix(bone);\r\n\r\n\t\t\t\t// transform the ray from world space to local space of the bone\r\n\r\n\t\t\t\trayBindSpace.copy(ray).applyMatrix4(inverseBoneMatrix);\r\n\r\n\t\t\t\t// transform the ray from local space of the bone to its bind space (T-Pose)\r\n\r\n\t\t\t\trayBindSpace.applyMatrix4(hitbox.bindMatrix);\r\n\r\n\t\t\t\t// now perform the intersection test\r\n\r\n\t\t\t\tif (rayBindSpace.intersectAABB(hitbox.aabb, intersectionPoint)) {\r\n\r\n\t\t\t\t\t// since the intersection point is in bind space, it's necessary to convert back to world space\r\n\r\n\t\t\t\t\tintersectionPoint.applyMatrix4(hitbox.bindMatrixInverse).applyMatrix4(bone.matrixWorld);\r\n\r\n\t\t\t\t\treturn intersectionPoint;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the current inverse matrix for the given bone. A cache system ensures, the inverse matrix\r\n\t* is computed only once per simulation step.\r\n\t*\r\n\t* @param {Bone} bone - The bone.\r\n\t* @return {Matrix4} The inverse matrix.\r\n\t*/\r\n\t_getInverseBoneMatrix(bone: any) {\r\n\r\n\t\tconst world = this.owner.world;\r\n\t\tconst tick = world.tick;\r\n\r\n\t\t// since computing inverse matrices is expensive, do it only once per simulation step\r\n\r\n\t\tlet entry = this._cache.get(bone);\r\n\r\n\t\tif (entry === undefined) {\r\n\r\n\t\t\tentry = { tick: tick, inverseBoneMatrix: new Matrix4().copy(bone.matrixWorld).invert() };\r\n\t\t\tthis._cache.set(bone, entry);\r\n\r\n\r\n\t\t} else {\r\n\r\n\t\t\tif (entry.tick < tick) {\r\n\r\n\t\t\t\tentry.tick = tick;\r\n\t\t\t\tentry.inverseBoneMatrix.copy(bone.matrixWorld).invert();\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tif (world.debug) {\r\n\r\n\t\t\t\t\tconsole.log('DIVE.CharacterBounds: Inverse matrix found in cache for bone.');\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn entry.inverseBoneMatrix;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { CharacterBounds };\r\n","import { GameEntity, MathUtils } from 'yuka';\r\nimport { WEAPON_STATUS_READY, WEAPON_STATUS_UNREADY, WEAPON_STATUS_EQUIP, WEAPON_STATUS_HIDE } from '../core/Constants';\r\n\r\n/**\r\n* Base class for all weapons.\r\n*/\r\nclass Weapon extends GameEntity {\r\n\r\n\tpublic owner: any;\r\n\tpublic type: number | null;\r\n\tpublic status: number;\r\n\tpublic previousState: number;\r\n\tpublic roundsLeft: number;\r\n\tpublic roundsPerClip: number;\r\n\tpublic ammo: number;\r\n\tpublic maxAmmo: number;\r\n\tpublic currentTime: number;\r\n\tpublic shotTime: number;\r\n\tpublic reloadTime: number;\r\n\tpublic equipTime: number;\r\n\tpublic hideTime: number;\r\n\tpublic endTimeShot: number;\r\n\tpublic endTimeReload: number;\r\n\tpublic endTimeEquip: number;\r\n\tpublic endTimeHide: number;\r\n\tpublic endTimeMuzzleFire: number;\r\n\tpublic fuzzyModule: any;\r\n\tpublic muzzle: any;\r\n\tpublic audios: any;\r\n\tpublic mixer: any;\r\n\tpublic animations: any;\r\n\r\n\t/**\r\n\t* Constructs a new weapon with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this weapon.\r\n\t*/\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.owner = owner;\r\n\r\n\t\tthis.canActivateTrigger = false;\r\n\r\n\t\tthis.type = null;\r\n\t\tthis.status = WEAPON_STATUS_UNREADY;\r\n\r\n\t\t// use to restore the state after a weapon change\r\n\r\n\t\tthis.previousState = WEAPON_STATUS_READY;\r\n\r\n\t\t// ammo related stuff\r\n\r\n\t\tthis.roundsLeft = 0;\r\n\t\tthis.roundsPerClip = 0;\r\n\t\tthis.ammo = 0;\r\n\t\tthis.maxAmmo = 0;\r\n\r\n\t\t// times are in seconds\r\n\r\n\t\tthis.currentTime = 0;\r\n\r\n\t\tthis.shotTime = Infinity;\r\n\t\tthis.reloadTime = Infinity;\r\n\t\tthis.equipTime = Infinity;\r\n\t\tthis.hideTime = Infinity;\r\n\r\n\t\tthis.endTimeShot = Infinity;\r\n\t\tthis.endTimeReload = Infinity;\r\n\t\tthis.endTimeEquip = Infinity;\r\n\t\tthis.endTimeHide = Infinity;\r\n\t\tthis.endTimeMuzzleFire = Infinity;\r\n\r\n\t\t// used for weapon selection\r\n\r\n\t\tthis.fuzzyModule = null;\r\n\r\n\t\t// render specific properties\r\n\r\n\t\tthis.muzzle = null;\r\n\t\tthis.audios = null;\r\n\t\tthis.mixer = null;\r\n\t\tthis.animations = null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Adds the given amount of rounds to the ammo.\r\n\t*\r\n\t* @param {Number} rounds - The amount of ammo.\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\t/**\r\n\t* Adds the given amount of rounds to the ammo.\r\n\t*\r\n\t* @param {Number} rounds - The amount of ammo.\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\taddRounds(rounds: number) {\r\n\r\n\t\tthis.ammo = MathUtils.clamp(this.ammo + rounds, 0, this.maxAmmo);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the remaining rounds/ammo of this weapon.\r\n\t*\r\n\t* @return {Number} The reamining rounds/ammo for this weapon.\r\n\t*/\r\n\tgetRemainingRounds() {\r\n\r\n\t\treturn this.ammo;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns a value representing the desirability of using the weapon.\r\n\t*\r\n\t* @param {Number} distance - The distance to the target.\r\n\t* @return {Number} A score between 0 and 1 representing the desirability.\r\n\t*/\r\n\tgetDesirability(_distance: number) {\r\n\r\n\t\treturn 0;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Equips the weapon.\r\n\t*\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\tequip() {\r\n\r\n\t\tthis.status = WEAPON_STATUS_EQUIP;\r\n\t\tthis.endTimeEquip = this.currentTime + this.equipTime;\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tlet animation = this.animations.get('hide');\r\n\t\t\tanimation.stop();\r\n\r\n\t\t\tanimation = this.animations.get('equip');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\tif (this.owner.isPlayer) {\r\n\r\n\t\t\tthis.owner.world.uiManager.updateAmmoStatus();\r\n\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Hides the weapon.\r\n\t*\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\thide() {\r\n\r\n\t\tthis.previousState = this.status;\r\n\t\tthis.status = WEAPON_STATUS_HIDE;\r\n\t\tthis.endTimeHide = this.currentTime + this.hideTime;\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('hide');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Reloads the weapon.\r\n\t*\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\treload() { }\r\n\r\n\t/**\r\n\t* Shoots at the given position.\r\n\t*\r\n\t* @param {Vector3} targetPosition - The target position.\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\tshoot(_targetPosition: any) { }\r\n\r\n\t/**\r\n\t* Update method of this weapon.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {Weapon} A reference to this weapon.\r\n\t*/\r\n\tupdate(delta: number) {\r\n\r\n\t\tthis.currentTime += delta;\r\n\r\n\t\tif (this.currentTime >= this.endTimeEquip) {\r\n\r\n\t\t\tthis.status = this.previousState; // restore previous state\r\n\t\t\tthis.endTimeEquip = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\tif (this.currentTime >= this.endTimeHide) {\r\n\r\n\t\t\tthis.status = WEAPON_STATUS_UNREADY;\r\n\t\t\tthis.endTimeHide = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// update animations\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tthis.mixer.update(delta);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Weapon };\r\n","import { Ray, Vector3 } from 'yuka';\r\nimport { AnimationMixer, LoopOnce } from 'three';\r\nimport { Weapon } from './Weapon';\r\nimport { WEAPON_STATUS_READY, WEAPON_STATUS_SHOT, WEAPON_STATUS_RELOAD, WEAPON_STATUS_EMPTY, WEAPON_STATUS_OUT_OF_AMMO, WEAPON_TYPES_BLASTER } from '../core/Constants';\r\nimport { CONFIG } from '../core/Config';\r\n\r\nconst spread = new Vector3();\r\n\r\n/**\r\n* Class for representing a blaster.\r\n*/\r\nclass Blaster extends Weapon {\r\n\tpublic muzzleFireTime: number;\r\n\r\n\t/**\r\n\t* Constructs a new blaster with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this weapon.\r\n\t*/\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.type = WEAPON_TYPES_BLASTER;\r\n\r\n\t\t// common weapon properties\r\n\r\n\t\tthis.roundsLeft = CONFIG.BLASTER.ROUNDS_LEFT;\r\n\t\tthis.roundsPerClip = CONFIG.BLASTER.ROUNDS_PER_CLIP;\r\n\t\tthis.ammo = CONFIG.BLASTER.AMMO;\r\n\t\tthis.maxAmmo = CONFIG.BLASTER.MAX_AMMO;\r\n\r\n\t\tthis.shotTime = CONFIG.BLASTER.SHOT_TIME;\r\n\t\tthis.reloadTime = CONFIG.BLASTER.RELOAD_TIME;\r\n\t\tthis.equipTime = CONFIG.BLASTER.EQUIP_TIME;\r\n\t\tthis.hideTime = CONFIG.BLASTER.HIDE_TIME;\r\n\t\tthis.muzzleFireTime = CONFIG.BLASTER.MUZZLE_TIME;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of this weapon.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {Blaster} A reference to this weapon.\r\n\t*/\r\n\t/**\r\n\t* Update method of this weapon.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {Blaster} A reference to this weapon.\r\n\t*/\r\n\tupdate(delta: number) {\r\n\r\n\t\tsuper.update(delta);\r\n\r\n\t\t// check reload\r\n\r\n\t\tif (this.currentTime >= this.endTimeReload) {\r\n\r\n\t\t\tconst toReload = this.roundsPerClip - this.roundsLeft;\r\n\r\n\t\t\tif (this.ammo >= toReload) {\r\n\r\n\t\t\t\tthis.roundsLeft = this.roundsPerClip;\r\n\t\t\t\tthis.ammo -= toReload;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.roundsLeft += this.ammo;\r\n\t\t\t\tthis.ammo = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// update UI\r\n\r\n\t\t\tif (this.owner.isPlayer) {\r\n\r\n\t\t\t\tthis.owner.world.uiManager.updateAmmoStatus();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.status = WEAPON_STATUS_READY;\r\n\r\n\t\t\tthis.endTimeReload = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check muzzle fire\r\n\r\n\t\tif (this.currentTime >= this.endTimeMuzzleFire) {\r\n\r\n\t\t\tthis.muzzle.visible = false;\r\n\r\n\t\t\tthis.endTimeMuzzleFire = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check shoot\r\n\r\n\t\tif (this.currentTime >= this.endTimeShot) {\r\n\r\n\t\t\tif (this.roundsLeft === 0) {\r\n\r\n\t\t\t\tif (this.ammo === 0) {\r\n\r\n\t\t\t\t\tthis.status = WEAPON_STATUS_OUT_OF_AMMO;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.status = WEAPON_STATUS_EMPTY;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.status = WEAPON_STATUS_READY;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.endTimeShot = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Reloads the weapon.\r\n\t*\r\n\t* @return {Blaster} A reference to this weapon.\r\n\t*/\r\n\treload() {\r\n\r\n\t\tthis.status = WEAPON_STATUS_RELOAD;\r\n\r\n\t\t// audio\r\n\r\n\t\tconst audio = this.audios.get('reload');\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t// animation\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('reload');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\tthis.endTimeReload = this.currentTime + this.reloadTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Shoots at the given position.\r\n\t*\r\n\t* @param {Vector3} targetPosition - The target position.\r\n\t* @return {Blaster} A reference to this weapon.\r\n\t*/\r\n\tshoot(targetPosition: any) {\r\n\r\n\t\tthis.status = WEAPON_STATUS_SHOT;\r\n\r\n\t\t// audio\r\n\r\n\t\tconst audio = this.audios.get('shot');\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t// animation\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('shot');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\t// muzzle fire\r\n\r\n\t\tthis.muzzle.visible = true;\r\n\t\tthis.muzzle.material.rotation = Math.random() * Math.PI;\r\n\r\n\t\tthis.endTimeMuzzleFire = this.currentTime + this.muzzleFireTime;\r\n\r\n\t\t// create bullet\r\n\r\n\t\tconst ray = new Ray();\r\n\r\n\t\tthis.getWorldPosition(ray.origin);\r\n\t\tray.direction.subVectors(targetPosition, ray.origin).normalize();\r\n\r\n\t\t// add spread\r\n\r\n\t\tspread.x = (1 - Math.random() * 2) * 0.01;\r\n\t\tspread.y = (1 - Math.random() * 2) * 0.01;\r\n\t\tspread.z = (1 - Math.random() * 2) * 0.01;\r\n\r\n\t\tray.direction.add(spread).normalize();\r\n\r\n\t\t// add bullet to world\r\n\r\n\t\tthis.owner.world.addBullet(this.owner, ray);\r\n\r\n\t\t// adjust ammo\r\n\r\n\t\tthis.roundsLeft--;\r\n\r\n\t\tthis.endTimeShot = this.currentTime + this.shotTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns a value representing the desirability of using the weapon.\r\n\t*\r\n\t* @param {Number} distance - The distance to the target.\r\n\t* @return {Number} A score between 0 and 1 representing the desirability.\r\n\t*/\r\n\tgetDesirability(distance: number) {\r\n\r\n\t\tthis.fuzzyModule.fuzzify('distanceToTarget', distance);\r\n\t\tthis.fuzzyModule.fuzzify('ammoStatus', this.roundsLeft);\r\n\r\n\t\treturn this.fuzzyModule.defuzzify('desirability') / 100;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits animations for this weapon. Only used for the player.\r\n\t*\r\n\t* @return {Blaster} A reference to this weapon.\r\n\t*/\r\n\tinitAnimations() {\r\n\r\n\t\tconst assetManager = this.owner.world.assetManager;\r\n\r\n\t\tconst mixer = new AnimationMixer(this as any);\r\n\t\tconst animations = new Map();\r\n\r\n\t\tconst shotClip = assetManager.animations.get('blaster_shot');\r\n\t\tconst reloadClip = assetManager.animations.get('blaster_reload');\r\n\t\tconst hideClip = assetManager.animations.get('blaster_hide');\r\n\t\tconst equipClip = assetManager.animations.get('blaster_equip');\r\n\r\n\t\tconst shotAction = mixer.clipAction(shotClip);\r\n\t\tshotAction.loop = LoopOnce;\r\n\r\n\t\tconst reloadAction = mixer.clipAction(reloadClip);\r\n\t\treloadAction.loop = LoopOnce;\r\n\r\n\t\tconst hideAction = mixer.clipAction(hideClip);\r\n\t\thideAction.loop = LoopOnce;\r\n\t\thideAction.clampWhenFinished = true;\r\n\r\n\t\tconst equipAction = mixer.clipAction(equipClip);\r\n\t\tequipAction.loop = LoopOnce;\r\n\r\n\t\tanimations.set('shot', shotAction);\r\n\t\tanimations.set('reload', reloadAction);\r\n\t\tanimations.set('hide', hideAction);\r\n\t\tanimations.set('equip', equipAction);\r\n\r\n\t\tthis.animations = animations;\r\n\t\tthis.mixer = mixer;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Blaster };\r\n","import { Ray, Vector3 } from 'yuka';\r\nimport { AnimationMixer, LoopOnce } from 'three';\r\nimport { Weapon } from './Weapon';\r\nimport { CONFIG } from '../core/Config';\r\nimport { WEAPON_STATUS_READY, WEAPON_STATUS_SHOT, WEAPON_STATUS_RELOAD, WEAPON_STATUS_EMPTY, WEAPON_STATUS_OUT_OF_AMMO, WEAPON_TYPES_SHOTGUN } from '../core/Constants';\r\n\r\nconst spread = new Vector3();\r\n\r\n/**\r\n* Class for representing a shotgun.\r\n*/\r\nclass Shotgun extends Weapon {\r\n\r\n\tpublic muzzleFireTime: number;\r\n\tpublic bulletsPerShot: number;\r\n\tpublic spread: number;\r\n\tpublic shotReloadTime: number;\r\n\tpublic endTimeShotReload: number;\r\n\r\n\t/**\r\n\t* Constructs a new shotgun with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this weapon.\r\n\t*/\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.type = WEAPON_TYPES_SHOTGUN;\r\n\r\n\t\t// common weapon properties\r\n\r\n\t\tthis.roundsLeft = CONFIG.SHOTGUN.ROUNDS_LEFT;\r\n\t\tthis.roundsPerClip = CONFIG.SHOTGUN.ROUNDS_PER_CLIP;\r\n\t\tthis.ammo = CONFIG.SHOTGUN.AMMO;\r\n\t\tthis.maxAmmo = CONFIG.SHOTGUN.MAX_AMMO;\r\n\r\n\t\tthis.shotTime = CONFIG.SHOTGUN.SHOT_TIME;\r\n\t\tthis.reloadTime = CONFIG.SHOTGUN.RELOAD_TIME;\r\n\t\tthis.equipTime = CONFIG.SHOTGUN.EQUIP_TIME;\r\n\t\tthis.hideTime = CONFIG.SHOTGUN.HIDE_TIME;\r\n\t\tthis.muzzleFireTime = CONFIG.SHOTGUN.MUZZLE_TIME;\r\n\r\n\t\t// shotgun specific properties\r\n\r\n\t\tthis.bulletsPerShot = CONFIG.SHOTGUN.BULLETS_PER_SHOT;\r\n\t\tthis.spread = CONFIG.SHOTGUN.SPREAD;\r\n\r\n\t\tthis.shotReloadTime = CONFIG.SHOTGUN.SHOT_RELOAD_TIME;\r\n\t\tthis.endTimeShotReload = Infinity;\r\n\r\n\t}\r\n\t/**\r\n\t* Update method of this weapon.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {Shotgun} A reference to this weapon.\r\n\t*/\r\n\t/**\r\n\t* Update method of this weapon.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {Shotgun} A reference to this weapon.\r\n\t*/\r\n\tupdate(delta: number) {\r\n\r\n\t\tsuper.update(delta);\r\n\r\n\t\t// check reload after each shot\r\n\r\n\t\tif (this.currentTime >= this.endTimeShotReload) {\r\n\r\n\t\t\tconst audio = this.audios.get('shot_reload');\r\n\t\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\t\taudio.play();\r\n\r\n\t\t\tthis.endTimeShotReload = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check reload of clip\r\n\r\n\t\tif (this.currentTime >= this.endTimeReload) {\r\n\r\n\t\t\tconst toReload = this.roundsPerClip - this.roundsLeft;\r\n\r\n\t\t\tif (this.ammo >= toReload) {\r\n\r\n\t\t\t\tthis.roundsLeft = this.roundsPerClip;\r\n\t\t\t\tthis.ammo -= toReload;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.roundsLeft += this.ammo;\r\n\t\t\t\tthis.ammo = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// update UI\r\n\r\n\t\t\tif (this.owner.isPlayer) {\r\n\r\n\t\t\t\tthis.owner.world.uiManager.updateAmmoStatus();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.status = WEAPON_STATUS_READY;\r\n\r\n\t\t\tthis.endTimeReload = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check muzzle fire\r\n\r\n\t\tif (this.currentTime >= this.endTimeMuzzleFire) {\r\n\r\n\t\t\tthis.muzzle.visible = false;\r\n\r\n\t\t\tthis.endTimeMuzzleFire = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check shoot\r\n\r\n\t\tif (this.currentTime >= this.endTimeShot) {\r\n\r\n\t\t\tif (this.roundsLeft === 0) {\r\n\r\n\t\t\t\tif (this.ammo === 0) {\r\n\r\n\t\t\t\t\tthis.status = WEAPON_STATUS_OUT_OF_AMMO;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.status = WEAPON_STATUS_EMPTY;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.status = WEAPON_STATUS_READY;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.endTimeShot = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Reloads the weapon.\r\n\t*\r\n\t* @return {Shotgun} A reference to this weapon.\r\n\t*/\r\n\treload() {\r\n\r\n\t\tthis.status = WEAPON_STATUS_RELOAD;\r\n\r\n\t\t// audio\r\n\r\n\t\tconst audio = this.audios.get('reload');\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t// animation\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('reload');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\tthis.endTimeReload = this.currentTime + this.reloadTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Shoots at the given position.\r\n\t*\r\n\t* @param {Vector3} targetPosition - The target position.\r\n\t* @return {Shotgun} A reference to this weapon.\r\n\t*/\r\n\tshoot(targetPosition: any) {\r\n\r\n\t\tthis.status = WEAPON_STATUS_SHOT;\r\n\r\n\t\t// audio\r\n\r\n\t\tconst audio = this.audios.get('shot');\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t// animation\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('shot');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\t// muzzle fire\r\n\r\n\t\tthis.muzzle.visible = true;\r\n\t\tthis.muzzle.material.rotation = Math.random() * Math.PI;\r\n\r\n\t\tthis.endTimeMuzzleFire = this.currentTime + this.muzzleFireTime;\r\n\r\n\t\t// create bullets\r\n\r\n\t\tconst ray = new Ray();\r\n\r\n\t\tthis.getWorldPosition(ray.origin);\r\n\t\tray.direction.subVectors(targetPosition, ray.origin).normalize();\r\n\r\n\t\tfor (let i = 0; i < this.bulletsPerShot; i++) {\r\n\r\n\t\t\tconst r = ray.clone();\r\n\r\n\t\t\tspread.x = (1 - Math.random() * 2) * this.spread;\r\n\t\t\tspread.y = (1 - Math.random() * 2) * this.spread;\r\n\t\t\tspread.z = (1 - Math.random() * 2) * this.spread;\r\n\r\n\t\t\tr.direction.add(spread).normalize();\r\n\r\n\t\t\tthis.owner.world.addBullet(this.owner, r);\r\n\r\n\t\t}\r\n\r\n\t\t// adjust ammo\r\n\r\n\t\tthis.roundsLeft--;\r\n\r\n\t\tthis.endTimeShotReload = this.currentTime + this.shotReloadTime;\r\n\t\tthis.endTimeShot = this.currentTime + this.shotTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns a value representing the desirability of using the weapon.\r\n\t*\r\n\t* @param {Number} distance - The distance to the target.\r\n\t* @return {Number} A score between 0 and 1 representing the desirability.\r\n\t  */\r\n\tgetDesirability(distance: number) {\r\n\r\n\t\tthis.fuzzyModule.fuzzify('distanceToTarget', distance);\r\n\t\tthis.fuzzyModule.fuzzify('ammoStatus', this.roundsLeft);\r\n\r\n\t\treturn this.fuzzyModule.defuzzify('desirability') / 100;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits animations for this weapon. Only used for the player.\r\n\t*\r\n\t* @return {Shotgun} A reference to this weapon.\r\n\t*/\r\n\tinitAnimations() {\r\n\r\n\t\tconst assetManager = this.owner.world.assetManager;\r\n\r\n\t\tconst mixer = new AnimationMixer(this as any);\r\n\t\tconst animations = new Map();\r\n\r\n\t\tconst shotClip = assetManager.animations.get('shotgun_shot');\r\n\t\tconst reloadClip = assetManager.animations.get('shotgun_reload');\r\n\t\tconst hideClip = assetManager.animations.get('shotgun_hide');\r\n\t\tconst equipClip = assetManager.animations.get('shotgun_equip');\r\n\r\n\t\tconst shotAction = mixer.clipAction(shotClip);\r\n\t\tshotAction.loop = LoopOnce;\r\n\r\n\t\tconst reloadAction = mixer.clipAction(reloadClip);\r\n\t\treloadAction.loop = LoopOnce;\r\n\r\n\t\tconst hideAction = mixer.clipAction(hideClip);\r\n\t\thideAction.loop = LoopOnce;\r\n\t\thideAction.clampWhenFinished = true;\r\n\r\n\t\tconst equipAction = mixer.clipAction(equipClip);\r\n\t\tequipAction.loop = LoopOnce;\r\n\r\n\t\tanimations.set('shot', shotAction);\r\n\t\tanimations.set('reload', reloadAction);\r\n\t\tanimations.set('hide', hideAction);\r\n\t\tanimations.set('equip', equipAction);\r\n\r\n\t\tthis.animations = animations;\r\n\t\tthis.mixer = mixer;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Shotgun };\r\n","import { Ray, Vector3 } from 'yuka';\r\nimport { AnimationMixer, LoopOnce } from 'three';\r\nimport { Weapon } from './Weapon';\r\nimport { WEAPON_STATUS_READY, WEAPON_STATUS_SHOT, WEAPON_STATUS_RELOAD, WEAPON_STATUS_EMPTY, WEAPON_STATUS_OUT_OF_AMMO, WEAPON_TYPES_ASSAULT_RIFLE } from '../core/Constants';\r\nimport { CONFIG } from '../core/Config';\r\n\r\nconst spread = new Vector3();\r\n\r\n/**\r\n* Class for representing a assault rifle.\r\n*/\r\nclass AssaultRifle extends Weapon {\r\n\r\n\t/**\r\n\t* Constructs a new assault rifle with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this weapon.\r\n\t*/\r\n\tpublic muzzleFireTime: number;\r\n\r\n\t/**\r\n\t* Constructs a new assault rifle with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this weapon.\r\n\t*/\r\n\tconstructor(owner: any) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.type = WEAPON_TYPES_ASSAULT_RIFLE;\r\n\r\n\t\t// common weapon properties\r\n\r\n\t\tthis.roundsLeft = CONFIG.ASSAULT_RIFLE.ROUNDS_LEFT;\r\n\t\tthis.roundsPerClip = CONFIG.ASSAULT_RIFLE.ROUNDS_PER_CLIP;\r\n\t\tthis.ammo = CONFIG.ASSAULT_RIFLE.AMMO;\r\n\t\tthis.maxAmmo = CONFIG.ASSAULT_RIFLE.MAX_AMMO;\r\n\r\n\t\tthis.shotTime = CONFIG.ASSAULT_RIFLE.SHOT_TIME;\r\n\t\tthis.reloadTime = CONFIG.ASSAULT_RIFLE.RELOAD_TIME;\r\n\t\tthis.equipTime = CONFIG.ASSAULT_RIFLE.EQUIP_TIME;\r\n\t\tthis.hideTime = CONFIG.ASSAULT_RIFLE.HIDE_TIME;\r\n\t\tthis.muzzleFireTime = CONFIG.ASSAULT_RIFLE.MUZZLE_TIME;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of this weapon.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {AssaultRifle} A reference to this weapon.\r\n\t*/\r\n\tupdate(delta: number) {\r\n\r\n\t\tsuper.update(delta);\r\n\r\n\t\t// check reload\r\n\r\n\t\tif (this.currentTime >= this.endTimeReload) {\r\n\r\n\t\t\tconst toReload = this.roundsPerClip - this.roundsLeft;\r\n\r\n\t\t\tif (this.ammo >= toReload) {\r\n\r\n\t\t\t\tthis.roundsLeft = this.roundsPerClip;\r\n\t\t\t\tthis.ammo -= toReload;\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.roundsLeft += this.ammo;\r\n\t\t\t\tthis.ammo = 0;\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// update UI\r\n\r\n\t\t\tif (this.owner.isPlayer) {\r\n\r\n\t\t\t\tthis.owner.world.uiManager.updateAmmoStatus();\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.status = WEAPON_STATUS_READY;\r\n\r\n\t\t\tthis.endTimeReload = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check muzzle fire\r\n\r\n\t\tif (this.currentTime >= this.endTimeMuzzleFire) {\r\n\r\n\t\t\tthis.muzzle.visible = false;\r\n\r\n\t\t\tthis.endTimeMuzzleFire = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\t// check shoot\r\n\r\n\t\tif (this.currentTime >= this.endTimeShot) {\r\n\r\n\t\t\tif (this.roundsLeft === 0) {\r\n\r\n\t\t\t\tif (this.ammo === 0) {\r\n\r\n\t\t\t\t\tthis.status = WEAPON_STATUS_OUT_OF_AMMO;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.status = WEAPON_STATUS_EMPTY;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.status = WEAPON_STATUS_READY;\r\n\r\n\t\t\t}\r\n\r\n\t\t\tthis.endTimeShot = Infinity;\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Reloads the weapon.\r\n\t*\r\n\t* @return {AssaultRifle} A reference to this weapon.\r\n\t*/\r\n\treload() {\r\n\r\n\t\tthis.status = WEAPON_STATUS_RELOAD;\r\n\r\n\t\t// audio\r\n\r\n\t\tconst audio = this.audios.get('reload');\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t// animation\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('reload');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\tthis.endTimeReload = this.currentTime + this.reloadTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Shoots at the given position.\r\n\t*\r\n\t* @param {Vector3} targetPosition - The target position.\r\n\t* @return {AssaultRifle} A reference to this weapon.\r\n\t*/\r\n\tshoot(targetPosition: any) {\r\n\r\n\t\tthis.status = WEAPON_STATUS_SHOT;\r\n\r\n\t\t// audio\r\n\r\n\t\tconst audio = this.audios.get('shot');\r\n\t\tif (audio.isPlaying === true) audio.stop();\r\n\t\taudio.play();\r\n\r\n\t\t// animation\r\n\r\n\t\tif (this.mixer) {\r\n\r\n\t\t\tconst animation = this.animations.get('shot');\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.play();\r\n\r\n\t\t}\r\n\r\n\t\t// muzzle fire\r\n\r\n\t\tthis.muzzle.visible = true;\r\n\t\tthis.muzzle.material.rotation = Math.random() * Math.PI;\r\n\r\n\t\tthis.endTimeMuzzleFire = this.currentTime + this.muzzleFireTime;\r\n\r\n\t\t// create bullet\r\n\r\n\t\tconst ray = new Ray();\r\n\r\n\t\tthis.getWorldPosition(ray.origin);\r\n\t\tray.direction.subVectors(targetPosition, ray.origin).normalize();\r\n\r\n\t\t// add spread\r\n\r\n\t\tspread.x = (1 - Math.random() * 2) * 0.01;\r\n\t\tspread.y = (1 - Math.random() * 2) * 0.01;\r\n\t\tspread.z = (1 - Math.random() * 2) * 0.01;\r\n\r\n\t\tray.direction.add(spread).normalize();\r\n\r\n\t\t// add bullet to world\r\n\r\n\t\tthis.owner.world.addBullet(this.owner, ray);\r\n\r\n\t\t// adjust ammo\r\n\r\n\t\tthis.roundsLeft--;\r\n\r\n\t\tthis.endTimeShot = this.currentTime + this.shotTime;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns a value representing the desirability of using the weapon.\r\n\t*\r\n\t* @param {Number} distance - The distance to the target.\r\n\t* @return {Number} A score between 0 and 1 representing the desirability.\r\n\t*/\r\n\tgetDesirability(distance: number) {\r\n\r\n\t\tthis.fuzzyModule.fuzzify('distanceToTarget', distance);\r\n\t\tthis.fuzzyModule.fuzzify('ammoStatus', this.roundsLeft);\r\n\r\n\t\treturn this.fuzzyModule.defuzzify('desirability') / 100;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits animations for this weapon. Only used for the player.\r\n\t*\r\n\t* @return {AssaultRifle} A reference to this weapon.\r\n\t*/\r\n\tinitAnimations() {\r\n\r\n\t\tconst assetManager = this.owner.world.assetManager;\r\n\r\n\t\tconst mixer = new AnimationMixer(this as any);\r\n\t\tconst animations = new Map();\r\n\r\n\t\tconst shotClip = assetManager.animations.get('assaultRifle_shot');\r\n\t\tconst reloadClip = assetManager.animations.get('assaultRifle_reload');\r\n\t\tconst hideClip = assetManager.animations.get('assaultRifle_hide');\r\n\t\tconst equipClip = assetManager.animations.get('assaultRifle_equip');\r\n\r\n\t\tconst shotAction = mixer.clipAction(shotClip);\r\n\t\tshotAction.loop = LoopOnce;\r\n\r\n\t\tconst reloadAction = mixer.clipAction(reloadClip);\r\n\t\treloadAction.loop = LoopOnce;\r\n\r\n\t\tconst hideAction = mixer.clipAction(hideClip);\r\n\t\thideAction.loop = LoopOnce;\r\n\t\thideAction.clampWhenFinished = true;\r\n\r\n\t\tconst equipAction = mixer.clipAction(equipClip);\r\n\t\tequipAction.loop = LoopOnce;\r\n\r\n\t\tanimations.set('shot', shotAction);\r\n\t\tanimations.set('reload', reloadAction);\r\n\t\tanimations.set('hide', hideAction);\r\n\t\tanimations.set('equip', equipAction);\r\n\r\n\t\tthis.animations = animations;\r\n\t\tthis.mixer = mixer;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { AssaultRifle };\r\n","import { Vector3, MathUtils } from 'yuka';\nimport { FuzzyVariable, LeftShoulderFuzzySet, TriangularFuzzySet, RightShoulderFuzzySet, FuzzyRule, FuzzyAND, FuzzyModule } from 'yuka';\nimport { CONFIG } from './Config';\nimport { WEAPON_TYPES_BLASTER, WEAPON_TYPES_SHOTGUN, WEAPON_TYPES_ASSAULT_RIFLE, WEAPON_STATUS_OUT_OF_AMMO } from './Constants';\nimport { WEAPON_STATUS_EMPTY, WEAPON_STATUS_READY, WEAPON_STATUS_UNREADY } from './Constants';\nimport { Blaster } from '../weapons/Blaster';\nimport { Shotgun } from '../weapons/Shotgun';\nimport { AssaultRifle } from '../weapons/AssaultRifle';\nimport { Weapon } from '../weapons/Weapon';\n\nconst displacement = new Vector3();\nconst targetPosition = new Vector3();\nconst offset = new Vector3();\n\n/**\n* Class to manage all operations specific to weapons and their deployment.\n*\n*/\nclass WeaponSystem {\n\n\tpublic owner: any;\n\tpublic reactionTime: number;\n\tpublic aimAccuracy: number;\n\tpublic weapons: Array<Weapon>;\n\tpublic weaponsMap: Map<number, Weapon | null>;\n\tpublic currentWeapon: Weapon | any;\n\tpublic nextWeaponType: number | null;\n\tpublic renderComponents: any;\n\tpublic fuzzyModules: any;\n\n\t/**\n\t* Constructs a new weapon system with the given values.\n\t*\n\t* @param {GameEntity} owner - The owner of this weapon system.\n\t*/\n\tconstructor(owner: any) {\n\n\t\tthis.owner = owner;\n\n\t\t// this is the minimum amount of time in seconds an enemy needs to\n\t\t// see an opponent before it can react to it. This variable is used\n\t\t// to prevent an enemy shooting at an opponent the instant it becomes visible.\n\n\t\tthis.reactionTime = CONFIG.BOT.WEAPON.REACTION_TIME;\n\n\t\t// each time the current weapon is fired a certain amount of random noise is\n\t\t// added to the target poisition. The lower this value the more accurate\n\t\t// a bot's aim will be. The value represents the maximum amount of offset in\n\t\t// world units.\n\n\t\tthis.aimAccuracy = CONFIG.BOT.WEAPON.AIM_ACCURACY;\n\n\t\t// an array with all weapons the bot has in its inventory\n\n\t\tthis.weapons = new Array();\n\n\t\t// this map holds the same data as the weapon array but it ensures only one weapon\n\t\t// per type is present in the inventory\n\n\t\tthis.weaponsMap = new Map();\n\n\t\tthis.weaponsMap.set(WEAPON_TYPES_BLASTER, null);\n\t\tthis.weaponsMap.set(WEAPON_TYPES_SHOTGUN, null);\n\t\tthis.weaponsMap.set(WEAPON_TYPES_ASSAULT_RIFLE, null);\n\n\t\t// represents the current hold weapon\n\n\t\tthis.currentWeapon = null;\n\n\t\t// represents the next weapon type the enemy wants to use\n\n\t\tthis.nextWeaponType = null;\n\n\t\t// manages the render components for the weapons\n\n\t\tthis.renderComponents = {\n\t\t\tblaster: {\n\t\t\t\tmesh: null,\n\t\t\t\taudios: new Map(),\n\t\t\t\tmuzzle: null\n\t\t\t},\n\t\t\tshotgun: {\n\t\t\t\tmesh: null,\n\t\t\t\taudios: new Map(),\n\t\t\t\tmuzzle: null\n\t\t\t},\n\t\t\tassaultRifle: {\n\t\t\t\tmesh: null,\n\t\t\t\taudios: new Map(),\n\t\t\t\tmuzzle: null\n\t\t\t}\n\t\t};\n\n\t\t// manages the fuzzy modules for the weapons. they are going to be used to\n\t\t// determine the best weapon for a given situation\n\n\t\tthis.fuzzyModules = {\n\t\t\tblaster: null,\n\t\t\tshotGun: null,\n\t\t\tassaultRifle: null\n\t\t};\n\n\t}\n\n\t/**\n\t* Inits the weapon system. Should be called once during the creation\n\t* or startup process of an entity.\n\t*\n\t* @return {WeaponSystem} A reference to this weapon system.\n\t*/\n\tinit(): this {\n\n\t\t// init render components\n\n\t\tthis._initRenderComponents();\n\n\t\t// init fuzzy modules (only necessary for bots)\n\n\t\tif (this.owner.isPlayer === false) {\n\n\t\t\tthis._initFuzzyModules();\n\n\t\t}\n\n\t\t// reset the system to its initial state\n\n\t\tthis.reset();\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Resets the internal data structures and sets an initial weapon.\n\t*\n\t* @return {WeaponSystem} A reference to this weapon system.\n\t*/\n\treset(): this {\n\n\t\t// remove existing weapons if necessary\n\n\t\tfor (let i = (this.weapons.length - 1); i >= 0; i--) {\n\n\t\t\tconst weapon = this.weapons[i];\n\n\t\t\tif (weapon.type !== null) {\n\t\t\t\tthis.removeWeapon(weapon.type);\n\t\t\t}\n\n\t\t}\n\n\t\t// add weapons to inventory\n\n\t\tthis.addWeapon(WEAPON_TYPES_BLASTER);\n\n\t\t// change to initial weapon\n\n\t\tthis.changeWeapon(WEAPON_TYPES_BLASTER);\n\n\t\t// reset next weapon\n\n\t\tthis.nextWeaponType = null;\n\n\t\t// the initial weapon is always ready to use\n\n\t\tthis.currentWeapon.status = WEAPON_STATUS_READY;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Determines the most appropriate weapon to use given the current game state.\n\t*\n\t* @return {WeaponSystem} A reference to this weapon system.\n\t*/\n\tselectBestWeapon(): this {\n\n\t\tconst owner = this.owner;\n\t\tconst target = owner.targetSystem.getTarget();\n\n\t\tif (target) {\n\n\t\t\tlet highestDesirability = 0;\n\t\t\tlet bestWeaponType = WEAPON_TYPES_BLASTER;\n\n\t\t\t// calculate the distance to the target\n\n\t\t\tconst distanceToTarget = this.owner.position.distanceTo(target.position);\n\n\t\t\t// for each weapon in the inventory calculate its desirability given the\n\t\t\t// current situation. The most desirable weapon is selected\n\n\t\t\tfor (let i = 0, l = this.weapons.length; i < l; i++) {\n\n\t\t\t\tconst weapon = this.weapons[i];\n\n\t\t\t\tlet desirability = (weapon.roundsLeft === 0) ? 0 : weapon.getDesirability(distanceToTarget);\n\n\t\t\t\t// if weapon is different than currentWeapon, decrease the desirability in order to respect the\n\t\t\t\t// cost of changing a weapon\n\n\t\t\t\tif (this.currentWeapon !== weapon) desirability -= CONFIG.BOT.WEAPON.CHANGE_COST;\n\n\t\t\t\t//\n\n\t\t\t\tif (desirability > highestDesirability) {\n\n\t\t\t\t\tif (weapon.type !== null) {\n\t\t\t\t\t\thighestDesirability = desirability;\n\t\t\t\t\t\tbestWeaponType = weapon.type;\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// select the best weapon\n\n\t\t\tthis.setNextWeapon(bestWeaponType);\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Changes the current weapon to one of the specified type.\n\t*\n\t* @param {WEAPON_TYPES} type - The weapon type.\n\t* @return {WeaponSystem} A reference to this weapon system.\n\t*/\n\tchangeWeapon(type: number): this {\n\n\t\t\tconst weapon = this.weaponsMap.get(type);\n\n\t\t\tif (weapon) {\n\n\t\t\t\tthis.currentWeapon = weapon;\n\n\t\t\t\t// adjust render components. only a single weapon can be visible\n\t\t\t\t// Use optional chaining since meshes may not be loaded yet\n\n\t\t\t\tswitch (weapon.type) {\n\n\t\t\t\t\tcase WEAPON_TYPES_BLASTER:\n\t\t\t\t\t\t// Keep old weapons hidden - RIFT handles rendering\n\t\t\t\t\t\tif (this.renderComponents?.blaster?.mesh) this.renderComponents.blaster.mesh.visible = false;\n\t\t\t\t\t\tif (this.renderComponents?.shotgun?.mesh) this.renderComponents.shotgun.mesh.visible = false;\n\t\t\t\t\t\tif (this.renderComponents?.assaultRifle?.mesh) this.renderComponents.assaultRifle.mesh.visible = false;\n\t\t\t\t\t\tif (this.owner.isPlayer && this.renderComponents?.blaster?.mesh) weapon.setRenderComponent(this.renderComponents.blaster.mesh, sync);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase WEAPON_TYPES_SHOTGUN:\n\t\t\t\t\t\tif (this.renderComponents?.blaster?.mesh) this.renderComponents.blaster.mesh.visible = false;\n\t\t\t\t\t\tif (this.renderComponents?.shotgun?.mesh) this.renderComponents.shotgun.mesh.visible = false;\n\t\t\t\t\t\tif (this.renderComponents?.assaultRifle?.mesh) this.renderComponents.assaultRifle.mesh.visible = false;\n\t\t\t\t\t\tif (this.owner.isPlayer && this.renderComponents?.shotgun?.mesh) weapon.setRenderComponent(this.renderComponents.shotgun.mesh, sync);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\n\t\t\t\t\t\tif (this.renderComponents?.blaster?.mesh) this.renderComponents.blaster.mesh.visible = false;\n\t\t\t\t\t\tif (this.renderComponents?.shotgun?.mesh) this.renderComponents.shotgun.mesh.visible = false;\n\t\t\t\t\t\tif (this.renderComponents?.assaultRifle?.mesh) this.renderComponents.assaultRifle.mesh.visible = false;\n\t\t\t\t\t\tif (this.owner.isPlayer && this.renderComponents?.assaultRifle?.mesh) weapon.setRenderComponent(this.renderComponents.assaultRifle.mesh, sync);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tconsole.error('DIVE.WeaponSystem: Invalid weapon type:', type);\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Adds a weapon of the specified type to the bot's inventory.\n\t\t* If the bot already has a weapon of this type only the ammo is added.\n\t\t*\n\t\t* @param {WEAPON_TYPES} type - The weapon type.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\naddWeapon(type: number): this {\n\n\t\t\tconst owner = this.owner;\n\n\t\t\tlet weapon: Weapon | undefined;\n\n\t\t\tswitch (type) {\n\n\t\t\t\tcase WEAPON_TYPES_BLASTER:\n\t\t\t\t\tweapon = new Blaster(owner);\n\t\t\t\t\tweapon.fuzzyModule = this.fuzzyModules.blaster;\n\t\t\t\t\tweapon.muzzle = this.renderComponents.blaster.muzzle;\n\t\t\t\t\tweapon.audios = this.renderComponents.blaster.audios;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_TYPES_SHOTGUN:\n\t\t\t\t\tweapon = new Shotgun(owner);\n\t\t\t\t\tweapon.fuzzyModule = this.fuzzyModules.shotGun;\n\t\t\t\t\tweapon.muzzle = this.renderComponents.shotgun.muzzle;\n\t\t\t\t\tweapon.audios = this.renderComponents.shotgun.audios;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\n\t\t\t\t\tweapon = new AssaultRifle(owner);\n\t\t\t\t\tweapon.fuzzyModule = this.fuzzyModules.assaultRifle;\n\t\t\t\t\tweapon.muzzle = this.renderComponents.assaultRifle.muzzle;\n\t\t\t\t\tweapon.audios = this.renderComponents.assaultRifle.audios;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error('DIVE.WeaponSystem: Invalid weapon type:', type);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\t// check inventory\n\n\t\t\tconst weaponInventory = this.weaponsMap.get(type);\n\n\t\t\tif (weaponInventory !== null && weaponInventory !== undefined && weapon) {\n\n\t\t\t\t// if the bot already holds a weapon of this type, just add its ammo\n\n\t\t\t\tweaponInventory.addRounds(weapon.getRemainingRounds());\n\n\t\t\t} else {\n\n\t\t\t\t// if not already present, add to inventory\n\n\t\t\t\tif (!weapon) return this;\n\n\t\t\t\tthis.weaponsMap.set(type, weapon);\n\t\t\t\tthis.weapons.push(weapon);\n\n\t\t\t\t// also add it to owner entity so the weapon is correctly updated by\n\t\t\t\t// the entity manager\n\n\t\t\t\towner.weaponContainer.add(weapon);\n\n\t\t\t\tif (owner.isPlayer) {\n\n\t\t\t\t\tweapon.scale.set(2, 2, 2);\n\t\t\t\t\tweapon.position.set(0.3, - 0.3, - 1);\n\t\t\t\t\tweapon.rotation.fromEuler(0, Math.PI, 0);\n\t\t\t\t\t(weapon as any).initAnimations();\n\n\t\t\t\t} else {\n\n\t\t\t\t\tweapon.position.set(- 0.1, - 0.2, 0.5);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Removes the specified weapon type from the bot's inventory.\n\t\t*\n\t\t* @param {WEAPON_TYPES} type - The weapon type.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nremoveWeapon(type: number): void {\n\n\t\t\tconst weapon = this.weaponsMap.get(type);\n\n\t\t\tif(weapon) {\n\n\t\t\t\tthis.weaponsMap.set(type, null);\n\n\t\t\t\tconst index = this.weapons.indexOf(weapon);\n\t\t\t\tthis.weapons.splice(index, 1);\n\n\t\t\t\tthis.owner.weaponContainer.remove(weapon);\n\n\t\t\t}\n\n\t\t}\n\n\t\t/**\n\t\t* Sets the next weapon type the owner should use.\n\t\t*\n\t\t* @param {WEAPON_TYPES} type - The weapon type.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nsetNextWeapon(type: number): this {\n\n\t\t\t// no need for action if the current weapon is already of the given type\n\n\t\t\tif (this.currentWeapon.type !== type) {\n\n\t\t\t\tthis.nextWeaponType = type;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Returns the weapon of the given type. If no weapon is present, null is returned.\n\t\t*\n\t\t* @param {WEAPON_TYPES} type - The weapon type.\n\t\t* @return {Weapon} A weapon.\n\t\t*/\ngetWeapon(type: number): Weapon | null | undefined {\n\n\t\t\treturn this.weaponsMap.get(type);\n\n\t\t}\n\n\t\t/**\n\t\t* Ensures that the current equiped weapon is rendered.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nshowCurrentWeapon(): this {\n\n\t\t\tconst type = this.currentWeapon.type;\n\n\t\t\tswitch (type) {\n\n\t\t\t\tcase WEAPON_TYPES_BLASTER:\n\t\t\t\t\tthis.renderComponents.blaster.mesh.visible = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_TYPES_SHOTGUN:\n\t\t\t\t\tthis.renderComponents.shotgun.mesh.visible = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\n\t\t\t\t\tthis.renderComponents.assaultRifle.mesh.visible = true;\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error('DIVE.WeaponSystem: Invalid weapon type:', type);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Ensures that the current equipped weapon is not rendered.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nhideCurrentWeapon(): this {\n\n\t\t\t// Guard against null currentWeapon (can happen with RIFT weapon system)\n\t\t\tif (!this.currentWeapon) {\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tconst type = this.currentWeapon.type;\n\n\t\t\tswitch (type) {\n\n\t\t\t\tcase WEAPON_TYPES_BLASTER:\n\t\t\t\t\tif (this.renderComponents.blaster?.mesh) {\n\t\t\t\t\t\tthis.renderComponents.blaster.mesh.visible = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_TYPES_SHOTGUN:\n\t\t\t\t\tif (this.renderComponents.shotgun?.mesh) {\n\t\t\t\t\t\tthis.renderComponents.shotgun.mesh.visible = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\n\t\t\t\t\tif (this.renderComponents.assaultRifle?.mesh) {\n\t\t\t\t\t\tthis.renderComponents.assaultRifle.mesh.visible = false;\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.error('DIVE.WeaponSystem: Invalid weapon type:', type);\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Returns the amount of ammo remaining for the specified weapon.\n\t\t*\n\t\t* @param {WEAPON_TYPES} type - The weapon type.\n\t\t* @return {Number} The amount of ammo.\n\t\t*/\ngetRemainingAmmoForWeapon(type: number): number {\n\n\t\t\tconst weapon = this.weaponsMap.get(type);\n\n\t\t\treturn weapon ? weapon.getRemainingRounds() : 0;\n\n\t\t}\n\n\t\t/**\n\t\t* Updates method of the weapon system. Called each simulation step if the owner is alive.\n\t\t*\n\t\t* @param {Number} delta - The time delta value.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nupdate(delta: number): this {\n\n\t\t\tthis.updateWeaponChange();\n\t\t\tthis.updateAimAndShot(delta);\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Updates weapon changing logic.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nupdateWeaponChange(): this {\n\n\t\t\tif (this.nextWeaponType !== null) {\n\n\t\t\t\t// if the current weapon is in certain states, hide it in order to start the weapon change\n\n\t\t\t\tif (this.currentWeapon.status === WEAPON_STATUS_READY ||\n\t\t\t\t\tthis.currentWeapon.status === WEAPON_STATUS_EMPTY ||\n\t\t\t\t\tthis.currentWeapon.status === WEAPON_STATUS_OUT_OF_AMMO) {\n\n\t\t\t\t\tthis.currentWeapon.hide();\n\n\t\t\t\t}\n\n\t\t\t\t// as soon as the current weapon becomes unready, change to the defined next weapon type\n\n\t\t\t\tif (this.currentWeapon.status === WEAPON_STATUS_UNREADY) {\n\n\t\t\t\t\tthis.changeWeapon(this.nextWeaponType);\n\t\t\t\t\tthis.currentWeapon.equip();\n\t\t\t\t\tthis.nextWeaponType = null;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Updates the aiming and shooting of the enemy.\n\t\t*\n\t\t* @param {Number} delta - The time delta value.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nupdateAimAndShot(delta: number): this {\n\n\t\t\tconst owner = this.owner;\n\t\t\tconst targetSystem = owner.targetSystem;\n\t\t\tconst target = targetSystem.getTarget();\n\n\t\t\tif (target) {\n\n\t\t\t\t// if the target is visible, directly rotate towards it and then\n\t\t\t\t// fire a round\n\n\t\t\t\tif (targetSystem.isTargetShootable()) {\n\n\t\t\t\t\t// stop search for the attacker if the target is shootable\n\n\t\t\t\t\towner.resetSearch();\n\n\t\t\t\t\t// the bot can fire a round if it is headed towards its target\n\t\t\t\t\t// and after a certain reaction time\n\n\t\t\t\t\tconst targeted = owner.rotateTo(target.position, delta, 0.05); // \"targeted\" is true if the enemy is faced to the target\n\n\t\t\t\t\tconst timeBecameVisible = targetSystem.getTimeBecameVisible();\n\t\t\t\t\tconst elapsedTime = owner.world.time.getElapsed();\n\n\t\t\t\t\tif (targeted === true && (elapsedTime - timeBecameVisible) >= this.reactionTime) {\n\n\t\t\t\t\t\ttarget.bounds.getCenter(targetPosition);\n\n\t\t\t\t\t\tthis.addNoiseToAim(targetPosition);\n\n\t\t\t\t\t\tthis.shoot(targetPosition);\n\n\t\t\t\t\t}\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// the target might not be shootable but the enemy is still attacked.\n\t\t\t\t\t// in this case, search for the attacker\n\n\t\t\t\t\tif (owner.searchAttacker) {\n\n\t\t\t\t\t\ttargetPosition.copy(owner.position).add(owner.attackDirection);\n\t\t\t\t\t\towner.rotateTo(targetPosition, delta);\n\n\t\t\t\t\t} else {\n\n\t\t\t\t\t\t// otherwise rotate to the latest recorded position\n\n\t\t\t\t\t\towner.rotateTo(targetSystem.getLastSensedPosition(), delta);\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t} else {\n\n\t\t\t\t// if the enemy has no target, look for an attacker if necessary\n\n\t\t\t\tif (owner.searchAttacker) {\n\n\t\t\t\t\ttargetPosition.copy(owner.position).add(owner.attackDirection);\n\t\t\t\t\towner.rotateTo(targetPosition, delta);\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// if the enemy has no target and is not being attacked, just look along\n\t\t\t\t\t// the movement direction\n\n\t\t\t\t\tdisplacement.copy(owner.velocity).normalize();\n\t\t\t\t\ttargetPosition.copy(owner.position).add(displacement);\n\n\t\t\t\t\towner.rotateTo(targetPosition, delta);\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Ensures the enemy does not perfectly aim at the given target position. It\n\t\t* alters the target position by a certain offset. The offset proportionally\n\t\t* increases with the distance between the owner of the weapon and its target.\n\t\t*\n\t\t* @param {Vector3} targetPosition - The target position.\n\t\t* @return {Vector3} The target position.\n\t\t*/\naddNoiseToAim(targetPosition: any): any {\n\n\t\t\tconst distance = this.owner.position.distanceTo(targetPosition);\n\n\t\t\toffset.x = MathUtils.randFloat(- this.aimAccuracy, this.aimAccuracy);\n\t\t\toffset.y = MathUtils.randFloat(- this.aimAccuracy, this.aimAccuracy);\n\t\t\toffset.z = MathUtils.randFloat(- this.aimAccuracy, this.aimAccuracy);\n\n\t\t\tconst maxDistance = CONFIG.BOT.WEAPON.NOISE_MAX_DISTANCE; // this distance produces the maximum amount of offset/noise\n\t\t\tconst f = Math.min(distance, maxDistance) / maxDistance;\n\n\t\t\ttargetPosition.add(offset.multiplyScalar(f));\n\n\t\t\treturn targetPosition;\n\n\t\t}\n\n\t\t/**\n\t\t* Shoots at the given position with the current weapon.\n\t\t*\n\t\t* @param {Vector3} targetPosition - The target position.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nshoot(targetPosition: any): this {\n\n\t\t\t// Use RIFT weapon system for enemies if available\n\t\t\tif (this.owner.isPlayer === false && this.owner.riftWeaponSystem) {\n\t\t\t\tthis.owner._shootRIFT(targetPosition);\n\t\t\t\treturn this;\n\t\t\t}\n\n\t\t\tconst currentWeapon = this.currentWeapon;\n\t\t\tconst status = currentWeapon.status;\n\n\t\t\tswitch (status) {\n\n\t\t\t\tcase WEAPON_STATUS_EMPTY:\n\t\t\t\t\tcurrentWeapon.reload();\n\t\t\t\t\tbreak;\n\n\t\t\t\tcase WEAPON_STATUS_READY:\n\t\t\t\t\tcurrentWeapon.shoot(targetPosition);\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\tbreak;\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Reloads the current weapon.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\nreload() {\n\n\t\t\tconst currentWeapon = this.currentWeapon;\n\n\t\t\tif (currentWeapon.status === WEAPON_STATUS_READY || currentWeapon.status === WEAPON_STATUS_EMPTY) {\n\n\t\t\t\tcurrentWeapon.reload();\n\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the render components of all weapons. Each enemy and the player\n\t\t* need a set of individual render components.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initRenderComponents() {\n\n\t\t\tthis._initBlasterRenderComponent();\n\n\t\t\tthis._initShotgunRenderComponent();\n\n\t\t\tthis._initAssaultRifleRenderComponent();\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the render components for the blaster.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initBlasterRenderComponent() {\n\n\t\t\tconst assetManager = this.owner.world.assetManager;\n\n\t\t\t// setup copy of blaster mesh\n\n\t\t\tlet blasterMesh;\n\n\t\t\tif (this.owner.isPlayer === false) {\n\n\t\t\t\t// pick the low resolution model for the enemies\n\n\t\t\t\tblasterMesh = assetManager.models.get('blaster_low').clone();\n\n\t\t\t\tblasterMesh.scale.set(100, 100, 100);\n\t\t\t\tblasterMesh.rotation.set(Math.PI * 0.5, Math.PI, 0);\n\t\t\t\tblasterMesh.position.set(0, 15, 5);\n\t\t\t\tblasterMesh.updateMatrix();\n\n\t\t\t\t// add the mesh to the right hand of the enemy\n\n\t\t\t\tconst rightHand = this.owner._renderComponent.getObjectByName('Armature_mixamorigRightHand');\n\t\t\t\trightHand.add(blasterMesh);\n\n\t\t\t} else {\n\n\t\t\t\tblasterMesh = assetManager.models.get('blaster_high');\n\n\t\t\t\tthis.owner.world.scene.add(blasterMesh);\n\n\t\t\t}\n\n\t\t\t// add muzzle sprite to the blaster mesh\n\n\t\t\tconst muzzleSprite = assetManager.models.get('muzzle').clone();\n\t\t\tmuzzleSprite.material = muzzleSprite.material.clone(); // this is necessary since Mesh.clone() is not deep and SpriteMaterial.rotation is going to be changed\n\t\t\tmuzzleSprite.position.set(0, 0.05, 0.2);\n\t\t\tmuzzleSprite.scale.set(0.3, 0.3, 0.3);\n\t\t\tmuzzleSprite.updateMatrix();\n\t\t\tblasterMesh.add(muzzleSprite);\n\n\t\t\t// add positional audios\n\n\t\t\tconst shot = assetManager.cloneAudio(assetManager.audios.get('blaster_shot'));\n\t\t\tshot.setRolloffFactor(0.5);\n\t\t\tshot.setVolume(0.4);\n\t\t\tblasterMesh.add(shot);\n\t\t\tconst reload = assetManager.cloneAudio(assetManager.audios.get('reload'));\n\t\t\treload.setVolume(0.1);\n\t\t\tblasterMesh.add(reload);\n\n\t\t\t// store this configuration\n\n\t\t\tthis.renderComponents.blaster.mesh = blasterMesh;\n\t\t\tthis.renderComponents.blaster.audios.set('shot', shot);\n\t\t\tthis.renderComponents.blaster.audios.set('reload', reload);\n\t\t\tthis.renderComponents.blaster.muzzle = muzzleSprite;\n\n\t\t\t// Hide for player (RIFT handles rendering)\n\t\t\tif (this.owner.isPlayer) {\n\t\t\t\tblasterMesh.visible = false;\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the render components for the shotgun.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initShotgunRenderComponent() {\n\n\t\t\tconst assetManager = this.owner.world.assetManager;\n\n\t\t\t// setup copy of shotgun mesh\n\n\t\t\tlet shotgunMesh;\n\n\t\t\tif (this.owner.isPlayer === false) {\n\n\t\t\t\t// pick the low resolution model for the enemies\n\n\t\t\t\tshotgunMesh = assetManager.models.get('shotgun_low').clone();\n\n\t\t\t\tshotgunMesh.scale.set(100, 100, 100);\n\t\t\t\tshotgunMesh.rotation.set(Math.PI * 0.5, Math.PI * 1.05, 0);\n\t\t\t\tshotgunMesh.position.set(- 5, 30, 2);\n\t\t\t\tshotgunMesh.updateMatrix();\n\n\t\t\t\t// add the mesh to the right hand of the enemy\n\n\t\t\t\tconst rightHand = this.owner._renderComponent.getObjectByName('Armature_mixamorigRightHand');\n\t\t\t\trightHand.add(shotgunMesh);\n\n\t\t\t} else {\n\n\t\t\t\tshotgunMesh = assetManager.models.get('shotgun_high');\n\n\t\t\t\tthis.owner.world.scene.add(shotgunMesh);\n\n\t\t\t}\n\n\t\t\t// add muzzle sprite\n\n\t\t\tconst muzzleSprite = assetManager.models.get('muzzle').clone();\n\t\t\tmuzzleSprite.material = muzzleSprite.material.clone();\n\t\t\tmuzzleSprite.position.set(0, 0.05, 0.3);\n\t\t\tmuzzleSprite.scale.set(0.4, 0.4, 0.4);\n\t\t\tmuzzleSprite.updateMatrix();\n\t\t\tshotgunMesh.add(muzzleSprite);\n\n\t\t\t// add positional audios\n\n\t\t\tconst shot = assetManager.cloneAudio(assetManager.audios.get('shotgun_shot'));\n\t\t\tshot.setRolloffFactor(0.5);\n\t\t\tshot.setVolume(0.4);\n\t\t\tshotgunMesh.add(shot);\n\t\t\tconst reload = assetManager.cloneAudio(assetManager.audios.get('reload'));\n\t\t\treload.setVolume(0.1);\n\t\t\tshotgunMesh.add(reload);\n\t\t\tconst shotReload = assetManager.cloneAudio(assetManager.audios.get('shotgun_shot_reload'));\n\t\t\tshotReload.setVolume(0.1);\n\t\t\tshotgunMesh.add(shotReload);\n\n\t\t\t// store this configuration\n\n\t\t\tthis.renderComponents.shotgun.mesh = shotgunMesh;\n\t\t\tthis.renderComponents.shotgun.audios.set('shot', shot);\n\t\t\tthis.renderComponents.shotgun.audios.set('reload', reload);\n\t\t\tthis.renderComponents.shotgun.audios.set('shot_reload', shotReload);\n\t\t\tthis.renderComponents.shotgun.muzzle = muzzleSprite;\n\n\t\t\t// Hide for player (RIFT handles rendering)\n\t\t\tif (this.owner.isPlayer) {\n\t\t\t\tshotgunMesh.visible = false;\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the render components for the assault rifle.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initAssaultRifleRenderComponent() {\n\n\t\t\tconst assetManager = this.owner.world.assetManager;\n\n\t\t\t// setup copy of assault rifle mesh\n\n\t\t\tlet assaultRifleMesh;\n\n\t\t\tif (this.owner.isPlayer === false) {\n\n\t\t\t\t// pick the low resolution model for the enemies\n\n\t\t\t\tassaultRifleMesh = assetManager.models.get('assaultRifle_low').clone();\n\n\t\t\t\tassaultRifleMesh.scale.set(100, 100, 100);\n\t\t\t\tassaultRifleMesh.rotation.set(Math.PI * 0.5, Math.PI * 1, 0);\n\t\t\t\tassaultRifleMesh.position.set(- 5, 20, 7);\n\t\t\t\tassaultRifleMesh.updateMatrix();\n\n\t\t\t\t// add the mesh to the right hand of the enemy\n\n\t\t\t\tconst rightHand = this.owner._renderComponent.getObjectByName('Armature_mixamorigRightHand');\n\t\t\t\trightHand.add(assaultRifleMesh);\n\n\t\t\t} else {\n\n\t\t\t\tassaultRifleMesh = assetManager.models.get('assaultRifle_high');\n\n\t\t\t\tthis.owner.world.scene.add(assaultRifleMesh);\n\n\t\t\t}\n\n\t\t\t// add muzzle sprite\n\n\t\t\tconst muzzleSprite = assetManager.models.get('muzzle').clone();\n\t\t\tmuzzleSprite.material = muzzleSprite.material.clone();\n\t\t\tmuzzleSprite.position.set(0, 0, 0.5);\n\t\t\tmuzzleSprite.scale.set(0.4, 0.4, 0.4);\n\t\t\tmuzzleSprite.updateMatrix();\n\t\t\tassaultRifleMesh.add(muzzleSprite);\n\n\t\t\t// add positional audios\n\n\t\t\tconst shot = assetManager.cloneAudio(assetManager.audios.get('assault_rifle_shot'));\n\t\t\tshot.setRolloffFactor(0.5);\n\t\t\tshot.setVolume(0.8);\n\t\t\tassaultRifleMesh.add(shot);\n\t\t\tconst reload = assetManager.cloneAudio(assetManager.audios.get('reload'));\n\t\t\treload.setVolume(0.1);\n\t\t\tassaultRifleMesh.add(reload);\n\n\t\t\t// store this configuration\n\n\t\t\tthis.renderComponents.assaultRifle.mesh = assaultRifleMesh;\n\t\t\tthis.renderComponents.assaultRifle.audios.set('shot', shot);\n\t\t\tthis.renderComponents.assaultRifle.audios.set('reload', reload);\n\t\t\tthis.renderComponents.assaultRifle.muzzle = muzzleSprite;\n\n\t\t\t// Hide for player (RIFT handles rendering)\n\t\t\tif (this.owner.isPlayer) {\n\t\t\t\tassaultRifleMesh.visible = false;\n\t\t\t}\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the fuzzy modules for all weapons.\n\t\t*\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initFuzzyModules() {\n\n\t\t\tthis.fuzzyModules.assaultRifle = new FuzzyModule();\n\t\t\tthis.fuzzyModules.blaster = new FuzzyModule();\n\t\t\tthis.fuzzyModules.shotGun = new FuzzyModule();\n\n\t\t\tconst fuzzyModuleAssaultRifle = this.fuzzyModules.assaultRifle;\n\t\t\tconst fuzzyModuleBlaster = this.fuzzyModules.blaster;\n\t\t\tconst fuzzyModuleShotGun = this.fuzzyModules.shotGun;\n\n\t\t\t// the following FLVs are equal for all modules\n\n\t\t\t// FLV distance to target\n\n\t\t\tconst distanceToTarget = new FuzzyVariable();\n\n\t\t\tconst targetClose = new LeftShoulderFuzzySet(0, 10, 20);\n\t\t\tconst targetMedium = new TriangularFuzzySet(10, 20, 40);\n\t\t\tconst targetFar = new RightShoulderFuzzySet(20, 40, 1000);\n\n\t\t\tdistanceToTarget.add(targetClose);\n\t\t\tdistanceToTarget.add(targetMedium);\n\t\t\tdistanceToTarget.add(targetFar);\n\n\t\t\t// FLV desirability\n\n\t\t\tconst desirability = new FuzzyVariable();\n\n\t\t\tconst undesirable = new LeftShoulderFuzzySet(0, 25, 50);\n\t\t\tconst desirable = new TriangularFuzzySet(25, 50, 75);\n\t\t\tconst veryDesirable = new RightShoulderFuzzySet(50, 75, 100);\n\n\t\t\tdesirability.add(undesirable);\n\t\t\tdesirability.add(desirable);\n\t\t\tdesirability.add(veryDesirable);\n\n\t\t\t//\n\n\t\t\tfuzzyModuleAssaultRifle.addFLV('desirability', desirability);\n\t\t\tfuzzyModuleAssaultRifle.addFLV('distanceToTarget', distanceToTarget);\n\n\t\t\tfuzzyModuleBlaster.addFLV('desirability', desirability);\n\t\t\tfuzzyModuleBlaster.addFLV('distanceToTarget', distanceToTarget);\n\n\t\t\tfuzzyModuleShotGun.addFLV('desirability', desirability);\n\t\t\tfuzzyModuleShotGun.addFLV('distanceToTarget', distanceToTarget);\n\n\t\t\t//\n\n\t\t\tconst fuzzySets = {\n\t\t\t\ttargetClose: targetClose,\n\t\t\t\ttargetMedium: targetMedium,\n\t\t\t\ttargetFar: targetFar,\n\t\t\t\tundesirable: undesirable,\n\t\t\t\tdesirable: desirable,\n\t\t\t\tveryDesirable: veryDesirable\n\t\t\t};\n\n\t\t\tthis._initAssaultRifleFuzzyModule(fuzzySets);\n\t\t\tthis._initBlasterFuzzyModule(fuzzySets);\n\t\t\tthis._initShotgunFuzzyModule(fuzzySets);\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the fuzzy module for the blaster.\n\t\t*\n\t\t* @param {Object} fuzzySets - An object with predefined fuzzy sets.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initBlasterFuzzyModule(fuzzySets: any): this {\n\n\t\t\t// FLV ammo status\n\n\t\t\tconst fuzzyModuleBlaster = this.fuzzyModules.blaster;\n\t\t\tconst ammoStatusBlaster = new FuzzyVariable();\n\n\t\t\tconst lowBlaster = new LeftShoulderFuzzySet(0, 8, 15);\n\t\t\tconst okayBlaster = new TriangularFuzzySet(8, 20, 30);\n\t\t\tconst LoadsBlaster = new RightShoulderFuzzySet(20, 30, 48);\n\n\t\t\tammoStatusBlaster.add(lowBlaster);\n\t\t\tammoStatusBlaster.add(okayBlaster);\n\t\t\tammoStatusBlaster.add(LoadsBlaster);\n\n\t\t\tfuzzyModuleBlaster.addFLV('ammoStatus', ammoStatusBlaster);\n\n\t\t\t// rules\n\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, lowBlaster), fuzzySets.undesirable));\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, okayBlaster), fuzzySets.desirable));\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, LoadsBlaster), fuzzySets.desirable));\n\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, lowBlaster), fuzzySets.desirable));\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, okayBlaster), fuzzySets.desirable));\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, LoadsBlaster), fuzzySets.desirable));\n\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, lowBlaster), fuzzySets.desirable));\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, okayBlaster), fuzzySets.desirable));\n\t\t\tfuzzyModuleBlaster.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, LoadsBlaster), fuzzySets.desirable));\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the fuzzy module for the shotgun.\n\t\t*\n\t\t* @param {Object} fuzzySets - An object with predefined fuzzy sets.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initShotgunFuzzyModule(fuzzySets: any): this {\n\n\t\t\t// FLV ammo status\n\n\t\t\tconst fuzzyModuleShotGun = this.fuzzyModules.shotGun;\n\t\t\tconst ammoStatusShotgun = new FuzzyVariable();\n\n\t\t\tconst lowShot = new LeftShoulderFuzzySet(0, 2, 4);\n\t\t\tconst okayShot = new TriangularFuzzySet(2, 7, 10);\n\t\t\tconst LoadsShot = new RightShoulderFuzzySet(7, 10, 12);\n\n\t\t\tammoStatusShotgun.add(lowShot);\n\t\t\tammoStatusShotgun.add(okayShot);\n\t\t\tammoStatusShotgun.add(LoadsShot);\n\n\t\t\tfuzzyModuleShotGun.addFLV('ammoStatus', ammoStatusShotgun);\n\n\t\t\t// rules\n\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, lowShot), fuzzySets.desirable));\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, okayShot), fuzzySets.veryDesirable));\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, LoadsShot), fuzzySets.veryDesirable));\n\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, lowShot), fuzzySets.undesirable));\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, okayShot), fuzzySets.undesirable));\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, LoadsShot), fuzzySets.desirable));\n\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, lowShot), fuzzySets.undesirable));\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, okayShot), fuzzySets.undesirable));\n\t\t\tfuzzyModuleShotGun.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, LoadsShot), fuzzySets.undesirable));\n\n\t\t\treturn this;\n\n\t\t}\n\n\t\t/**\n\t\t* Inits the fuzzy module for the assault rifle.\n\t\t*\n\t\t* @param {Object} fuzzySets - An object with predefined fuzzy sets.\n\t\t* @return {WeaponSystem} A reference to this weapon system.\n\t\t*/\n_initAssaultRifleFuzzyModule(fuzzySets: any): this {\n\n\t\t\t// FLV ammo status\n\n\t\t\tconst fuzzyModuleAssaultRifle = this.fuzzyModules.assaultRifle;\n\t\t\tconst ammoStatusAssaultRifle = new FuzzyVariable();\n\n\t\t\tconst lowAssault = new LeftShoulderFuzzySet(0, 2, 8);\n\t\t\tconst okayAssault = new TriangularFuzzySet(2, 10, 20);\n\t\t\tconst LoadsAssault = new RightShoulderFuzzySet(10, 20, 30);\n\n\t\t\tammoStatusAssaultRifle.add(lowAssault);\n\t\t\tammoStatusAssaultRifle.add(okayAssault);\n\t\t\tammoStatusAssaultRifle.add(LoadsAssault);\n\n\t\t\tfuzzyModuleAssaultRifle.addFLV('ammoStatus', ammoStatusAssaultRifle);\n\n\t\t\t// rules\n\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, lowAssault), fuzzySets.undesirable));\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, okayAssault), fuzzySets.desirable));\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetClose, LoadsAssault), fuzzySets.desirable));\n\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, lowAssault), fuzzySets.desirable));\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, okayAssault), fuzzySets.veryDesirable));\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, LoadsAssault), fuzzySets.veryDesirable));\n\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetMedium, lowAssault), fuzzySets.desirable));\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, okayAssault), fuzzySets.veryDesirable));\n\t\t\tfuzzyModuleAssaultRifle.addRule(new FuzzyRule(new FuzzyAND(fuzzySets.targetFar, LoadsAssault), fuzzySets.veryDesirable));\n\n\t\t\treturn this;\n\n\t}\n\n}\n\nfunction sync(entity: any, renderComponent: any) {\n\n\trenderComponent.matrix.copy(entity.worldMatrix);\n\n}\n\nexport { WeaponSystem };\n","const visibleRecords = new Array();\r\nconst invisibleRecords = new Array();\r\n\r\n/**\r\n* Class to select a target from the opponents currently in a bot's perceptive memory.\r\n*\r\n*/\r\nclass TargetSystem {\r\n\r\n\tpublic owner: any;\r\n\tpublic _currentRecord: any;\r\n\r\n\t/**\r\n\t* Constructs a new target system with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this weapon system.\r\n\t*/\r\n\tconstructor(owner: any) {\r\n\r\n\t\tthis.owner = owner; // enemy\r\n\r\n\t\tthis._currentRecord = null; // represents the memory record of the current target\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates the target system internal state.\r\n\t*\r\n\t* @return {TargetSystem} A reference to this target system.\r\n\t*/\r\n\tupdate() {\r\n\r\n\t\tconst records = this.owner.memoryRecords;\r\n\r\n\t\t// reset\r\n\r\n\t\tthis._currentRecord = null;\r\n\r\n\t\tvisibleRecords.length = 0;\r\n\t\tinvisibleRecords.length = 0;\r\n\r\n\t\t// sort records according to their visibility\r\n\r\n\t\tfor (let i = 0, l = records.length; i < l; i++) {\r\n\r\n\t\t\tconst record = records[i];\r\n\r\n\t\t\tif (record.visible) {\r\n\r\n\t\t\t\tvisibleRecords.push(record);\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tinvisibleRecords.push(record);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\t// record selection\r\n\r\n\t\tif (visibleRecords.length > 0) {\r\n\r\n\t\t\t// if there are visible records, select the closest one\r\n\r\n\t\t\tlet minDistance = Infinity;\r\n\r\n\t\t\tfor (let i = 0, l = visibleRecords.length; i < l; i++) {\r\n\r\n\t\t\t\tconst record = visibleRecords[i];\r\n\r\n\t\t\t\tconst distance = this.owner.position.squaredDistanceTo(record.lastSensedPosition);\r\n\r\n\t\t\t\tif (distance < minDistance) {\r\n\r\n\t\t\t\t\tminDistance = distance;\r\n\t\t\t\t\tthis._currentRecord = record;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t} else if (invisibleRecords.length > 0) {\r\n\r\n\t\t\t// if there are invisible records, select the one that was last sensed\r\n\r\n\t\t\tlet maxTimeLastSensed = - Infinity;\r\n\r\n\t\t\tfor (let i = 0, l = invisibleRecords.length; i < l; i++) {\r\n\r\n\t\t\t\tconst record = invisibleRecords[i];\r\n\r\n\t\t\t\tif (record.timeLastSensed > maxTimeLastSensed) {\r\n\r\n\t\t\t\t\tmaxTimeLastSensed = record.timeLastSensed;\r\n\t\t\t\t\tthis._currentRecord = record;\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Resets the internal data structures.\r\n\t*\r\n\t* @return {TargetSystem} A reference to this target system.\r\n\t*/\r\n\treset() {\r\n\r\n\t\tthis._currentRecord = null;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Checks if the target is shootable/visible or not\r\n\t*\r\n\t* @return {Boolean} Whether the target is shootable/visible or not.\r\n\t*/\r\n\tisTargetShootable() {\r\n\r\n\t\treturn (this._currentRecord !== null) ? this._currentRecord.visible : false;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the last sensed position of the target, or null if there is no target.\r\n\t*\r\n\t* @return {Vector3} The last sensed position of the target.\r\n\t*/\r\n\tgetLastSensedPosition() {\r\n\r\n\t\treturn (this._currentRecord !== null) ? this._currentRecord.lastSensedPosition : null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the time when the target was last sensed or -1 if there is none.\r\n\t*\r\n\t* @return {Number} The time when the target was last sensed.\r\n\t*/\r\n\tgetTimeLastSensed() {\r\n\r\n\t\treturn (this._currentRecord !== null) ? this._currentRecord.timeLastSensed : - 1;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the time when the target became visible or -1 if there is none.\r\n\t*\r\n\t* @return {Number} The time when the target became visible.\r\n\t*/\r\n\tgetTimeBecameVisible() {\r\n\r\n\t\treturn (this._currentRecord !== null) ? this._currentRecord.timeBecameVisible : - 1;\r\n\r\n\t}\r\n\r\n\t/** Returns the current target if there is one.\r\n\t*\r\n\t* @returns {Enemy} Returns the current target if there is one, else null.\r\n\t*/\r\n\tgetTarget() {\r\n\r\n\t\treturn (this._currentRecord !== null) ? this._currentRecord.entity : null;\r\n\r\n\t}\r\n\r\n\t/** Returns true if the enemy has an active target.\r\n\t*\r\n\t* @returns {Boolean} Whether the enemy has an active target or not.\r\n\t*/\r\n\thasTarget() {\r\n\r\n\t\treturn this._currentRecord !== null;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { TargetSystem };\r\n","import { CompositeGoal, Vector3, Goal, Regulator } from 'yuka';\r\nimport { FindPathGoal } from './FindPathGoal';\r\nimport { FollowPathGoal } from './FollowPathGoal';\r\nimport { CONFIG } from '../core/Config';\r\n\r\nconst result = { distance: Infinity, item: null };\r\n\r\n/**\r\n* Goal to get an item of the given item type.\r\n*/\r\nclass GetItemGoal extends CompositeGoal<any> {\r\n\r\n\tpublic itemType: any;\r\n\tpublic item: any;\r\n\tpublic regulator: Regulator;\r\n\r\n\t/**\r\n\t* Constructs a new GetItemGoal with the given values.\r\n\t*\r\n\t* @param owner - The owner of this goal.\r\n\t* @param itemType - The type of the item.\r\n\t* @param item - The exact item to get.\r\n\t*/\r\n\tconstructor(owner: any, itemType: any, item: any = null) {\r\n\r\n\t\tsuper(owner);\r\n\r\n\t\tthis.itemType = itemType;\r\n\t\tthis.item = item;\r\n\r\n\t\tthis.regulator = new Regulator(CONFIG.BOT.GOAL.ITEM_VISIBILITY_UPDATE_FREQUENCY);\r\n\r\n\t}\r\n\r\n\tactivate() {\r\n\r\n\t\tconst owner = this.owner;\r\n\r\n\t\t// if this goal is reactivated then there may be some existing subgoals that must be removed\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t\t// get closest available item of the given type\r\n\r\n\t\towner.world.getClosestItem(owner, this.itemType, result);\r\n\r\n\t\tthis.item = (result as any).item;\r\n\r\n\t\tif (this.item) {\r\n\r\n\t\t\t// if an item was found, try to pick it up\r\n\r\n\t\t\tconst from = new Vector3().copy(owner.position);\r\n\t\t\tconst to = new Vector3().copy(this.item.position);\r\n\r\n\t\t\t// setup subgoals\r\n\r\n\t\t\tthis.addSubgoal(new FindPathGoal(owner, from, to));\r\n\t\t\tthis.addSubgoal(new FollowPathGoal(owner));\r\n\r\n\t\t} else {\r\n\r\n\t\t\t// if no item was returned, there is nothing to pick up.\r\n\t\t\t// mark the goal as failed\r\n\r\n\t\t\tthis.status = Goal.STATUS.FAILED;\r\n\r\n\t\t\t// ensure the bot does not look for this type of item for a while\r\n\r\n\t\t\towner.ignoreItem(this.itemType);\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\texecute() {\r\n\r\n\t\tif (this.active()) {\r\n\r\n\t\t\t// only check the availability of the item if it is visible for the enemy\r\n\r\n\t\t\tif (this.regulator.ready() && this.owner.vision.visible(this.item.position)) {\r\n\r\n\t\t\t\t// if it was picked up by somebody else, mark the goal as failed\r\n\r\n\t\t\t\tif (this.item.active === false) {\r\n\r\n\t\t\t\t\tthis.status = Goal.STATUS.FAILED;\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tthis.status = this.executeSubgoals();\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t} else {\r\n\r\n\t\t\t\tthis.status = this.executeSubgoals();\r\n\r\n\t\t\t}\r\n\r\n\t\t\t// replan the goal means the bot tries to find another item of the same type\r\n\r\n\t\t\tthis.replanIfFailed();\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n\tterminate() {\r\n\r\n\t\tthis.clearSubgoals();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { GetItemGoal };\r\n","import { GoalEvaluator, MathUtils } from 'yuka';\r\nimport { Feature } from '../core/Feature';\r\nimport { GetItemGoal } from '../goals/GetItemGoal';\r\nimport { Enemy } from '../entities/Enemy';\r\nimport { HEALTH_PACK } from '../core/Constants';\r\n\r\n/**\r\n* Class for representing the get-health goal evaluator. Can be used to compute a score that\r\n* represents the desirability of the respective top-level goal.\r\n*/\r\nclass GetHealthEvaluator extends GoalEvaluator<Enemy> {\r\n\r\n\tpublic itemType: number;\r\n\tpublic tweaker: number;\r\n\r\n\t/**\r\n\t* Constructs a new get health goal evaluator.\r\n\t*\r\n\t* @param {Number} characterBias - Can be used to adjust the preferences of the enemy.\r\n\t* @param {Number} itemType - The item type.\r\n\t*/\r\n\tconstructor(characterBias = 1, itemType = HEALTH_PACK) {\r\n\r\n\t\tsuper(characterBias);\r\n\r\n\t\tthis.itemType = itemType;\r\n\t\tthis.tweaker = 0.2; // value used to tweak the desirability\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Calculates the desirability. It's a score between 0 and 1 representing the desirability\r\n\t* of a goal.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t* @return {Number} The desirability.\r\n\t*/\r\n\tcalculateDesirability(owner: Enemy) {\r\n\r\n\t\tlet desirability = 0;\r\n\r\n\t\tif (owner.isItemIgnored(this.itemType) === false && owner.health < owner.maxHealth) {\r\n\r\n\t\t\tconst distanceScore = Feature.distanceToItem(owner, this.itemType);\r\n\t\t\tconst healthScore = Feature.health(owner);\r\n\r\n\t\t\tdesirability = this.tweaker * (1 - healthScore) / distanceScore;\r\n\r\n\t\t\tdesirability = MathUtils.clamp(desirability, 0, 1);\r\n\r\n\t\t}\r\n\r\n\t\treturn desirability;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Executed if this goal evaluator produces the highest desirability.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t*/\r\n\tsetGoal(owner: Enemy) {\r\n\r\n\t\tconst currentSubgoal = owner.brain.currentSubgoal();\r\n\r\n\t\tif ((currentSubgoal instanceof GetItemGoal) === false) {\r\n\r\n\t\t\towner.brain.clearSubgoals();\r\n\r\n\t\t\towner.brain.addSubgoal(new GetItemGoal(owner, this.itemType));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { GetHealthEvaluator };\r\n","import { GoalEvaluator, MathUtils } from 'yuka';\r\nimport { Feature } from '../core/Feature';\r\nimport { GetItemGoal } from '../goals/GetItemGoal';\r\nimport { Enemy } from '../entities/Enemy';\r\nimport { WEAPON_TYPES_SHOTGUN } from '../core/Constants';\r\n\r\n/**\r\n* Class for representing the get-weapon goal evaluator. Can be used to compute a score that\r\n* represents the desirability of the respective top-level goal.\r\n*/\r\nclass GetWeaponEvaluator extends GoalEvaluator<Enemy> {\r\n\r\n\tpublic itemType: number;\r\n\tpublic tweaker: number;\r\n\r\n\t/**\r\n\t* Constructs a new get weapon goal evaluator.\r\n\t*\r\n\t* @param {Number} characterBias - Can be used to adjust the preferences of the enemy.\r\n\t* @param {Number} itemType - The item type.\r\n\t*/\r\n\tconstructor(characterBias = 1, itemType = WEAPON_TYPES_SHOTGUN) {\r\n\r\n\t\tsuper(characterBias);\r\n\r\n\t\tthis.itemType = itemType;\r\n\t\tthis.tweaker = 0.15; // value used to tweak the desirability\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Calculates the desirability. It's a score between 0 and 1 representing the desirability\r\n\t* of a goal.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t* @return {Number} The desirability.\r\n\t*/\r\n\tcalculateDesirability(owner: Enemy) {\r\n\r\n\t\tlet desirability = 0;\r\n\r\n\t\tif (owner.isItemIgnored(this.itemType) === false) {\r\n\r\n\t\t\tconst distanceScore = Feature.distanceToItem(owner, this.itemType);\r\n\t\t\tconst weaponScore = Feature.individualWeaponStrength(owner, this.itemType);\r\n\t\t\tconst healthScore = Feature.health(owner);\r\n\r\n\t\t\tdesirability = this.tweaker * (1 - weaponScore) * healthScore / distanceScore;\r\n\r\n\t\t\tdesirability = MathUtils.clamp(desirability, 0, 1);\r\n\r\n\t\t}\r\n\r\n\t\treturn desirability;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Executed if this goal evaluator produces the highest desirability.\r\n\t*\r\n\t* @param {Enemy} owner - The owner of this goal evaluator.\r\n\t*/\r\n\tsetGoal(owner: Enemy) {\r\n\r\n\t\tconst currentSubgoal = owner.brain.currentSubgoal();\r\n\r\n\t\tif ((currentSubgoal instanceof GetItemGoal) === false) {\r\n\r\n\t\t\towner.brain.clearSubgoals();\r\n\r\n\t\t\towner.brain.addSubgoal(new GetItemGoal(owner, this.itemType));\r\n\r\n\t\t}\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { GetWeaponEvaluator };\r\n","// RIFT Integration - Weapon Types\r\n\r\nexport enum WeaponType {\r\n  AK47 = 'AK47',\r\n  AWP = 'AWP',\r\n  LMG = 'LMG',\r\n  M4 = 'M4',\r\n  Pistol = 'Pistol',\r\n  Scar = 'Scar',\r\n  Shotgun = 'Shotgun',\r\n  Sniper = 'Sniper',\r\n  Tec9 = 'Tec9',\r\n}\r\n\r\nexport interface RecoilConfig {\r\n  pitchAmount: number;\r\n  pitchRandom: number;\r\n  yawAmount: number;\r\n  yawRandom: number;\r\n  recoveryRate: number;\r\n  kickZ: number;\r\n  kickRotX: number;\r\n}\r\n\r\nexport interface SpreadConfig {\r\n  base: number;\r\n  max: number;\r\n  increasePerShot: number;\r\n  recoveryRate: number;\r\n}\r\n\r\nexport interface MuzzleConfig {\r\n  lightColor: number;\r\n  lightRange: number;\r\n  flashScale: { min: number; max: number };\r\n  flashDuration: number;\r\n  lightIntensity: number;\r\n  smokeParticles: number;\r\n  smokeSpeed: number;\r\n  position: { x: number; y: number; z: number };\r\n}\r\n\r\nexport interface SprayPatternConfig {\r\n  enabled: boolean;\r\n  resetTime: number;\r\n  scale: number;\r\n  vertical: number[];\r\n  horizontal: number[];\r\n}\r\n\r\nexport interface ScreenEffectsConfig {\r\n  maxFovPunch: number;\r\n  fovPunch: number;\r\n  shakeIntensity: number;\r\n  maxChroma: number;\r\n  chromaIntensity: number;\r\n  shakeDecay: number;\r\n  fovPunchRecovery: number;\r\n  chromaDecay: number;\r\n}\r\n\r\nexport interface AnimationConfig {\r\n  swayAmount: number;\r\n  swayRecovery: number;\r\n  sprintLerpSpeed: number;\r\n  reloadLerpSpeed: number;\r\n  baseX: number;\r\n  baseY: number;\r\n  baseZ: number;\r\n  bobInfluence: number;\r\n  sprintOffsetX: number;\r\n  sprintOffsetY: number;\r\n  reloadDipY: number;\r\n  reloadRotX: number;\r\n  sprintRotZ: number;\r\n}\r\n\r\nexport interface FalloffConfig {\r\n  startDistance: number;\r\n  endDistance: number;\r\n  minDamage: number;\r\n}\r\n\r\nexport interface WeaponAudioConfig {\r\n  fire: string;\r\n  reload: string;\r\n  tail?: string;\r\n  cock?: string;\r\n  load?: string;\r\n  zoom?: string;\r\n}\r\n\r\nexport interface SingleWeaponConfig {\r\n  name: string;\r\n  damage: number;\r\n  fireRate: number;\r\n  magSize: number;\r\n  reserveAmmo: number;\r\n  reloadTime: number;\r\n  automatic: boolean;\r\n  pelletCount?: number;\r\n  falloff?: FalloffConfig;\r\n  audio: WeaponAudioConfig;\r\n  recoil: RecoilConfig;\r\n  spread: SpreadConfig;\r\n  muzzle: MuzzleConfig;\r\n  sprayPattern: SprayPatternConfig;\r\n  screen: ScreenEffectsConfig;\r\n  animation: AnimationConfig;\r\n}\r\n\r\nexport type WeaponConfig = {\r\n  [key in WeaponType]: SingleWeaponConfig;\r\n};\r\n","// RIFT Integration - Weapon Configurations\r\n\r\nimport { WeaponType, WeaponConfig, SprayPatternConfig, ScreenEffectsConfig, AnimationConfig } from '../types/weapons';\r\n\r\nconst BASE_AUDIO_PATH = 'assets/audio/weapons/';\r\n\r\nconst DEFAULT_SPRAY_PATTERN: SprayPatternConfig = {\r\n  enabled: true,\r\n  resetTime: 300,\r\n  scale: 0.002,\r\n  vertical: [1, 2, 3, 4, 5, 6, 7, 8, 8, 8, 7, 6, 5],\r\n  horizontal: [0, 0, 1, -1, 2, -2, 3, -3, 2, -2, 1, -1],\r\n};\r\n\r\nconst DEFAULT_SCREEN: ScreenEffectsConfig = {\r\n  maxFovPunch: 5,\r\n  fovPunch: 0.5,\r\n  shakeIntensity: 0.1,\r\n  maxChroma: 0.02,\r\n  chromaIntensity: 0.005,\r\n  shakeDecay: 0.9,\r\n  fovPunchRecovery: 10,\r\n  chromaDecay: 0.8,\r\n};\r\n\r\nconst DEFAULT_ANIMATION: AnimationConfig = {\r\n  swayAmount: 0.05,\r\n  swayRecovery: 5,\r\n  sprintLerpSpeed: 10,\r\n  reloadLerpSpeed: 10,\r\n  baseX: 0.25,\r\n  baseY: -0.2,\r\n  baseZ: -0.5,\r\n  bobInfluence: 1,\r\n  sprintOffsetX: -0.1,\r\n  sprintOffsetY: -0.1,\r\n  reloadDipY: 0.15,\r\n  reloadRotX: 0.4,\r\n  sprintRotZ: 0.5,\r\n};\r\n\r\nexport const WEAPON_CONFIG: WeaponConfig = {\r\n  [WeaponType.AK47]: {\r\n    name: 'AK-47',\r\n    damage: 30,\r\n    fireRate: 10,\r\n    magSize: 30,\r\n    reserveAmmo: 90,\r\n    reloadTime: 2.0,\r\n    automatic: true,\r\n    falloff: {\r\n      startDistance: 20,\r\n      endDistance: 50,\r\n      minDamage: 15\r\n    },\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'AK47-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'LMG-Reload.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.05,\r\n      pitchRandom: 0.02,\r\n      yawAmount: 0.02,\r\n      yawRandom: 0.03,\r\n      recoveryRate: 5,\r\n      kickZ: 0.1,\r\n      kickRotX: 0.1,\r\n    },\r\n    spread: {\r\n      base: 0.0015,\r\n      max: 0.008,\r\n      increasePerShot: 0.0008,\r\n      recoveryRate: 3,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffaa00,\r\n      lightRange: 5,\r\n      flashScale: { min: 0.7, max: 1.2 },\r\n      flashDuration: 0.06,\r\n      lightIntensity: 2.5,\r\n      smokeParticles: 4,\r\n      smokeSpeed: 0.6,\r\n      position: { x: 0, y: 0.04, z: -0.8 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: DEFAULT_SCREEN,\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.AWP]: {\r\n    name: 'AWP',\r\n    damage: 100,\r\n    fireRate: 0.8,\r\n    magSize: 10,\r\n    reserveAmmo: 30,\r\n    reloadTime: 2.8,\r\n    automatic: false,\r\n    falloff: {\r\n      startDistance: 100,\r\n      endDistance: 200,\r\n      minDamage: 95\r\n    },\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'AWP-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'Sniper-Reload.mp3',\r\n      zoom: BASE_AUDIO_PATH + 'Sniper-Zoom.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.2,\r\n      pitchRandom: 0.05,\r\n      yawAmount: 0.05,\r\n      yawRandom: 0.05,\r\n      recoveryRate: 2,\r\n      kickZ: 0.3,\r\n      kickRotX: 0.3,\r\n    },\r\n    spread: {\r\n      base: 0.0005,\r\n      max: 0.006,\r\n      increasePerShot: 0.005,\r\n      recoveryRate: 1,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffcc00,\r\n      lightRange: 10,\r\n      flashScale: { min: 1.5, max: 2.5 },\r\n      flashDuration: 0.08,\r\n      lightIntensity: 4,\r\n      smokeParticles: 6,\r\n      smokeSpeed: 0.8,\r\n      position: { x: 0, y: 0.05, z: -1.3 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: { ...DEFAULT_SCREEN, fovPunch: 2, shakeIntensity: 0.3 },\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.LMG]: {\r\n    name: 'LMG',\r\n    damage: 25,\r\n    fireRate: 12,\r\n    magSize: 100,\r\n    reserveAmmo: 200,\r\n    reloadTime: 3.5,\r\n    automatic: true,\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'LMG-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'LMG-Reload.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.04,\r\n      pitchRandom: 0.03,\r\n      yawAmount: 0.03,\r\n      yawRandom: 0.04,\r\n      recoveryRate: 4,\r\n      kickZ: 0.15,\r\n      kickRotX: 0.15,\r\n    },\r\n    spread: {\r\n      base: 0.0025,\r\n      max: 0.012,\r\n      increasePerShot: 0.0004,\r\n      recoveryRate: 2,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffaa00,\r\n      lightRange: 6,\r\n      flashScale: { min: 0.8, max: 1.4 },\r\n      flashDuration: 0.07,\r\n      lightIntensity: 2.8,\r\n      smokeParticles: 5,\r\n      smokeSpeed: 0.7,\r\n      position: { x: 0, y: 0, z: -0.95 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: DEFAULT_SCREEN,\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.M4]: {\r\n    name: 'M4',\r\n    damage: 28,\r\n    fireRate: 11,\r\n    magSize: 30,\r\n    reserveAmmo: 90,\r\n    reloadTime: 1.8,\r\n    automatic: true,\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'M4-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'LMG-Reload.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.04,\r\n      pitchRandom: 0.01,\r\n      yawAmount: 0.01,\r\n      yawRandom: 0.02,\r\n      recoveryRate: 6,\r\n      kickZ: 0.08,\r\n      kickRotX: 0.08,\r\n    },\r\n    spread: {\r\n      base: 0.0012,\r\n      max: 0.007,\r\n      increasePerShot: 0.0007,\r\n      recoveryRate: 4,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffffaa,\r\n      lightRange: 4.5,\r\n      flashScale: { min: 0.6, max: 1.0 },\r\n      flashDuration: 0.05,\r\n      lightIntensity: 2.2,\r\n      smokeParticles: 3,\r\n      smokeSpeed: 0.5,\r\n      position: { x: 0, y: 0.02, z: -0.6 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: DEFAULT_SCREEN,\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.Pistol]: {\r\n    name: 'Pistol',\r\n    damage: 20,\r\n    fireRate: 6,\r\n    magSize: 12,\r\n    reserveAmmo: 48,\r\n    reloadTime: 1.2,\r\n    automatic: false,\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'Pistol-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'Pistol-Reload.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.08,\r\n      pitchRandom: 0.02,\r\n      yawAmount: 0.01,\r\n      yawRandom: 0.01,\r\n      recoveryRate: 8,\r\n      kickZ: 0.05,\r\n      kickRotX: 0.05,\r\n    },\r\n    spread: {\r\n      base: 0.001,\r\n      max: 0.005,\r\n      increasePerShot: 0.0015,\r\n      recoveryRate: 5,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffffcc,\r\n      lightRange: 3,\r\n      flashScale: { min: 0.3, max: 0.6 },\r\n      flashDuration: 0.04,\r\n      lightIntensity: 1.5,\r\n      smokeParticles: 2,\r\n      smokeSpeed: 0.4,\r\n      position: { x: 0, y: 0.05, z: -0.15 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: DEFAULT_SCREEN,\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.Scar]: {\r\n    name: 'SCAR',\r\n    damage: 35,\r\n    fireRate: 9,\r\n    magSize: 20,\r\n    reserveAmmo: 60,\r\n    reloadTime: 2.4,\r\n    automatic: true,\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'Scar-Fire-1.mp3',\r\n      reload: BASE_AUDIO_PATH + 'Scar-Reload.mp3',\r\n      tail: BASE_AUDIO_PATH + 'Scar-Tail-Fire.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.06,\r\n      pitchRandom: 0.02,\r\n      yawAmount: 0.02,\r\n      yawRandom: 0.02,\r\n      recoveryRate: 4,\r\n      kickZ: 0.12,\r\n      kickRotX: 0.12,\r\n    },\r\n    spread: {\r\n      base: 0.0018,\r\n      max: 0.009,\r\n      increasePerShot: 0.001,\r\n      recoveryRate: 3,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffbb00,\r\n      lightRange: 5.5,\r\n      flashScale: { min: 0.9, max: 1.5 },\r\n      flashDuration: 0.065,\r\n      lightIntensity: 2.7,\r\n      smokeParticles: 4,\r\n      smokeSpeed: 0.65,\r\n      position: { x: 0, y: 0.08, z: -0.5 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: DEFAULT_SCREEN,\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.Shotgun]: {\r\n    name: 'Shotgun',\r\n    damage: 15, // Per pellet - 8 pellets = 120 damage at close range\r\n    fireRate: 1.5,\r\n    magSize: 8,\r\n    reserveAmmo: 32,\r\n    reloadTime: 2.5,\r\n    automatic: false,\r\n    pelletCount: 8, // Fires 8 pellets in a spread pattern\r\n    falloff: {\r\n      startDistance: 5,\r\n      endDistance: 20,\r\n      minDamage: 3\r\n    },\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'Shotgun-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'Shotgun-Load.mp3',\r\n      cock: BASE_AUDIO_PATH + 'Shotgun-Cock.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.3,\r\n      pitchRandom: 0.1,\r\n      yawAmount: 0.1,\r\n      yawRandom: 0.1,\r\n      recoveryRate: 2,\r\n      kickZ: 0.4,\r\n      kickRotX: 0.4,\r\n    },\r\n    spread: {\r\n      base: 0.035, // Wide spread for shotgun pattern\r\n      max: 0.055,\r\n      increasePerShot: 0.012,\r\n      recoveryRate: 2,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffaa33,\r\n      lightRange: 7,\r\n      flashScale: { min: 1.2, max: 2.0 },\r\n      flashDuration: 0.075,\r\n      lightIntensity: 3.5,\r\n      smokeParticles: 7,\r\n      smokeSpeed: 0.9,\r\n      position: { x: 0, y: 0.02, z: -1.0 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: { ...DEFAULT_SCREEN, fovPunch: 1.5, shakeIntensity: 0.2 },\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.Sniper]: {\r\n    name: 'Sniper Rifle',\r\n    damage: 90,\r\n    fireRate: 1.0,\r\n    magSize: 5,\r\n    reserveAmmo: 20,\r\n    reloadTime: 2.8,\r\n    automatic: false,\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'Sniper-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'Sniper-Reload.mp3',\r\n      load: BASE_AUDIO_PATH + 'Sniper-Load.mp3',\r\n      zoom: BASE_AUDIO_PATH + 'Sniper-Zoom.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.25,\r\n      pitchRandom: 0.05,\r\n      yawAmount: 0.05,\r\n      yawRandom: 0.05,\r\n      recoveryRate: 2,\r\n      kickZ: 0.35,\r\n      kickRotX: 0.35,\r\n    },\r\n    spread: {\r\n      base: 0.0003,\r\n      max: 0.005,\r\n      increasePerShot: 0.004,\r\n      recoveryRate: 1,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffffdd,\r\n      lightRange: 8,\r\n      flashScale: { min: 1.3, max: 2.2 },\r\n      flashDuration: 0.08,\r\n      lightIntensity: 3.8,\r\n      smokeParticles: 5,\r\n      smokeSpeed: 0.75,\r\n      position: { x: 0, y: 0.05, z: -1.25 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: { ...DEFAULT_SCREEN, fovPunch: 2, shakeIntensity: 0.3 },\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n\r\n  [WeaponType.Tec9]: {\r\n    name: 'Tec-9',\r\n    damage: 22,\r\n    fireRate: 14,\r\n    magSize: 24,\r\n    reserveAmmo: 72,\r\n    reloadTime: 1.6,\r\n    automatic: true,\r\n    audio: {\r\n      fire: BASE_AUDIO_PATH + 'Tec-9-Fire.mp3',\r\n      reload: BASE_AUDIO_PATH + 'Tec-9-Reload.mp3',\r\n      load: BASE_AUDIO_PATH + 'Tec-9-Load.mp3',\r\n      tail: BASE_AUDIO_PATH + 'Tec-9-Tail-Fire.mp3',\r\n    },\r\n    recoil: {\r\n      pitchAmount: 0.06,\r\n      pitchRandom: 0.03,\r\n      yawAmount: 0.04,\r\n      yawRandom: 0.04,\r\n      recoveryRate: 6,\r\n      kickZ: 0.07,\r\n      kickRotX: 0.07,\r\n    },\r\n    spread: {\r\n      base: 0.003,\r\n      max: 0.011,\r\n      increasePerShot: 0.0006,\r\n      recoveryRate: 4,\r\n    },\r\n    muzzle: {\r\n      lightColor: 0xffdd88,\r\n      lightRange: 4,\r\n      flashScale: { min: 0.5, max: 0.9 },\r\n      flashDuration: 0.045,\r\n      lightIntensity: 2.0,\r\n      smokeParticles: 3,\r\n      smokeSpeed: 0.55,\r\n      position: { x: 0, y: 0.05, z: -0.35 },\r\n    },\r\n    sprayPattern: DEFAULT_SPRAY_PATTERN,\r\n    screen: DEFAULT_SCREEN,\r\n    animation: DEFAULT_ANIMATION,\r\n  },\r\n};\r\n","import * as THREE from 'three';\r\nimport { WEAPON_CONFIG } from '../config/weaponConfigs';\r\nimport { SingleWeaponConfig, WeaponType } from '../types/weapons';\r\nimport { AssetManager } from '../core/AssetManager';\r\nimport { AudioManager } from '../managers/AudioManager';\r\n\r\ninterface WeaponState {\r\n  currentMag: number;\r\n  reserveAmmo: number;\r\n  lastShotTime: number;\r\n  isReloading: boolean;\r\n  reloadStartTime: number;\r\n}\r\n\r\nexport class WeaponSystem {\r\n  private camera: THREE.Camera;\r\n  private audioManager: AudioManager;\r\n  private weaponMesh!: THREE.Object3D;\r\n\r\n  // Muzzle flash effects (persistent)\r\n  private muzzleFlash!: THREE.Sprite;\r\n  private muzzleFlash2!: THREE.Sprite;\r\n  private muzzleLight!: THREE.PointLight;\r\n  private muzzleFlashTimer: number = 0;\r\n  private muzzleFlashDuration: number = 0.05;\r\n\r\n  // State\r\n  public currentWeapon: WeaponType = WeaponType.AK47;\r\n  private weaponStates: Map<WeaponType, WeaponState> = new Map();\r\n  public isZoomed: boolean = false;\r\n\r\n  // Recoil & Spread\r\n  private currentRecoil: { x: number; y: number } = { x: 0, y: 0 };\r\n  private targetRecoil: { x: number; y: number } = { x: 0, y: 0 };\r\n  private currentSpread: number = 0;\r\n\r\n  // Weapon Animation\r\n  private weaponSwayX: number = 0;\r\n  private weaponSwayY: number = 0;\r\n  private weaponKickZ: number = 0;\r\n  private weaponKickRotX: number = 0;\r\n  private sprintBlend: number = 0;\r\n  private reloadBlend: number = 0;\r\n  private zoomBlend: number = 0; // 0 = hip fire, 1 = fully zoomed\r\n\r\n  // Weapon model (placeholder position for now)\r\n  // private weaponOffset: THREE.Vector3 = new THREE.Vector3(0.2, -0.2, -0.5);\r\n\r\n  // Callbacks\r\n  private shellEjectCallback?: (pos: THREE.Vector3, dir: THREE.Vector3) => void;\r\n  private zoomCallback?: (isZoomed: boolean) => void;\r\n\r\n  // Third-person mode for AI enemies\r\n  private isThirdPerson: boolean = false;\r\n  private thirdPersonParent: THREE.Object3D | null = null;\r\n\r\n  constructor(_scene: THREE.Scene, camera: THREE.Camera, _assetManager: AssetManager, audioManager: AudioManager) {\r\n    this.camera = camera;\r\n    this.audioManager = audioManager;\r\n\r\n    this.initializeWeaponStates();\r\n    this.loadAllAudio();\r\n\r\n    // Initialize muzzle flash effects\r\n    this.initializeMuzzleFlash();\r\n\r\n    // Initialize weapon model\r\n    this.resetWeaponState();\r\n  }\r\n\r\n  public setShellEjectCallback(callback: (pos: THREE.Vector3, dir: THREE.Vector3) => void): void {\r\n    this.shellEjectCallback = callback;\r\n  }\r\n\r\n  public setZoomCallback(callback: (isZoomed: boolean) => void): void {\r\n    this.zoomCallback = callback;\r\n  }\r\n\r\n  /**\r\n   * Set zoom/ADS state - only works for sniper weapons (AWP, Sniper)\r\n   * @param zoomed Whether to zoom in or out\r\n   * @returns True if zoom state changed, false otherwise\r\n   */\r\n  public setZoom(zoomed: boolean): boolean {\r\n    // Only allow zoom for sniper-type weapons\r\n    if (this.currentWeapon !== WeaponType.Sniper && this.currentWeapon !== WeaponType.AWP) {\r\n      return false;\r\n    }\r\n\r\n    if (this.isZoomed === zoomed) return false;\r\n\r\n    this.isZoomed = zoomed;\r\n    \r\n    // Don't instantly hide - let the animation blend handle visibility\r\n    // The weapon will smoothly lower and fade out during zoom transition\r\n\r\n    // Notify callback (for HUD scope overlay and FOV)\r\n    if (this.zoomCallback) {\r\n      this.zoomCallback(zoomed);\r\n    }\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Configure weapon system for third-person view (for AI enemies)\r\n   * @param parent The object to attach the weapon to (e.g., hand bone)\r\n   */\r\n  public setThirdPersonMode(parent: THREE.Object3D): void {\r\n    this.isThirdPerson = true;\r\n    this.thirdPersonParent = parent;\r\n    \r\n    // Re-attach current weapon to new parent with third-person positioning\r\n    if (this.weaponMesh) {\r\n      if (this.weaponMesh.parent) {\r\n        this.weaponMesh.parent.remove(this.weaponMesh);\r\n      }\r\n      \r\n      // Scale down for third-person and position in hand\r\n      this.weaponMesh.scale.set(0.7, 0.7, 0.7);\r\n      this.weaponMesh.position.set(0, 0, 0);\r\n      this.weaponMesh.rotation.set(0, Math.PI, 0); // Flip to face forward\r\n      \r\n      parent.add(this.weaponMesh);\r\n    }\r\n  }\r\n\r\n  private initializeWeaponStates(): void {\r\n    (Object.values(WEAPON_CONFIG) as SingleWeaponConfig[]).forEach((config) => {\r\n      // Find the key for this config\r\n      const type = Object.keys(WEAPON_CONFIG).find(key => WEAPON_CONFIG[key as WeaponType] === config) as WeaponType;\r\n\r\n      if (type) {\r\n        this.weaponStates.set(type, {\r\n          currentMag: config.magSize,\r\n          reserveAmmo: config.reserveAmmo,\r\n          lastShotTime: 0,\r\n          isReloading: false,\r\n          reloadStartTime: 0\r\n        });\r\n      }\r\n    });\r\n  }\r\n\r\n  private initializeMuzzleFlash(): void {\r\n    const initialConfig = WEAPON_CONFIG[this.currentWeapon];\r\n    const initialPos = initialConfig.muzzle.position;\r\n\r\n    // Primary muzzle flash sprite\r\n    const spriteMat = new THREE.SpriteMaterial({\r\n      color: 0xffffaa,\r\n      transparent: true,\r\n      opacity: 0,\r\n      blending: THREE.AdditiveBlending,\r\n    });\r\n    this.muzzleFlash = new THREE.Sprite(spriteMat);\r\n    this.muzzleFlash.scale.set(0.3, 0.3, 1);\r\n    this.muzzleFlash.position.set(initialPos.x, initialPos.y, initialPos.z);\r\n\r\n    // Secondary muzzle flash sprite (for depth)\r\n    const spriteMat2 = new THREE.SpriteMaterial({\r\n      color: 0xffaa00,\r\n      transparent: true,\r\n      opacity: 0,\r\n      blending: THREE.AdditiveBlending,\r\n    });\r\n    this.muzzleFlash2 = new THREE.Sprite(spriteMat2);\r\n    this.muzzleFlash2.scale.set(0.2, 0.2, 1);\r\n    this.muzzleFlash2.position.set(initialPos.x, initialPos.y, initialPos.z - 0.02);\r\n\r\n    // Muzzle light\r\n    this.muzzleLight = new THREE.PointLight(initialConfig.muzzle.lightColor, 0, initialConfig.muzzle.lightRange);\r\n    this.muzzleLight.position.copy(this.muzzleFlash.position);\r\n  }\r\n\r\n  private loadAllAudio(): void {\r\n    const loadedPaths = new Set<string>();\r\n\r\n    // Preload all weapon sounds\r\n    (Object.values(WEAPON_CONFIG) as SingleWeaponConfig[]).forEach((config) => {\r\n      Object.values(config.audio).forEach((path) => {\r\n        if (path && typeof path === 'string' && !loadedPaths.has(path)) {\r\n          this.audioManager.loadAudio(path);\r\n          loadedPaths.add(path);\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  public get currentConfig(): SingleWeaponConfig {\r\n    return WEAPON_CONFIG[this.currentWeapon];\r\n  }\r\n\r\n  public getEquippedWeapons(): WeaponType[] {\r\n    // For now, return all available weapons in a fixed order\r\n    return Object.values(WeaponType);\r\n  }\r\n\r\n  public switchWeapon(weapon: WeaponType | number): void {\r\n    // Unzoom when switching weapons\r\n    if (this.isZoomed) {\r\n      this.setZoom(false);\r\n    }\r\n\r\n    if (typeof weapon === 'number') {\r\n      const weapons = this.getEquippedWeapons();\r\n      if (weapon >= 0 && weapon < weapons.length) {\r\n        this.currentWeapon = weapons[weapon];\r\n      }\r\n    } else {\r\n      this.currentWeapon = weapon;\r\n    }\r\n\r\n    // Reset reloading state on switch\r\n    const state = this.weaponStates.get(this.currentWeapon);\r\n    if (state) {\r\n      state.isReloading = false;\r\n    }\r\n\r\n    this.resetWeaponState();\r\n\r\n    // Play deploy sound if available (optional)\r\n  }\r\n\r\n  public scrollWeapon(direction: number): void {\r\n    const weapons = this.getEquippedWeapons();\r\n    let currentIndex = weapons.indexOf(this.currentWeapon);\r\n\r\n    if (direction > 0) {\r\n      currentIndex = (currentIndex + 1) % weapons.length;\r\n    } else {\r\n      currentIndex = (currentIndex - 1 + weapons.length) % weapons.length;\r\n    }\r\n\r\n    this.switchWeapon(weapons[currentIndex]);\r\n  }\r\n\r\n  public get isReloading(): boolean {\r\n    return this.weaponStates.get(this.currentWeapon)?.isReloading || false;\r\n  }\r\n\r\n  public get currentMag(): number {\r\n    return this.weaponStates.get(this.currentWeapon)?.currentMag || 0;\r\n  }\r\n\r\n  public get reserveAmmo(): number {\r\n    return this.weaponStates.get(this.currentWeapon)?.reserveAmmo || 0;\r\n  }\r\n\r\n  public getCurrentSpread(): number {\r\n    return this.currentSpread;\r\n  }\r\n\r\n  public getMuzzleWorldPosition(): THREE.Vector3 {\r\n    // Calculate muzzle position: weapon base position + muzzle offset from weapon config\r\n    const config = WEAPON_CONFIG[this.currentWeapon];\r\n    const muzzleOffset = config.muzzle.position;\r\n\r\n    // Start with weapon base position in first-person (relative to camera)\r\n    // Weapon position is (0.25, -0.25, -0.4) relative to camera\r\n    const weaponBasePos = new THREE.Vector3(0.25, -0.25, -0.4);\r\n    \r\n    // Add muzzle offset (relative to weapon)\r\n    // Note: muzzle z should be negative to be forward of weapon\r\n    const muzzlePos = weaponBasePos.clone();\r\n    muzzlePos.x += muzzleOffset.x;\r\n    muzzlePos.y += muzzleOffset.y;\r\n    muzzlePos.z += muzzleOffset.z; // muzzle.z is typically negative (forward)\r\n    \r\n    // Transform from camera-local space to world space\r\n    muzzlePos.applyMatrix4(this.camera.matrixWorld);\r\n\r\n    return muzzlePos;\r\n  }\r\n\r\n  /**\r\n   * Get the ejection port position (right side of weapon, where shells eject from)\r\n   */\r\n  private getEjectionPortPosition(): THREE.Vector3 {\r\n    // Start with weapon base position (relative to camera)\r\n    const weaponBasePos = new THREE.Vector3(0.25, -0.25, -0.4);\r\n    \r\n    // Ejection port is on the right side of the weapon, behind the muzzle\r\n    // Offset: right +0.08, up +0.05, slight forward -0.1 (relative to weapon base)\r\n    weaponBasePos.x += 0.08;  // Right side\r\n    weaponBasePos.y += 0.05;  // Slightly above weapon center\r\n    weaponBasePos.z += -0.1;  // Slightly forward of weapon center\r\n    \r\n    // Transform to world space\r\n    weaponBasePos.applyMatrix4(this.camera.matrixWorld);\r\n    return weaponBasePos;\r\n  }\r\n\r\n  /**\r\n   * Get the shell ejection direction (right, up, and slightly back)\r\n   */\r\n  private getEjectionDirection(): THREE.Vector3 {\r\n    // Shells eject to the right, upward, and slightly backward\r\n    // Add randomization for natural variation\r\n    const dir = new THREE.Vector3(\r\n      0.8 + Math.random() * 0.4,   // Right (0.8-1.2)\r\n      0.5 + Math.random() * 0.3,   // Up (0.5-0.8)\r\n      0.1 + Math.random() * 0.2    // Slightly back (0.1-0.3)\r\n    );\r\n    dir.applyQuaternion(this.camera.quaternion);\r\n    return dir.normalize();\r\n  }\r\n\r\n  public shoot(\r\n    camera: THREE.Camera,\r\n    _onGround: boolean,\r\n    isSprinting: boolean,\r\n    _velocity: THREE.Vector3\r\n  ): { shotFired: boolean; direction: THREE.Vector3; directions?: THREE.Vector3[] } {\r\n    const config = WEAPON_CONFIG[this.currentWeapon];\r\n    const state = this.weaponStates.get(this.currentWeapon);\r\n\r\n    if (!config || !state) return { shotFired: false, direction: new THREE.Vector3() };\r\n\r\n    // Check can fire\r\n    const now = performance.now();\r\n    const msPerShot = 1000 / config.fireRate;\r\n\r\n    if (state.isReloading || state.currentMag <= 0 || now - state.lastShotTime < msPerShot) {\r\n      if (state.currentMag <= 0 && !state.isReloading && state.reserveAmmo > 0) {\r\n        this.reload();\r\n      }\r\n      return { shotFired: false, direction: new THREE.Vector3() };\r\n    }\r\n\r\n    // Sprint check (cannot fire while sprinting)\r\n    if (isSprinting) {\r\n      return { shotFired: false, direction: new THREE.Vector3() };\r\n    }\r\n\r\n    // Update state\r\n    state.lastShotTime = now;\r\n    state.currentMag--;\r\n\r\n    // Play sound\r\n    if (config.audio.fire) {\r\n      this.audioManager.playSound(config.audio.fire, 'sfx', { volume: 0.5 });\r\n    }\r\n\r\n    // Apply recoil (includes weapon visual kick)\r\n    this.applyRecoil(config.recoil);\r\n\r\n    // Increase spread\r\n    this.currentSpread = Math.min(\r\n      this.currentSpread + config.spread.increasePerShot,\r\n      config.spread.max\r\n    );\r\n\r\n    // Trigger muzzle flash\r\n    this.triggerMuzzleFlash();\r\n\r\n    // Eject shell from ejection port (right side of weapon)\r\n    if (this.shellEjectCallback) {\r\n      const ejectionPos = this.getEjectionPortPosition();\r\n      const ejectionDir = this.getEjectionDirection();\r\n      this.shellEjectCallback(ejectionPos, ejectionDir);\r\n    }\r\n\r\n    // Calculate shot direction(s)\r\n    const baseDir = camera.getWorldDirection(new THREE.Vector3());\r\n\r\n    // Apply recoil to direction\r\n    const euler = new THREE.Euler(this.currentRecoil.y, this.currentRecoil.x, 0, 'YXZ');\r\n    baseDir.applyEuler(euler);\r\n\r\n    if (config.pelletCount && config.pelletCount > 1) {\r\n      // Shotgun spread\r\n      const directions: THREE.Vector3[] = [];\r\n      for (let i = 0; i < config.pelletCount; i++) {\r\n        const dir = baseDir.clone();\r\n        this.applySpread(dir, this.currentSpread * 2); // Wider spread for shotgun\r\n        directions.push(dir);\r\n      }\r\n      return { shotFired: true, direction: baseDir, directions };\r\n    } else {\r\n      // Single shot spread\r\n      this.applySpread(baseDir, this.currentSpread);\r\n      return { shotFired: true, direction: baseDir };\r\n    }\r\n  }\r\n\r\n  private applySpread(direction: THREE.Vector3, spreadAmount: number): void {\r\n    const u = Math.random() * 2 - 1;\r\n    const v = Math.random() * 2 - 1;\r\n\r\n    const right = new THREE.Vector3().crossVectors(direction, new THREE.Vector3(0, 1, 0)).normalize();\r\n    const up = new THREE.Vector3().crossVectors(right, direction).normalize();\r\n\r\n    direction.addScaledVector(right, u * spreadAmount);\r\n    direction.addScaledVector(up, v * spreadAmount);\r\n    direction.normalize();\r\n  }\r\n\r\n  private applyRecoil(recoilConfig: { pitchAmount: number; yawAmount: number; kickZ: number; kickRotX: number }): void {\r\n    // Camera recoil\r\n    this.targetRecoil.x += (Math.random() - 0.5) * recoilConfig.yawAmount;\r\n    this.targetRecoil.y += recoilConfig.pitchAmount;\r\n\r\n    // Weapon visual kick from config\r\n    this.weaponKickZ = recoilConfig.kickZ;\r\n    this.weaponKickRotX = (recoilConfig.kickRotX * Math.PI) / 180; // Convert degrees to radians\r\n    \r\n    console.log('Recoil applied - kickZ:', this.weaponKickZ, 'kickRotX:', this.weaponKickRotX, 'config:', recoilConfig);\r\n  }\r\n\r\n  private triggerMuzzleFlash(): void {\r\n    const config = WEAPON_CONFIG[this.currentWeapon];\r\n\r\n    // Set flash active\r\n    this.muzzleFlashTimer = config.muzzle.flashDuration;\r\n    this.muzzleFlashDuration = config.muzzle.flashDuration;\r\n\r\n    // Set initial opacity\r\n    (this.muzzleFlash.material as THREE.SpriteMaterial).opacity = 1.2;\r\n    (this.muzzleFlash2.material as THREE.SpriteMaterial).opacity = 0.9;\r\n    \r\n    // Set light intensity\r\n    this.muzzleLight.intensity = config.muzzle.lightIntensity;\r\n\r\n    // Randomize rotation for variety\r\n    this.muzzleFlash.material.rotation = Math.random() * Math.PI * 2;\r\n    this.muzzleFlash2.material.rotation = Math.random() * Math.PI * 2;\r\n  }\r\n\r\n  public reload(): void {\r\n    const state = this.weaponStates.get(this.currentWeapon);\r\n    const config = WEAPON_CONFIG[this.currentWeapon];\r\n\r\n    if (!state || !config || state.isReloading || state.currentMag === config.magSize || state.reserveAmmo <= 0) {\r\n      return;\r\n    }\r\n\r\n    // Unzoom if reloading while zoomed\r\n    if (this.isZoomed) {\r\n      this.setZoom(false);\r\n    }\r\n\r\n    state.isReloading = true;\r\n    state.reloadStartTime = performance.now();\r\n\r\n    if (config.audio.reload) {\r\n      this.audioManager.playSound(config.audio.reload, 'sfx', { volume: 0.5 });\r\n    }\r\n  }\r\n\r\n  public update(deltaTime: number, mouseMovement: { x: number, y: number }, isSprinting: boolean, headBobTime: number = 0): void {\r\n    const config = WEAPON_CONFIG[this.currentWeapon];\r\n    const state = this.weaponStates.get(this.currentWeapon);\r\n\r\n    if (!config || !state) return;\r\n\r\n    // Handle Reloading\r\n    if (state.isReloading) {\r\n      if (performance.now() - state.reloadStartTime >= config.reloadTime * 1000) {\r\n        const needed = config.magSize - state.currentMag;\r\n        const toAdd = Math.min(needed, state.reserveAmmo);\r\n\r\n        state.currentMag += toAdd;\r\n        state.reserveAmmo -= toAdd;\r\n        state.isReloading = false;\r\n      }\r\n    }\r\n\r\n    // Recoil recovery\r\n    this.currentRecoil.x = THREE.MathUtils.lerp(this.currentRecoil.x, this.targetRecoil.x, deltaTime * 10);\r\n    this.currentRecoil.y = THREE.MathUtils.lerp(this.currentRecoil.y, this.targetRecoil.y, deltaTime * 10);\r\n\r\n    this.targetRecoil.x = THREE.MathUtils.lerp(this.targetRecoil.x, 0, deltaTime * config.recoil.recoveryRate);\r\n    this.targetRecoil.y = THREE.MathUtils.lerp(this.targetRecoil.y, 0, deltaTime * config.recoil.recoveryRate);\r\n\r\n    // Spread recovery\r\n    const minSpread = isSprinting ? config.spread.base * 2 : config.spread.base;\r\n    this.currentSpread = THREE.MathUtils.lerp(this.currentSpread, minSpread, deltaTime * config.spread.recoveryRate);\r\n\r\n    // Weapon kickback recovery\r\n    this.weaponKickZ *= 1 - 5 * deltaTime;\r\n    this.weaponKickRotX *= 1 - 5 * deltaTime;\r\n\r\n\t\t// Weapon sway (follows mouse movement with lag)\r\n\t\tconst swayAmount = 0.01; // How much weapon lags behind mouse\r\n\t\tconst swayRecovery = 8; // How fast it returns to center\r\n\t\tthis.weaponSwayX += (mouseMovement.x * swayAmount - this.weaponSwayX) * swayRecovery * deltaTime;\r\n\t\tthis.weaponSwayY += (mouseMovement.y * swayAmount - this.weaponSwayY) * swayRecovery * deltaTime;    // Sprint blend\r\n    const targetSprint = isSprinting ? 1 : 0;\r\n    this.sprintBlend += (targetSprint - this.sprintBlend) * 8 * deltaTime;\r\n\r\n    // Reload blend\r\n    const targetReload = state.isReloading ? 1 : 0;\r\n    this.reloadBlend += (targetReload - this.reloadBlend) * 8 * deltaTime;\r\n\r\n    // Zoom blend (smooth transition for scope animation)\r\n    const targetZoom = this.isZoomed ? 1 : 0;\r\n    this.zoomBlend += (targetZoom - this.zoomBlend) * 10 * deltaTime; // Slightly faster for snappy feel\r\n\r\n    // Update muzzle flash\r\n    if (this.muzzleFlashTimer > 0) {\r\n      this.muzzleFlashTimer -= deltaTime;\r\n      if (this.muzzleFlashTimer <= 0) {\r\n        this.muzzleFlashTimer = 0;\r\n        (this.muzzleFlash.material as THREE.SpriteMaterial).opacity = 0;\r\n        (this.muzzleFlash2.material as THREE.SpriteMaterial).opacity = 0;\r\n        this.muzzleLight.intensity = 0;\r\n      } else {\r\n        // Fade out\r\n        const ratio = this.muzzleFlashTimer / this.muzzleFlashDuration;\r\n        (this.muzzleFlash.material as THREE.SpriteMaterial).opacity = ratio * 1.2;\r\n        (this.muzzleFlash2.material as THREE.SpriteMaterial).opacity = ratio * 0.9;\r\n        this.muzzleLight.intensity = ratio * config.muzzle.lightIntensity;\r\n\r\n        // Rotate slightly during flash\r\n        this.muzzleFlash.material.rotation += deltaTime * 10;\r\n        this.muzzleFlash2.material.rotation -= deltaTime * 10;\r\n      }\r\n    }\r\n\r\n    // Update weapon transform (position and rotation)\r\n    this.updateWeaponTransform(deltaTime, headBobTime);\r\n  }\r\n\r\n  private updateWeaponTransform(delta: number, headBobTime: number): void {\r\n    if (!this.weaponMesh) return;\r\n    \r\n    // Skip FPS-style animations for third-person mode\r\n    if (this.isThirdPerson) {\r\n      // Simple kickback for third-person\r\n      const kickZ = this.weaponKickZ * 0.5; // Reduced kickback\r\n      this.weaponMesh.position.z = kickZ;\r\n      return;\r\n    }\r\n\r\n    // Hide weapon smoothly when fully zoomed\r\n    // Start hiding at 70% zoom progress for smooth transition\r\n    const hideThreshold = 0.7;\r\n    if (this.zoomBlend > hideThreshold) {\r\n      const hideProgress = (this.zoomBlend - hideThreshold) / (1 - hideThreshold);\r\n      this.weaponMesh.visible = hideProgress < 0.99;\r\n    } else {\r\n      this.weaponMesh.visible = true;\r\n    }\r\n\r\n    // Base position\r\n    let targetX = 0.25 - this.weaponSwayX;\r\n    let targetY = -0.25 - this.weaponSwayY;\r\n    let targetZ = -0.4;\r\n\r\n    // Weapon bob (breathing/walking motion) - reduce during zoom\r\n    const bobInfluence = 1.0 - this.zoomBlend * 0.8; // Less bob when zooming\r\n    const bobX = Math.cos(headBobTime * 0.5) * 0.015 * bobInfluence;\r\n    const bobY = Math.sin(headBobTime) * 0.035 * bobInfluence;\r\n    targetX += bobX;\r\n    targetY += bobY;\r\n\r\n    // Kickback from shooting\r\n    targetZ += this.weaponKickZ;\r\n\r\n    // Sprint offset (lower and to the side)\r\n    targetX += 0.1 * this.sprintBlend;\r\n    targetY -= 0.2 * this.sprintBlend;\r\n\r\n    // Reload offset (dip down)\r\n    targetY -= 0.15 * this.reloadBlend;\r\n\r\n    // Zoom animation: weapon raises up to bring scope to eye level\r\n    // Also moves forward and centers for proper ADS position\r\n    targetY += 0.15 * this.zoomBlend;  // Raise the weapon up\r\n    targetZ -= 0.2 * this.zoomBlend;   // Pull forward toward eye\r\n    targetX -= 0.15 * this.zoomBlend;  // Center the weapon\r\n\r\n    // Rotation\r\n    let targetRotX = -this.weaponKickRotX + (0.3 * this.reloadBlend);\r\n    let targetRotZ = (0.2 * this.sprintBlend);\r\n    \r\n    // Zoom rotation: tilt weapon slightly to align scope\r\n    targetRotX += 0.1 * this.zoomBlend;\r\n\r\n    // Smooth lerp to target\r\n    const lerpSpeed = 15;\r\n    this.weaponMesh.position.x += (targetX - this.weaponMesh.position.x) * lerpSpeed * delta;\r\n    this.weaponMesh.position.y += (targetY - this.weaponMesh.position.y) * lerpSpeed * delta;\r\n    this.weaponMesh.position.z += (targetZ - this.weaponMesh.position.z) * lerpSpeed * delta;\r\n    this.weaponMesh.rotation.x += (targetRotX - this.weaponMesh.rotation.x) * lerpSpeed * delta;\r\n    this.weaponMesh.rotation.z += (targetRotZ - this.weaponMesh.rotation.z) * lerpSpeed * delta;\r\n  }\r\n\r\n  private resetWeaponState(): void {\r\n    console.log('DEBUG: resetWeaponState START');\r\n    // Remove old model\r\n    if (this.weaponMesh && this.weaponMesh.parent) {\r\n      this.weaponMesh.parent.remove(this.weaponMesh);\r\n    }\r\n\r\n    // Create new model\r\n    const group = this.createWeaponModel();\r\n    this.weaponMesh = group;\r\n\r\n    // Add muzzle effects to weapon\r\n    const config = WEAPON_CONFIG[this.currentWeapon];\r\n    const pos = config.muzzle.position;\r\n    \r\n    this.muzzleFlash.position.set(pos.x, pos.y, pos.z);\r\n    this.muzzleFlash2.position.set(pos.x, pos.y, pos.z - 0.02);\r\n    this.muzzleLight.position.copy(this.muzzleFlash.position);\r\n    this.muzzleLight.color.setHex(config.muzzle.lightColor);\r\n    this.muzzleLight.distance = config.muzzle.lightRange;\r\n\r\n    this.weaponMesh.add(this.muzzleFlash);\r\n    this.weaponMesh.add(this.muzzleFlash2);\r\n    this.weaponMesh.add(this.muzzleLight);\r\n\r\n    // Attach to appropriate parent based on mode\r\n    if (this.isThirdPerson && this.thirdPersonParent) {\r\n      // Third-person mode: attach to hand bone with appropriate transform\r\n      this.weaponMesh.scale.set(0.7, 0.7, 0.7);\r\n      this.weaponMesh.position.set(0, 0, 0);\r\n      this.weaponMesh.rotation.set(0, Math.PI, 0); // Face forward\r\n      this.thirdPersonParent.add(this.weaponMesh);\r\n      console.log('DEBUG: Weapon added to third-person parent');\r\n    } else {\r\n      // First-person mode: attach to camera\r\n      this.weaponMesh.scale.set(1.0, 1.0, 1.0);\r\n      this.weaponMesh.position.set(0.25, -0.25, -0.4);\r\n      this.camera.add(this.weaponMesh);\r\n      console.log('DEBUG: Weapon added to camera. Weapon UUID:', this.weaponMesh.uuid);\r\n      console.log('DEBUG: Camera UUID:', this.camera.uuid);\r\n    }\r\n  }\r\n\r\n  // Weapon model creation\r\n  private createWeaponModel(): THREE.Group {\r\n    switch (this.currentWeapon) {\r\n      case WeaponType.AK47: return this.createAK47Model();\r\n      case WeaponType.AWP: return this.createAWPModel();\r\n      case WeaponType.LMG: return this.createLMGModel();\r\n      case WeaponType.M4: return this.createM4Model();\r\n      case WeaponType.Pistol: return this.createPistolModel();\r\n      case WeaponType.Scar: return this.createScarModel();\r\n      case WeaponType.Shotgun: return this.createShotgunModel();\r\n      case WeaponType.Sniper: return this.createSniperModel();\r\n      case WeaponType.Tec9: return this.createTec9Model();\r\n      default: return this.createAK47Model();\r\n    }\r\n  }\r\n\r\n  private createAK47Model(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.08, 0.12, 0.6),\r\n      new THREE.MeshStandardMaterial({ color: 0x5d4037, metalness: 0.1, roughness: 0.8 }) // Wood\r\n    );\r\n    body.position.set(0, 0, -0.1);\r\n    group.add(body);\r\n\r\n    // Metal parts\r\n    const receiver = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.09, 0.13, 0.3),\r\n      new THREE.MeshStandardMaterial({ color: 0x222222, metalness: 0.8, roughness: 0.4 })\r\n    );\r\n    receiver.position.set(0, 0.01, -0.1);\r\n    group.add(receiver);\r\n\r\n    // Barrel\r\n    const barrel = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.02, 0.02, 0.6),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111, metalness: 0.9, roughness: 0.3 })\r\n    );\r\n    barrel.rotation.x = Math.PI / 2;\r\n    barrel.position.set(0, 0.04, -0.5);\r\n    group.add(barrel);\r\n\r\n    // Magazine (Curved look via rotation)\r\n    const mag = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.04, 0.25, 0.08),\r\n      new THREE.MeshStandardMaterial({ color: 0x333333 })\r\n    );\r\n    mag.position.set(0, -0.15, -0.05);\r\n    mag.rotation.x = 0.3;\r\n    group.add(mag);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createAWPModel(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Green Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.1, 0.15, 0.8),\r\n      new THREE.MeshStandardMaterial({ color: 0x2e7d32, metalness: 0.2, roughness: 0.7 })\r\n    );\r\n    body.position.set(0, 0, -0.2);\r\n    group.add(body);\r\n\r\n    // Long Barrel\r\n    const barrel = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.025, 0.025, 1.0),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    barrel.rotation.x = Math.PI / 2;\r\n    barrel.position.set(0, 0.05, -0.8);\r\n    group.add(barrel);\r\n\r\n    // Scope\r\n    const scope = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.04, 0.05, 0.3),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    scope.rotation.x = Math.PI / 2;\r\n    scope.position.set(0, 0.12, -0.1);\r\n    group.add(scope);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createLMGModel(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Bulky Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.15, 0.2, 0.7),\r\n      new THREE.MeshStandardMaterial({ color: 0x424242 })\r\n    );\r\n    body.position.set(0, 0, -0.1);\r\n    group.add(body);\r\n\r\n    // Box Mag\r\n    const mag = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.12, 0.2, 0.15),\r\n      new THREE.MeshStandardMaterial({ color: 0x2e7d32 })\r\n    );\r\n    mag.position.set(0, -0.15, 0);\r\n    group.add(mag);\r\n\r\n    // Barrel\r\n    const barrel = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.03, 0.03, 0.7),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    barrel.rotation.x = Math.PI / 2;\r\n    barrel.position.set(0, 0, -0.6);\r\n    group.add(barrel);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createM4Model(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.08, 0.12, 0.5),\r\n      new THREE.MeshStandardMaterial({ color: 0x1a1a1a })\r\n    );\r\n    body.position.set(0, 0, -0.1);\r\n    group.add(body);\r\n\r\n    // Barrel with handguard\r\n    const handguard = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.09, 0.09, 0.35),\r\n      new THREE.MeshStandardMaterial({ color: 0x222222 })\r\n    );\r\n    handguard.position.set(0, 0.02, -0.4);\r\n    group.add(handguard);\r\n\r\n    // Carry handle / Sight\r\n    const sight = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.02, 0.06, 0.15),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    sight.position.set(0, 0.1, -0.1);\r\n    group.add(sight);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createPistolModel(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Slide\r\n    const slide = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.06, 0.08, 0.25),\r\n      new THREE.MeshStandardMaterial({ color: 0xbdc3c7, metalness: 0.8 })\r\n    );\r\n    slide.position.set(0, 0.05, 0);\r\n    group.add(slide);\r\n\r\n    // Grip\r\n    const grip = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.05, 0.15, 0.07),\r\n      new THREE.MeshStandardMaterial({ color: 0x2c3e50 })\r\n    );\r\n    grip.position.set(0, -0.05, 0.05);\r\n    grip.rotation.x = -0.2;\r\n    group.add(grip);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createScarModel(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Tan Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.1, 0.15, 0.6),\r\n      new THREE.MeshStandardMaterial({ color: 0xd2b48c }) // Tan\r\n    );\r\n    body.position.set(0, 0, -0.1);\r\n    group.add(body);\r\n\r\n    // Upper receiver\r\n    const upper = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.1, 0.08, 0.7),\r\n      new THREE.MeshStandardMaterial({ color: 0xc2a47c })\r\n    );\r\n    upper.position.set(0, 0.08, -0.15);\r\n    group.add(upper);\r\n\r\n    // Mag\r\n    const mag = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.04, 0.2, 0.08),\r\n      new THREE.MeshStandardMaterial({ color: 0x222222 })\r\n    );\r\n    mag.position.set(0, -0.15, -0.05);\r\n    group.add(mag);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createShotgunModel(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.1, 0.12, 0.5),\r\n      new THREE.MeshStandardMaterial({ color: 0x333333 })\r\n    );\r\n    body.position.set(0, 0, -0.1);\r\n    group.add(body);\r\n\r\n    // Long Barrel\r\n    const barrel = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.03, 0.03, 0.8),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    barrel.rotation.x = Math.PI / 2;\r\n    barrel.position.set(0, 0.02, -0.6);\r\n    group.add(barrel);\r\n\r\n    // Pump\r\n    const pump = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.08, 0.06, 0.2),\r\n      new THREE.MeshStandardMaterial({ color: 0x5d4037 }) // Wood pump\r\n    );\r\n    pump.position.set(0, -0.05, -0.5);\r\n    group.add(pump);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createSniperModel(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.08, 0.1, 0.7),\r\n      new THREE.MeshStandardMaterial({ color: 0x222222 })\r\n    );\r\n    body.position.set(0, 0, -0.2);\r\n    group.add(body);\r\n\r\n    // Barrel\r\n    const barrel = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.02, 0.02, 0.9),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    barrel.rotation.x = Math.PI / 2;\r\n    barrel.position.set(0, 0.05, -0.8);\r\n    group.add(barrel);\r\n\r\n    // Scope\r\n    const scope = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.035, 0.04, 0.25),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    scope.rotation.x = Math.PI / 2;\r\n    scope.position.set(0, 0.1, -0.1);\r\n    group.add(scope);\r\n\r\n    return group;\r\n  }\r\n\r\n  private createTec9Model(): THREE.Group {\r\n    const group = new THREE.Group();\r\n\r\n    // Body\r\n    const body = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.06, 0.08, 0.3),\r\n      new THREE.MeshStandardMaterial({ color: 0x222222 })\r\n    );\r\n    body.position.set(0, 0.05, 0);\r\n    group.add(body);\r\n\r\n    // Barrel shroud\r\n    const shroud = new THREE.Mesh(\r\n      new THREE.CylinderGeometry(0.03, 0.03, 0.2),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111, wireframe: false })\r\n    );\r\n    shroud.rotation.x = Math.PI / 2;\r\n    shroud.position.set(0, 0.05, -0.25);\r\n    group.add(shroud);\r\n\r\n    // Mag (Forward of trigger)\r\n    const mag = new THREE.Mesh(\r\n      new THREE.BoxGeometry(0.03, 0.2, 0.05),\r\n      new THREE.MeshStandardMaterial({ color: 0x111111 })\r\n    );\r\n    mag.position.set(0, -0.1, -0.1);\r\n    group.add(mag);\r\n\r\n    return group;\r\n  }\r\n}\r\n","import { Vehicle, Regulator, Think, FollowPathBehavior, OnPathBehavior, SeekBehavior, Vector3, Vision, MemorySystem, GameEntity, Quaternion, MathUtils } from 'yuka';\nimport { MESSAGE_HIT, MESSAGE_DEAD, STATUS_ALIVE, STATUS_DYING, STATUS_DEAD, WEAPON_TYPES_ASSAULT_RIFLE, WEAPON_TYPES_SHOTGUN, HEALTH_PACK } from '../core/Constants';\nimport { AttackEvaluator } from '../evaluators/AttackEvaluator';\nimport { ExploreEvaluator } from '../evaluators/ExploreEvaluator';\nimport { CharacterBounds } from '../utils/CharacterBounds';\nimport { WeaponSystem } from '../core/WeaponSystem';\nimport { TargetSystem } from '../core/TargetSystem';\nimport { CONFIG } from '../core/Config';\nimport { GetHealthEvaluator } from '../evaluators/GetHealthEvaluator';\nimport { GetWeaponEvaluator } from '../evaluators/GetWeaponEvaluator';\nimport World from '../core/World';\nimport { WeaponSystem as RIFTWeaponSystem } from '../systems/WeaponSystem';\nimport { Camera as ThreeCamera, PerspectiveCamera, Vector3 as ThreeVector3, Object3D } from 'three';\nimport { WeaponType } from '../types/weapons';\n\nconst positiveWeightings = new Array();\nconst weightings = [0, 0, 0, 0];\nconst directions = [\n\t{ direction: new Vector3(0, 0, 1), name: 'soldier_forward' },\n\t{ direction: new Vector3(0, 0, - 1), name: 'soldier_backward' },\n\t{ direction: new Vector3(- 1, 0, 0), name: 'soldier_left' },\n\t{ direction: new Vector3(1, 0, 0), name: 'soldier_right' }\n];\nconst lookDirection = new Vector3();\nconst moveDirection = new Vector3();\nconst quaternion = new Quaternion();\nconst transformedDirection = new Vector3();\nconst worldPosition = new Vector3();\nconst customTarget = new Vector3();\n\n/**\n* Class for representing the opponent bots in this game.\n*/\nclass Enemy extends Vehicle {\n\n\tpublic world: typeof World;\n\tpublic currentTime: number;\n\tpublic boundingRadius: number;\n\tpublic maxSpeed: number;\n\tpublic updateOrientation: boolean;\n\tpublic health: number;\n\tpublic maxHealth: number;\n\tpublic status: number;\n\tpublic isPlayer: boolean;\n\n\tpublic currentRegion: any;\n\tpublic currentPosition: Vector3;\n\tpublic previousPosition: Vector3;\n\n\tpublic searchAttacker: boolean;\n\tpublic attackDirection: Vector3;\n\tpublic endTimeSearch: number;\n\tpublic searchTime: number;\n\n\tpublic ignoreHealth: boolean;\n\tpublic ignoreWeapons: boolean;\n\tpublic ignoreShotgun: boolean;\n\tpublic ignoreAssaultRifle: boolean;\n\tpublic endTimeIgnoreHealth: number;\n\tpublic endTimeIgnoreShotgun: number;\n\tpublic endTimeIgnoreAssaultRifle: number;\n\tpublic ignoreItemsTimeout: number;\n\n\tpublic endTimeDying: number;\n\tpublic dyingTime: number;\n\n\tpublic head: GameEntity;\n\tpublic weaponContainer: GameEntity;\n\tpublic bounds: CharacterBounds;\n\n\tpublic mixer: any;\n\tpublic animations: Map<string, any>;\n\n\tpublic path: any;\n\n\tpublic brain: Think<Enemy>;\n\tpublic goalArbitrationRegulator: Regulator;\n\n\tpublic memorySystem: MemorySystem;\n\tpublic memoryRecords: Array<any>;\n\n\tdeclare public steering: any;\n\n\tpublic vision: Vision;\n\tpublic visionRegulator: Regulator;\n\n\tpublic targetSystem: TargetSystem;\n\tpublic targetSystemRegulator: Regulator;\n\n\tpublic weaponSystem: WeaponSystem;\n\tpublic weaponSelectionRegulator: Regulator;\n\n\t// RIFT Integration\n\tpublic riftWeaponSystem: RIFTWeaponSystem | null = null;\n\tpublic enemyCamera: ThreeCamera | null = null; // Virtual camera for weapon rendering\n\n\t// Getter for protected _renderComponent from Yuka's GameEntity\n\tpublic get renderComponent(): Object3D | null {\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\n\t\treturn (this as any)._renderComponent || null;\n\t}\n\n\tpublic pathHelper: any;\n\tpublic hitboxHelper: any;\n\n\t/**\n\t* Constructs a new enemy.\n\t*\n\t* @param {World} world - A reference to the world.\n\t*/\n\tconstructor(world: typeof World) {\n\n\t\tsuper();\n\n\t\tthis.world = world;\n\n\t\tthis.currentTime = 0;\n\t\tthis.boundingRadius = CONFIG.BOT.BOUNDING_RADIUS;\n\t\tthis.maxSpeed = CONFIG.BOT.MOVEMENT.MAX_SPEED;\n\t\tthis.updateOrientation = false;\n\t\tthis.health = CONFIG.BOT.MAX_HEALTH;\n\t\tthis.maxHealth = CONFIG.BOT.MAX_HEALTH;\n\t\tthis.status = STATUS_ALIVE;\n\t\tthis.isPlayer = false;\n\n\t\t// current convex region of the navmesh the entity is in\n\n\t\tthis.currentRegion = null;\n\t\tthis.currentPosition = new Vector3();\n\t\tthis.previousPosition = new Vector3();\n\n\t\t// searching for attackers\n\n\t\tthis.searchAttacker = false;\n\t\tthis.attackDirection = new Vector3();\n\t\tthis.endTimeSearch = Infinity;\n\t\tthis.searchTime = CONFIG.BOT.SEARCH_FOR_ATTACKER_TIME;\n\n\t\t// item related properties\n\n\t\tthis.ignoreHealth = false;\n\t\tthis.ignoreWeapons = false;\n\t\tthis.ignoreShotgun = false;\n\t\tthis.ignoreAssaultRifle = false;\n\t\tthis.endTimeIgnoreHealth = Infinity;\n\t\tthis.endTimeIgnoreShotgun = Infinity;\n\t\tthis.endTimeIgnoreAssaultRifle = Infinity;\n\t\tthis.ignoreItemsTimeout = CONFIG.BOT.IGNORE_ITEMS_TIMEOUT;\n\n\t\t// death animation\n\n\t\tthis.endTimeDying = Infinity;\n\t\tthis.dyingTime = CONFIG.BOT.DYING_TIME;\n\n\t\t// head\n\n\t\tthis.head = new GameEntity();\n\t\tthis.head.position.y = CONFIG.BOT.HEAD_HEIGHT;\n\t\tthis.add(this.head);\n\n\t\t// the weapons are attached to the following container entity\n\n\t\tthis.weaponContainer = new GameEntity();\n\t\tthis.head.add(this.weaponContainer);\n\n\t\t// bounds\n\n\t\tthis.bounds = new CharacterBounds(this);\n\n\t\t// animation\n\n\t\tthis.mixer = null;\n\t\tthis.animations = new Map();\n\n\t\t// brain\n\n\t\tthis.brain = new Think(this);\n\t\tthis.brain.addEvaluator(new AttackEvaluator());\n\t\tthis.brain.addEvaluator(new GetHealthEvaluator());\n\t\tthis.brain.addEvaluator(new GetWeaponEvaluator());\n\t\tthis.brain.addEvaluator(new ExploreEvaluator());\n\n\t\tthis.goalArbitrationRegulator = new Regulator(CONFIG.BOT.GOAL_ARBITRATION_FREQUENCY);\n\n\t\t// memory\n\n\t\tthis.memorySystem = new MemorySystem(this);\n\t\tthis.memorySystem.memorySpan = CONFIG.BOT.MEMORY.SPAN;\n\t\tthis.memoryRecords = new Array();\n\n\t\t// steering\n\n\t\tconst followPathBehavior = new FollowPathBehavior();\n\t\tfollowPathBehavior.active = false;\n\t\tfollowPathBehavior.nextWaypointDistance = CONFIG.BOT.NAVIGATION.NEXT_WAYPOINT_DISTANCE;\n\t\t(followPathBehavior as any)._arrive.deceleration = CONFIG.BOT.NAVIGATION.ARRIVE_DECELERATION;\n\t\tthis.steering.add(followPathBehavior);\n\n\t\tconst onPathBehavior = new OnPathBehavior();\n\t\tonPathBehavior.active = false;\n\t\tonPathBehavior.path = followPathBehavior.path;\n\t\tonPathBehavior.radius = CONFIG.BOT.NAVIGATION.PATH_RADIUS;\n\t\tonPathBehavior.weight = CONFIG.BOT.NAVIGATION.ONPATH_WEIGHT;\n\t\tthis.steering.add(onPathBehavior);\n\n\t\tconst seekBehavior = new SeekBehavior();\n\t\tseekBehavior.active = false;\n\t\tthis.steering.add(seekBehavior);\n\n\t\t// vision\n\n\t\tthis.vision = new Vision(this.head);\n\t\tthis.vision.fieldOfView = CONFIG.BOT.VISION.FOV;\n\t\tthis.vision.range = CONFIG.BOT.VISION.RANGE;\n\t\tthis.visionRegulator = new Regulator(CONFIG.BOT.VISION.UPDATE_FREQUENCY);\n\n\n\t\t// target system\n\n\t\tthis.targetSystem = new TargetSystem(this);\n\t\tthis.targetSystemRegulator = new Regulator(CONFIG.BOT.TARGET_SYSTEM.UPDATE_FREQUENCY);\n\n\t\t// weapon system\n\n\t\tthis.weaponSystem = new WeaponSystem(this);\n\t\tthis.weaponSelectionRegulator = new Regulator(CONFIG.BOT.WEAPON.UPDATE_FREQUENCY);\n\n\t\t// debug\n\n\t\tthis.pathHelper = null;\n\t\tthis.hitboxHelper = null;\n\n\t}\n\n\t/**\n\t* Executed when this game entity is updated for the first time by its entity manager.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tstart() {\n\n\t\tconst run = this.animations.get('soldier_forward');\n\t\trun.enabled = true;\n\n\t\tconst level = this.manager!.getEntityByName('level');\n\t\tif (level) {\n\t\t\tthis.vision.addObstacle(level);\n\t\t}\n\n\t\tthis.bounds.init();\n\t\tthis.weaponSystem.init();\n\n\t\t// Initialize RIFT weapon system for this enemy\n\t\tthis._initRIFTWeaponSystem();\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Updates the internal state of this game entity.\n\t*\n\t* @param {Number} delta - The time delta.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tupdate(delta: number) {\n\n\t\tsuper.update(delta);\n\n\t\tthis.currentTime += delta;\n\n\t\t// ensure the enemy never leaves the level\n\n\t\tthis.stayInLevel();\n\n\t\t// only update the core logic of the enemy if it is alive\n\n\t\tif (this.status === STATUS_ALIVE) {\n\n\t\t\t// update hitbox\n\n\t\t\tthis.bounds.update();\n\n\t\t\t// update perception\n\n\t\t\tif (this.visionRegulator.ready()) {\n\n\t\t\t\tthis.updateVision();\n\n\t\t\t}\n\n\t\t\t// update memory system\n\n\t\t\tthis.memorySystem.getValidMemoryRecords(this.currentTime, this.memoryRecords);\n\n\t\t\t// update target system\n\n\t\t\tif (this.targetSystemRegulator.ready()) {\n\n\t\t\t\tthis.targetSystem.update();\n\n\t\t\t}\n\n\t\t\t// update goals\n\n\t\t\tthis.brain.execute();\n\n\t\t\tif (this.goalArbitrationRegulator.ready()) {\n\n\t\t\t\tthis.brain.arbitrate();\n\n\t\t\t}\n\n\t\t\t// update weapon selection\n\n\t\t\tif (this.weaponSelectionRegulator.ready()) {\n\n\t\t\t\tthis.weaponSystem.selectBestWeapon();\n\n\t\t\t}\n\n\t\t\t// stop search for attacker if necessary\n\n\t\t\tif (this.currentTime >= this.endTimeSearch) {\n\n\t\t\t\tthis.resetSearch();\n\n\t\t\t}\n\n\t\t\t// reset ignore flags if necessary\n\n\t\t\tif (this.currentTime >= this.endTimeIgnoreHealth) {\n\n\t\t\t\tthis.ignoreHealth = false;\n\n\t\t\t}\n\n\t\t\tif (this.currentTime >= this.endTimeIgnoreShotgun) {\n\n\t\t\t\tthis.ignoreShotgun = false;\n\n\t\t\t}\n\n\t\t\tif (this.currentTime >= this.endTimeIgnoreAssaultRifle) {\n\n\t\t\t\tthis.ignoreAssaultRifle = false;\n\n\t\t\t}\n\n\t\t\t// updating the weapon system means updating the aiming and shooting.\n\t\t\t// so this call will change the actual heading/orientation of the enemy\n\n\t\t\tthis.weaponSystem.update(delta);\n\n\t\t\t// Update RIFT weapon system (animations, muzzle flash, etc.)\n\t\t\tif (this.riftWeaponSystem && this.enemyCamera) {\n\t\t\t\tthis.riftWeaponSystem.update(delta, { x: 0, y: 0 }, false, this.currentTime);\n\t\t\t}\n\n\t\t}\n\n\t\t// handle dying\n\n\t\tif (this.status === STATUS_DYING) {\n\n\t\t\tif (this.currentTime >= this.endTimeDying) {\n\n\t\t\t\tthis.status = STATUS_DEAD;\n\t\t\t\tthis.endTimeDying = Infinity;\n\n\t\t\t}\n\n\t\t}\n\n\t\t// handle death\n\n\t\tif (this.status === STATUS_DEAD) {\n\n\t\t\tif (this.world.debug) {\n\n\t\t\t\tconsole.log('DIVE.Enemy: Enemy with ID %s died.', this.uuid);\n\n\t\t\t}\n\n\t\t\tthis.reset();\n\n\t\t\tthis.world.spawningManager.respawnCompetitor(this);\n\n\t\t}\n\n\t\t// always update animations\n\n\t\tthis.updateAnimations(delta);\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Ensures the enemy never leaves the level.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tstayInLevel() {\n\n\t\t// \"currentPosition\" represents the final position after the movement for a single\n\t\t// simualation step. it's now necessary to check if this point is still on\n\t\t// the navMesh\n\n\t\tthis.currentPosition.copy(this.position);\n\n\t\tthis.currentRegion = this.world.navMesh.clampMovement(\n\t\t\tthis.currentRegion,\n\t\t\tthis.previousPosition,\n\t\t\tthis.currentPosition,\n\t\t\tthis.position // this is the result vector that gets clamped\n\t\t);\n\n\t\t// save this position for the next method invocation\n\n\t\tthis.previousPosition.copy(this.position);\n\n\t\t// adjust height of the entity according to the ground\n\n\t\tconst distance = this.currentRegion.plane.distanceToPoint(this.position);\n\n\t\tthis.position.y -= distance * CONFIG.NAVMESH.HEIGHT_CHANGE_FACTOR; // smooth transition\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Updates the vision component of this game entity and stores\n\t* the result in the respective memory system.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tupdateVision() {\n\n\t\tconst memorySystem = this.memorySystem;\n\t\tconst vision = this.vision;\n\n\t\tconst competitors = this.world.competitors;\n\n\t\tfor (let i = 0, l = competitors.length; i < l; i++) {\n\n\t\t\tconst competitor = competitors[i];\n\n\t\t\t// ignore own entity and consider only living enemies\n\n\t\t\tif (competitor === this || competitor.status !== STATUS_ALIVE) continue;\n\n\t\t\tif (memorySystem.hasRecord(competitor) === false) {\n\n\t\t\t\tmemorySystem.createRecord(competitor);\n\n\t\t\t}\n\n\t\t\tconst record = memorySystem.getRecord(competitor);\n\n\t\t\tcompetitor.head.getWorldPosition(worldPosition);\n\n\t\t\tif (record && vision.visible(worldPosition) === true && competitor.active) {\n\n\t\t\t\trecord.timeLastSensed = this.currentTime;\n\t\t\t\trecord.lastSensedPosition.copy(competitor.position); // it's intended to use the body's position here\n\t\t\t\tif (record.visible === false) record.timeBecameVisible = this.currentTime;\n\t\t\t\trecord.visible = true;\n\n\t\t\t} else if (record) {\n\n\t\t\t\trecord.visible = false;\n\n\t\t\t}\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Updates the animations of this game entity.\n\t*\n\t* @param {Number} delta - The time delta.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tupdateAnimations(delta: number) {\n\n\t\tif (this.status === STATUS_ALIVE) {\n\n\t\t\t// directions\n\n\t\t\tthis.getDirection(lookDirection);\n\t\t\tmoveDirection.copy(this.velocity).normalize();\n\n\t\t\t// rotation\n\n\t\t\tquaternion.lookAt(this.forward, moveDirection, this.up);\n\n\t\t\t// calculate weightings for movement animations\n\n\t\t\tpositiveWeightings.length = 0;\n\t\t\tlet sum = 0;\n\n\t\t\tfor (let i = 0, l = directions.length; i < l; i++) {\n\n\t\t\t\ttransformedDirection.copy(directions[i].direction).applyRotation(quaternion);\n\t\t\t\tconst dot = transformedDirection.dot(lookDirection);\n\t\t\t\tweightings[i] = (dot < 0) ? 0 : dot;\n\t\t\t\tconst animation = this.animations.get(directions[i].name);\n\n\t\t\t\tif (weightings[i] > 0.001) {\n\n\t\t\t\t\tanimation.enabled = true;\n\t\t\t\t\tpositiveWeightings.push(i);\n\t\t\t\t\tsum += weightings[i];\n\n\t\t\t\t} else {\n\n\t\t\t\t\tanimation.enabled = false;\n\t\t\t\t\tanimation.weight = 0;\n\n\t\t\t\t}\n\n\t\t\t}\n\n\t\t\t// the weightings for enabled animations have to be calculated in an additional\n\t\t\t// loop since the sum of weightings of all enabled animations has to be 1\n\n\t\t\tfor (let i = 0, l = positiveWeightings.length; i < l; i++) {\n\n\t\t\t\tconst index = positiveWeightings[i];\n\t\t\t\tconst animation = this.animations.get(directions[index].name);\n\t\t\t\tanimation.weight = weightings[index] / sum;\n\n\t\t\t\t// scale the animtion based on the actual velocity\n\n\t\t\t\tanimation.timeScale = this.getSpeed() / this.maxSpeed;\n\n\t\t\t}\n\n\t\t}\n\n\t\tthis.mixer.update(delta);\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Adds the given health points to this entity.\n\t*\n\t* @param {Number} amount - The amount of health to add.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\taddHealth(amount: number) {\n\n\t\tthis.health += amount;\n\n\t\tthis.health = Math.min(this.health, this.maxHealth); // ensure that health does not exceed maxHealth\n\n\t\tif (this.world.debug) {\n\n\t\t\tconsole.log('DIVE.Enemy: Entity with ID %s receives %i health points.', this.uuid, amount);\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/*\n\t* Adds the given weapon to the internal weapon system.\n\t*\n\t* @param {WEAPON_TYPES} type - The weapon type.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\taddWeapon(type: any) {\n\n\t\tthis.weaponSystem.addWeapon(type);\n\n\t\t// if the entity already has the weapon, increase the ammo\n\n\t\tthis.world.uiManager.updateAmmoStatus();\n\n\t\t// bots should directly switch to collected weapons if they have\n\t\t// no current target\n\n\t\tif (this.targetSystem.hasTarget() === false) {\n\n\t\t\tthis.weaponSystem.setNextWeapon(type);\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Sets the animations of this game entity by creating a\n\t* series of animation actions.\n\t*\n\t* @param {AnimationMixer} mixer - The animation mixer.\n\t* @param {Array} clips - An array of animation clips.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tsetAnimations(mixer: any, clips: any) {\n\n\t\tthis.mixer = mixer;\n\n\t\t// actions\n\n\t\tfor (const clip of clips) {\n\n\t\t\tconst action = mixer.clipAction(clip);\n\t\t\taction.play();\n\t\t\taction.enabled = false;\n\t\t\taction.name = clip.name;\n\n\t\t\tthis.animations.set(action.name, action);\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Resets the enemy after a death.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\treset() {\n\n\t\tthis.health = this.maxHealth;\n\t\tthis.status = STATUS_ALIVE;\n\n\t\t// reset search for attacker\n\n\t\tthis.resetSearch();\n\n\t\t// items\n\n\t\tthis.ignoreHealth = false;\n\t\tthis.ignoreWeapons = false;\n\n\t\t// clear brain and memory\n\n\t\tthis.brain.clearSubgoals();\n\n\t\tthis.memoryRecords.length = 0;\n\t\tthis.memorySystem.clear();\n\n\t\t// reset target and weapon system\n\n\t\tthis.targetSystem.reset();\n\t\tthis.weaponSystem.reset();\n\n\t\t// reset all animations\n\n\t\tthis.resetAnimations();\n\n\t\t// set default animation\n\n\t\tconst run = this.animations.get('soldier_forward');\n\t\trun.enabled = true;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Resets all animations.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tresetAnimations() {\n\n\t\tfor (let animation of this.animations.values()) {\n\n\t\t\tanimation.enabled = false;\n\t\t\tanimation.time = 0;\n\t\t\tanimation.timeScale = 1;\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Resets the search for an attacker.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tresetSearch() {\n\n\t\tthis.searchAttacker = false;\n\t\tthis.attackDirection.set(0, 0, 0);\n\t\tthis.endTimeSearch = Infinity;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Inits the death of an entity.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tinitDeath() {\n\n\t\tthis.status = STATUS_DYING;\n\t\tthis.endTimeDying = this.currentTime + this.dyingTime;\n\n\t\tthis.velocity.set(0, 0, 0);\n\n\t\t// reset all steering behaviors\n\n\t\tfor (let behavior of this.steering.behaviors) {\n\n\t\t\tbehavior.active = false;\n\n\t\t}\n\n\t\t// reset all animations\n\n\t\tthis.resetAnimations();\n\n\t\t// start death animation\n\n\t\tconst index = MathUtils.randInt(1, 2);\n\t\tconst dying = this.animations.get('soldier_death' + index);\n\t\tdying.enabled = true;\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Returns the intesection point if a projectile intersects with this entity.\n\t* If no intersection is detected, null is returned.\n\t*\n\t* @param {Ray} ray - The ray that defines the trajectory of this bullet.\n\t* @param {Vector3} intersectionPoint - The intersection point.\n\t* @return {Vector3} The intersection point.\n\t*/\n\tcheckProjectileIntersection(ray: any, intersectionPoint: any) {\n\n\t\treturn this.bounds.intersectRay(ray, intersectionPoint);\n\n\t}\n\n\t/**\n\t* Returns true if the enemy is at the given target position. The result of the test\n\t* can be influenced with a configurable tolerance value.\n\t*\n\t* @param {Vector3} position - The target position.\n\t* @return {Boolean} Whether the enemy is at the given target position or not.\n\t*/\n\tatPosition(position: any) {\n\n\t\tconst tolerance = CONFIG.BOT.NAVIGATION.ARRIVE_TOLERANCE * CONFIG.BOT.NAVIGATION.ARRIVE_TOLERANCE;\n\n\t\tconst distance = this.position.squaredDistanceTo(position);\n\n\t\treturn distance <= tolerance;\n\n\t}\n\n\t/**\n\t* Ignores the given item type for a certain amount of time.\n\t*\n\t* @param {Number} type - The item type.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tignoreItem(type: any) {\n\n\t\tswitch (type) {\n\n\t\t\tcase HEALTH_PACK:\n\t\t\t\tthis.ignoreHealth = true;\n\t\t\t\tthis.endTimeIgnoreHealth = this.currentTime + this.ignoreItemsTimeout;\n\t\t\t\tbreak;\n\n\t\t\tcase WEAPON_TYPES_SHOTGUN:\n\t\t\t\tthis.ignoreShotgun = true;\n\t\t\t\tthis.endTimeIgnoreShotgun = this.currentTime + this.ignoreItemsTimeout;\n\t\t\t\tbreak;\n\n\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\n\t\t\t\tthis.ignoreAssaultRifle = true;\n\t\t\t\tthis.endTimeIgnoreAssaultRifle = this.currentTime + this.ignoreItemsTimeout;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error('DIVE.Enemy: Invalid item type:', type);\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Returns true if the given item type is currently ignored by the enemy.\n\t*\n\t* @param {Number} type - The item type.\n\t* @return {Boolean} Whether the given item type is ignored or not.\n\t*/\n\tisItemIgnored(type: number): boolean {\n\n\t\tlet ignoreItem = false;\n\n\t\tswitch (type) {\n\n\t\t\tcase HEALTH_PACK:\n\t\t\t\tignoreItem = this.ignoreHealth;\n\t\t\t\tbreak;\n\n\t\t\tcase WEAPON_TYPES_SHOTGUN:\n\t\t\t\tignoreItem = this.ignoreShotgun;\n\t\t\t\tbreak;\n\n\t\t\tcase WEAPON_TYPES_ASSAULT_RIFLE:\n\t\t\t\tignoreItem = this.ignoreAssaultRifle;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tconsole.error('DIVE.Enemy: Invalid item type:', type);\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn ignoreItem;\n\n\t}\n\n\t/**\n\t* Removes the given entity from the memory system.\n\t*\n\t* @param {GameEntity} entity - The entity to remove\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tremoveEntityFromMemory(entity: GameEntity): this {\n\n\t\tthis.memorySystem.deleteRecord(entity);\n\t\tthis.memorySystem.getValidMemoryRecords(this.currentTime, this.memoryRecords);\n\n\t\treturn this;\n\n\t}\n\n\t/**\n\t* Returns true if the enemy can move a step to the given dirction without\n\t* leaving the level. The new position vector is stored into the given vector.\n\t*\n\t* @param {Vector3} direction - The direction vector.\n\t* @param {Vector3} position - The new position vector.\n\t* @return {Boolean} Whether the enemy can move a bit to the left or not.\n\t*/\n\tcanMoveInDirection(direction: any, position: any) {\n\n\t\tposition.copy(direction).applyRotation(this.rotation).normalize();\n\t\tposition.multiplyScalar(CONFIG.BOT.MOVEMENT.DODGE_SIZE).add(this.position);\n\n\t\tconst navMesh = this.world.navMesh;\n\t\tconst region = navMesh.getRegionForPoint(position, 1);\n\n\t\treturn region !== null;\n\n\t}\n\n\t/**\n\t* Ensure the enemy only changes it rotation around its y-axis by consider the target\n\t* in a logical xz-plane which has the same height as the current position.\n\t* In this way, the enemy never \"tilts\" its body. Necessary for levels with different heights.\n\t*\n\t* @param {Vector3} target - The target position.\n\t* @param {Number} delta - The time delta.\n\t* @param {Number} tolerance - A tolerance value in radians to tweak the result\n\t* when a game entity is considered to face a target.\n\t* @return {Boolean} Whether the entity is faced to the target or not.\n\t*/\n\trotateTo(target: any, delta: number, tolerance: number) {\n\n\t\tcustomTarget.copy(target);\n\t\tcustomTarget.y = this.position.y;\n\n\t\treturn super.rotateTo(customTarget, delta, tolerance);\n\n\t}\n\n\t/**\n\t* Initializes the RIFT weapon system for this enemy.\n\t* Creates a virtual camera and weapon renderer attached to enemy's head.\n\t*\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\tprivate _initRIFTWeaponSystem(): this {\n\t\t// Create a virtual camera for this enemy (used for weapon aiming/raycast)\n\t\tthis.enemyCamera = new PerspectiveCamera(75, 1, 0.1, 1000);\n\n\t\t// Position camera at enemy's head by finding the head bone in the skeleton\n\t\tlet handBone: any = null;\n\t\tlet headBone: any = null;\n\t\t\n\t\tif (this.renderComponent) {\n\t\t\t// Try to find head and hand bones in the skeleton\n\t\t\tthis.renderComponent.traverse((child: any) => {\n\t\t\t\tif (child.isBone) {\n\t\t\t\t\tconst boneName = child.name.toLowerCase();\n\t\t\t\t\tif (boneName.includes('head')) {\n\t\t\t\t\t\theadBone = child;\n\t\t\t\t\t}\n\t\t\t\t\t// Look for right hand bone (weapon hand)\n\t\t\t\t\tif (boneName.includes('hand') && boneName.includes('right') || \n\t\t\t\t\t    boneName.includes('r_hand') || \n\t\t\t\t\t    boneName.includes('hand_r') ||\n\t\t\t\t\t    boneName.includes('rhand')) {\n\t\t\t\t\t\thandBone = child;\n\t\t\t\t\t}\n\t\t\t\t\t// Also try arm if no hand found\n\t\t\t\t\tif (!handBone && (boneName.includes('arm') && boneName.includes('right') ||\n\t\t\t\t\t    boneName.includes('r_arm') || \n\t\t\t\t\t    boneName.includes('arm_r'))) {\n\t\t\t\t\t\thandBone = child;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t});\n\n\t\t\t// If we found a head bone, attach camera to it\n\t\t\t// Otherwise attach to the root render component\n\t\t\tconst attachPoint = headBone || this.renderComponent;\n\t\t\tattachPoint.add(this.enemyCamera);\n\t\t\t\n\t\t\t// Position camera slightly forward and up if attached to root\n\t\t\tif (!headBone) {\n\t\t\t\tthis.enemyCamera.position.set(0, CONFIG.BOT.HEAD_HEIGHT, 0.5);\n\t\t\t}\n\t\t}\n\n\t\t// Create RIFT weapon system for this enemy\n\t\tthis.riftWeaponSystem = new RIFTWeaponSystem(\n\t\t\tthis.world.scene,\n\t\t\tthis.enemyCamera,\n\t\t\tthis.world.assetManager,\n\t\t\tthis.world.rift.audioManager\n\t\t);\n\n\t\t// Set up shell ejection callback\n\t\tthis.riftWeaponSystem.setShellEjectCallback((pos: ThreeVector3, dir: ThreeVector3) => {\n\t\t\t// Ground level is the enemy's Y position (enemy.position is at feet level)\n\t\t\tconst groundLevel = this.position.y;\n\t\t\tthis.world.rift.particleSystem.spawnShellCasing(pos, dir, groundLevel);\n\t\t});\n\n\t\t// Configure for third-person mode so weapon is visible in enemy's hand\n\t\tif (handBone) {\n\t\t\t// Attach weapon to hand bone\n\t\t\tthis.riftWeaponSystem.setThirdPersonMode(handBone);\n\t\t\tconsole.log(`Enemy ${this.name}: Weapon attached to hand bone: ${handBone.name}`);\n\t\t} else if (this.renderComponent) {\n\t\t\t// Create a weapon mount point if no hand bone found\n\t\t\tconst weaponMount = new Object3D();\n\t\t\tweaponMount.name = 'weapon_mount';\n\t\t\tweaponMount.position.set(0.3, CONFIG.BOT.HEAD_HEIGHT * 0.6, 0.2); // Position at right side, chest height\n\t\t\tthis.renderComponent.add(weaponMount);\n\t\t\tthis.riftWeaponSystem.setThirdPersonMode(weaponMount);\n\t\t\tconsole.log(`Enemy ${this.name}: Weapon attached to fallback mount point`);\n\t\t}\n\n\t\t// Start with a random weapon\n\t\tconst weapons = [WeaponType.AK47, WeaponType.M4, WeaponType.Scar, WeaponType.Shotgun, WeaponType.LMG, WeaponType.Pistol];\n\t\tconst randomWeapon = weapons[Math.floor(Math.random() * weapons.length)];\n\t\tconst weaponIndex = Object.values(WeaponType).indexOf(randomWeapon);\n\t\tthis.riftWeaponSystem.switchWeapon(weaponIndex);\n\n\t\t// Hide old Drift weapon models (blaster, shotgun, assault rifle)\n\t\tif (this.weaponSystem && this.weaponSystem.renderComponents) {\n\t\t\tconst oldComponents = [\n\t\t\t\tthis.weaponSystem.renderComponents.blaster,\n\t\t\t\tthis.weaponSystem.renderComponents.shotgun,\n\t\t\t\tthis.weaponSystem.renderComponents.assaultRifle\n\t\t\t];\n\t\t\t\n\t\t\tfor (const component of oldComponents) {\n\t\t\t\tif (component && component.mesh) {\n\t\t\t\t\tcomponent.mesh.visible = false;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconsole.log(`Enemy ${this.name} initialized with RIFT weapon system, weapon: ${randomWeapon}`);\n\n\t\treturn this;\n\t}\n\n\t/**\n\t* Shoots using the RIFT weapon system at the target position.\n\t* This creates proper muzzle flash, tracers, and impacts.\n\t*\n\t* @param {Vector3} targetPosition - The target position in Yuka space.\n\t* @return {Enemy} A reference to this game entity.\n\t*/\n\t// @ts-expect-error Method reserved for future use\n\tprivate _shootRIFT(targetPosition: Vector3): this {\n\t\tif (!this.riftWeaponSystem || !this.enemyCamera) return this;\n\n\t\t// Update camera orientation to match enemy\n\t\tif (this.renderComponent) {\n\t\t\tthis.renderComponent.updateMatrixWorld(true);\n\t\t\tthis.enemyCamera.updateMatrixWorld(true);\n\t\t\t\n\t\t\t// Make camera look at target\n\t\t\tconst targetThree = new ThreeVector3(targetPosition.x, targetPosition.y, targetPosition.z);\n\t\t\tthis.enemyCamera.lookAt(targetThree);\n\t\t}\n\n\t\t// Shoot using RIFT weapon system\n\t\tconst result = this.riftWeaponSystem.shoot(\n\t\t\tthis.enemyCamera,\n\t\t\ttrue, // onGround\n\t\t\tfalse, // isSprinting\n\t\t\tnew ThreeVector3(this.velocity.x, this.velocity.y, this.velocity.z)\n\t\t);\n\n\t\tif (result.shotFired) {\n\t\t\t// Build obstacle list (same as Player)\n\t\t\tconst obstacles: any[] = [];\n\t\t\t\n\t\t\t// Add level\n\t\t\tif (this.world.level && this.world.level.renderComponent) {\n\t\t\t\tobstacles.push(this.world.level.renderComponent);\n\t\t\t}\n\n\t\t\t// Add player\n\t\t\tif (this.world.player && this.world.player.renderComponent) {\n\t\t\t\tobstacles.push(this.world.player.renderComponent);\n\t\t\t}\n\n\t\t\t// Add other competitors (excluding self)\n\t\t\tfor (const competitor of this.world.competitors) {\n\t\t\t\tif (competitor !== this && competitor.renderComponent && competitor.status === STATUS_ALIVE) {\n\t\t\t\t\tobstacles.push(competitor.renderComponent);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Get muzzle position from RIFT weapon system\n\t\t\tconst muzzlePos = this.riftWeaponSystem.getMuzzleWorldPosition();\n\t\t\tconst config = this.riftWeaponSystem.currentConfig;\n\t\t\tconst damage = config.damage;\n\n\t\t\t// Process shot(s) with RIFT integration\n\t\t\tif (result.directions) {\n\t\t\t\t// Shotgun - multiple pellets\n\t\t\t\tfor (const direction of result.directions) {\n\t\t\t\t\tthis.world.rift.processEnemyShot(\n\t\t\t\t\t\tthis.enemyCamera,\n\t\t\t\t\t\tdirection,\n\t\t\t\t\t\tmuzzlePos,\n\t\t\t\t\t\tobstacles,\n\t\t\t\t\t\tthis,\n\t\t\t\t\t\tdamage\n\t\t\t\t\t);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Single shot\n\t\t\t\tthis.world.rift.processEnemyShot(\n\t\t\t\t\tthis.enemyCamera,\n\t\t\t\t\tresult.direction,\n\t\t\t\t\tmuzzlePos,\n\t\t\t\t\tobstacles,\n\t\t\t\t\tthis,\n\t\t\t\t\tdamage\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\n\t\treturn this;\n\t}\n\n\t/**\n\t* Holds the implementation for the message handling of this game entity.\n\t*\n\t* @param {Telegram} telegram - The telegram with the message data.\n\t* @return {Boolean} Whether the message was processed or not.\n\t*/\n\thandleMessage(telegram: any) {\n\n\t\tswitch (telegram.message) {\n\n\t\t\tcase MESSAGE_HIT:\n\n\t\t\t\t// Ignore damage if already dead or dying\n\t\t\t\tif (this.status !== STATUS_ALIVE) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\n\t\t\t\t// reduce health (clamp to 0 minimum)\n\n\t\t\t\tthis.health = Math.max(0, this.health - telegram.data.damage);\n\n\t\t\t\t// logging\n\n\t\t\t\tif (this.world.debug) {\n\n\t\t\t\t\tconsole.log('DIVE.Enemy: Enemy with ID %s hit by Game Entity with ID %s receiving %i damage.', this.uuid, telegram.sender.uuid, telegram.data.damage);\n\n\t\t\t\t}\n\n\t\t\t\t// if the player is the sender and if the enemy still lives, change the style of the crosshairs\n\n\t\t\t\tif (telegram.sender.isPlayer && this.status === STATUS_ALIVE) {\n\n\t\t\t\t\tthis.world.uiManager.showHitIndication();\n\n\t\t\t\t}\n\n\t\t\t\t// check if the enemy is death\n\n\t\t\t\tif (this.health <= 0 && this.status === STATUS_ALIVE) {\n\n\t\t\t\t\tthis.initDeath();\n\n\t\t\t\t\t// inform all other competitors about its death\n\n\t\t\t\t\tconst competitors = this.world.competitors;\n\n\t\t\t\t\tfor (let i = 0, l = competitors.length; i < l; i++) {\n\n\t\t\t\t\t\tconst competitor = competitors[i];\n\n\t\t\t\t\t\tif (this !== competitor) this.sendMessage(competitor, MESSAGE_DEAD);\n\n\t\t\t\t\t}\n\n\t\t\t\t\t// update UI\n\n\t\t\t\t\tthis.world.uiManager.addFragMessage(telegram.sender, this);\n\n\t\t\t\t} else {\n\n\t\t\t\t\t// if not, search for attacker if he is still alive\n\n\t\t\t\t\tif (telegram.sender.status === STATUS_ALIVE) {\n\n\t\t\t\t\t\tthis.searchAttacker = true;\n\t\t\t\t\t\tthis.endTimeSearch = this.currentTime + this.searchTime; // only search for a specific amount of time\n\t\t\t\t\t\tthis.attackDirection.copy(telegram.data.direction).multiplyScalar(- 1); // negate the vector\n\n\t\t\t\t\t}\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t\tcase MESSAGE_DEAD:\n\n\t\t\t\tconst sender = telegram.sender;\n\t\t\t\tconst memoryRecord = this.memorySystem.getRecord(sender);\n\n\t\t\t\t// delete the dead enemy from the memory system when it was visible.\n\t\t\t\t// also update the target system so the bot looks for a different target\n\n\t\t\t\tif (memoryRecord && memoryRecord.visible) {\n\n\t\t\t\t\tthis.removeEntityFromMemory(sender);\n\t\t\t\t\tthis.targetSystem.update();\n\n\t\t\t\t}\n\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\treturn true;\n\n\t}\n\n}\n\nexport { Enemy };\n","// RIFT Integration - Game Configuration\r\n\r\nimport { PlayerConfig, CameraConfig } from '../types';\r\n\r\nexport const PLAYER_CONFIG: PlayerConfig = {\r\n  maxHealth: 100,\r\n  maxArmor: 100,\r\n  maxStamina: 100,\r\n  height: 1.7,\r\n  walkSpeed: 8,\r\n  sprintSpeed: 13,\r\n  jumpForce: 12,\r\n  gravity: 35,\r\n  groundAccel: 50,\r\n  airAccel: 20,\r\n  groundDecel: 30,\r\n  airDecel: 5,\r\n  jumpBuffer: 0.1,\r\n  coyoteTime: 0.15,\r\n  jumpCutMultiplier: 0.5,\r\n  stepHeight: 0.5,\r\n  staminaDrain: 20,\r\n  staminaRegen: 30,\r\n  slideSpeed: 18,\r\n  slideDuration: 1.0,\r\n  slideFriction: 2.5,\r\n  slideCooldown: 1.0,\r\n};\r\n\r\nexport const CAMERA_CONFIG: CameraConfig = {\r\n  baseFOV: 75,\r\n  sprintFOV: 85,\r\n  jumpFOV: 78,\r\n  landFOV: 70,\r\n  fovLerpSpeed: 10,\r\n  bobFrequency: 12,\r\n  bobAmplitudeX: 0.015,\r\n  bobAmplitudeY: 0.035,\r\n  breathFrequency: 2,\r\n  breathAmplitude: 0.005,\r\n  jumpStretch: 0.2,\r\n  mouseSensitivity: 0.002,\r\n};\r\n\r\nexport const ARENA_CONFIG = {\r\n  size: 60,\r\n  wallHeight: 8,\r\n};\r\n\r\nexport const LOBBY_URL = '/social/';\r\n","import { MovingEntity, Ray, Vector3, GameEntity } from 'yuka';\r\nimport { MESSAGE_HIT } from '../core/Constants';\r\n\r\nconst intersectionPoint = new Vector3();\r\nconst ray = new Ray();\r\n\r\n/**\r\n* Base class for representing a projectile.\r\n*/\r\nclass Projectile extends MovingEntity {\r\n\r\n\tpublic owner: any; // Using any for now to avoid circular dependency issues, or use GameEntity if possible\r\n\tpublic ray: Ray;\r\n\tpublic lifetime: number;\r\n\tpublic currentTime: number;\r\n\tpublic damage: number;\r\n\r\n\t/**\r\n\t* Constructs a new projectile with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this projectile.\r\n\t* @param {Ray} ray - The ray that defines the trajectory of this projectile.\r\n\t*/\r\n\tconstructor(owner: GameEntity | null = null, ray = new Ray()) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.canActivateTrigger = false;\r\n\r\n\t\tthis.owner = owner;\r\n\t\tthis.ray = ray;\r\n\r\n\t\tthis.lifetime = 0;\r\n\t\tthis.currentTime = 0;\r\n\r\n\t\tthis.damage = 0;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of this projectile.\r\n\t*\r\n\t* @param {Number} delta - The time delta value;\r\n\t* @return {Projectile} A reference to this projectile.\r\n\t*/\r\n\tupdate(delta: number) {\r\n\r\n\t\tconst world = this.owner.world;\r\n\r\n\t\tthis.currentTime += delta;\r\n\r\n\t\tif (this.currentTime > this.lifetime) {\r\n\r\n\t\t\tworld.remove(this);\r\n\r\n\t\t} else {\r\n\r\n\t\t\tray.copy(this.ray);\r\n\t\t\tray.origin.copy(this.position);\r\n\r\n\t\t\tsuper.update(delta);\r\n\r\n\t\t\tconst entity = world.checkProjectileIntersection(this, intersectionPoint);\r\n\r\n\t\t\tif (entity !== null) {\r\n\r\n\t\t\t\t// calculate distance from origin to intersection point\r\n\r\n\t\t\t\tconst distanceToIntersection = ray.origin.squaredDistanceTo(intersectionPoint);\r\n\t\t\t\tconst validDistance = ray.origin.squaredDistanceTo(this.position);\r\n\r\n\t\t\t\tif (distanceToIntersection <= validDistance) {\r\n\r\n\t\t\t\t\t// inform game entity about hit\r\n\r\n\t\t\t\t\tthis.owner.sendMessage(entity, MESSAGE_HIT, 0, { damage: this.damage, direction: this.ray.direction });\r\n\r\n\t\t\t\t\t// remove projectile from world\r\n\r\n\t\t\t\t\tworld.remove(this);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Projectile };\r\n","import { GameEntity, MovingEntity, Vector3, AABB, MathUtils } from 'yuka';\r\nimport { LoopOnce, AnimationMixer, AnimationAction, PositionalAudio, Vector3 as ThreeVector3, Object3D } from 'three';\r\nimport { WeaponSystem } from '../core/WeaponSystem';\r\nimport { CONFIG } from '../core/Config';\r\nimport { PLAYER_CONFIG } from '../config/gameConfig';\r\nimport { Projectile } from '../weapons/Projectile';\r\nimport { STATUS_ALIVE, WEAPON_TYPES_BLASTER, WEAPON_TYPES_SHOTGUN, WEAPON_TYPES_ASSAULT_RIFLE, MESSAGE_HIT, MESSAGE_DEAD, STATUS_DYING, STATUS_DEAD } from '../core/Constants';\r\nimport World from '../core/World';\r\n\r\nconst intersectionPoint = new Vector3();\r\nconst targetPosition = new Vector3();\r\nconst projectile = new Projectile();\r\nconst attackDirection = new Vector3();\r\nconst lookDirection = new Vector3();\r\nconst cross = new Vector3();\r\n\r\n/**\r\n* Class for representing the human player of the game.\r\n*/\r\nclass Player extends MovingEntity {\r\n\r\n\tpublic world: typeof World;\r\n\tpublic head: GameEntity;\r\n\tpublic weaponContainer: GameEntity;\r\n\tpublic weaponSystem: WeaponSystem;\r\n\tpublic bounds: AABB;\r\n\tpublic boundsDefinition: AABB;\r\n\tpublic currentRegion: any;\r\n\tpublic currentPosition: Vector3;\r\n\tpublic previousPosition: Vector3;\r\n\tpublic audios: Map<string, PositionalAudio>;\r\n\tpublic mixer: AnimationMixer | null;\r\n\tpublic animations: Map<string, AnimationAction>;\r\n\tpublic ui: { health: HTMLElement | null };\r\n\tpublic status: number;\r\n\tpublic currentTime: number;\r\n\tpublic endTimeDying: number;\r\n\tpublic dyingTime: number;\r\n\tpublic isPlayer: boolean;\r\n\tpublic health: number;\r\n\tpublic maxHealth: number;\r\n\tpublic height: number;\r\n\tpublic updateOrientation: boolean;\r\n\tpublic maxSpeed: number;\r\n\tpublic name: string;\r\n\tdeclare public active: boolean;\r\n\r\n\t// Getter for protected _renderComponent from Yuka's GameEntity\r\n\tpublic get renderComponent(): Object3D | null {\r\n\t\t// eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n\t\treturn (this as any)._renderComponent || null;\r\n\t}\r\n\r\n\t// Rift Physics Properties\r\n\tpublic velocity: Vector3; // Override Yuka velocity with same type but managed differently if needed\r\n\tpublic onGround: boolean = true;\r\n\tpublic isSprinting: boolean = false;\r\n\tpublic isSliding: boolean = false;\r\n\tpublic slideTimer: number = 0;\r\n\tpublic slideCooldownTimer: number = 0;\r\n\tpublic slideDirection: Vector3 = new Vector3();\r\n\tpublic coyoteTimer: number = 0;\r\n\tpublic jumpBufferTimer: number = 0;\r\n\tpublic isJumping: boolean = false;\r\n\tpublic canCutJump: boolean = false;\r\n\tpublic prevVelocity: Vector3 = new Vector3();\r\n\tpublic groundNormal: Vector3 = new Vector3(0, 1, 0);\r\n\tpublic slopeAngle: number = 0;\r\n\tpublic maxSlopeAngle: number = Math.PI / 4;\r\n\tpublic stamina: number = 100;\r\n\tpublic landingImpact: number = 0;\r\n\tpublic headBobTime: number = 0;\r\n\r\n\t// Audio buffers (will be loaded by AudioManager or passed in)\r\n\tpublic lastFootstepTime: number = 0;\r\n\r\n\t/**\r\n\t* Constructs a new player object.\r\n\t*\r\n\t* @param {World} world - A reference to the world.\r\n\t*/\r\n\tconstructor(world: typeof World) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.world = world;\r\n\r\n\t\tthis.currentTime = 0;\r\n\t\tthis.boundingRadius = CONFIG.PLAYER.BOUNDING_RADIUS;\r\n\t\tthis.height = CONFIG.PLAYER.HEAD_HEIGHT;\r\n\t\tthis.updateOrientation = false;\r\n\t\tthis.maxSpeed = CONFIG.PLAYER.MAX_SPEED;\r\n\t\tthis.health = CONFIG.PLAYER.MAX_HEALTH;\r\n\t\tthis.maxHealth = CONFIG.PLAYER.MAX_HEALTH;\r\n\t\tthis.isPlayer = true;\r\n\r\n\t\t// Initialize Rift Physics\r\n\t\tthis.velocity = new Vector3();\r\n\r\n\t\tthis.status = STATUS_ALIVE;\r\n\r\n\t\t// the camera is attached to the player's head\r\n\r\n\t\tthis.head = new GameEntity();\r\n\t\tthis.head.forward.set(0, 0, - 1);\r\n\t\tthis.add(this.head);\r\n\r\n\t\t// death animation\r\n\r\n\t\tthis.endTimeDying = Infinity;\r\n\t\tthis.dyingTime = CONFIG.PLAYER.DYING_TIME;\r\n\r\n\t\t// the weapons are attached to the following container entity\r\n\r\n\t\tthis.weaponContainer = new GameEntity();\r\n\t\tthis.head.add(this.weaponContainer);\r\n\r\n\t\t// the player uses the weapon system, too\r\n\r\n\t\tthis.weaponSystem = new WeaponSystem(this);\r\n\r\n\t\t// Skip old weapon system initialization for player - RIFT handles all weapons\r\n\t\tif (!this.isPlayer) {\r\n\t\t\tthis.weaponSystem.init();\r\n\t\t}\r\n\r\n\t\t// the player's bounds (using a single AABB is sufficient for now)\r\n\r\n\t\tthis.bounds = new AABB();\r\n\t\tthis.boundsDefinition = new AABB(new Vector3(- 0.25, 0, - 0.25), new Vector3(0.25, 1.8, 0.25));\r\n\r\n\t\t// current convex region of the navmesh the entity is in\r\n\r\n\t\tthis.currentRegion = null;\r\n\t\tthis.currentPosition = new Vector3();\r\n\t\tthis.previousPosition = new Vector3();\r\n\r\n\t\t// audio\r\n\r\n\t\tthis.audios = new Map();\r\n\r\n\t\t// animation\r\n\r\n\t\tthis.mixer = null;\r\n\t\tthis.animations = new Map();\r\n\r\n\t\t// ui\r\n\t\tthis.ui = {\r\n\r\n\t\t\thealth: document.getElementById('health'),\r\n\r\n\t\t};\r\n\r\n\t\tthis.name = 'Player';\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates the internal state of this game entity.\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tupdate(delta: number) {\r\n\r\n\t\t// Only process input and physics if alive\r\n\t\tif (this.status === STATUS_ALIVE) {\r\n\t\t\t// Capture Input from Controls\r\n\t\t\tconst input = this.world.fpsControls.input;\r\n\t\t\tconst inputDir = new Vector3();\r\n\t\t\tif (input.forward) inputDir.z -= 1;\r\n\t\t\tif (input.backward) inputDir.z += 1;\r\n\t\t\tif (input.left) inputDir.x -= 1;\r\n\t\t\tif (input.right) inputDir.x += 1;\r\n\r\n\t\t\t// Run Physics Simulation\r\n\t\t\tthis.updatePhysics(\r\n\t\t\t\tdelta,\r\n\t\t\t\tinputDir,\r\n\t\t\t\tinput.sprint,\r\n\t\t\t\tinput.jump,\r\n\t\t\t\tinput.crouch,\r\n\t\t\t\tthis.world.arenaObjects\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\t// Sync Yuka Entity State\r\n\t\t// Yuka uses 'position' and 'velocity' which we are updating in updatePhysics\r\n\t\t// But we need to ensure Yuka's internal state is happy\r\n\r\n\t\t// Call super.update to handle Yuka specific things (like behaviors if any, though Player usually doesn't have them)\r\n\t\tsuper.update(delta);\r\n\r\n\t\tthis.currentTime += delta;\r\n\r\n\t\t// ensure the enemy never leaves the level (Legacy check, physics handles bounds now but good backup)\r\n\t\t// this.stayInLevel(); \r\n\r\n\t\tif (this.status === STATUS_ALIVE) {\r\n\t\t\tif (!this.isPlayer) {\r\n\t\t\t\tthis.weaponSystem.updateWeaponChange();\r\n\t\t\t}\r\n\t\t\tthis.bounds.copy(this.boundsDefinition).applyMatrix4(this.worldMatrix);\r\n\t\t}\r\n\r\n\t\tif (this.status === STATUS_DYING) {\r\n\t\t\tif (this.currentTime >= this.endTimeDying) {\r\n\t\t\t\tthis.status = STATUS_DEAD;\r\n\t\t\t\tthis.endTimeDying = Infinity;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.status === STATUS_DEAD) {\r\n\t\t\tif (this.world.debug) console.log('DIVE.Player: Player died.');\r\n\t\t\tthis.reset();\r\n\t\t\tthis.world.spawningManager.respawnCompetitor(this);\r\n\t\t\tthis.world.fpsControls.sync();\r\n\t\t\t// Update health UI after respawn position is set\r\n\t\t\tthis.world.uiManager.updateHealthStatus();\r\n\t\t}\r\n\r\n\t\tthis.mixer!.update(delta);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\tupdatePhysics(\r\n\t\tdelta: number,\r\n\t\tinputDir: Vector3,\r\n\t\twantsToSprint: boolean,\r\n\t\twantsJump: boolean,\r\n\t\twantsCrouch: boolean,\r\n\t\t_arenaObjects: Array<{ mesh: any; box: any }>\r\n\t) {\r\n\r\n\t\tthis.prevVelocity.copy(this.velocity);\r\n\r\n\t\tconst hasInput = inputDir.squaredLength() > 0;\r\n\t\tif (hasInput) {\r\n\t\t\tinputDir.normalize();\r\n\t\t\t// Apply rotation to input\r\n\t\t\tinputDir.applyRotation(this.rotation);\r\n\r\n\t\t\t// Slope adjustment\r\n\t\t\tif (this.onGround && this.slopeAngle > 0) {\r\n\t\t\t\t// Project inputDir onto the plane defined by groundNormal\r\n\t\t\t\t// Yuka Vector3 doesn't have projectOnPlane, so we do it manually\r\n\t\t\t\t// v - n * (v . n)\r\n\t\t\t\tconst dot = inputDir.dot(this.groundNormal);\r\n\t\t\t\tconst proj = this.groundNormal.clone().multiplyScalar(dot);\r\n\t\t\t\tinputDir.sub(proj).normalize();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Slide Cooldown\r\n\t\tif (this.slideCooldownTimer > 0) {\r\n\t\t\tthis.slideCooldownTimer -= delta;\r\n\t\t}\r\n\r\n\t\t// Slide Initiation\r\n\t\tif (wantsCrouch && this.isSprinting && this.onGround && this.slideCooldownTimer <= 0 && !this.isSliding) {\r\n\t\t\tthis.isSliding = true;\r\n\t\t\tthis.slideTimer = PLAYER_CONFIG.slideDuration || 1.0;\r\n\t\t\tthis.slideDirection.copy(this.velocity).normalize();\r\n\t\t\tthis.velocity.add(this.slideDirection.clone().multiplyScalar(2));\r\n\t\t}\r\n\r\n\t\t// Slide State Management\r\n\t\tif (this.isSliding) {\r\n\t\t\tthis.slideTimer -= delta;\r\n\t\t\tif (this.slideTimer <= 0 || this.velocity.length() < (PLAYER_CONFIG.walkSpeed || 8) * 0.5) {\r\n\t\t\t\tthis.isSliding = false;\r\n\t\t\t\tthis.slideCooldownTimer = PLAYER_CONFIG.slideCooldown || 1.0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Sprint and stamina\r\n\t\tthis.isSprinting = wantsToSprint && this.onGround && this.stamina > 0 && !this.isSliding;\r\n\t\tif (this.isSprinting) {\r\n\t\t\tthis.stamina -= (PLAYER_CONFIG.staminaDrain || 20) * delta;\r\n\t\t\tif (this.stamina < 0) {\r\n\t\t\t\tthis.stamina = 0;\r\n\t\t\t\tthis.isSprinting = false;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.stamina = Math.min(PLAYER_CONFIG.maxStamina || 100, this.stamina + (PLAYER_CONFIG.staminaRegen || 30) * delta);\r\n\t\t}\r\n\r\n\t\t// Movement\r\n\t\tlet targetSpeed = PLAYER_CONFIG.walkSpeed || 8;\r\n\t\tif (this.isSprinting) targetSpeed = PLAYER_CONFIG.sprintSpeed || 13;\r\n\r\n\t\tconst isGrounded = this.onGround;\r\n\t\t\r\n\t\t// Horizontal velocity\r\n\t\tconst horizVel = new Vector3(this.velocity.x, 0, this.velocity.z);\r\n\r\n\t\tif (this.isSliding) {\r\n\t\t\tconst slideSpeed = (PLAYER_CONFIG.slideSpeed || 18) * (this.slideTimer / (PLAYER_CONFIG.slideDuration || 1.0));\r\n\t\t\tconst targetSlideVel = new Vector3(this.slideDirection.x, 0, this.slideDirection.z).multiplyScalar(slideSpeed);\r\n\r\n\t\t\t// Lerp horizontal velocity\r\n\t\t\t// Yuka Vector3 doesn't have lerp, do manual\r\n\t\t\tconst alpha = (PLAYER_CONFIG.slideFriction || 2.5) * delta;\r\n\t\t\thorizVel.x += (targetSlideVel.x - horizVel.x) * alpha;\r\n\t\t\thorizVel.z += (targetSlideVel.z - horizVel.z) * alpha;\r\n\t\t} else {\r\n\t\t\tconst accel = isGrounded ? (PLAYER_CONFIG.groundAccel || 50) : (PLAYER_CONFIG.airAccel || 20);\r\n\t\t\tconst decel = isGrounded ? (PLAYER_CONFIG.groundDecel || 30) : (PLAYER_CONFIG.airDecel || 5);\r\n\r\n\t\t\tif (hasInput) {\r\n\t\t\t\tconst targetVel = new Vector3(inputDir.x, 0, inputDir.z).multiplyScalar(targetSpeed);\r\n\t\t\t\tconst alpha = accel * delta;\r\n\t\t\t\t// Simple lerp approximation for accel\r\n\t\t\t\tconst diff = new Vector3().copy(targetVel).sub(horizVel);\r\n\t\t\t\tif (diff.length() > alpha) {\r\n\t\t\t\t\tdiff.normalize().multiplyScalar(alpha);\r\n\t\t\t\t}\r\n\t\t\t\thorizVel.add(diff);\r\n\t\t\t} else {\r\n\t\t\t\tconst decayFactor = Math.exp(-decel * delta);\r\n\t\t\t\thorizVel.multiplyScalar(decayFactor);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.velocity.x = horizVel.x;\r\n\t\tthis.velocity.z = horizVel.z;\r\n\r\n\t\t// Head bob\r\n\t\tconst speed = Math.sqrt(this.velocity.x * this.velocity.x + this.velocity.z * this.velocity.z);\r\n\t\tthis.headBobTime += delta * speed * 2;\r\n\r\n\t\t// Apply head bob to camera (head entity)\r\n\t\tif (this.head) {\r\n\t\t\tconst motion = Math.sin(this.headBobTime);\r\n\t\t\t// Head position = base height + bob offset\r\n\t\t\tthis.head.position.y = this.height + Math.abs(motion) * 0.06;\r\n\t\t\tthis.head.position.x = motion * 0.08;\r\n\t\t}\r\n\r\n\t\t// Jump\r\n\t\tif (this.onGround) {\r\n\t\t\tthis.coyoteTimer = PLAYER_CONFIG.coyoteTime || 0.15;\r\n\t\t\tthis.isJumping = false;\r\n\t\t} else {\r\n\t\t\tthis.coyoteTimer = Math.max(0, this.coyoteTimer - delta);\r\n\t\t}\r\n\r\n\t\tthis.jumpBufferTimer = Math.max(0, this.jumpBufferTimer - delta);\r\n\t\tif (wantsJump) this.jumpBufferTimer = 0.1; // Set buffer\r\n\r\n\t\tconst canJump = this.coyoteTimer > 0 || this.onGround;\r\n\t\tif (canJump && this.jumpBufferTimer > 0) {\r\n\t\t\tthis.velocity.y = PLAYER_CONFIG.jumpForce || 12;\r\n\t\t\tthis.isJumping = true;\r\n\t\t\tthis.canCutJump = true;\r\n\t\t\tthis.coyoteTimer = 0;\r\n\t\t\tthis.jumpBufferTimer = 0;\r\n\r\n\t\t\tif (this.isSliding) {\r\n\t\t\t\tthis.isSliding = false;\r\n\t\t\t\tthis.slideCooldownTimer = PLAYER_CONFIG.slideCooldown || 1.0;\r\n\t\t\t}\r\n\r\n\t\t\t// Play jump sound\r\n\t\t\tconst audio = this.audios.get('jump'); // Assuming 'jump' audio exists or we map it\r\n\t\t\tif (audio && !audio.isPlaying) audio.play();\r\n\t\t}\r\n\r\n\t\tif (this.canCutJump && !wantsJump && this.velocity.y > 0) {\r\n\t\t\tthis.velocity.y *= (PLAYER_CONFIG.jumpCutMultiplier || 0.5);\r\n\t\t\tthis.canCutJump = false;\r\n\t\t}\r\n\r\n\t\t// Gravity\r\n\t\tthis.velocity.y -= (PLAYER_CONFIG.gravity || 35) * delta;\r\n\r\n\t\t// Move\r\n\t\tconst moveStep = this.velocity.clone().multiplyScalar(delta);\r\n\t\tconst newPos = this.position.clone().add(moveStep);\r\n\r\n\t\t// Ground collision using navMesh (like original Drift)\r\n\t\tthis.onGround = false;\r\n\t\t\r\n\t\tif (this.world.navMesh && this.currentRegion) {\r\n\t\t\t// Use navMesh-based collision\r\n\t\t\tthis.currentPosition.copy(newPos);\r\n\t\t\t\r\n\t\t\tthis.currentRegion = this.world.navMesh.clampMovement(\r\n\t\t\t\tthis.currentRegion,\r\n\t\t\t\tthis.previousPosition,\r\n\t\t\t\tthis.currentPosition,\r\n\t\t\t\tnewPos // result vector gets clamped\r\n\t\t\t);\r\n\t\t\t\r\n\t\t\tthis.previousPosition.copy(newPos);\r\n\t\t\t\r\n\t\t\t// Adjust height according to ground (like original stayInLevel)\r\n\t\t\tif (this.currentRegion) {\r\n\t\t\t\tconst distance = this.currentRegion.plane.distanceToPoint(newPos);\r\n\t\t\t\t\r\n\t\t\t\t// Smooth ground following when on/near ground\r\n\t\t\t\tif (this.velocity.y <= 0) {\r\n\t\t\t\t\tnewPos.y -= distance * CONFIG.NAVMESH.HEIGHT_CHANGE_FACTOR;\r\n\t\t\t\t\tif (Math.abs(distance) < 0.5) {\r\n\t\t\t\t\t\tthis.velocity.y = 0;\r\n\t\t\t\t\t\tthis.onGround = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Fallback: simple ground plane at y=0\r\n\t\t\tif (newPos.y <= 0) {\r\n\t\t\t\tnewPos.y = 0;\r\n\t\t\t\tthis.velocity.y = 0;\r\n\t\t\t\tthis.onGround = true;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.position.copy(newPos);\r\n\t}\r\n\r\n\tcheckSlope(_arenaObjects: any[]) {\r\n\t\t// Simplified slope check\r\n\t\tthis.slopeAngle = 0;\r\n\t\tthis.groundNormal.set(0, 1, 0);\r\n\t\t// Raycast down would be better, but for now assume flat or handle via collision\r\n\t}\r\n\r\n\t/**\r\n\t* Resets the player after a death.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\treset() {\r\n\r\n\t\tthis.health = this.maxHealth;\r\n\t\tthis.status = STATUS_ALIVE;\r\n\r\n\t\t// Reset physics state\r\n\t\tthis.velocity.set(0, 0, 0);\r\n\t\tthis.prevVelocity.set(0, 0, 0);\r\n\t\tthis.onGround = true;\r\n\t\tthis.isSprinting = false;\r\n\t\tthis.isSliding = false;\r\n\t\tthis.slideTimer = 0;\r\n\t\tthis.slideCooldownTimer = 0;\r\n\t\tthis.slideDirection.set(0, 0, 0);\r\n\t\tthis.coyoteTimer = 0;\r\n\t\tthis.jumpBufferTimer = 0;\r\n\t\tthis.isJumping = false;\r\n\t\tthis.canCutJump = false;\r\n\t\tthis.groundNormal.set(0, 1, 0);\r\n\t\tthis.slopeAngle = 0;\r\n\t\tthis.stamina = 100;\r\n\t\tthis.landingImpact = 0;\r\n\t\tthis.headBobTime = 0;\r\n\r\n\t\tthis.weaponSystem.reset();\r\n\r\n\t\tthis.world.fpsControls.reset();\r\n\t\tthis.world.fpsControls.active = true;\r\n\r\n\t\tthis.world.uiManager.showFPSInterface();\r\n\t\t// Note: Health UI is updated after respawn position is set, not here\r\n\r\n\t\t// Reset death animation properly so it can play again\r\n\t\tconst animation = this.animations.get('player_death');\r\n\t\tif (animation) {\r\n\t\t\tanimation.stop();\r\n\t\t\tanimation.reset(); // Reset time to 0 so it can play from beginning next time\r\n\t\t}\r\n\r\n\t\t// Reset endTimeDying to prevent immediate re-death\r\n\t\tthis.endTimeDying = Infinity;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Alias for reset, required by GameModeManager\r\n\t*/\r\n\trespawn() {\r\n\t\tthis.reset();\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the death of the player.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tinitDeath() {\r\n\r\n\t\tthis.status = STATUS_DYING;\r\n\t\tthis.endTimeDying = this.currentTime + this.dyingTime;\r\n\r\n\t\tthis.velocity.set(0, 0, 0);\r\n\r\n\t\tconst animation = this.animations.get('player_death');\r\n\t\tif (animation) {\r\n\t\t\tanimation.reset(); // Ensure animation starts from beginning\r\n\t\t\tanimation.play();\r\n\t\t}\r\n\r\n\t\tthis.weaponSystem.hideCurrentWeapon();\r\n\r\n\t\tthis.world.fpsControls.active = false;\r\n\t\tthis.world.uiManager.hideFPSInterface();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Fires a round at the player's target with the current armed weapon.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tshoot() {\r\n\r\n\t\t// Cannot shoot if dead or dying\r\n\t\tif (this.status !== STATUS_ALIVE) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\tconst head = this.head;\r\n\t\tconst world = this.world;\r\n\r\n\t\t// Use RIFT weapon system if available\r\n\t\tif (world.rift && world.rift.weaponSystem) {\r\n\t\t\tconst onGround = this.velocity.y === 0;\r\n\t\t\tconst isSprinting = Math.sqrt(this.velocity.x ** 2 + this.velocity.z ** 2) > 10;\r\n\t\t\tconst velocity = new ThreeVector3(this.velocity.x, this.velocity.y, this.velocity.z);\r\n\r\n\t\t\t// Build obstacle list: level geometry + enemy render components\r\n\t\t\tconst obstacles: any[] = [];\r\n\r\n\t\t\t// Add level geometry\r\n\t\t\tif (world.level && world.level.renderComponent) {\r\n\t\t\t\tobstacles.push(world.level.renderComponent);\r\n\t\t\t\tconsole.log('Added level to obstacles:', world.level.renderComponent.name);\r\n\t\t\t}\r\n\r\n\t\t\t// Add all competitors (enemies) render components\r\n\t\t\tworld.competitors.forEach((competitor: any) => {\r\n\t\t\t\tif (competitor !== this && competitor.active && competitor.renderComponent) {\r\n\t\t\t\t\tobstacles.push(competitor.renderComponent);\r\n\t\t\t\t\tconsole.log('Added competitor to obstacles:', competitor.name, 'Active:', competitor.active);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tconsole.log('Total obstacles for raycast:', obstacles.length);\r\n\t\t\tworld.rift.handleShooting(onGround, isSprinting, velocity, obstacles);\r\n\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t// Fallback to old system if RIFT not available\r\n\t\tconst ray = projectile.ray;\r\n\t\thead.getWorldPosition(ray.origin);\r\n\t\thead.getWorldDirection(ray.direction);\r\n\t\tprojectile.owner = this;\r\n\r\n\t\tconst result = world.checkProjectileIntersection(projectile, intersectionPoint);\r\n\t\tconst distance = (result === null) ? 1000 : ray.origin.distanceTo(intersectionPoint);\r\n\t\ttargetPosition.copy(ray.origin).add(ray.direction.multiplyScalar(distance));\r\n\r\n\t\tthis.weaponSystem.shoot(targetPosition);\r\n\t\tworld.uiManager.updateAmmoStatus();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Reloads the current weapon of the player.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\treload() {\r\n\r\n\t\t// Use RIFT weapon system if available\r\n\t\tif (this.world.rift && this.world.rift.weaponSystem) {\r\n\t\t\tthis.world.rift.weaponSystem.reload();\r\n\t\t} else {\r\n\t\t\tthis.weaponSystem.reload();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Changes the weapon to the defined type.\r\n\t*\r\n\t* @param {WEAPON_TYPES} type - The weapon type.\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tchangeWeapon(type: number) {\r\n\r\n\t\t// Use RIFT weapon system if available\r\n\t\tif (this.world.rift && this.world.rift.weaponSystem) {\r\n\t\t\t// Map old weapon types to RIFT weapon indices (0-8)\r\n\t\t\tconst weaponMap: { [key: number]: number } = {\r\n\t\t\t\t[WEAPON_TYPES_BLASTER]: 4, // Pistol\r\n\t\t\t\t[WEAPON_TYPES_SHOTGUN]: 6, // Shotgun\r\n\t\t\t\t[WEAPON_TYPES_ASSAULT_RIFLE]: 0, // AK47\r\n\t\t\t};\r\n\t\t\tconst weaponIndex = weaponMap[type] !== undefined ? weaponMap[type] : 0;\r\n\t\t\tthis.world.rift.weaponSystem.switchWeapon(weaponIndex);\r\n\t\t} else {\r\n\t\t\tthis.weaponSystem.setNextWeapon(type);\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns true if the player has a weapon of the given type.\r\n\t*\r\n\t* @param {WEAPON_TYPES} type - The weapon type.\r\n\t* @return {Boolean} Whether the player has a weapon of the given type or not.\r\n\t*/\r\n\thasWeapon(type: number) {\r\n\r\n\t\treturn this.weaponSystem.getWeapon(type) !== null;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Indicates if the player does currently use an automatic weapon.\r\n\t*\r\n\t* @return {Boolean} Whether an automatic weapon is used or not.\r\n\t*/\r\n\tisAutomaticWeaponUsed() {\r\n\r\n\t\treturn (this.weaponSystem.currentWeapon!.type === WEAPON_TYPES_ASSAULT_RIFLE);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Activates this game entity. Enemies will shot at the player and\r\n\t* the current weapon is rendered.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tactivate() {\r\n\r\n\t\tthis.active = true;\r\n\t\tif (this.weaponSystem.currentWeapon) {\r\n\t\t\tthis.weaponSystem.currentWeapon._renderComponent.visible = true;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Deactivates this game entity. Enemies will not shot at the player and\r\n\t* the current weapon is not rendered.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tdeactivate() {\r\n\r\n\t\tthis.active = false;\r\n\t\tif (this.weaponSystem.currentWeapon) {\r\n\t\t\tthis.weaponSystem.currentWeapon._renderComponent.visible = false;\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Returns the intesection point if a projectile intersects with this entity.\r\n\t* If no intersection is detected, null is returned.\r\n\t*\r\n\t* @param {Ray} ray - The ray that defines the trajectory of this bullet.\r\n\t* @param {Vector3} intersectionPoint - The intersection point.\r\n\t* @return {Vector3} The intersection point.\r\n\t*/\r\n\tcheckProjectileIntersection(ray: any, intersectionPoint: any) {\r\n\r\n\t\treturn ray.intersectAABB(this.bounds, intersectionPoint);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Ensures the player never leaves the level.\r\n\t*\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tstayInLevel() {\r\n\r\n\t\t// \"currentPosition\" represents the final position after the movement for a single\r\n\t\t// simualation step. it's now necessary to check if this point is still on\r\n\t\t// the navMesh\r\n\r\n\t\tthis.currentPosition.copy(this.position);\r\n\r\n\t\tthis.currentRegion = this.world.navMesh.clampMovement(\r\n\t\t\tthis.currentRegion,\r\n\t\t\tthis.previousPosition,\r\n\t\t\tthis.currentPosition,\r\n\t\t\tthis.position // this is the result vector that gets clamped\r\n\t\t);\r\n\r\n\t\t// save this position for the next method invocation\r\n\r\n\t\tthis.previousPosition.copy(this.position);\r\n\r\n\t\t// adjust height of the entity according to the ground\r\n\r\n\t\tconst distance = this.currentRegion.plane.distanceToPoint(this.position);\r\n\r\n\t\tthis.position.y -= distance * CONFIG.NAVMESH.HEIGHT_CHANGE_FACTOR; // smooth transition\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/*\r\n\t* Adds the given health points to this entity.\r\n\t*\r\n\t* @param {Number} amount - The amount of health to add.\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\taddHealth(amount: number) {\r\n\r\n\t\tthis.health += amount;\r\n\r\n\t\tthis.health = Math.min(this.health, this.maxHealth); // ensure that health does not exceed maxHealth\r\n\r\n\t\tthis.world.uiManager.updateHealthStatus();\r\n\r\n\t\t//\r\n\r\n\t\tif (this.world.debug) {\r\n\r\n\t\t\tconsole.log('DIVE.Player: Entity with ID %s receives %i health points.', this.uuid, amount);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/*\r\n\t* Adds the given weapon to the internal weapon system.\r\n\t*\r\n\t* @param {WEAPON_TYPES} type - The weapon type.\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\taddWeapon(type: number) {\r\n\r\n\t\tthis.weaponSystem.addWeapon(type);\r\n\r\n\t\t// if the entity already has the weapon, increase the ammo\r\n\r\n\t\tthis.world.uiManager.updateAmmoStatus();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Sets the animations of this game entity by creating a\r\n\t* series of animation actions.\r\n\t*\r\n\t* @param {AnimationMixer} mixer - The animation mixer.\r\n\t* @param {Array} clips - An array of animation clips.\r\n\t* @return {Player} A reference to this game entity.\r\n\t*/\r\n\tsetAnimations(mixer: any, clips: any) {\r\n\r\n\t\tthis.mixer = mixer;\r\n\r\n\t\t// actions\r\n\r\n\t\tfor (const clip of clips) {\r\n\r\n\t\t\tconst action = mixer.clipAction(clip);\r\n\t\t\taction.loop = LoopOnce;\r\n\t\t\taction.clampWhenFinished = true; // Hold at the end frame\r\n\t\t\taction.name = clip.name;\r\n\r\n\t\t\tthis.animations.set(action.name, action);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Holds the implementation for the message handling of this game entity.\r\n\t*\r\n\t* @param {Telegram} telegram - The telegram with the message data.\r\n\t* @return {Boolean} Whether the message was processed or not.\r\n\t*/\r\n\thandleMessage(telegram: any) {\r\n\r\n\t\tswitch (telegram.message) {\r\n\r\n\t\t\tcase MESSAGE_HIT:\r\n\r\n\t\t\t\t// Ignore damage if already dead or dying\r\n\t\t\t\tif (this.status !== STATUS_ALIVE) {\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// play audio\r\n\r\n\t\t\t\tconst audio = this.audios.get('impact' + MathUtils.randInt(1, 7));\r\n\t\t\t\tif (audio && audio.isPlaying === true) audio.stop();\r\n\t\t\t\tif (audio) audio.play();\r\n\r\n\t\t\t\t// reduce health (clamp to 0 minimum)\r\n\r\n\t\t\t\tthis.health = Math.max(0, this.health - telegram.data.damage);\r\n\r\n\t\t\t\t// update UI\r\n\r\n\t\t\t\tthis.world.uiManager.updateHealthStatus();\r\n\t\t\t\t\r\n\t\t\t\t// Apply RIFT damage effects (screen shake, vignette)\r\n\t\t\t\tif (this.world.rift) {\r\n\t\t\t\t\tconst angle = this.computeAngleToAttacker(telegram.data.direction);\r\n\t\t\t\t\tconst angleDegrees = (angle * 180) / Math.PI;\r\n\t\t\t\t\tthis.world.rift.applyDamageEffects(telegram.data.damage, this.maxHealth, angleDegrees);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// logging\r\n\r\n\t\t\t\tif (this.world.debug) {\r\n\r\n\t\t\t\t\tconsole.log('DIVE.Player: Player hit by Game Entity with ID %s receiving %i damage.', telegram.sender.uuid, telegram.data.damage);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// check if the player is dead\r\n\r\n\t\t\t\tif (this.health <= 0 && this.status === STATUS_ALIVE) {\r\n\r\n\t\t\t\t\tthis.initDeath();\r\n\r\n\t\t\t\t\t// inform all other competitors about its death\r\n\r\n\t\t\t\t\tconst competitors = this.world.competitors;\r\n\r\n\t\t\t\t\tfor (let i = 0, l = competitors.length; i < l; i++) {\r\n\r\n\t\t\t\t\t\tconst competitor = competitors[i];\r\n\r\n\t\t\t\t\t\tif (this !== competitor) this.sendMessage(competitor, MESSAGE_DEAD);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// update UI\r\n\r\n\t\t\t\t\tthis.world.uiManager.addFragMessage(telegram.sender, this);\r\n\r\n\t\t\t\t} else {\r\n\r\n\t\t\t\t\tconst angle = this.computeAngleToAttacker(telegram.data.direction);\r\n\t\t\t\t\tthis.world.uiManager.showDamageIndication(angle);\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t\tbreak;\r\n\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Computes the angle between the current look direction and the attack direction in\r\n\t* the range of [-, ].\r\n\t*\r\n\t* @param {Vector3} projectileDirection - The direction of the projectile.\r\n\t* @return {Number} The angle in radians.\r\n\t*/\r\n\tcomputeAngleToAttacker(projectileDirection: any) {\r\n\r\n\t\tattackDirection.copy(projectileDirection).multiplyScalar(- 1);\r\n\t\tattackDirection.y = 0; // project plane on (0,1,0) plane\r\n\t\tattackDirection.normalize();\r\n\r\n\t\tthis.head.getWorldDirection(lookDirection);\r\n\t\tlookDirection.y = 0;\r\n\t\tlookDirection.normalize();\r\n\r\n\t\t// since both direction vectors lie in the same plane, use the following formula\r\n\t\t//\r\n\t\t// dot = a * b\r\n\t\t// det = n * (a x b)\r\n\t\t// angle = atan2(det, dot)\r\n\t\t//\r\n\t\t// Note: We can't use Vector3.angleTo() since the result is always in the range [0,]\r\n\r\n\t\tconst dot = attackDirection.dot(lookDirection);\r\n\t\tconst det = this.up.dot(cross.crossVectors(attackDirection, lookDirection)); // triple product\r\n\r\n\t\treturn Math.atan2(det, dot);\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Player };\r\n","import { Ray } from 'yuka';\r\nimport { CONFIG } from '../core/Config';\r\nimport { Projectile } from './Projectile';\r\n\r\n/**\r\n* Class for representing a bullet.\r\n*/\r\nclass Bullet extends Projectile {\r\n\r\n\t/**\r\n\t* Constructs a new bullet with the given values.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of this bullet.\r\n\t* @param {Ray} ray - The ray that defines the trajectory of this bullet.\r\n\t*/\r\n\tconstructor(owner: any = null, ray: any = new Ray()) {\r\n\r\n\t\tsuper(owner, ray);\r\n\r\n\t\tthis.maxSpeed = CONFIG.BULLET.MAX_SPEED;\r\n\r\n\t\tthis.position.copy(ray.origin);\r\n\t\tthis.velocity.copy(ray.direction).multiplyScalar(this.maxSpeed);\r\n\r\n\t\tconst s = 1 + (Math.random() * 1.5); // scale the shot line a bit\r\n\r\n\t\tthis.scale.set(s, s, s);\r\n\r\n\t\tthis.lifetime = CONFIG.BULLET.LIFETIME;\r\n\r\n\t\tthis.damage = CONFIG.BULLET.DAMAGE;\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { Bullet };\r\n","import { Task } from 'yuka';\r\n\r\n/**\r\n* Class for representing a single path planning task.\r\n*/\r\nclass PathPlannerTask extends Task {\r\n\r\n\tpublic planner: any;\r\n\tpublic vehicle: any;\r\n\tpublic from: any;\r\n\tpublic to: any;\r\n\tpublic callback: any;\r\n\r\n\t/**\r\n\t* Construct a new PathPlannerTask with the given arguments.\r\n\t*\r\n\t* @param {PathPlanner} planner - The path planner which created this task.\r\n\t* @param {Vehicle} vehicle - The vehicle for which the path is to be found.\r\n\t* @param {Vector3} from - The start point of the path.\r\n\t* @param {Vector3} to - The target point of the path.\r\n\t* @param {Function} callback - The callback which is called after the task is finished.\r\n\t*/\r\n\tconstructor(planner: any, vehicle: any, from: any, to: any, callback: any) {\r\n\r\n\t\tsuper();\r\n\r\n\t\tthis.callback = callback;\r\n\t\tthis.planner = planner;\r\n\t\tthis.vehicle = vehicle;\r\n\t\tthis.from = from;\r\n\t\tthis.to = to;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* This function executes the path finding and afterwards the callback function.\r\n\t*/\r\n\texecute() {\r\n\r\n\t\tconst path = this.planner.navMesh.findPath(this.from, this.to);\r\n\r\n\t\tthis.callback(this.vehicle, path);\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { PathPlannerTask };\r\n","import { TaskQueue } from 'yuka';\r\nimport { PathPlannerTask } from './PathPlannerTask';\r\n\r\n/**\r\n* Class for asynchronous path finding using Yuka's task features.\r\n*/\r\nclass PathPlanner {\r\n\r\n\tpublic navMesh: any;\r\n\tpublic taskQueue: TaskQueue;\r\n\r\n\t/**\r\n\t* Construct a new PathPlanner with the given arguments.\r\n\t*\r\n\t* @param {NavMesh} navMesh - The navmesh used for path finding.\r\n\t*/\r\n\tconstructor(navMesh: any) {\r\n\r\n\t\tthis.navMesh = navMesh;\r\n\r\n\t\tthis.taskQueue = new TaskQueue();\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a new task for pathfinding and adds the task to the queue.\r\n\t*\r\n\t* @param {Vehicle} vehicle - The vehicle for which the path is to be found.\r\n\t* @param {Vector3} from - The start point of the path.\r\n\t* @param {Vector3} to - The target point of the path.\r\n\t* @param {Function} callback - The callback which is called after the task is finished.\r\n\t*/\r\n\tfindPath(vehicle: any, from: any, to: any, callback: any) {\r\n\r\n\t\tconst task = new PathPlannerTask(this, vehicle, from, to, callback);\r\n\r\n\t\tthis.taskQueue.enqueue(task);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Update method of the path planenr.\r\n\t*/\r\n\tupdate() {\r\n\r\n\t\tthis.taskQueue.update();\r\n\r\n\t}\r\n\r\n}\r\n\r\nexport { PathPlanner };\r\n","import { ShaderMaterial, UniformsUtils, BackSide, Mesh, BoxGeometry, Vector3 } from 'three';\r\n\r\nclass Sky extends Mesh {\r\n\r\n\tconstructor() {\r\n\r\n\t\tconst shader = SkyShader;\r\n\r\n\t\tconst material = new ShaderMaterial( {\r\n\t\t\tfragmentShader: shader.fragmentShader,\r\n\t\t\tvertexShader: shader.vertexShader,\r\n\t\t\tuniforms: UniformsUtils.clone( shader.uniforms ),\r\n\t\t\tside: BackSide,\r\n\t\t\tdepthWrite: false\r\n\t\t} );\r\n\r\n\t\tsuper( new BoxGeometry( 1, 1, 1 ), material );\r\n\r\n\t}\r\n\r\n}\r\n\r\nconst SkyShader = {\r\n\r\n\tuniforms: {\r\n\t\t'skyLuminance': { value: 1 },\r\n\t\t'turbidity': { value: 2 },\r\n\t\t'rayleigh': { value: 1 },\r\n\t\t'mieCoefficient': { value: 0.005 },\r\n\t\t'mieDirectionalG': { value: 0.8 },\r\n\t\t'sunPosition': { value: new Vector3() }\r\n\t},\r\n\r\n\tvertexShader: /* glsl */`\r\n\t\tuniform vec3 sunPosition;\r\n\t\tuniform float rayleigh;\r\n\t\tuniform float turbidity;\r\n\t\tuniform float mieCoefficient;\r\n\r\n\t\tvarying vec3 vWorldPosition;\r\n\t\tvarying vec3 vSunDirection;\r\n\t\tvarying float vSunfade;\r\n\t\tvarying vec3 vBetaR;\r\n\t\tvarying vec3 vBetaM;\r\n\t\tvarying float vSunE;\r\n\r\n\t\tconst vec3 up = vec3( 0.0, 1.0, 0.0 );\r\n\r\n\t\t// constants for atmospheric scattering\r\n\t\tconst float e = 2.71828182845904523536028747135266249775724709369995957;\r\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\r\n\r\n\t\t// wavelength of used primaries, according to preetham\r\n\t\tconst vec3 lambda = vec3( 680E-9, 550E-9, 450E-9 );\r\n\t\t// this pre-calcuation replaces older TotalRayleigh(vec3 lambda) function:\r\n\t\t// (8.0 * pow(pi, 3.0) * pow(pow(n, 2.0) - 1.0, 2.0) * (6.0 + 3.0 * pn)) / (3.0 * N * pow(lambda, vec3(4.0)) * (6.0 - 7.0 * pn))\r\n\t\tconst vec3 totalRayleigh = vec3( 5.804542996261093E-6, 1.3562911419845635E-5, 3.0265902468824876E-5 );\r\n\r\n\t\t// mie stuff\r\n\t\t// K coefficient for the primaries\r\n\t\tconst float v = 4.0;\r\n\t\tconst vec3 K = vec3( 0.686, 0.678, 0.666 );\r\n\t\t// MieConst = pi * pow( ( 2.0 * pi ) / lambda, vec3( v - 2.0 ) ) * K\r\n\t\tconst vec3 MieConst = vec3( 1.8399918514433978E14, 2.7798023919660528E14, 4.0790479543861094E14 );\r\n\r\n\t\t// earth shadow hack\r\n\t\t// cutoffAngle = pi / 1.95;\r\n\t\tconst float cutoffAngle = 1.6110731556870734;\r\n\t\tconst float steepness = 1.5;\r\n\t\tconst float EE = 1000.0;\r\n\r\n\t\tfloat sunIntensity( float zenithAngleCos ) {\r\n\t\t\tzenithAngleCos = clamp( zenithAngleCos, -1.0, 1.0 );\r\n\t\t\treturn EE * max( 0.0, 1.0 - pow( e, -( ( cutoffAngle - acos( zenithAngleCos ) ) / steepness ) ) );\r\n\t\t}\r\n\r\n\t\tvec3 totalMie( float T ) {\r\n\t\t\tfloat c = ( 0.2 * T ) * 10E-18;\r\n\t\t\treturn 0.434 * c * MieConst;\r\n\t\t}\r\n\r\n\t\tvoid main() {\r\n\r\n\t\t\tvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\r\n\t\t\tvWorldPosition = worldPosition.xyz;\r\n\r\n\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\r\n\t\t\tgl_Position.z = gl_Position.w; // set z to camera.far\r\n\r\n\t\t\tvSunDirection = normalize( sunPosition );\r\n\r\n\t\t\tvSunE = sunIntensity( dot( vSunDirection, up ) );\r\n\r\n\t\t\tvSunfade = 1.0 - clamp( 1.0 - exp( ( sunPosition.y / 450000.0 ) ), 0.0, 1.0 );\r\n\r\n\t\t\tfloat rayleighCoefficient = rayleigh - ( 1.0 * ( 1.0 - vSunfade ) );\r\n\r\n\t\t\t// extinction (absorbtion + out scattering)\r\n\t\t\t// rayleigh coefficients\r\n\t\t\tvBetaR = totalRayleigh * rayleighCoefficient;\r\n\r\n\t\t\t// mie coefficients\r\n\t\t\tvBetaM = totalMie( turbidity ) * mieCoefficient;\r\n\r\n\t\t}\r\n\t`,\r\n\r\n\tfragmentShader: /* glsl */`\r\n\t\tvarying vec3 vWorldPosition;\r\n\t\tvarying vec3 vSunDirection;\r\n\t\tvarying float vSunfade;\r\n\t\tvarying vec3 vBetaR;\r\n\t\tvarying vec3 vBetaM;\r\n\t\tvarying float vSunE;\r\n\r\n\t\tuniform float skyLuminance;\r\n\t\tuniform float mieDirectionalG;\r\n\r\n\t\tconst vec3 cameraPos = vec3( 0.0, 0.0, 0.0 );\r\n\r\n\t\t// constants for atmospheric scattering\r\n\t\tconst float pi = 3.141592653589793238462643383279502884197169;\r\n\r\n\t\tconst float n = 1.0003; // refractive index of air\r\n\t\tconst float N = 2.545E25; // number of molecules per unit volume for air at 288.15K and 1013mb (sea level -45 celsius)\r\n\r\n\t\t// optical length at zenith for molecules\r\n\t\tconst float rayleighZenithLength = 8.4E3;\r\n\t\tconst float mieZenithLength = 1.25E3;\r\n\t\tconst vec3 up = vec3( 0.0, 1.0, 0.0 );\r\n\t\t// 66 arc seconds -> degrees, and the cosine of that\r\n\t\tconst float sunAngularDiameterCos = 0.999956676946448443553574619906976478926848692873900859324;\r\n\r\n\t\t// 3.0 / ( 16.0 * pi )\r\n\t\tconst float THREE_OVER_SIXTEENPI = 0.05968310365946075;\r\n\t\t// 1.0 / ( 4.0 * pi )\r\n\t\tconst float ONE_OVER_FOURPI = 0.07957747154594767;\r\n\r\n\t\tfloat rayleighPhase( float cosTheta ) {\r\n\t\t\treturn THREE_OVER_SIXTEENPI * ( 1.0 + pow( cosTheta, 2.0 ) );\r\n\t\t}\r\n\r\n\t\tfloat hgPhase( float cosTheta, float g ) {\r\n\t\t\tfloat g2 = pow( g, 2.0 );\r\n\t\t\tfloat inverse = 1.0 / pow( 1.0 - 2.0 * g * cosTheta + g2, 1.5 );\r\n\t\t\treturn ONE_OVER_FOURPI * ( ( 1.0 - g2 ) * inverse );\r\n\t\t}\r\n\r\n\t\t// Filmic ToneMapping http://filmicgames.com/archives/75\r\n\t\tconst float A = 0.15;\r\n\t\tconst float B = 0.50;\r\n\t\tconst float C = 0.10;\r\n\t\tconst float D = 0.20;\r\n\t\tconst float E = 0.02;\r\n\t\tconst float F = 0.30;\r\n\r\n\t\tconst float whiteScale = 1.0748724675633854; // 1.0 / Uncharted2Tonemap(1000.0)\r\n\r\n\t\tvec3 Uncharted2Tonemap( vec3 x ) {\r\n\t\t\treturn ( ( x * ( A * x + C * B ) + D * E ) / ( x * ( A * x + B ) + D * F ) ) - E / F;\r\n\t\t}\r\n\r\n\r\n\t\tvoid main() {\r\n\t\t\t// optical length\r\n\t\t\t// cutoff angle at 90 to avoid singularity in next formula.\r\n\t\t\tfloat zenithAngle = acos( max( 0.0, dot( up, normalize( vWorldPosition - cameraPos ) ) ) );\r\n\t\t\tfloat inverse = 1.0 / ( cos( zenithAngle ) + 0.15 * pow( 93.885 - ( ( zenithAngle * 180.0 ) / pi ), -1.253 ) );\r\n\t\t\tfloat sR = rayleighZenithLength * inverse;\r\n\t\t\tfloat sM = mieZenithLength * inverse;\r\n\r\n\t\t\t// combined extinction factor\r\n\t\t\tvec3 Fex = exp( -( vBetaR * sR + vBetaM * sM ) );\r\n\r\n\t\t\t// in scattering\r\n\t\t\tfloat cosTheta = dot( normalize( vWorldPosition - cameraPos ), vSunDirection );\r\n\r\n\t\t\tfloat rPhase = rayleighPhase( cosTheta * 0.5 + 0.5 );\r\n\t\t\tvec3 betaRTheta = vBetaR * rPhase;\r\n\r\n\t\t\tfloat mPhase = hgPhase( cosTheta, mieDirectionalG );\r\n\t\t\tvec3 betaMTheta = vBetaM * mPhase;\r\n\r\n\t\t\tvec3 Lin = pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * ( 1.0 - Fex ), vec3( 1.5 ) );\r\n\t\t\tLin *= mix( vec3( 1.0 ), pow( vSunE * ( ( betaRTheta + betaMTheta ) / ( vBetaR + vBetaM ) ) * Fex, vec3( 1.0 / 2.0 ) ), clamp( pow( 1.0 - dot( up, vSunDirection ), 5.0 ), 0.0, 1.0 ) );\r\n\r\n\t\t\t// nightsky\r\n\t\t\tvec3 direction = normalize( vWorldPosition - cameraPos );\r\n\t\t\tfloat theta = acos( direction.y ); // elevation --> y-axis, [-pi/2, pi/2]\r\n\t\t\tfloat phi = atan( direction.z, direction.x ); // azimuth --> x-axis [-pi/2, pi/2]\r\n\t\t\tvec2 uv = vec2( phi, theta ) / vec2( 2.0 * pi, pi ) + vec2( 0.5, 0.0 );\r\n\t\t\tvec3 L0 = vec3( 0.1 ) * Fex;\r\n\r\n\t\t\t// composition + solar disc\r\n\t\t\tfloat sundisk = smoothstep( sunAngularDiameterCos, sunAngularDiameterCos + 0.00002, cosTheta );\r\n\t\t\tL0 += ( vSunE * 19000.0 * Fex ) * sundisk;\r\n\r\n\t\t\tvec3 texColor = ( Lin + L0 ) * 0.04 + vec3( 0.0, 0.0003, 0.00075 );\r\n\r\n\t\t\tvec3 curr = Uncharted2Tonemap( ( log2( 2.0 / pow( skyLuminance, 4.0 ) ) ) * texColor );\r\n\t\t\tvec3 color = curr * whiteScale;\r\n\r\n\t\t\tvec3 retColor = pow( color, vec3( 1.0 / ( 1.2 + ( 1.2 * vSunfade ) ) ) );\r\n\r\n\t\t\tgl_FragColor = vec4( retColor, 1.0 );\r\n\r\n\t\t}\r\n\t`\r\n\r\n};\r\n\r\nexport { Sky };\r\n","// RIFT Integration - Particle System\r\n// Handles bullet impacts, muzzle smoke, explosions, debris, shell casings\r\n\r\nimport * as THREE from 'three';\r\n\r\nclass ParticlePool {\r\n  private pool: THREE.Object3D[] = [];\r\n  private createFn: () => THREE.Object3D;\r\n  private scene: THREE.Scene;\r\n\r\n  constructor(scene: THREE.Scene, createFn: () => THREE.Object3D, initialSize: number = 20) {\r\n    this.scene = scene;\r\n    this.createFn = createFn;\r\n    for (let i = 0; i < initialSize; i++) {\r\n      const obj = createFn();\r\n      obj.visible = false;\r\n      this.scene.add(obj);\r\n      this.pool.push(obj);\r\n    }\r\n  }\r\n\r\n  public get(): THREE.Object3D {\r\n    let obj: THREE.Object3D;\r\n    if (this.pool.length > 0) {\r\n      obj = this.pool.pop()!;\r\n    } else {\r\n      obj = this.createFn();\r\n      this.scene.add(obj);\r\n    }\r\n    obj.visible = true;\r\n    return obj;\r\n  }\r\n\r\n  public release(obj: THREE.Object3D): void {\r\n    obj.visible = false;\r\n    this.pool.push(obj);\r\n  }\r\n}\r\n\r\nexport interface Particle {\r\n  mesh: THREE.Mesh | THREE.Sprite;\r\n  velocity: THREE.Vector3;\r\n  lifetime: number;\r\n  maxLifetime: number;\r\n  initialScale?: number;\r\n  gravity?: number;\r\n}\r\n\r\ninterface Shell {\r\n  mesh: THREE.Mesh;\r\n  velocity: THREE.Vector3;\r\n  rotationalVelocity: THREE.Vector3;\r\n  lifetime: number;\r\n  onHit?: (pos: THREE.Vector3) => void;\r\n  hasHit: boolean;\r\n  groundLevel: number; // Y coordinate of the ground where shell should land\r\n  bounceCount: number; // Track number of bounces for sound variation\r\n  settled: boolean; // Whether the shell has come to rest on the ground\r\n}\r\n\r\nexport class ParticleSystem {\r\n  private particles: Particle[] = [];\r\n  private shells: Shell[] = [];\r\n  private scene: THREE.Scene;\r\n  \r\n  // Callback for shell bounce sounds\r\n  private onShellBounce?: (position: THREE.Vector3, bounceNumber: number) => void;\r\n  \r\n  // Pools\r\n  private spherePool: ParticlePool;\r\n  private cubePool: ParticlePool;\r\n  private shellPool: ParticlePool;\r\n  private smokePool: ParticlePool;\r\n  private sparkPool: ParticlePool;\r\n  private shockwavePool: ParticlePool;\r\n\r\n  private hitImpactTexture?: THREE.Texture;\r\n  private hitSpriteLowTexture?: THREE.Texture;\r\n  private fireSmokeTexture?: THREE.Texture;\r\n\r\n  constructor(scene: THREE.Scene) {\r\n    this.scene = scene;\r\n    \r\n    // Initialize pools\r\n    this.spherePool = new ParticlePool(scene, () => {\r\n      return new THREE.Mesh(\r\n        new THREE.SphereGeometry(0.05, 4, 4),\r\n        new THREE.MeshBasicMaterial({ color: 0xffffff })\r\n      );\r\n    }, 100);\r\n\r\n    this.cubePool = new ParticlePool(scene, () => {\r\n      return new THREE.Mesh(\r\n        new THREE.BoxGeometry(0.03, 0.03, 0.03),\r\n        new THREE.MeshBasicMaterial({ color: 0xffffff })\r\n      );\r\n    }, 50);\r\n\r\n    this.shellPool = new ParticlePool(scene, () => {\r\n      // Shell casing - brass colored cylinder, larger for visibility\r\n      const mesh = new THREE.Mesh(\r\n        new THREE.CylinderGeometry(0.008, 0.006, 0.04, 8), // Larger, tapered brass casing\r\n        new THREE.MeshStandardMaterial({ \r\n          color: 0xd4af37, \r\n          metalness: 0.85, \r\n          roughness: 0.15,\r\n          emissive: 0xd4af37,\r\n          emissiveIntensity: 0.15 // Slight glow for visibility\r\n        })\r\n      );\r\n      mesh.castShadow = true;\r\n      return mesh;\r\n    }, 50);\r\n\r\n    this.smokePool = new ParticlePool(scene, () => {\r\n      const material = new THREE.SpriteMaterial({\r\n        color: 0xaaaaaa,\r\n        transparent: true,\r\n        opacity: 0.5,\r\n        blending: THREE.NormalBlending,\r\n        depthWrite: false\r\n      });\r\n      return new THREE.Sprite(material);\r\n    }, 50);\r\n\r\n    this.sparkPool = new ParticlePool(scene, () => {\r\n      return new THREE.Mesh(\r\n        new THREE.BoxGeometry(0.05, 0.05, 0.2),\r\n        new THREE.MeshBasicMaterial({ color: 0xffff00 })\r\n      );\r\n    }, 50);\r\n\r\n    this.shockwavePool = new ParticlePool(scene, () => {\r\n      return new THREE.Mesh(\r\n        new THREE.TorusGeometry(1, 0.1, 8, 32),\r\n        new THREE.MeshBasicMaterial({ color: 0xffaa00, transparent: true, opacity: 0.5 })\r\n      );\r\n    }, 10);\r\n\r\n    this.loadTextures();\r\n  }\r\n\r\n  private loadTextures(): void {\r\n    const textureLoader = new THREE.TextureLoader();\r\n    \r\n    textureLoader.load(\r\n      'textures/effects/hit-impact.png',\r\n      (texture) => { this.hitImpactTexture = texture; },\r\n      undefined,\r\n      () => {} // Silently fail if texture not found\r\n    );\r\n\r\n    textureLoader.load(\r\n      'textures/effects/hit-sprite.png',\r\n      (texture) => { this.hitSpriteLowTexture = texture; },\r\n      undefined,\r\n      () => {}\r\n    );\r\n\r\n    textureLoader.load(\r\n      'textures/effects/smoke.png',\r\n      (texture) => { this.fireSmokeTexture = texture; },\r\n      undefined,\r\n      () => {}\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Spawn basic particle burst - simple geometric particles\r\n   */\r\n  public spawn(position: THREE.Vector3, color: number, count: number): void {\r\n    for (let i = 0; i < count; i++) {\r\n      const particle = this.spherePool.get() as THREE.Mesh;\r\n      (particle.material as THREE.MeshBasicMaterial).color.setHex(color);\r\n      (particle.material as THREE.MeshBasicMaterial).opacity = 1;\r\n      (particle.material as THREE.MeshBasicMaterial).transparent = false;\r\n      \r\n      particle.position.copy(position);\r\n      particle.scale.set(1, 1, 1);\r\n\r\n      const velocity = new THREE.Vector3(\r\n        (Math.random() - 0.5) * 5,\r\n        Math.random() * 5,\r\n        (Math.random() - 0.5) * 5\r\n      );\r\n\r\n      this.particles.push({\r\n        mesh: particle,\r\n        velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 0.5 + Math.random() * 0.5,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn blood particles on enemy hit\r\n   */\r\n  public spawnBlood(position: THREE.Vector3): void {\r\n    const count = 4 + Math.floor(Math.random() * 3);\r\n    for (let i = 0; i < count; i++) {\r\n      const particle = this.cubePool.get() as THREE.Mesh;\r\n      (particle.material as THREE.MeshBasicMaterial).color.setHex(0xaa0000);\r\n      (particle.material as THREE.MeshBasicMaterial).opacity = 1;\r\n      \r\n      particle.position.copy(position);\r\n      particle.scale.set(0.7, 0.7, 0.7);\r\n\r\n      const velocity = new THREE.Vector3(\r\n        (Math.random() - 0.5) * 2,\r\n        Math.random() * 2,\r\n        (Math.random() - 0.5) * 2\r\n      );\r\n\r\n      this.particles.push({\r\n        mesh: particle,\r\n        velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 0.4 + Math.random() * 0.4,\r\n        gravity: 9.8\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn explosive sprite-based impact effect\r\n   */\r\n  public spawnImpactEffect(position: THREE.Vector3, isKill: boolean = false): void {\r\n    this.spawnBlood(position);\r\n\r\n    const texture = isKill ? this.hitImpactTexture : this.hitSpriteLowTexture;\r\n    if (!texture) {\r\n      this.spawn(position, isKill ? 0xffff00 : 0xff8800, isKill ? 15 : 8);\r\n      return;\r\n    }\r\n\r\n    const spriteCount = isKill ? 3 : 2;\r\n    for (let i = 0; i < spriteCount; i++) {\r\n      const spriteMaterial = new THREE.SpriteMaterial({\r\n        map: texture,\r\n        blending: THREE.AdditiveBlending,\r\n        transparent: true,\r\n        opacity: 1,\r\n        color: isKill ? 0xffff00 : 0xff4400,\r\n      });\r\n\r\n      const sprite = new THREE.Sprite(spriteMaterial);\r\n      const baseScale = isKill ? 0.8 : 0.5;\r\n      const scale = baseScale + i * 0.2;\r\n      sprite.scale.set(scale, scale, scale);\r\n      sprite.position.copy(position);\r\n\r\n      this.scene.add(sprite);\r\n      this.particles.push({\r\n        mesh: sprite,\r\n        velocity: new THREE.Vector3(0, 0, 0),\r\n        lifetime: 0,\r\n        maxLifetime: isKill ? 0.3 : 0.2,\r\n        initialScale: scale,\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn material-based impact effects (metal sparks, wood splinters, concrete dust)\r\n   */\r\n  public spawnMaterialImpact(position: THREE.Vector3, normal: THREE.Vector3, material: string): void {\r\n    switch (material) {\r\n      case 'metal':\r\n        this.spawnSparks(position, normal);\r\n        this.spawnDebris(position, normal, 0xcccccc, 3);\r\n        break;\r\n      case 'wood':\r\n        this.spawnDebris(position, normal, 0x8b4513, 6);\r\n        this.spawnDust(position, normal, 0x5d4037, 0.5);\r\n        break;\r\n      case 'concrete':\r\n      case 'stone':\r\n        this.spawnDebris(position, normal, 0x888888, 5);\r\n        this.spawnDust(position, normal, 0xaaaaaa, 0.8);\r\n        break;\r\n      case 'dirt':\r\n      case 'grass':\r\n        this.spawnDebris(position, normal, 0x5d4037, 4);\r\n        this.spawnDust(position, normal, 0x795548, 0.6);\r\n        break;\r\n      default:\r\n        this.spawnDebris(position, normal, 0x888888, 4);\r\n        this.spawnDust(position, normal, 0xcccccc, 0.4);\r\n    }\r\n  }\r\n\r\n  private spawnSparks(position: THREE.Vector3, normal: THREE.Vector3): void {\r\n    const count = 5 + Math.floor(Math.random() * 5);\r\n    for (let i = 0; i < count; i++) {\r\n      const spark = this.sparkPool.get() as THREE.Mesh;\r\n      (spark.material as THREE.MeshBasicMaterial).opacity = 1;\r\n      \r\n      spark.position.copy(position);\r\n      \r\n      const velocity = normal.clone().multiplyScalar(5 + Math.random() * 5);\r\n      velocity.x += (Math.random() - 0.5) * 4;\r\n      velocity.y += (Math.random() - 0.5) * 4;\r\n      velocity.z += (Math.random() - 0.5) * 4;\r\n\r\n      spark.lookAt(position.clone().add(velocity));\r\n\r\n      this.particles.push({\r\n        mesh: spark,\r\n        velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 0.1 + Math.random() * 0.2,\r\n        gravity: 5\r\n      });\r\n    }\r\n  }\r\n\r\n  private spawnDust(position: THREE.Vector3, normal: THREE.Vector3, color: number, opacity: number): void {\r\n    const count = 2 + Math.floor(Math.random() * 2);\r\n    for (let i = 0; i < count; i++) {\r\n      const dust = this.smokePool.get() as THREE.Sprite;\r\n      const material = dust.material;\r\n      \r\n      if (this.fireSmokeTexture && !material.map) {\r\n        material.map = this.fireSmokeTexture;\r\n      }\r\n      \r\n      material.color.setHex(color);\r\n      material.opacity = opacity * (0.2 + Math.random() * 0.2);\r\n      material.rotation = Math.random() * Math.PI * 2;\r\n      \r\n      const scale = 0.3 + Math.random() * 0.3;\r\n      dust.scale.set(scale, scale, 1);\r\n      dust.position.copy(position);\r\n      \r\n      const velocity = normal.clone().multiplyScalar(0.5 + Math.random() * 1.0);\r\n      velocity.add(new THREE.Vector3(\r\n        (Math.random() - 0.5) * 0.5,\r\n        (Math.random() - 0.5) * 0.5,\r\n        (Math.random() - 0.5) * 0.5\r\n      ));\r\n\r\n      this.particles.push({\r\n        mesh: dust,\r\n        velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 0.5 + Math.random() * 0.5,\r\n        initialScale: scale,\r\n        gravity: -0.2\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn surface impact debris\r\n   */\r\n  public spawnDebris(position: THREE.Vector3, normal: THREE.Vector3, color: number, count: number = 5): void {\r\n    for (let i = 0; i < count; i++) {\r\n      const particle = this.cubePool.get() as THREE.Mesh;\r\n      (particle.material as THREE.MeshBasicMaterial).color.setHex(color);\r\n      (particle.material as THREE.MeshBasicMaterial).opacity = 1;\r\n      \r\n      particle.position.copy(position);\r\n      particle.scale.set(1, 1, 1);\r\n\r\n      const velocity = normal.clone().multiplyScalar(2 + Math.random() * 3);\r\n      velocity.x += (Math.random() - 0.5) * 2;\r\n      velocity.y += (Math.random() - 0.5) * 2;\r\n      velocity.z += (Math.random() - 0.5) * 2;\r\n\r\n      this.particles.push({\r\n        mesh: particle,\r\n        velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 0.4 + Math.random() * 0.3,\r\n        gravity: 9.8\r\n      });\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Spawn shell casing ejection\r\n   * @param position World position to spawn shell\r\n   * @param direction Ejection direction\r\n   * @param groundLevel Y coordinate of the ground (player feet position)\r\n   * @param onHit Optional callback when shell hits ground\r\n   */\r\n  public spawnShellCasing(position: THREE.Vector3, direction: THREE.Vector3, groundLevel: number = 0, onHit?: (pos: THREE.Vector3) => void): void {\r\n    const mesh = this.shellPool.get() as THREE.Mesh;\r\n    \r\n    // Reset material opacity (may have been faded from previous use)\r\n    const material = mesh.material as THREE.MeshStandardMaterial;\r\n    material.opacity = 1.0;\r\n    material.transparent = false;\r\n    \r\n    mesh.position.copy(position);\r\n    // Initial rotation - orient cylinder with some randomness\r\n    mesh.rotation.set(\r\n      Math.random() * Math.PI * 2,\r\n      Math.random() * Math.PI * 2,\r\n      Math.random() * Math.PI * 2\r\n    );\r\n    \r\n    // Ejection velocity - direction with added upward component\r\n    const speed = 2.5 + Math.random() * 1.5;\r\n    const velocity = direction.clone().multiplyScalar(speed);\r\n    \r\n    // Add upward velocity for arc\r\n    velocity.y += 1.5 + Math.random() * 1.0;\r\n    \r\n    console.log('Shell spawned:', {\r\n      pos: mesh.position.clone(),\r\n      groundLevel: groundLevel,\r\n      velocity: velocity.clone()\r\n    });\r\n    \r\n    this.shells.push({\r\n      mesh,\r\n      velocity,\r\n      rotationalVelocity: new THREE.Vector3(\r\n        (Math.random() - 0.5) * 20,\r\n        (Math.random() - 0.5) * 20,\r\n        (Math.random() - 0.5) * 20\r\n      ),\r\n      lifetime: 15.0, // Long lifetime so shells stay visible on ground\r\n      onHit,\r\n      hasHit: false,\r\n      groundLevel: groundLevel, // Store ground level for this shell\r\n      bounceCount: 0, // Track bounces for sound variation\r\n      settled: false // Not yet settled on ground\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Spawn muzzle smoke effect\r\n   */\r\n  public spawnMuzzleSmoke(position: THREE.Vector3, direction: THREE.Vector3): void {\r\n    if (Math.random() > 0.3) return;\r\n\r\n    const sprite = this.smokePool.get() as THREE.Sprite;\r\n    const material = sprite.material;\r\n    \r\n    if (this.fireSmokeTexture && !material.map) {\r\n      material.map = this.fireSmokeTexture;\r\n    }\r\n    \r\n    material.color.setHex(0xeeeeee);\r\n    material.opacity = 0.02 + Math.random() * 0.05;\r\n    material.rotation = Math.random() * Math.PI * 2;\r\n    \r\n    const scale = 0.1 + Math.random() * 0.15;\r\n    sprite.scale.set(scale, scale, 1);\r\n    sprite.position.copy(position);\r\n    \r\n    sprite.position.add(new THREE.Vector3(\r\n      (Math.random() - 0.5) * 0.05,\r\n      (Math.random() - 0.5) * 0.05,\r\n      (Math.random() - 0.5) * 0.05\r\n    ));\r\n\r\n    const speed = 0.2 + Math.random() * 0.3;\r\n    const velocity = direction.clone().multiplyScalar(speed);\r\n    velocity.add(new THREE.Vector3(\r\n      (Math.random() - 0.5) * 0.1,\r\n      0.2 + Math.random() * 0.2,\r\n      (Math.random() - 0.5) * 0.1\r\n    ));\r\n\r\n    this.particles.push({\r\n      mesh: sprite,\r\n      velocity,\r\n      lifetime: 0,\r\n      maxLifetime: 0.3 + Math.random() * 0.3,\r\n      initialScale: scale,\r\n      gravity: -0.3\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Spawn a full explosion effect\r\n   */\r\n  public spawnExplosion(position: THREE.Vector3): void {\r\n    // Flash\r\n    const flash = this.spherePool.get() as THREE.Mesh;\r\n    (flash.material as THREE.MeshBasicMaterial).color.setHex(0xffffee);\r\n    (flash.material as THREE.MeshBasicMaterial).opacity = 1;\r\n    (flash.material as THREE.MeshBasicMaterial).transparent = true;\r\n    flash.position.copy(position);\r\n    flash.scale.set(2, 2, 2);\r\n    \r\n    this.particles.push({\r\n      mesh: flash,\r\n      velocity: new THREE.Vector3(0, 0, 0),\r\n      lifetime: 0,\r\n      maxLifetime: 0.1,\r\n      initialScale: 2\r\n    });\r\n\r\n    // Fireball\r\n    const fireCount = 12;\r\n    for (let i = 0; i < fireCount; i++) {\r\n      const fire = this.spherePool.get() as THREE.Mesh;\r\n      const color = Math.random() > 0.5 ? 0xff4400 : 0xff8800;\r\n      (fire.material as THREE.MeshBasicMaterial).color.setHex(color);\r\n      (fire.material as THREE.MeshBasicMaterial).opacity = 0.8;\r\n      (fire.material as THREE.MeshBasicMaterial).transparent = true;\r\n      \r\n      fire.position.copy(position);\r\n      fire.position.add(new THREE.Vector3(\r\n        (Math.random() - 0.5) * 0.5,\r\n        (Math.random() - 0.5) * 0.5,\r\n        (Math.random() - 0.5) * 0.5\r\n      ));\r\n      \r\n      const scale = 1.5 + Math.random();\r\n      fire.scale.set(scale, scale, scale);\r\n\r\n      const velocity = new THREE.Vector3(\r\n        (Math.random() - 0.5) * 8,\r\n        (Math.random() - 0.5) * 8 + 2,\r\n        (Math.random() - 0.5) * 8\r\n      );\r\n\r\n      this.particles.push({\r\n        mesh: fire,\r\n        velocity: velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 0.4 + Math.random() * 0.3,\r\n        initialScale: scale\r\n      });\r\n    }\r\n\r\n    // Debris\r\n    const debrisCount = 15;\r\n    for (let i = 0; i < debrisCount; i++) {\r\n      const debris = this.cubePool.get() as THREE.Mesh;\r\n      (debris.material as THREE.MeshBasicMaterial).color.setHex(0x333333);\r\n      \r\n      debris.position.copy(position);\r\n      const scale = 0.2 + Math.random() * 0.3;\r\n      debris.scale.set(scale, scale, scale);\r\n\r\n      const velocity = new THREE.Vector3(\r\n        (Math.random() - 0.5) * 15,\r\n        Math.random() * 10 + 5,\r\n        (Math.random() - 0.5) * 15\r\n      );\r\n\r\n      this.particles.push({\r\n        mesh: debris,\r\n        velocity: velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 1.5 + Math.random(),\r\n        gravity: 15\r\n      });\r\n    }\r\n\r\n    // Smoke\r\n    const smokeCount = 8;\r\n    for (let i = 0; i < smokeCount; i++) {\r\n      const smoke = this.spherePool.get() as THREE.Mesh;\r\n      (smoke.material as THREE.MeshBasicMaterial).color.setHex(0x222222);\r\n      (smoke.material as THREE.MeshBasicMaterial).opacity = 0.6;\r\n      (smoke.material as THREE.MeshBasicMaterial).transparent = true;\r\n\r\n      smoke.position.copy(position);\r\n      const scale = 2.0 + Math.random();\r\n      smoke.scale.set(scale, scale, scale);\r\n\r\n      const velocity = new THREE.Vector3(\r\n        (Math.random() - 0.5) * 3,\r\n        Math.random() * 3 + 1,\r\n        (Math.random() - 0.5) * 3\r\n      );\r\n\r\n      this.particles.push({\r\n        mesh: smoke,\r\n        velocity: velocity,\r\n        lifetime: 0,\r\n        maxLifetime: 1.5 + Math.random(),\r\n        initialScale: scale\r\n      });\r\n    }\r\n\r\n    // Shockwave\r\n    const shockwave = this.shockwavePool.get() as THREE.Mesh;\r\n    (shockwave.material as THREE.MeshBasicMaterial).opacity = 0.5;\r\n    shockwave.position.copy(position);\r\n    shockwave.rotation.x = -Math.PI / 2;\r\n    shockwave.scale.set(0.1, 0.1, 0.1);\r\n\r\n    this.particles.push({\r\n      mesh: shockwave,\r\n      velocity: new THREE.Vector3(0, 0, 0),\r\n      lifetime: 0,\r\n      maxLifetime: 0.5,\r\n      initialScale: 0.1\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Spawn trail particles for projectiles\r\n   */\r\n  public spawnTrail(position: THREE.Vector3, color: number, size: number): void {\r\n    const particle = this.smokePool.get() as THREE.Sprite;\r\n    const material = particle.material;\r\n    \r\n    if (this.fireSmokeTexture && !material.map) {\r\n      material.map = this.fireSmokeTexture;\r\n    }\r\n    \r\n    material.color.setHex(color);\r\n    material.opacity = 0.3;\r\n    material.rotation = Math.random() * Math.PI * 2;\r\n    \r\n    particle.scale.set(size, size, 1);\r\n    particle.position.copy(position);\r\n    \r\n    this.particles.push({\r\n      mesh: particle,\r\n      velocity: new THREE.Vector3(0, 0, 0),\r\n      lifetime: 0,\r\n      maxLifetime: 0.5,\r\n      initialScale: size,\r\n      gravity: -0.5\r\n    });\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    // Update particles\r\n    for (let i = this.particles.length - 1; i >= 0; i--) {\r\n      const particle = this.particles[i];\r\n      particle.lifetime += delta;\r\n\r\n      if (particle.lifetime >= particle.maxLifetime) {\r\n        if (particle.mesh instanceof THREE.Mesh) {\r\n          if (particle.mesh.geometry.type === 'SphereGeometry') {\r\n            this.spherePool.release(particle.mesh);\r\n          } else if (particle.mesh.geometry.type === 'BoxGeometry') {\r\n            this.cubePool.release(particle.mesh);\r\n          } else if (particle.mesh.geometry.type === 'TorusGeometry') {\r\n            this.shockwavePool.release(particle.mesh);\r\n          } else {\r\n            this.scene.remove(particle.mesh);\r\n          }\r\n        } else if (particle.mesh instanceof THREE.Sprite) {\r\n          if (particle.mesh.material.depthWrite === false && particle.mesh.material.blending === THREE.NormalBlending) {\r\n            this.smokePool.release(particle.mesh);\r\n          } else {\r\n            this.scene.remove(particle.mesh);\r\n          }\r\n        } else {\r\n          this.scene.remove(particle.mesh);\r\n        }\r\n        this.particles.splice(i, 1);\r\n        continue;\r\n      }\r\n\r\n      particle.mesh.position.add(particle.velocity.clone().multiplyScalar(delta));\r\n      \r\n      const gravity = particle.gravity !== undefined ? particle.gravity : 5;\r\n      particle.velocity.y -= gravity * delta;\r\n\r\n      const lifeRatio = particle.lifetime / particle.maxLifetime;\r\n      if (particle.mesh instanceof THREE.Sprite) {\r\n        particle.mesh.material.opacity = 1 - lifeRatio;\r\n        if (particle.initialScale) {\r\n          const scale = particle.initialScale * (1 + lifeRatio * 0.5);\r\n          particle.mesh.scale.set(scale, scale, 1);\r\n        }\r\n      } else {\r\n        (particle.mesh.material as THREE.Material).opacity = 1 - lifeRatio;\r\n        (particle.mesh.material as THREE.Material).transparent = true;\r\n        \r\n        if (particle.mesh.geometry.type === 'TorusGeometry') {\r\n          const scale = 1 + lifeRatio * 20;\r\n          particle.mesh.scale.set(scale, scale, scale);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update shells\r\n    for (let i = this.shells.length - 1; i >= 0; i--) {\r\n      const shell = this.shells[i];\r\n      shell.lifetime -= delta;\r\n      \r\n      // Remove shells when lifetime expires\r\n      if (shell.lifetime <= 0) {\r\n        this.shellPool.release(shell.mesh);\r\n        this.shells.splice(i, 1);\r\n        continue;\r\n      }\r\n      \r\n      // If shell is settled, just handle fade-out in last 2 seconds\r\n      if (shell.settled) {\r\n        if (shell.lifetime < 2.0) {\r\n          // Fade out shell in last 2 seconds\r\n          const material = shell.mesh.material as THREE.MeshStandardMaterial;\r\n          material.transparent = true;\r\n          material.opacity = shell.lifetime / 2.0;\r\n        }\r\n        continue; // Skip physics for settled shells\r\n      }\r\n      \r\n      // Apply gravity\r\n      shell.velocity.y -= 9.8 * delta;\r\n      shell.mesh.position.add(shell.velocity.clone().multiplyScalar(delta));\r\n      \r\n      // Apply rotation (tumbling)\r\n      shell.mesh.rotation.x += shell.rotationalVelocity.x * delta;\r\n      shell.mesh.rotation.y += shell.rotationalVelocity.y * delta;\r\n      shell.mesh.rotation.z += shell.rotationalVelocity.z * delta;\r\n      \r\n      // Ground collision using stored ground level (+ shell radius offset)\r\n      const shellRadius = 0.02; // Match half the shell height\r\n      const groundY = shell.groundLevel + shellRadius;\r\n      \r\n      if (shell.mesh.position.y <= groundY && shell.velocity.y < 0) {\r\n        shell.mesh.position.y = groundY;\r\n        shell.bounceCount++;\r\n        \r\n        // Calculate impact velocity for sound intensity\r\n        const impactSpeed = Math.abs(shell.velocity.y);\r\n        \r\n        // Play bounce sound (louder for first bounce, quieter for subsequent)\r\n        if (this.onShellBounce && impactSpeed > 0.3) {\r\n          this.onShellBounce(shell.mesh.position.clone(), shell.bounceCount);\r\n        }\r\n        \r\n        // Bounce physics - energy loss increases with each bounce\r\n        const bounceFactor = Math.max(0.15, 0.45 - shell.bounceCount * 0.1);\r\n        const frictionFactor = Math.max(0.4, 0.75 - shell.bounceCount * 0.1);\r\n        \r\n        if (impactSpeed > 0.4) {\r\n          // Bounce - reverse and reduce Y velocity\r\n          shell.velocity.y = impactSpeed * bounceFactor;\r\n          shell.velocity.x *= frictionFactor;\r\n          shell.velocity.z *= frictionFactor;\r\n          shell.rotationalVelocity.multiplyScalar(frictionFactor);\r\n        } else {\r\n          // Too slow to bounce - start settling\r\n          shell.velocity.y = 0;\r\n          shell.velocity.x *= 0.7;\r\n          shell.velocity.z *= 0.7;\r\n          shell.rotationalVelocity.multiplyScalar(0.5);\r\n        }\r\n        \r\n        // Check if shell should settle completely\r\n        const totalSpeed = Math.sqrt(\r\n          shell.velocity.x * shell.velocity.x + \r\n          shell.velocity.y * shell.velocity.y +\r\n          shell.velocity.z * shell.velocity.z\r\n        );\r\n        \r\n        if (totalSpeed < 0.1 && shell.bounceCount >= 2) {\r\n          // Shell has settled - stop all movement\r\n          shell.velocity.set(0, 0, 0);\r\n          shell.rotationalVelocity.set(0, 0, 0);\r\n          shell.settled = true;\r\n          \r\n          // Lay the shell flat on the ground\r\n          shell.mesh.rotation.x = Math.PI / 2; // Horizontal\r\n          shell.mesh.rotation.z = Math.random() * Math.PI * 2; // Random rotation around Y\r\n          shell.mesh.position.y = groundY; // Ensure on ground\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set callback for shell bounce sounds\r\n   */\r\n  public setShellBounceCallback(callback: (position: THREE.Vector3, bounceNumber: number) => void): void {\r\n    this.onShellBounce = callback;\r\n  }\r\n\r\n  public clear(): void {\r\n    this.particles.forEach((p) => this.scene.remove(p.mesh));\r\n    this.particles.length = 0;\r\n  }\r\n}\r\n","import * as THREE from 'three';\r\n\r\nexport enum SurfaceMaterial {\r\n  BRICK = 'brick',\r\n  WOOD = 'wood',\r\n  METAL = 'metal',\r\n  ROCK = 'rock',\r\n  GRAVEL = 'gravel',\r\n  DEFAULT = 'default'\r\n}\r\n\r\ninterface ImpactAudioBuffers {\r\n  bodyImpacts: AudioBuffer[];\r\n  deathImpact?: AudioBuffer;\r\n  hitImpact?: AudioBuffer;\r\n  explosion?: AudioBuffer;\r\n  bulletWhiz?: AudioBuffer;\r\n  shellDrop?: AudioBuffer;\r\n  surfaceImpacts: {\r\n    [key in SurfaceMaterial]?: AudioBuffer[];\r\n  };\r\n}\r\n\r\nexport class ImpactSystem {\r\n  private audioBuffers: ImpactAudioBuffers = {\r\n    bodyImpacts: [],\r\n    surfaceImpacts: {}\r\n  };\r\n  private audioListener: THREE.AudioListener;\r\n  private scene: THREE.Scene;\r\n\r\n  constructor(scene: THREE.Scene, listener: THREE.AudioListener) {\r\n    this.scene = scene;\r\n    this.audioListener = listener;\r\n    this.loadAudio();\r\n  }\r\n\r\n  private loadAudio(): void {\r\n    const audioLoader = new THREE.AudioLoader();\r\n\r\n    // Body impact sounds (randomized for variety)\r\n    // Body impact sounds (randomized for variety)\r\n    const bodyImpactPaths = [\r\n      'assets/audio/sfx/impacts/Body-Impact-1.mp3',\r\n      'assets/audio/sfx/impacts/Body-Impact-2.mp3',\r\n      'assets/audio/sfx/impacts/Body-Impact-3.mp3',\r\n    ];\r\n\r\n    bodyImpactPaths.forEach((path) => {\r\n      audioLoader.load(path, (buffer) => {\r\n        this.audioBuffers.bodyImpacts.push(buffer);\r\n      }, undefined, (err) => console.warn(`Failed to load ${path}:`, err));\r\n    });\r\n\r\n    // Death impact\r\n    audioLoader.load('assets/audio/sfx/impacts/Death-Impact.mp3', (buffer) => {\r\n      this.audioBuffers.deathImpact = buffer;\r\n    }, undefined, (err) => console.warn('Failed to load death impact:', err));\r\n\r\n    // Hit confirmation\r\n    audioLoader.load('assets/audio/sfx/impacts/Hit-Impact.mp3', (buffer) => {\r\n      this.audioBuffers.hitImpact = buffer;\r\n    }, undefined, (err) => console.warn('Failed to load hit impact:', err));\r\n\r\n    // Explosion (Placeholder using Shotgun Fire pitched down)\r\n    audioLoader.load('assets/audio/sfx/weapons/Shotgun-Fire.mp3', (buffer) => {\r\n      this.audioBuffers.explosion = buffer;\r\n    }, undefined, (err) => console.warn('Failed to load explosion sound:', err));\r\n\r\n    // Bullet Whiz (using a tail sound as placeholder)\r\n    audioLoader.load('assets/audio/sfx/weapons/Tec-9-Tail.mp3', (buffer) => {\r\n      this.audioBuffers.bulletWhiz = buffer;\r\n    }, undefined, (err) => console.warn('Failed to load bullet whiz:', err));\r\n\r\n    // Shell Drop (using light metal impact)\r\n    audioLoader.load('assets/audio/sfx/impacts/Impact-Iron-Light.mp3', (buffer) => {\r\n      this.audioBuffers.shellDrop = buffer;\r\n    }, undefined, (err) => console.warn('Failed to load shell drop:', err));\r\n\r\n    // Surface impacts - organized by material\r\n    const surfaceImpacts = {\r\n      [SurfaceMaterial.BRICK]: [\r\n        'assets/audio/sfx/impacts/Impact-Brick-1.mp3',\r\n        'assets/audio/sfx/impacts/Impact-Brick-2.mp3',\r\n      ],\r\n      [SurfaceMaterial.GRAVEL]: [\r\n        'assets/audio/sfx/impacts/Impact-Gravel-1.mp3',\r\n        'assets/audio/sfx/impacts/Impact-Gravel-2.mp3',\r\n      ],\r\n      [SurfaceMaterial.WOOD]: [\r\n        'assets/audio/sfx/impacts/Impact-Wood-1.mp3',\r\n        'assets/audio/sfx/impacts/Impact-Wood-2.mp3',\r\n      ],\r\n      [SurfaceMaterial.ROCK]: [\r\n        'assets/audio/sfx/impacts/Impact-Rock-1.mp3',\r\n        'assets/audio/sfx/impacts/Impact-Rock-2.mp3',\r\n      ],\r\n      [SurfaceMaterial.METAL]: [\r\n        'assets/audio/sfx/impacts/Impact-Metal.mp3',\r\n        'assets/audio/sfx/impacts/Impact-Iron.mp3',\r\n        'assets/audio/sfx/impacts/Impact-Iron-Light.mp3',\r\n      ],\r\n    };\r\n\r\n    Object.entries(surfaceImpacts).forEach(([material, paths]) => {\r\n      this.audioBuffers.surfaceImpacts[material as SurfaceMaterial] = [];\r\n      paths.forEach((path) => {\r\n        audioLoader.load(path, (buffer) => {\r\n          this.audioBuffers.surfaceImpacts[material as SurfaceMaterial]!.push(buffer);\r\n        }, undefined, (err) => console.warn(`Failed to load ${path}:`, err));\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Play body hit impact sound - randomized for variety\r\n   * Volume is exaggerated for satisfying feedback\r\n   */\r\n  public playBodyImpact(position: THREE.Vector3, volume: number = 1.0): void {\r\n    if (this.audioBuffers.bodyImpacts.length === 0) return;\r\n\r\n    const sound = new THREE.PositionalAudio(this.audioListener);\r\n    const randomBuffer = this.audioBuffers.bodyImpacts[\r\n      Math.floor(Math.random() * this.audioBuffers.bodyImpacts.length)\r\n    ];\r\n\r\n    sound.setBuffer(randomBuffer);\r\n    sound.setRefDistance(5);\r\n    sound.setVolume(volume * 1.5); // Exaggerated for punchiness\r\n    sound.setLoop(false);\r\n\r\n    // Create temporary object for positional audio\r\n    const temp = new THREE.Object3D();\r\n    temp.position.copy(position);\r\n    this.scene.add(temp);\r\n    temp.add(sound);\r\n\r\n    sound.play();\r\n    sound.onEnded = () => {\r\n      this.scene.remove(temp);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Play death impact - final, explosive sound\r\n   */\r\n  public playDeathImpact(position: THREE.Vector3): void {\r\n    if (!this.audioBuffers.deathImpact) return;\r\n\r\n    const sound = new THREE.PositionalAudio(this.audioListener);\r\n    sound.setBuffer(this.audioBuffers.deathImpact);\r\n    sound.setRefDistance(8);\r\n    sound.setVolume(2.0); // Very loud and punchy\r\n    sound.setLoop(false);\r\n\r\n    const temp = new THREE.Object3D();\r\n    temp.position.copy(position);\r\n    this.scene.add(temp);\r\n    temp.add(sound);\r\n\r\n    sound.play();\r\n    sound.onEnded = () => {\r\n      this.scene.remove(temp);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Play hit confirmation sound - instant feedback, zero latency\r\n   */\r\n  public playHitConfirmation(volume: number = 0.8): void {\r\n    if (!this.audioBuffers.hitImpact) return;\r\n\r\n    const sound = new THREE.Audio(this.audioListener);\r\n    sound.setBuffer(this.audioBuffers.hitImpact);\r\n    sound.setVolume(volume * 1.2);\r\n    sound.play();\r\n  }\r\n\r\n  /**\r\n   * Play bullet whiz sound for near misses\r\n   * High pitch, fast playback to simulate supersonic crack\r\n   */\r\n  public playBulletWhiz(position: THREE.Vector3): void {\r\n    if (!this.audioBuffers.bulletWhiz) return;\r\n\r\n    const sound = new THREE.PositionalAudio(this.audioListener);\r\n    sound.setBuffer(this.audioBuffers.bulletWhiz);\r\n    sound.setRefDistance(5);\r\n    sound.setVolume(0.4);\r\n    sound.setPlaybackRate(1.5 + Math.random() * 0.5); // Vary pitch\r\n    sound.setLoop(false);\r\n\r\n    const temp = new THREE.Object3D();\r\n    temp.position.copy(position);\r\n    this.scene.add(temp);\r\n    temp.add(sound);\r\n\r\n    sound.play();\r\n    sound.onEnded = () => {\r\n      this.scene.remove(temp);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Play shell casing drop sound\r\n   * Tiny, metallic clink with variable volume for bounce intensity\r\n   * @param position World position of the shell\r\n   * @param volumeScale Optional volume multiplier (0-1), default 1.0\r\n   */\r\n  public playShellDrop(position: THREE.Vector3, volumeScale: number = 1.0): void {\r\n    if (!this.audioBuffers.shellDrop) return;\r\n\r\n    const sound = new THREE.PositionalAudio(this.audioListener);\r\n    sound.setBuffer(this.audioBuffers.shellDrop);\r\n    sound.setRefDistance(2);\r\n    sound.setVolume(0.25 * Math.max(0.2, Math.min(1.0, volumeScale))); // Subtle volume\r\n    sound.setPlaybackRate(1.8 + Math.random() * 0.8); // Varied pitch for natural sound\r\n    sound.setLoop(false);\r\n\r\n    const temp = new THREE.Object3D();\r\n    temp.position.copy(position);\r\n    this.scene.add(temp);\r\n    temp.add(sound);\r\n\r\n    sound.play();\r\n    sound.onEnded = () => {\r\n      this.scene.remove(temp);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Play massive explosion sound\r\n   */\r\n  public playExplosion(position: THREE.Vector3): void {\r\n    if (!this.audioBuffers.explosion) return;\r\n\r\n    const sound = new THREE.PositionalAudio(this.audioListener);\r\n    sound.setBuffer(this.audioBuffers.explosion);\r\n    sound.setRefDistance(20); // Heard from far away\r\n    sound.setVolume(2.0); // Very loud\r\n    sound.setPlaybackRate(0.5); // Deep, bassy rumble\r\n    sound.setLoop(false);\r\n\r\n    const temp = new THREE.Object3D();\r\n    temp.position.copy(position);\r\n    this.scene.add(temp);\r\n    temp.add(sound);\r\n\r\n    sound.play();\r\n    sound.onEnded = () => {\r\n      this.scene.remove(temp);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Play surface impact based on material type\r\n   * Different materials = distinct sonic signatures for instant clarity\r\n   */\r\n  public playSurfaceImpact(\r\n    position: THREE.Vector3,\r\n    material: SurfaceMaterial,\r\n    volume: number = 0.8\r\n  ): void {\r\n    const buffers = this.audioBuffers.surfaceImpacts[material];\r\n    if (!buffers || buffers.length === 0) {\r\n      // Fallback to metal for default\r\n      const fallback = this.audioBuffers.surfaceImpacts[SurfaceMaterial.METAL];\r\n      if (!fallback || fallback.length === 0) return;\r\n      this.playSurfaceImpactWithBuffer(position, fallback, volume);\r\n      return;\r\n    }\r\n\r\n    this.playSurfaceImpactWithBuffer(position, buffers, volume);\r\n  }\r\n\r\n  private playSurfaceImpactWithBuffer(\r\n    position: THREE.Vector3,\r\n    buffers: AudioBuffer[],\r\n    volume: number\r\n  ): void {\r\n    const sound = new THREE.PositionalAudio(this.audioListener);\r\n    const randomBuffer = buffers[Math.floor(Math.random() * buffers.length)];\r\n\r\n    sound.setBuffer(randomBuffer);\r\n    sound.setRefDistance(10);\r\n    sound.setVolume(volume * 1.3); // Punchy and exaggerated\r\n    sound.setLoop(false);\r\n\r\n    const temp = new THREE.Object3D();\r\n    temp.position.copy(position);\r\n    this.scene.add(temp);\r\n    temp.add(sound);\r\n\r\n    sound.play();\r\n    sound.onEnded = () => {\r\n      this.scene.remove(temp);\r\n    };\r\n  }\r\n}\r\n","import * as THREE from 'three';\r\nimport { SurfaceMaterial } from './ImpactSystem';\r\n\r\nexport { SurfaceMaterial }; // Re-export for compatibility\r\n\r\ninterface Decal {\r\n  mesh: THREE.Mesh;\r\n  lifetime: number;\r\n  maxLifetime: number;\r\n  material: THREE.MeshBasicMaterial;\r\n}\r\n\r\nexport class DecalSystem {\r\n  private decals: Decal[] = [];\r\n  private scene: THREE.Scene;\r\n  private bulletHoleTexture?: THREE.Texture;\r\n  private crackHoleTexture?: THREE.Texture;\r\n  private maxDecals = 50; // Limit to maintain performance and visual clarity\r\n\r\n  constructor(scene: THREE.Scene) {\r\n    this.scene = scene;\r\n    this.loadTextures();\r\n  }\r\n\r\n  private loadTextures(): void {\r\n    const textureLoader = new THREE.TextureLoader();\r\n\r\n    textureLoader.load(\r\n      'assets/images/Bullet-Hole.png_6e4be8ce.png',\r\n      (texture) => {\r\n        this.bulletHoleTexture = texture;\r\n      },\r\n      undefined,\r\n      (err) => console.warn('Failed to load bullet hole texture:', err)\r\n    );\r\n\r\n    textureLoader.load(\r\n      'assets/images/Crack-Hole.png_ee41c0b1.png',\r\n      (texture) => {\r\n        this.crackHoleTexture = texture;\r\n      },\r\n      undefined,\r\n      (err) => console.warn('Failed to load crack hole texture:', err)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Create a bullet hole decal at impact point\r\n   * Decals are oriented to surface normal and fade over time for visual clarity\r\n   */\r\n  public createBulletHole(\r\n    position: THREE.Vector3,\r\n    normal: THREE.Vector3,\r\n    material: SurfaceMaterial\r\n  ): void {\r\n    if (!this.bulletHoleTexture) return;\r\n\r\n    // Use crack texture for brick/rock surfaces for variety\r\n    const useCrack = \r\n      (material === SurfaceMaterial.BRICK || material === SurfaceMaterial.ROCK) &&\r\n      this.crackHoleTexture &&\r\n      Math.random() < 0.3;\r\n\r\n    const texture = useCrack ? this.crackHoleTexture : this.bulletHoleTexture;\r\n    const size = 0.15 + Math.random() * 0.1; // Slight size variation\r\n\r\n    // Create decal mesh\r\n    const geometry = new THREE.PlaneGeometry(size, size);\r\n    const mat = new THREE.MeshBasicMaterial({\r\n      map: texture,\r\n      transparent: true,\r\n      opacity: 0.9,\r\n      depthWrite: false,\r\n      depthTest: true,\r\n      side: THREE.DoubleSide // Ensure visible from both sides just in case\r\n    });\r\n\r\n    const decal = new THREE.Mesh(geometry, mat);\r\n    \r\n    // Position slightly offset from surface to avoid z-fighting\r\n    decal.position.copy(position).add(normal.clone().multiplyScalar(0.002)); // Reduced offset for tiny scale\r\n    \r\n    // Orient to surface normal\r\n    decal.lookAt(position.clone().add(normal));\r\n    \r\n    // Random rotation for variety\r\n    decal.rotateZ(Math.random() * Math.PI * 2);\r\n\r\n    this.scene.add(decal);\r\n    \r\n    // Fade decals after 8 seconds, fully remove after 12 to keep arena clean\r\n    this.decals.push({\r\n      mesh: decal,\r\n      lifetime: 0,\r\n      maxLifetime: 12,\r\n      material: mat,\r\n    });\r\n\r\n    // Remove oldest decal if we exceed max\r\n    if (this.decals.length > this.maxDecals) {\r\n      const oldest = this.decals.shift();\r\n      if (oldest) {\r\n        this.scene.remove(oldest.mesh);\r\n        oldest.material.dispose();\r\n        oldest.mesh.geometry.dispose();\r\n      }\r\n    }\r\n  }\r\n\r\n  // Alias for compatibility\r\n  public createDecal(position: THREE.Vector3, normal: THREE.Vector3, material: SurfaceMaterial): void {\r\n    this.createBulletHole(position, normal, material);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    for (let i = this.decals.length - 1; i >= 0; i--) {\r\n      const decal = this.decals[i];\r\n      decal.lifetime += delta;\r\n\r\n      // Start fading at 8 seconds\r\n      if (decal.lifetime > 8) {\r\n        const fadeProgress = (decal.lifetime - 8) / (decal.maxLifetime - 8);\r\n        decal.material.opacity = 0.9 * (1 - fadeProgress);\r\n      }\r\n\r\n      // Remove when lifetime exceeded\r\n      if (decal.lifetime >= decal.maxLifetime) {\r\n        this.scene.remove(decal.mesh);\r\n        decal.material.dispose();\r\n        decal.mesh.geometry.dispose();\r\n        this.decals.splice(i, 1);\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    this.decals.forEach((decal) => {\r\n      this.scene.remove(decal.mesh);\r\n      decal.material.dispose();\r\n      decal.mesh.geometry.dispose();\r\n    });\r\n    this.decals.length = 0;\r\n  }\r\n}\r\n","import * as THREE from 'three';\r\n\r\ninterface TracerInstance {\r\n  mesh: THREE.Mesh;\r\n  material: THREE.MeshBasicMaterial;\r\n  lifetime: number;\r\n  maxLifetime: number;\r\n  active: boolean;\r\n}\r\n\r\nexport class BulletTracerSystem {\r\n  private activeTracers: TracerInstance[] = [];\r\n  private pool: TracerInstance[] = [];\r\n  private scene: THREE.Scene;\r\n  private tracerTexture?: THREE.Texture;\r\n  private fireTracerTexture?: THREE.Texture;\r\n  private sharedGeometry: THREE.PlaneGeometry;\r\n\r\n  constructor(scene: THREE.Scene, _camera: THREE.Camera) {\r\n    this.scene = scene;\r\n    this.sharedGeometry = new THREE.PlaneGeometry(1, 1);\r\n    this.loadTextures();\r\n  }\r\n\r\n  private loadTextures(): void {\r\n    const textureLoader = new THREE.TextureLoader();\r\n    \r\n    // Load tracer textures\r\n    textureLoader.load(\r\n      'assets/images/ui/Bullet-Trace.png_1b6132fc.png',\r\n      (texture) => {\r\n        this.tracerTexture = texture;\r\n        this.tracerTexture.wrapS = THREE.RepeatWrapping;\r\n        this.tracerTexture.wrapT = THREE.RepeatWrapping;\r\n      },\r\n      undefined,\r\n      (err) => console.warn('Failed to load bullet trace texture:', err)\r\n    );\r\n\r\n    textureLoader.load(\r\n      'assets/images/ui/Bullet-Fire-Trace.jpg_d795b3f8.jpg',\r\n      (texture) => {\r\n        this.fireTracerTexture = texture;\r\n        this.fireTracerTexture.wrapS = THREE.RepeatWrapping;\r\n        this.fireTracerTexture.wrapT = THREE.RepeatWrapping;\r\n      },\r\n      undefined,\r\n      (err) => console.warn('Failed to load fire trace texture:', err)\r\n    );\r\n  }\r\n\r\n  private getFromPool(): TracerInstance {\r\n    if (this.pool.length > 0) {\r\n      const instance = this.pool.pop()!;\r\n      instance.active = true;\r\n      instance.mesh.visible = true;\r\n      this.scene.add(instance.mesh);\r\n      return instance;\r\n    }\r\n\r\n    const material = new THREE.MeshBasicMaterial({\r\n      transparent: true,\r\n      opacity: 1.0,\r\n      blending: THREE.AdditiveBlending,\r\n      side: THREE.DoubleSide,\r\n      depthWrite: false,\r\n      depthTest: false,\r\n      fog: false,\r\n    });\r\n\r\n    const mesh = new THREE.Mesh(this.sharedGeometry, material);\r\n    this.scene.add(mesh);\r\n\r\n    return {\r\n      mesh,\r\n      material,\r\n      lifetime: 0,\r\n      maxLifetime: 0.2,\r\n      active: true\r\n    };\r\n  }\r\n\r\n  private returnToPool(instance: TracerInstance): void {\r\n    instance.active = false;\r\n    instance.mesh.visible = false;\r\n    this.scene.remove(instance.mesh);\r\n    this.pool.push(instance);\r\n  }\r\n\r\n  /**\r\n   * Create visually impressive textured bullet tracer beam\r\n   * Dopamine-inducing fast tracer with proper texture stretching\r\n   */\r\n  public createTracer(start: THREE.Vector3, end: THREE.Vector3, color: number = 0x00ffff, useFireTexture: boolean = false): void {\r\n    const direction = new THREE.Vector3().subVectors(end, start);\r\n    const distance = direction.length();\r\n    \r\n    if (distance < 0.1) return;\r\n    \r\n    const instance = this.getFromPool();\r\n    \r\n    // Setup material\r\n    const texture = useFireTexture && this.fireTracerTexture ? this.fireTracerTexture : this.tracerTexture;\r\n    instance.material.map = texture || null;\r\n    instance.material.color.setHex(color);\r\n    instance.material.opacity = 1.0;\r\n    instance.material.needsUpdate = true;\r\n\r\n    // Setup mesh transform\r\n    instance.mesh.position.copy(start).addScaledVector(direction, 0.5);\r\n    \r\n    const quaternion = new THREE.Quaternion();\r\n    quaternion.setFromUnitVectors(\r\n      new THREE.Vector3(1, 0, 0), // plane's X axis\r\n      direction.clone().normalize()\r\n    );\r\n    instance.mesh.quaternion.copy(quaternion);\r\n    \r\n    // Scale: X = length of ray, Y = thickness (visual width)\r\n    const thickness = 0.03; // Scaled down thickness (was 0.15)\r\n    instance.mesh.scale.set(distance, thickness, 1);\r\n\r\n    instance.lifetime = 0;\r\n    instance.maxLifetime = 0.15; // Fast fade\r\n    \r\n    this.activeTracers.push(instance);\r\n  }\r\n\r\n  /**\r\n   * Create multiple tracers for shotgun spread\r\n   */\r\n  public createMultipleTracers(\r\n    start: THREE.Vector3,\r\n    endpoints: THREE.Vector3[],\r\n    color: number = 0x00ffff,\r\n    useFireTexture: boolean = false\r\n  ): void {\r\n    endpoints.forEach((end) => {\r\n      this.createTracer(start, end, color, useFireTexture);\r\n    });\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    for (let i = this.activeTracers.length - 1; i >= 0; i--) {\r\n      const tracer = this.activeTracers[i];\r\n      tracer.lifetime += delta;\r\n\r\n      if (tracer.lifetime >= tracer.maxLifetime) {\r\n        this.returnToPool(tracer);\r\n        this.activeTracers.splice(i, 1);\r\n      } else {\r\n        // Fast, snappy fade: alpha = 1 - age/lifetime\r\n        const fadeProgress = tracer.lifetime / tracer.maxLifetime;\r\n        tracer.material.opacity = 1.0 - fadeProgress;\r\n      }\r\n    }\r\n  }\r\n\r\n  public clear(): void {\r\n    // Return all active to pool\r\n    this.activeTracers.forEach(t => this.returnToPool(t));\r\n    this.activeTracers = [];\r\n    \r\n    // Clean up pool\r\n    this.pool.forEach(t => {\r\n        this.scene.remove(t.mesh);\r\n        t.material.dispose();\r\n    });\r\n    this.pool = [];\r\n    this.sharedGeometry.dispose();\r\n  }\r\n}\r\n","import * as THREE from 'three';\r\n\r\n/**\r\n * RIFT Screen Effects System\r\n * \r\n * Provides visual feedback effects for combat:\r\n * - Screen shake (from firing, explosions, damage)\r\n * - FOV punch (firing feedback)\r\n * - Chromatic aberration\r\n * - Camera kick from recoil\r\n */\r\n\r\ninterface ShakeInstance {\r\n  intensity: number;\r\n  duration: number;\r\n  elapsed: number;\r\n  frequency: number;\r\n  decay: number;\r\n}\r\n\r\ninterface FOVPunch {\r\n  amount: number;\r\n  duration: number;\r\n  elapsed: number;\r\n  baseFOV: number;\r\n}\r\n\r\nexport class ScreenEffects {\r\n  private camera: THREE.PerspectiveCamera;\r\n  \r\n  // Screen shake state\r\n  private shakeInstances: ShakeInstance[] = [];\r\n  private shakeOffset: THREE.Vector3 = new THREE.Vector3();\r\n  \r\n  // FOV punch state\r\n  private fovPunch: FOVPunch | null = null;\r\n  \r\n  // Camera recoil state (applies to camera rotation)\r\n  private recoilPitch: number = 0; // Up/down (Y rotation after euler decomposition)\r\n  private recoilYaw: number = 0;   // Left/right (X rotation)\r\n  private targetRecoilPitch: number = 0;\r\n  private targetRecoilYaw: number = 0;\r\n  private recoilRecoveryRate: number = 5;\r\n  \r\n  // Chromatic aberration (requires post-processing or shader)\r\n  private chromaticAberration: number = 0;\r\n  private targetChromaticAberration: number = 0;\r\n  \r\n  // Vignette intensity\r\n  private vignetteIntensity: number = 0;\r\n  private targetVignetteIntensity: number = 0;\r\n  \r\n  // Original camera state\r\n  private originalPosition: THREE.Vector3 = new THREE.Vector3();\r\n  private baseFOV: number = 75;\r\n  \r\n  constructor(camera: THREE.PerspectiveCamera) {\r\n    this.camera = camera;\r\n    this.baseFOV = camera.fov;\r\n    this.originalPosition.copy(camera.position);\r\n  }\r\n  \r\n  /**\r\n   * Add screen shake effect\r\n   * @param intensity Shake amplitude in world units\r\n   * @param duration Duration in seconds\r\n   * @param frequency Shake frequency (cycles per second)\r\n   * @param decay Decay rate (0-1, higher = faster decay)\r\n   */\r\n  public addShake(\r\n    intensity: number = 0.05,\r\n    duration: number = 0.15,\r\n    frequency: number = 25,\r\n    decay: number = 0.5\r\n  ): void {\r\n    this.shakeInstances.push({\r\n      intensity,\r\n      duration,\r\n      elapsed: 0,\r\n      frequency,\r\n      decay\r\n    });\r\n  }\r\n  \r\n  /**\r\n   * Apply weapon firing screen shake\r\n   */\r\n  public addFireShake(weaponPower: number = 1.0): void {\r\n    // Scale shake based on weapon power (pistol = 0.5, sniper = 2.0)\r\n    const intensity = 0.02 * weaponPower;\r\n    const duration = 0.08;\r\n    const frequency = 30;\r\n    this.addShake(intensity, duration, frequency, 0.7);\r\n  }\r\n  \r\n  /**\r\n   * Apply explosion shake\r\n   * @param distance Distance from explosion (affects intensity)\r\n   */\r\n  public addExplosionShake(distance: number = 10): void {\r\n    // Inverse square falloff\r\n    const falloff = Math.max(0.1, 1 - (distance / 50));\r\n    const intensity = 0.15 * falloff;\r\n    const duration = 0.5;\r\n    const frequency = 15;\r\n    this.addShake(intensity, duration, frequency, 0.3);\r\n  }\r\n  \r\n  /**\r\n   * Apply damage shake (when player takes damage)\r\n   * @param damagePercent Percent of max health as damage (0-1)\r\n   */\r\n  public addDamageShake(damagePercent: number = 0.1): void {\r\n    const intensity = 0.05 + (damagePercent * 0.1);\r\n    const duration = 0.2 + (damagePercent * 0.1);\r\n    const frequency = 20;\r\n    this.addShake(intensity, duration, frequency, 0.4);\r\n  }\r\n  \r\n  /**\r\n   * Apply FOV punch effect (brief zoom out on firing)\r\n   * @param amount FOV increase in degrees\r\n   * @param duration Duration in seconds\r\n   */\r\n  public addFOVPunch(amount: number = 2, duration: number = 0.1): void {\r\n    this.fovPunch = {\r\n      amount,\r\n      duration,\r\n      elapsed: 0,\r\n      baseFOV: this.baseFOV\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Apply camera recoil (actual camera rotation)\r\n   * @param pitch Vertical recoil (positive = up)\r\n   * @param yaw Horizontal recoil (random left/right)\r\n   */\r\n  public applyRecoil(pitch: number, yaw: number): void {\r\n    this.targetRecoilPitch += pitch;\r\n    this.targetRecoilYaw += yaw;\r\n  }\r\n  \r\n  /**\r\n   * Get current recoil values for camera application\r\n   */\r\n  public getRecoil(): { pitch: number; yaw: number } {\r\n    return {\r\n      pitch: this.recoilPitch,\r\n      yaw: this.recoilYaw\r\n    };\r\n  }\r\n  \r\n  /**\r\n   * Set recoil recovery rate\r\n   */\r\n  public setRecoilRecoveryRate(rate: number): void {\r\n    this.recoilRecoveryRate = rate;\r\n  }\r\n  \r\n  /**\r\n   * Trigger chromatic aberration effect\r\n   * @param intensity Effect intensity (0-1)\r\n   */\r\n  public addChromaticAberration(intensity: number = 0.5): void {\r\n    this.targetChromaticAberration = intensity;\r\n  }\r\n  \r\n  /**\r\n   * Trigger vignette flash\r\n   * @param intensity Effect intensity (0-1)\r\n   */\r\n  public addVignette(intensity: number = 0.5): void {\r\n    this.targetVignetteIntensity = intensity;\r\n  }\r\n  \r\n  /**\r\n   * Update all screen effects\r\n   * @param delta Time since last frame in seconds\r\n   */\r\n  public update(delta: number): void {\r\n    this.updateShake(delta);\r\n    this.updateFOVPunch(delta);\r\n    this.updateRecoil(delta);\r\n    this.updateChromaticAberration(delta);\r\n    this.updateVignette(delta);\r\n  }\r\n  \r\n  private updateShake(delta: number): void {\r\n    // Reset shake offset\r\n    this.shakeOffset.set(0, 0, 0);\r\n    \r\n    // Process all shake instances\r\n    for (let i = this.shakeInstances.length - 1; i >= 0; i--) {\r\n      const shake = this.shakeInstances[i];\r\n      shake.elapsed += delta;\r\n      \r\n      if (shake.elapsed >= shake.duration) {\r\n        // Remove expired shake\r\n        this.shakeInstances.splice(i, 1);\r\n        continue;\r\n      }\r\n      \r\n      // Calculate decay\r\n      const progress = shake.elapsed / shake.duration;\r\n      const decayMultiplier = Math.pow(1 - progress, shake.decay * 2);\r\n      \r\n      // Calculate shake offset using perlin-like noise simulation\r\n      const t = shake.elapsed * shake.frequency;\r\n      const currentIntensity = shake.intensity * decayMultiplier;\r\n      \r\n      this.shakeOffset.x += Math.sin(t * 6.28) * currentIntensity;\r\n      this.shakeOffset.y += Math.cos(t * 5.13) * currentIntensity;\r\n      this.shakeOffset.z += Math.sin(t * 4.27) * currentIntensity * 0.5;\r\n    }\r\n  }\r\n  \r\n  private updateFOVPunch(delta: number): void {\r\n    if (!this.fovPunch) return;\r\n    \r\n    this.fovPunch.elapsed += delta;\r\n    \r\n    if (this.fovPunch.elapsed >= this.fovPunch.duration) {\r\n      // Reset FOV\r\n      this.camera.fov = this.baseFOV;\r\n      this.camera.updateProjectionMatrix();\r\n      this.fovPunch = null;\r\n      return;\r\n    }\r\n    \r\n    // Ease out FOV punch\r\n    const progress = this.fovPunch.elapsed / this.fovPunch.duration;\r\n    const eased = 1 - Math.pow(progress, 2);\r\n    const currentPunch = this.fovPunch.amount * eased;\r\n    \r\n    this.camera.fov = this.baseFOV + currentPunch;\r\n    this.camera.updateProjectionMatrix();\r\n  }\r\n  \r\n  private updateRecoil(delta: number): void {\r\n    // Smooth interpolation towards target recoil\r\n    this.recoilPitch = THREE.MathUtils.lerp(\r\n      this.recoilPitch, \r\n      this.targetRecoilPitch, \r\n      delta * 15\r\n    );\r\n    this.recoilYaw = THREE.MathUtils.lerp(\r\n      this.recoilYaw, \r\n      this.targetRecoilYaw, \r\n      delta * 15\r\n    );\r\n    \r\n    // Decay target recoil back to 0\r\n    this.targetRecoilPitch = THREE.MathUtils.lerp(\r\n      this.targetRecoilPitch, \r\n      0, \r\n      delta * this.recoilRecoveryRate\r\n    );\r\n    this.targetRecoilYaw = THREE.MathUtils.lerp(\r\n      this.targetRecoilYaw, \r\n      0, \r\n      delta * this.recoilRecoveryRate\r\n    );\r\n  }\r\n  \r\n  private updateChromaticAberration(delta: number): void {\r\n    // Decay chromatic aberration\r\n    this.chromaticAberration = THREE.MathUtils.lerp(\r\n      this.chromaticAberration,\r\n      this.targetChromaticAberration,\r\n      delta * 10\r\n    );\r\n    \r\n    // Decay target to 0\r\n    this.targetChromaticAberration = THREE.MathUtils.lerp(\r\n      this.targetChromaticAberration,\r\n      0,\r\n      delta * 8\r\n    );\r\n  }\r\n  \r\n  private updateVignette(delta: number): void {\r\n    // Decay vignette\r\n    this.vignetteIntensity = THREE.MathUtils.lerp(\r\n      this.vignetteIntensity,\r\n      this.targetVignetteIntensity,\r\n      delta * 10\r\n    );\r\n    \r\n    // Decay target to 0\r\n    this.targetVignetteIntensity = THREE.MathUtils.lerp(\r\n      this.targetVignetteIntensity,\r\n      0,\r\n      delta * 5\r\n    );\r\n  }\r\n  \r\n  /**\r\n   * Get current shake offset to apply to camera\r\n   */\r\n  public getShakeOffset(): THREE.Vector3 {\r\n    return this.shakeOffset.clone();\r\n  }\r\n  \r\n  /**\r\n   * Get chromatic aberration intensity (for post-processing)\r\n   */\r\n  public getChromaticAberration(): number {\r\n    return this.chromaticAberration;\r\n  }\r\n  \r\n  /**\r\n   * Get vignette intensity (for post-processing)\r\n   */\r\n  public getVignetteIntensity(): number {\r\n    return this.vignetteIntensity;\r\n  }\r\n  \r\n  /**\r\n   * Reset all effects\r\n   */\r\n  public reset(): void {\r\n    this.shakeInstances = [];\r\n    this.shakeOffset.set(0, 0, 0);\r\n    this.fovPunch = null;\r\n    this.recoilPitch = 0;\r\n    this.recoilYaw = 0;\r\n    this.targetRecoilPitch = 0;\r\n    this.targetRecoilYaw = 0;\r\n    this.chromaticAberration = 0;\r\n    this.targetChromaticAberration = 0;\r\n    this.vignetteIntensity = 0;\r\n    this.targetVignetteIntensity = 0;\r\n    this.camera.fov = this.baseFOV;\r\n    this.camera.updateProjectionMatrix();\r\n  }\r\n  \r\n  /**\r\n   * Update base FOV (e.g., when player changes settings)\r\n   */\r\n  public setBaseFOV(fov: number): void {\r\n    this.baseFOV = fov;\r\n    this.camera.fov = fov;\r\n    this.camera.updateProjectionMatrix();\r\n  }\r\n}\r\n","export class KillfeedManager {\r\n    private container: HTMLElement;\r\n    private maxItems: number = 5;\r\n    private itemDuration: number = 4000; // 4 seconds\r\n\r\n    constructor() {\r\n        this.container = document.getElementById('killfeed')!;\r\n        if (!this.container) {\r\n            console.error('Killfeed container not found!');\r\n        }\r\n    }\r\n\r\n    public addKill(killer: string, victim: string, weapon: string, isHeadshot: boolean, isMultiKill: boolean = false, killerTeam: string = '', victimTeam: string = ''): void {\r\n        if (!this.container) return;\r\n\r\n        // Use requestAnimationFrame to defer DOM manipulation\r\n        requestAnimationFrame(() => {\r\n            const item = document.createElement('div');\r\n            item.className = 'killfeed-item';\r\n            if (isHeadshot) item.classList.add('headshot');\r\n            if (isMultiKill) item.classList.add('multikill');\r\n\r\n            // Determine classes based on team or entity type\r\n            let killerClass = 'killfeed-killer';\r\n            if (killerTeam === 'red') killerClass += ' team-red';\r\n            else if (killerTeam === 'blue') killerClass += ' team-blue';\r\n            else if (killer === 'Enemy') killerClass += ' enemy';\r\n\r\n            let victimClass = 'killfeed-victim';\r\n            if (victimTeam === 'red') victimClass += ' team-red';\r\n            else if (victimTeam === 'blue') victimClass += ' team-blue';\r\n            else if (victim === 'Player') victimClass += ' player';\r\n\r\n            const headshotIcon = isHeadshot\r\n                ? '<img src=\"assets/images/ui/Headshot-Icon.png_ca1ab804.png\" class=\"killfeed-icon\">'\r\n                : '';\r\n\r\n            item.innerHTML = `\r\n                <span class=\"${killerClass}\">${killer}</span>\r\n                <span class=\"killfeed-weapon\">[${weapon}]</span>\r\n                ${headshotIcon}\r\n                <span class=\"${victimClass}\">${victim}</span>\r\n            `;\r\n\r\n            // Add to container\r\n            this.container.appendChild(item);\r\n\r\n            // Manage max items\r\n            while (this.container.children.length > this.maxItems) {\r\n                if (this.container.firstChild) {\r\n                    this.container.removeChild(this.container.firstChild);\r\n                }\r\n            }\r\n\r\n            // Auto remove\r\n            setTimeout(() => {\r\n                item.style.animation = 'fadeOut 0.5s ease-out forwards';\r\n                setTimeout(() => {\r\n                    if (item.parentNode === this.container) {\r\n                        this.container.removeChild(item);\r\n                    }\r\n                }, 500);\r\n            }, this.itemDuration);\r\n        });\r\n    }\r\n}\r\n","import { KillfeedManager } from './KillfeedManager';\r\n\r\nexport class HUDManager {\r\n  private healthBarMask: HTMLElement;\r\n  private healthText: HTMLElement;\r\n  private healthWrapper: HTMLElement;\r\n  private armorBarMask: HTMLElement;\r\n  private armorText: HTMLElement;\r\n  private staminaBarMask: HTMLElement;\r\n  private staminaText: HTMLElement;\r\n  private weaponName: HTMLElement;\r\n  private ammoDisplay: HTMLElement;\r\n  private waveDisplay: HTMLElement;\r\n  private scoreDisplay: HTMLElement;\r\n  private enemiesDisplay: HTMLElement;\r\n  private reloadIndicator: HTMLElement;\r\n  private powerupIndicator: HTMLElement;\r\n  private damageOverlay: HTMLElement;\r\n  private sniperScope: HTMLElement;\r\n  private crosshair: HTMLElement;\r\n  private crosshairTop: HTMLElement;\r\n  private crosshairBottom: HTMLElement;\r\n  private crosshairLeft: HTMLElement;\r\n  private crosshairRight: HTMLElement;\r\n  private killIcon: HTMLElement;\r\n  private headshotIcon: HTMLElement;\r\n  private multiKillDisplay: HTMLElement;\r\n  private streakDisplay: HTMLElement;\r\n  private multiKillTimeout: number | null = null;\r\n  private streakTimeout: number | null = null;\r\n\r\n  public killfeed: KillfeedManager;\r\n\r\n  // Vignette system\r\n  private vignetteImpactFlash: HTMLElement;\r\n  private vignetteDamagePulse: HTMLElement;\r\n  private vignetteCritical: HTMLElement;\r\n  private impactFlashTimeout: number | null = null;\r\n  private damagePulseTimeout: number | null = null;\r\n  private damageOverlayTimeout: number | null = null;\r\n\r\n  constructor() {\r\n    this.killfeed = new KillfeedManager();\r\n    this.healthBarMask = document.getElementById('health-bar-mask')!;\r\n    this.healthText = document.getElementById('health-text-value')!;\r\n    this.healthWrapper = document.getElementById('health-wrapper')!;\r\n    this.armorBarMask = document.getElementById('armor-bar-mask')!;\r\n    this.armorText = document.getElementById('armor-text-value')!;\r\n    this.staminaBarMask = document.getElementById('stamina-bar-mask')!;\r\n    this.staminaText = document.getElementById('stamina-text-value')!;\r\n    this.weaponName = document.getElementById('weapon-name')!;\r\n    this.ammoDisplay = document.getElementById('ammo-display')!;\r\n    this.waveDisplay = document.getElementById('wave-display')!;\r\n    this.scoreDisplay = document.getElementById('score-display')!;\r\n    this.enemiesDisplay = document.getElementById('enemies-remaining')!;\r\n    this.reloadIndicator = document.getElementById('reload-indicator')!;\r\n    this.powerupIndicator = document.getElementById('powerup-indicator')!;\r\n    this.damageOverlay = document.getElementById('damage-overlay')!;\r\n    this.sniperScope = document.getElementById('sniper-scope')!;\r\n    this.crosshair = document.getElementById('crosshair')!;\r\n    this.crosshairTop = document.getElementById('cross-top')!;\r\n    this.crosshairBottom = document.getElementById('cross-bottom')!;\r\n    this.crosshairLeft = document.getElementById('cross-left')!;\r\n    this.crosshairRight = document.getElementById('cross-right')!;\r\n    this.killIcon = document.getElementById('kill-icon')!;\r\n    this.headshotIcon = document.getElementById('headshot-icon')!;\r\n    this.multiKillDisplay = document.getElementById('multikill-display')!;\r\n    this.streakDisplay = document.getElementById('streak-display')!;\r\n\r\n    // Vignette system\r\n    this.vignetteImpactFlash = document.getElementById('vignette-impact-flash')!;\r\n    this.vignetteDamagePulse = document.getElementById('vignette-damage-pulse')!;\r\n    this.vignetteCritical = document.getElementById('vignette-critical')!;\r\n\r\n    // Hide wave display by default\r\n    if (this.waveDisplay) this.waveDisplay.style.display = 'none';\r\n  }\r\n\r\n  public updateHealth(health: number, maxHealth: number): void {\r\n    if (!this.healthBarMask) return;\r\n    const pct = Math.max(0, (health / maxHealth) * 100);\r\n    this.healthBarMask.style.width = `${pct}%`;\r\n    this.healthText.textContent = Math.ceil(health).toString();\r\n\r\n    // Update critical vignette based on HP\r\n    this.updateCriticalVignette(pct);\r\n\r\n    // Low health bar animation\r\n    if (pct < 25) {\r\n      this.healthWrapper.classList.add('critical');\r\n    } else {\r\n      this.healthWrapper.classList.remove('critical');\r\n    }\r\n  }\r\n\r\n  private updateCriticalVignette(healthPercent: number): void {\r\n    if (!this.vignetteCritical) return;\r\n    if (healthPercent < 15) {\r\n      // Very critical - intense pulsing\r\n      this.vignetteCritical.style.opacity = '1';\r\n      this.vignetteCritical.classList.add('pulsing');\r\n    } else if (healthPercent < 30) {\r\n      // Critical - strong visible vignette with pulsing\r\n      this.vignetteCritical.style.opacity = '0.85';\r\n      this.vignetteCritical.classList.add('pulsing');\r\n    } else if (healthPercent < 50) {\r\n      // Moderate damage - noticeable vignette\r\n      this.vignetteCritical.style.opacity = '0.55';\r\n      this.vignetteCritical.classList.remove('pulsing');\r\n    } else if (healthPercent < 75) {\r\n      // Light damage - subtle warning\r\n      this.vignetteCritical.style.opacity = '0.25';\r\n      this.vignetteCritical.classList.remove('pulsing');\r\n    } else {\r\n      // Healthy - fade out\r\n      this.vignetteCritical.style.opacity = '0';\r\n      this.vignetteCritical.classList.remove('pulsing');\r\n    }\r\n  }\r\n\r\n  public updateArmor(armor: number, maxArmor: number): void {\r\n    if (!this.armorBarMask) return;\r\n    const pct = Math.max(0, (armor / maxArmor) * 100);\r\n    this.armorBarMask.style.width = `${pct}%`;\r\n    this.armorText.textContent = Math.ceil(armor).toString();\r\n  }\r\n\r\n  public updateStamina(stamina: number, maxStamina: number): void {\r\n    if (!this.staminaBarMask) return;\r\n    const pct = Math.max(0, (stamina / maxStamina) * 100);\r\n    this.staminaBarMask.style.width = `${pct}%`;\r\n    this.staminaText.textContent = Math.ceil(stamina).toString();\r\n  }\r\n\r\n  public updateWeaponName(name: string): void {\r\n    if (this.weaponName) this.weaponName.textContent = name;\r\n  }\r\n\r\n  public updateAmmo(current: number, reserve: number): void {\r\n    if (!this.ammoDisplay) return;\r\n    this.ammoDisplay.textContent = `${current} / ${reserve}`;\r\n    this.ammoDisplay.className = current === 0 ? 'empty' : current <= 5 ? 'low' : '';\r\n  }\r\n\r\n  private currentWave: number = 0;\r\n\r\n  public updateWave(wave: number): void {\r\n    if (!this.waveDisplay) return;\r\n    // Only show animation when wave actually changes\r\n    if (wave === this.currentWave) return;\r\n    this.currentWave = wave;\r\n\r\n    this.waveDisplay.textContent = `WAVE ${wave}`;\r\n\r\n    // Trigger wave start animation\r\n    this.waveDisplay.classList.remove('active', 'wave-start');\r\n\r\n    // Use requestAnimationFrame to restart animation without blocking\r\n    requestAnimationFrame(() => {\r\n      this.waveDisplay.classList.add('wave-start');\r\n    });\r\n\r\n    // After animation, settle into active state\r\n    setTimeout(() => {\r\n      this.waveDisplay.classList.remove('wave-start');\r\n      this.waveDisplay.classList.add('active');\r\n    }, 1500); // Match animation duration (1.5s from CSS)\r\n  }\r\n\r\n  public updateScore(score: number): void {\r\n    if (!this.scoreDisplay) return;\r\n    const currentScore = parseInt(this.scoreDisplay.textContent || '0');\r\n    if (score > currentScore) {\r\n      this.scoreDisplay.classList.remove('pop');\r\n\r\n      // Use requestAnimationFrame to restart animation without blocking\r\n      requestAnimationFrame(() => {\r\n        this.scoreDisplay.classList.add('pop');\r\n      });\r\n    }\r\n    this.scoreDisplay.textContent = score.toString();\r\n  }\r\n\r\n  public updateEnemiesRemaining(count: number): void {\r\n    if (this.enemiesDisplay) this.enemiesDisplay.textContent = `Enemies: ${count}`;\r\n  }\r\n\r\n  public showReloading(isReloading: boolean): void {\r\n    if (!this.reloadIndicator) return;\r\n    if (isReloading) {\r\n      this.reloadIndicator.style.opacity = '1';\r\n      this.reloadIndicator.classList.add('active');\r\n    } else {\r\n      this.reloadIndicator.style.opacity = '0';\r\n      this.reloadIndicator.classList.remove('active');\r\n    }\r\n  }\r\n\r\n  public showPowerup(text: string, show: boolean): void {\r\n    if (!this.powerupIndicator) return;\r\n    this.powerupIndicator.textContent = text;\r\n    this.powerupIndicator.style.opacity = show ? '1' : '0';\r\n  }\r\n\r\n  public flashDamage(directionAngle?: number): void {\r\n    if (!this.damageOverlay) return;\r\n    // Debounce to prevent duplicate visual indicators\r\n    if (this.damageOverlayTimeout !== null) {\r\n      // Already showing damage indicator, skip this call\r\n      return;\r\n    }\r\n\r\n    this.damageOverlay.style.opacity = '1';\r\n    // RED indicator - drop-shadow creates a red glow effect\r\n    this.damageOverlay.style.filter = 'drop-shadow(0 0 8px red) drop-shadow(0 0 15px red)';\r\n\r\n    if (directionAngle !== undefined) {\r\n      // Rotate the damage indicator to point towards the source of damage\r\n      // The image points down by default, so we adjust accordingly\r\n      this.damageOverlay.style.transform = `translate(-50%, -50%) rotate(${(directionAngle + 180) % 360}deg)`;\r\n    } else {\r\n      // Generic damage (no specific direction)\r\n      this.damageOverlay.style.transform = 'translate(-50%, -50%)';\r\n    }\r\n\r\n    this.damageOverlayTimeout = setTimeout(() => {\r\n      this.damageOverlay.style.opacity = '0';\r\n      this.damageOverlay.style.filter = 'none';\r\n      this.damageOverlayTimeout = null;\r\n    }, 300) as unknown as number;\r\n  }\r\n\r\n  public showNearMissIndicator(directionAngle: number): void {\r\n    if (!this.damageOverlay) return;\r\n    // Clear any existing timeout to prevent conflicts\r\n    if (this.damageOverlayTimeout !== null) {\r\n      clearTimeout(this.damageOverlayTimeout);\r\n    }\r\n\r\n    // WHITE indicator for near misses - bright white glow\r\n    this.damageOverlay.style.opacity = '0.5'; // Less intense than actual hit\r\n    this.damageOverlay.style.filter = 'drop-shadow(0 0 8px white) drop-shadow(0 0 15px white)';\r\n\r\n    // Rotate to show direction of incoming fire (flip front/back only)\r\n    this.damageOverlay.style.transform = `translate(-50%, -50%) rotate(${(directionAngle + 180) % 360}deg)`;\r\n\r\n    this.damageOverlayTimeout = setTimeout(() => {\r\n      this.damageOverlay.style.opacity = '0';\r\n      this.damageOverlay.style.filter = 'none'; // Reset filter\r\n      this.damageOverlayTimeout = null;\r\n    }, 150) as unknown as number; // Shorter duration than actual hit\r\n  }\r\n\r\n  public showDamageVignette(damageAmount: number, maxHealth: number, directionAngle?: number): void {\r\n    if (!this.vignetteImpactFlash || !this.vignetteDamagePulse) return;\r\n    // Calculate damage intensity (0-1)\r\n    const damagePercent = (damageAmount / maxHealth) * 100;\r\n    const intensity = Math.min(damagePercent / 50, 1.0); // Cap at 50% of max health for full intensity\r\n\r\n    // LAYER 1: Impact Flash (instant, sharp)\r\n    if (this.impactFlashTimeout) clearTimeout(this.impactFlashTimeout);\r\n    this.vignetteImpactFlash.style.opacity = Math.min(0.9, 0.5 + intensity * 0.7).toString();\r\n\r\n    // Optional directional impact (stronger on the side of the hit)\r\n    if (directionAngle !== undefined) {\r\n      const radians = (directionAngle * Math.PI) / 180;\r\n      const x = Math.sin(radians) * 10;\r\n      const y = -Math.cos(radians) * 10;\r\n      this.vignetteImpactFlash.style.transform = `translate(${x}%, ${y}%)`;\r\n    } else {\r\n      this.vignetteImpactFlash.style.transform = 'translate(0, 0)';\r\n    }\r\n\r\n    this.impactFlashTimeout = window.setTimeout(() => {\r\n      this.vignetteImpactFlash.style.opacity = '0';\r\n      this.vignetteImpactFlash.style.transform = 'translate(0, 0)';\r\n    }, 120);\r\n\r\n    // LAYER 2: Damage Pulse (expanding glow)\r\n    if (this.damagePulseTimeout) clearTimeout(this.damagePulseTimeout);\r\n\r\n    // Color based on damage severity\r\n    const pulseColor = damagePercent > 30\r\n      ? 'rgba(255, 0, 51, INTENSITY)' // Heavy hit - bright red\r\n      : 'rgba(255, 165, 0, INTENSITY)'; // Light hit - orange\r\n\r\n    const pulseIntensity = Math.max(0.6, intensity * 1.2); // Much more visible\r\n    this.vignetteDamagePulse.style.background = `\r\n      radial-gradient(\r\n        ellipse at center,\r\n        transparent 30%,\r\n        ${pulseColor.replace('INTENSITY', (pulseIntensity * 0.3).toString())} 45%,\r\n        ${pulseColor.replace('INTENSITY', (pulseIntensity * 0.7).toString())} 60%,\r\n        ${pulseColor.replace('INTENSITY', (pulseIntensity * 0.95).toString())} 75%,\r\n        ${pulseColor.replace('INTENSITY', (pulseIntensity * 0.8).toString())} 90%\r\n      )\r\n    `;\r\n\r\n    this.vignetteDamagePulse.style.opacity = Math.min(pulseIntensity, 0.95).toString();\r\n    this.vignetteDamagePulse.classList.add('pulsing');\r\n\r\n    // Expand pulse\r\n    setTimeout(() => {\r\n      this.vignetteDamagePulse.classList.remove('pulsing');\r\n    }, 100);\r\n\r\n    this.damagePulseTimeout = window.setTimeout(() => {\r\n      this.vignetteDamagePulse.style.opacity = '0';\r\n    }, 400);\r\n\r\n    // Show directional damage arrow (red for hits)\r\n    if (directionAngle !== undefined) {\r\n      this.flashDamage(directionAngle);\r\n    }\r\n  }\r\n\r\n  public showHitmarker(isKill: boolean): void {\r\n    const hitmarker = document.getElementById('hitmarker')!;\r\n    if (!hitmarker) return;\r\n    const img = hitmarker.querySelector('img');\r\n\r\n    hitmarker.style.opacity = '1';\r\n    hitmarker.style.transform = isKill\r\n      ? 'translate(-50%, -50%) scale(1.5)'\r\n      : 'translate(-50%, -50%) scale(1.2)';\r\n\r\n    if (img) {\r\n      img.style.filter = isKill\r\n        ? 'drop-shadow(0 0 5px #ef4444) sepia(1) saturate(1000%) hue-rotate(-50deg)' // Red for kill\r\n        : 'drop-shadow(0 0 2px #ffffff)'; // White for hit\r\n    }\r\n\r\n    setTimeout(() => {\r\n      hitmarker.style.opacity = '0';\r\n      hitmarker.style.transform = 'translate(-50%, -50%) scale(1)';\r\n    }, 100);\r\n  }\r\n\r\n  public toggleScope(show: boolean): void {\r\n    if (this.sniperScope) this.sniperScope.style.opacity = show ? '1' : '0';\r\n    if (this.crosshair) this.crosshair.style.opacity = show ? '0' : '1';\r\n  }\r\n\r\n  public showMessage(message: string, duration: number = 2000): void {\r\n    const msgDisplay = document.getElementById('message-display');\r\n    if (msgDisplay) {\r\n      msgDisplay.textContent = message;\r\n      msgDisplay.style.opacity = '1';\r\n      setTimeout(() => {\r\n        msgDisplay.style.opacity = '0';\r\n      }, duration);\r\n    }\r\n  }\r\n\r\n  public showGameOver(stats: { wave: number; kills: number; accuracy: number; time: string; score: number }): void {\r\n    const gameOver = document.getElementById('game-over');\r\n    if (gameOver) {\r\n      gameOver.style.display = 'flex';\r\n      const finalScore = document.getElementById('final-score');\r\n      const finalWaves = document.getElementById('final-waves');\r\n      const finalKills = document.getElementById('final-kills');\r\n      const finalAccuracy = document.getElementById('final-accuracy');\r\n      const finalTime = document.getElementById('final-time');\r\n\r\n      if (finalScore) finalScore.textContent = stats.score.toString();\r\n      if (finalWaves) finalWaves.textContent = stats.wave.toString();\r\n      if (finalKills) finalKills.textContent = stats.kills.toString();\r\n      if (finalAccuracy) finalAccuracy.textContent = stats.accuracy.toString();\r\n      if (finalTime) finalTime.textContent = stats.time;\r\n    }\r\n  }\r\n\r\n  public hideGameOver(): void {\r\n    const gameOver = document.getElementById('game-over');\r\n    if (gameOver) {\r\n      gameOver.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  public updateCrosshair(spread: number, isMoving: boolean = false, isSprinting: boolean = false, isAirborne: boolean = false): void {\r\n    if (!this.crosshairTop) return;\r\n    // Map spread directly to crosshair gap - AAA FPS standard\r\n    // Base gap: 8px for tight feel, spread multiplier: 10000 for proper visibility\r\n    // CS:GO/Valorant style: minimal base, reactive to shooting\r\n    let gap = 8 + spread * 10000;\r\n\r\n    // Movement penalties (visual representation of accuracy loss)\r\n    if (isAirborne) {\r\n      gap *= 1.8; // Significant penalty when jumping\r\n    } else if (isSprinting) {\r\n      gap *= 1.4; // Running reduces accuracy\r\n    } else if (isMoving) {\r\n      gap *= 1.15; // Walking slightly reduces accuracy\r\n    }\r\n\r\n    // Clamp maximum gap to prevent screen-filling crosshair (AAA games cap at ~50-60px)\r\n    gap = Math.min(gap, 55);\r\n\r\n    // Apply the gap to each line\r\n    this.crosshairTop.style.transform = `translateX(-50%) translateY(-${gap}px)`;\r\n    this.crosshairBottom.style.transform = `translateX(-50%) translateY(${gap}px)`;\r\n    this.crosshairLeft.style.transform = `translateY(-50%) translateX(-${gap}px)`;\r\n    this.crosshairRight.style.transform = `translateY(-50%) translateX(${gap}px)`;\r\n  }\r\n\r\n  public showHitFeedback(isKill: boolean, isHeadshot: boolean): void {\r\n    if (!this.crosshair) return;\r\n    // Remove any existing feedback classes\r\n    this.crosshair.classList.remove('hit', 'headshot', 'kill');\r\n\r\n    // Add appropriate feedback class\r\n    if (isKill) {\r\n      this.crosshair.classList.add('kill');\r\n    } else if (isHeadshot) {\r\n      this.crosshair.classList.add('headshot');\r\n    } else {\r\n      this.crosshair.classList.add('hit');\r\n    }\r\n\r\n    // Remove the class after animation\r\n    setTimeout(() => {\r\n      this.crosshair.classList.remove('hit', 'headshot', 'kill');\r\n    }, 100);\r\n  }\r\n\r\n  public showPauseMenu(show: boolean): void {\r\n    const menu = document.getElementById('pause-menu');\r\n    if (menu) menu.style.display = show ? 'flex' : 'none';\r\n  }\r\n\r\n  public hideWaveDisplay(): void {\r\n    if (this.waveDisplay) this.waveDisplay.style.display = 'none';\r\n  }\r\n\r\n  public showWaveDisplay(): void {\r\n    if (this.waveDisplay) this.waveDisplay.style.display = 'block';\r\n  }\r\n\r\n  public hideStartScreen(): void {\r\n    const screen = document.getElementById('start-screen');\r\n    if (screen) screen.style.display = 'none';\r\n  }\r\n\r\n  public showKillIcon(): void {\r\n    if (!this.killIcon) return;\r\n    this.killIcon.style.opacity = '1';\r\n    this.killIcon.style.transform = 'translate(-50%, -50%) scale(1.2)';\r\n\r\n    setTimeout(() => {\r\n      this.killIcon.style.transform = 'translate(-50%, -50%) scale(1.0)';\r\n    }, 50);\r\n\r\n    setTimeout(() => {\r\n      this.killIcon.style.opacity = '0';\r\n    }, 500);\r\n  }\r\n\r\n  public showHeadshotIcon(): void {\r\n    if (!this.headshotIcon) return;\r\n    this.headshotIcon.style.opacity = '1';\r\n    this.headshotIcon.style.transform = 'translate(-50%, -50%) scale(1.2)';\r\n\r\n    setTimeout(() => {\r\n      this.headshotIcon.style.transform = 'translate(-50%, -50%) scale(1.0)';\r\n    }, 50);\r\n\r\n    setTimeout(() => {\r\n      this.headshotIcon.style.opacity = '0';\r\n    }, 500);\r\n  }\r\n\r\n  public showMultiKill(count: number): void {\r\n    if (!this.multiKillDisplay) return;\r\n    let text = '';\r\n    let tierClass = '';\r\n\r\n    switch (count) {\r\n      case 2: text = 'DOUBLE KILL'; tierClass = 'impact-tier-1'; break;\r\n      case 3: text = 'TRIPLE KILL'; tierClass = 'impact-tier-2'; break;\r\n      case 4: text = 'QUAD KILL'; tierClass = 'impact-tier-3'; break;\r\n      case 5: text = 'PENTA KILL'; tierClass = 'impact-tier-3'; break;\r\n      default: text = 'GODLIKE'; tierClass = 'impact-tier-4'; break;\r\n    }\r\n\r\n    this.multiKillDisplay.textContent = text;\r\n    this.multiKillDisplay.className = ''; // Clear classes\r\n    this.multiKillDisplay.style.opacity = '1';\r\n\r\n    // Use requestAnimationFrame to restart animation without blocking\r\n    requestAnimationFrame(() => {\r\n      this.multiKillDisplay.classList.add('impact-text', tierClass, 'shake');\r\n    });\r\n\r\n    if (this.multiKillTimeout) clearTimeout(this.multiKillTimeout);\r\n    this.multiKillTimeout = window.setTimeout(() => {\r\n      this.multiKillDisplay.style.opacity = '0';\r\n      this.multiKillDisplay.className = '';\r\n    }, 3000);\r\n  }\r\n\r\n  public showHitStreak(count: number): void {\r\n    if (!this.streakDisplay) return;\r\n    if (count < 3) return; // Show from 3 hits\r\n\r\n    this.streakDisplay.textContent = `${count} HIT STREAK`;\r\n    this.streakDisplay.className = '';\r\n    this.streakDisplay.style.opacity = '1';\r\n\r\n    // Determine tier based on streak\r\n    let tierClass = 'impact-tier-1';\r\n    if (count >= 10) tierClass = 'impact-tier-4';\r\n    else if (count >= 7) tierClass = 'impact-tier-3';\r\n    else if (count >= 5) tierClass = 'impact-tier-2';\r\n\r\n    // Use requestAnimationFrame to restart animation without blocking\r\n    requestAnimationFrame(() => {\r\n      this.streakDisplay.classList.add('impact-text', tierClass);\r\n      if (count >= 5) this.streakDisplay.classList.add('shake');\r\n    });\r\n\r\n    if (this.streakTimeout) clearTimeout(this.streakTimeout);\r\n    this.streakTimeout = window.setTimeout(() => {\r\n      this.streakDisplay.style.opacity = '0';\r\n      this.streakDisplay.className = '';\r\n    }, 2000);\r\n  }\r\n\r\n  public addKillFeed(killer: string, victim: string, weapon: string, isHeadshot: boolean, isMultiKill: boolean = false): void {\r\n    this.killfeed.addKill(killer, victim, weapon, isHeadshot, isMultiKill);\r\n  }\r\n\r\n  public hideHUD(): void {\r\n    const hud = document.getElementById('hud');\r\n    if (hud) {\r\n      hud.style.display = 'none';\r\n    }\r\n  }\r\n\r\n  public showHUD(): void {\r\n    const hud = document.getElementById('hud');\r\n    if (hud) {\r\n      hud.style.display = 'block';\r\n    }\r\n  }\r\n\r\n  public reset(): void {\r\n    // Reset wave tracker so first wave animation shows\r\n    this.currentWave = 0;\r\n  }\r\n\r\n  public updateScoreboard(scores: any, myUserId: string) {\r\n    const tbody = document.getElementById('scoreboard-body');\r\n    if (!tbody) return;\r\n\r\n    tbody.innerHTML = ''; // Clear existing\r\n\r\n    // Convert players object to array and sort by kills\r\n    const players = Object.entries(scores.players).map(([id, stats]: [string, any]) => ({\r\n      id,\r\n      ...stats\r\n    })).sort((a: any, b: any) => b.kills - a.kills);\r\n\r\n    players.forEach((p: any) => {\r\n      const tr = document.createElement('tr');\r\n      if (p.id === myUserId) {\r\n        tr.classList.add('local-player');\r\n      }\r\n\r\n      const name = p.id === myUserId ? 'YOU' : `Player ${p.id.substr(0, 4)}`;\r\n\r\n      tr.innerHTML = `\r\n                <td>${name}</td>\r\n                <td>${p.kills}</td>\r\n                <td>${p.deaths}</td>\r\n                <td>${p.ping || 0}ms</td>\r\n            `;\r\n      tbody.appendChild(tr);\r\n    });\r\n  }\r\n\r\n  public toggleScoreboard(visible: boolean) {\r\n    const scoreboard = document.getElementById('scoreboard');\r\n    if (scoreboard) {\r\n      scoreboard.style.display = visible ? 'block' : 'none';\r\n    }\r\n  }\r\n\r\n  public showWaitingForPlayers(show: boolean): void {\r\n    let waitingEl = document.getElementById('waiting-message');\r\n    if (!waitingEl) {\r\n      waitingEl = document.createElement('div');\r\n      waitingEl.id = 'waiting-message';\r\n      waitingEl.style.position = 'absolute';\r\n      waitingEl.style.top = '20%';\r\n      waitingEl.style.left = '50%';\r\n      waitingEl.style.transform = 'translate(-50%, -50%)';\r\n      waitingEl.style.color = '#ffffff';\r\n      waitingEl.style.fontFamily = \"'Orbitron', sans-serif\";\r\n      waitingEl.style.fontSize = '24px';\r\n      waitingEl.style.fontWeight = 'bold';\r\n      waitingEl.style.textShadow = '0 0 10px rgba(0, 255, 255, 0.5)';\r\n      waitingEl.style.zIndex = '100';\r\n      waitingEl.textContent = 'WAITING FOR PLAYERS...';\r\n      document.body.appendChild(waitingEl);\r\n    }\r\n    waitingEl.style.display = show ? 'block' : 'none';\r\n  }\r\n\r\n  public showTeamScoreboard(show: boolean): void {\r\n    let teamScoreEl = document.getElementById('team-scores');\r\n    if (!teamScoreEl) {\r\n      teamScoreEl = document.createElement('div');\r\n      teamScoreEl.id = 'team-scores';\r\n      teamScoreEl.style.position = 'absolute';\r\n      teamScoreEl.style.top = '20px';\r\n      teamScoreEl.style.left = '50%';\r\n      teamScoreEl.style.transform = 'translateX(-50%)';\r\n      teamScoreEl.style.display = 'flex';\r\n      teamScoreEl.style.gap = '20px';\r\n      teamScoreEl.style.fontFamily = \"'Orbitron', sans-serif\";\r\n      teamScoreEl.style.fontSize = '32px';\r\n      teamScoreEl.style.fontWeight = 'bold';\r\n      teamScoreEl.style.zIndex = '90';\r\n      teamScoreEl.innerHTML = `\r\n        <div id=\"score-blue\" style=\"color: #3b82f6; text-shadow: 0 0 10px rgba(59, 130, 246, 0.5);\">0</div>\r\n        <div style=\"color: #fff;\">-</div>\r\n        <div id=\"score-red\" style=\"color: #ef4444; text-shadow: 0 0 10px rgba(239, 68, 68, 0.5);\">0</div>\r\n      `;\r\n      document.body.appendChild(teamScoreEl);\r\n    }\r\n    teamScoreEl.style.display = show ? 'flex' : 'none';\r\n  }\r\n\r\n  public updateTeamScores(red: number, blue: number): void {\r\n    const redEl = document.getElementById('score-red');\r\n    const blueEl = document.getElementById('score-blue');\r\n    if (redEl) redEl.textContent = red.toString();\r\n    if (blueEl) blueEl.textContent = blue.toString();\r\n  }\r\n\r\n  public showFlagStatus(redStatus: string, blueStatus: string): void {\r\n    let flagStatusEl = document.getElementById('flag-status');\r\n    if (!flagStatusEl) {\r\n      flagStatusEl = document.createElement('div');\r\n      flagStatusEl.id = 'flag-status';\r\n      flagStatusEl.style.position = 'absolute';\r\n      flagStatusEl.style.top = '60px';\r\n      flagStatusEl.style.left = '50%';\r\n      flagStatusEl.style.transform = 'translateX(-50%)';\r\n      flagStatusEl.style.display = 'flex';\r\n      flagStatusEl.style.gap = '40px';\r\n      flagStatusEl.style.fontFamily = \"'Orbitron', sans-serif\";\r\n      flagStatusEl.style.fontSize = '18px';\r\n      flagStatusEl.style.fontWeight = 'bold';\r\n      flagStatusEl.style.zIndex = '90';\r\n      flagStatusEl.style.textShadow = '0 0 5px rgba(0,0,0,0.8)';\r\n      document.body.appendChild(flagStatusEl);\r\n    }\r\n\r\n    const getStatusColor = (status: string) => {\r\n      if (status === 'TAKEN') return '#ffaa00'; // Orange for danger\r\n      if (status === 'DROPPED') return '#ffff00'; // Yellow for caution\r\n      return '#ffffff'; // White for safe\r\n    };\r\n\r\n    flagStatusEl.innerHTML = `\r\n      <div style=\"color: #ef4444; display: flex; align-items: center; gap: 10px;\">\r\n        <span>RED FLAG:</span>\r\n        <span style=\"color: ${getStatusColor(redStatus)}\">${redStatus}</span>\r\n      </div>\r\n      <div style=\"color: #3b82f6; display: flex; align-items: center; gap: 10px;\">\r\n        <span>BLUE FLAG:</span>\r\n        <span style=\"color: ${getStatusColor(blueStatus)}\">${blueStatus}</span>\r\n      </div>\r\n    `;\r\n    flagStatusEl.style.display = 'flex';\r\n  }\r\n\r\n  public hideFlagStatus(): void {\r\n    const el = document.getElementById('flag-status');\r\n    if (el) el.style.display = 'none';\r\n  }\r\n\r\n  public updateZoneInfo(radius: number, timeToShrink: number): void {\r\n    let zoneEl = document.getElementById('zone-info');\r\n    if (!zoneEl) {\r\n      zoneEl = document.createElement('div');\r\n      zoneEl.id = 'zone-info';\r\n      zoneEl.style.position = 'absolute';\r\n      zoneEl.style.top = '100px';\r\n      zoneEl.style.right = '20px';\r\n      zoneEl.style.textAlign = 'right';\r\n      zoneEl.style.fontFamily = \"'Orbitron', sans-serif\";\r\n      zoneEl.style.color = '#fff';\r\n      zoneEl.style.textShadow = '0 0 5px rgba(0,0,0,0.8)';\r\n      document.body.appendChild(zoneEl);\r\n    }\r\n\r\n    const timeStr = timeToShrink > 0 ? `SHRINKING IN: ${Math.ceil(timeToShrink)}s` : 'ZONE SHRINKING!';\r\n    const color = timeToShrink > 0 ? '#fff' : '#ef4444';\r\n\r\n    zoneEl.innerHTML = `\r\n          <div style=\"font-size: 18px; font-weight: bold; color: ${color}\">${timeStr}</div>\r\n          <div style=\"font-size: 14px; color: #aaa\">ZONE RADIUS: ${Math.round(radius)}m</div>\r\n      `;\r\n    zoneEl.style.display = 'block';\r\n  }\r\n\r\n  public updateAliveCount(count: number): void {\r\n    let aliveEl = document.getElementById('alive-count');\r\n    if (!aliveEl) {\r\n      aliveEl = document.createElement('div');\r\n      aliveEl.id = 'alive-count';\r\n      aliveEl.style.position = 'absolute';\r\n      aliveEl.style.top = '20px';\r\n      aliveEl.style.right = '20px';\r\n      aliveEl.style.fontFamily = \"'Orbitron', sans-serif\";\r\n      aliveEl.style.fontSize = '24px';\r\n      aliveEl.style.fontWeight = 'bold';\r\n      aliveEl.style.color = '#fff';\r\n      aliveEl.style.textShadow = '0 0 5px rgba(0,0,0,0.8)';\r\n      document.body.appendChild(aliveEl);\r\n    }\r\n    aliveEl.textContent = `ALIVE: ${count}`;\r\n    aliveEl.style.display = 'block';\r\n  }\r\n\r\n  public showSpectatorUI(targetName: string): void {\r\n    let specEl = document.getElementById('spectator-ui');\r\n    if (!specEl) {\r\n      specEl = document.createElement('div');\r\n      specEl.id = 'spectator-ui';\r\n      specEl.style.position = 'absolute';\r\n      specEl.style.bottom = '100px';\r\n      specEl.style.left = '50%';\r\n      specEl.style.transform = 'translateX(-50%)';\r\n      specEl.style.fontFamily = \"'Orbitron', sans-serif\";\r\n      specEl.style.fontSize = '20px';\r\n      specEl.style.fontWeight = 'bold';\r\n      specEl.style.color = '#fbbf24'; // Amber\r\n      specEl.style.textShadow = '0 0 5px rgba(0,0,0,0.8)';\r\n      document.body.appendChild(specEl);\r\n    }\r\n    specEl.textContent = `SPECTATING: ${targetName}`;\r\n    specEl.style.display = 'block';\r\n\r\n    // Hide normal HUD elements\r\n    this.hideHUD();\r\n  }\r\n\r\n  public updateMinimap(playerPos: { x: number, z: number }, mapSize: number, zoneRadius: number, zoneCenter: { x: number, z: number }, remotePlayers: Array<{ x: number, z: number, team?: string }>): void {\r\n    let minimapCanvas = document.getElementById('minimap-canvas') as HTMLCanvasElement;\r\n    if (!minimapCanvas) {\r\n      const container = document.createElement('div');\r\n      container.id = 'minimap-container';\r\n      container.style.position = 'absolute';\r\n      container.style.bottom = '20px';\r\n      container.style.right = '20px';\r\n      container.style.width = '200px';\r\n      container.style.height = '200px';\r\n      container.style.border = '2px solid #fff';\r\n      container.style.borderRadius = '50%';\r\n      container.style.overflow = 'hidden';\r\n      container.style.backgroundColor = 'rgba(0, 0, 0, 0.5)';\r\n      document.body.appendChild(container);\r\n\r\n      minimapCanvas = document.createElement('canvas');\r\n      minimapCanvas.id = 'minimap-canvas';\r\n      minimapCanvas.width = 200;\r\n      minimapCanvas.height = 200;\r\n      container.appendChild(minimapCanvas);\r\n    }\r\n\r\n    const ctx = minimapCanvas.getContext('2d');\r\n    if (!ctx) return;\r\n\r\n    const size = 200;\r\n    const center = size / 2;\r\n    const scale = size / mapSize; // Map world units to pixels\r\n\r\n    ctx.clearRect(0, 0, size, size);\r\n\r\n    // Draw Zone\r\n    ctx.beginPath();\r\n    ctx.arc(\r\n      center + zoneCenter.x * scale,\r\n      center + zoneCenter.z * scale,\r\n      zoneRadius * scale,\r\n      0, Math.PI * 2\r\n    );\r\n    ctx.fillStyle = 'rgba(0, 100, 255, 0.2)';\r\n    ctx.fill();\r\n    ctx.strokeStyle = '#0066ff';\r\n    ctx.lineWidth = 2;\r\n    ctx.stroke();\r\n\r\n    // Draw Remote Players (if visible/teammates)\r\n    remotePlayers.forEach(p => {\r\n      ctx.beginPath();\r\n      ctx.arc(center + p.x * scale, center + p.z * scale, 3, 0, Math.PI * 2);\r\n      ctx.fillStyle = p.team === 'blue' ? '#3b82f6' : '#ef4444';\r\n      ctx.fill();\r\n    });\r\n\r\n    // Draw Local Player\r\n    ctx.beginPath();\r\n    ctx.arc(center + playerPos.x * scale, center + playerPos.z * scale, 4, 0, Math.PI * 2);\r\n    ctx.fillStyle = '#00ff00';\r\n    ctx.fill();\r\n    ctx.strokeStyle = '#fff';\r\n    ctx.lineWidth = 1;\r\n    ctx.stroke();\r\n  }\r\n\r\n  public setupSettingsMenu(\r\n    settingsManager: any,\r\n    onBack: () => void,\r\n    onChange?: () => void\r\n  ): void {\r\n    const settingsBtn = document.getElementById('settings-btn');\r\n    const settingsMenu = document.getElementById('settings-menu');\r\n    const backBtn = document.getElementById('settings-back-btn');\r\n    const pauseMenu = document.getElementById('pause-menu');\r\n\r\n    const sensSlider = document.getElementById('sensitivity-slider') as HTMLInputElement;\r\n    const sensValue = document.getElementById('sensitivity-value');\r\n    const volSlider = document.getElementById('volume-slider') as HTMLInputElement;\r\n    const volValue = document.getElementById('volume-value');\r\n    const fovSlider = document.getElementById('fov-slider') as HTMLInputElement;\r\n    const fovValue = document.getElementById('fov-value');\r\n\r\n    if (settingsBtn && settingsMenu && backBtn && pauseMenu) {\r\n      settingsBtn.addEventListener('click', () => {\r\n        pauseMenu.style.display = 'none';\r\n        settingsMenu.style.display = 'flex';\r\n\r\n        // Load current values\r\n        const current = settingsManager.getSettings();\r\n        if (sensSlider && sensValue) {\r\n          sensSlider.value = current.sensitivity.toString();\r\n          sensValue.textContent = current.sensitivity.toFixed(4);\r\n        }\r\n        if (volSlider && volValue) {\r\n          volSlider.value = current.volume.toString();\r\n          volValue.textContent = `${Math.round(current.volume * 100)}%`;\r\n        }\r\n        if (fovSlider && fovValue) {\r\n          fovSlider.value = current.fov.toString();\r\n          fovValue.textContent = current.fov.toString();\r\n        }\r\n      });\r\n\r\n      backBtn.addEventListener('click', () => {\r\n        settingsMenu.style.display = 'none';\r\n        pauseMenu.style.display = 'flex';\r\n        onBack();\r\n      });\r\n    }\r\n\r\n    // Bind sliders\r\n    if (sensSlider && sensValue) {\r\n      sensSlider.addEventListener('input', (e: any) => {\r\n        const val = parseFloat(e.target.value);\r\n        settingsManager.setSensitivity(val);\r\n        sensValue.textContent = val.toFixed(4);\r\n        if (onChange) onChange();\r\n      });\r\n    }\r\n\r\n    if (volSlider && volValue) {\r\n      volSlider.addEventListener('input', (e: any) => {\r\n        const val = parseFloat(e.target.value);\r\n        settingsManager.setVolume(val);\r\n        volValue.textContent = `${Math.round(val * 100)}%`;\r\n        if (onChange) onChange();\r\n      });\r\n    }\r\n\r\n    if (fovSlider && fovValue) {\r\n      fovSlider.addEventListener('input', (e: any) => {\r\n        const val = parseInt(e.target.value);\r\n        settingsManager.setFOV(val);\r\n        fovValue.textContent = val.toString();\r\n        if (onChange) onChange();\r\n      });\r\n    }\r\n  }\r\n  \r\n  public show(): void {\r\n    this.showHUD();\r\n  }\r\n  \r\n  public hide(): void {\r\n    this.hideHUD();\r\n  }\r\n  \r\n  public updateKillfeed(_delta: number): void {\r\n    // Logic to update killfeed animations if needed\r\n  }\r\n}\r\n","// RIFT Integration - Audio Manager\r\n// Centralized audio management for weapon sounds, ambient, positional audio\r\n\r\nimport * as THREE from 'three';\r\n\r\nexport interface AudioConfig {\r\n  volume: number;\r\n  loop: boolean;\r\n  positional: boolean;\r\n  refDistance?: number;\r\n  rolloffFactor?: number;\r\n  maxDistance?: number;\r\n}\r\n\r\ninterface ManagedAudio {\r\n  audio: THREE.Audio | THREE.PositionalAudio;\r\n  id: string;\r\n  category: 'music' | 'sfx' | 'ambient' | 'voice';\r\n}\r\n\r\nexport class AudioManager {\r\n  private listener: THREE.AudioListener;\r\n  private audioLoader: THREE.AudioLoader;\r\n  private bufferCache: Map<string, AudioBuffer> = new Map();\r\n  private activeAudio: ManagedAudio[] = [];\r\n\r\n  // Volume levels per category\r\n  private volumes = {\r\n    master: 1.0,\r\n    music: 0.5,\r\n    sfx: 0.8,\r\n    ambient: 0.6,\r\n    voice: 1.0,\r\n  };\r\n\r\n  // Reusable audio pools\r\n  private sfxPool: THREE.Audio[] = [];\r\n  private positionalPool: THREE.PositionalAudio[] = [];\r\n  private poolSize = 20;\r\n\r\n  constructor(camera: THREE.Camera) {\r\n    this.listener = new THREE.AudioListener();\r\n    camera.add(this.listener);\r\n    this.audioLoader = new THREE.AudioLoader();\r\n\r\n    // Initialize pools\r\n    for (let i = 0; i < this.poolSize; i++) {\r\n      this.sfxPool.push(new THREE.Audio(this.listener));\r\n      this.positionalPool.push(new THREE.PositionalAudio(this.listener));\r\n    }\r\n  }\r\n\r\n  public getListener(): THREE.AudioListener {\r\n    return this.listener;\r\n  }\r\n\r\n  // ========== LOADING ==========\r\n\r\n  public async loadAudio(path: string): Promise<AudioBuffer> {\r\n    if (this.bufferCache.has(path)) {\r\n      return this.bufferCache.get(path)!;\r\n    }\r\n\r\n    return new Promise((resolve, reject) => {\r\n      this.audioLoader.load(\r\n        path,\r\n        (buffer) => {\r\n          this.bufferCache.set(path, buffer);\r\n          resolve(buffer);\r\n        },\r\n        undefined,\r\n        (error) => {\r\n          console.warn(`Failed to load audio: ${path}`, error);\r\n          reject(error);\r\n        }\r\n      );\r\n    });\r\n  }\r\n\r\n  public async preloadAudios(paths: string[]): Promise<void> {\r\n    await Promise.all(paths.map((path) => this.loadAudio(path).catch(() => null)));\r\n  }\r\n\r\n  // ========== PLAYBACK ==========\r\n\r\n  public playSound(\r\n    pathOrBuffer: string | AudioBuffer,\r\n    category: 'sfx' | 'ambient' | 'voice' = 'sfx',\r\n    config: Partial<AudioConfig> = {}\r\n  ): THREE.Audio | null {\r\n    const audio = this.getFromPool(this.sfxPool);\r\n    if (!audio) return null;\r\n\r\n    const setup = (buffer: AudioBuffer) => {\r\n      if (audio.isPlaying) audio.stop();\r\n      audio.setBuffer(buffer);\r\n      audio.setVolume(this.getEffectiveVolume(category) * (config.volume ?? 1));\r\n      audio.setLoop(config.loop ?? false);\r\n      audio.play();\r\n    };\r\n\r\n    if (typeof pathOrBuffer === 'string') {\r\n      if (this.bufferCache.has(pathOrBuffer)) {\r\n        setup(this.bufferCache.get(pathOrBuffer)!);\r\n      } else {\r\n        this.loadAudio(pathOrBuffer).then(setup).catch(() => {});\r\n      }\r\n    } else {\r\n      setup(pathOrBuffer);\r\n    }\r\n\r\n    return audio;\r\n  }\r\n\r\n  public playPositionalSound(\r\n    pathOrBuffer: string | AudioBuffer,\r\n    position: THREE.Vector3,\r\n    category: 'sfx' | 'ambient' = 'sfx',\r\n    config: Partial<AudioConfig> = {}\r\n  ): THREE.PositionalAudio | null {\r\n    const audio = this.getPositionalFromPool();\r\n    if (!audio) return null;\r\n\r\n    audio.position.copy(position);\r\n    audio.setRefDistance(config.refDistance ?? 5);\r\n    audio.setRolloffFactor(config.rolloffFactor ?? 1);\r\n    audio.setMaxDistance(config.maxDistance ?? 50);\r\n\r\n    const setup = (buffer: AudioBuffer) => {\r\n      if (audio.isPlaying) audio.stop();\r\n      audio.setBuffer(buffer);\r\n      audio.setVolume(this.getEffectiveVolume(category) * (config.volume ?? 1));\r\n      audio.setLoop(config.loop ?? false);\r\n      audio.play();\r\n    };\r\n\r\n    if (typeof pathOrBuffer === 'string') {\r\n      if (this.bufferCache.has(pathOrBuffer)) {\r\n        setup(this.bufferCache.get(pathOrBuffer)!);\r\n      } else {\r\n        this.loadAudio(pathOrBuffer).then(setup).catch(() => {});\r\n      }\r\n    } else {\r\n      setup(pathOrBuffer);\r\n    }\r\n\r\n    return audio;\r\n  }\r\n\r\n  public playWeaponSound(\r\n    firePath: string,\r\n    tailPath?: string,\r\n    volume: number = 0.5\r\n  ): void {\r\n    // Fire sound\r\n    if (this.bufferCache.has(firePath)) {\r\n      this.playSound(this.bufferCache.get(firePath)!, 'sfx', { volume });\r\n    } else {\r\n      this.playSound(firePath, 'sfx', { volume });\r\n    }\r\n\r\n    // Tail/echo sound (delayed reverb effect)\r\n    if (tailPath) {\r\n      this.playSound(tailPath, 'sfx', { volume: volume * 0.6 });\r\n    }\r\n  }\r\n\r\n  // ========== VOLUME CONTROL ==========\r\n\r\n  public setMasterVolume(volume: number): void {\r\n    this.volumes.master = Math.max(0, Math.min(1, volume));\r\n    this.listener.setMasterVolume(this.volumes.master);\r\n  }\r\n\r\n  public setCategoryVolume(category: keyof typeof this.volumes, volume: number): void {\r\n    this.volumes[category] = Math.max(0, Math.min(1, volume));\r\n  }\r\n\r\n  public getEffectiveVolume(category: keyof typeof this.volumes): number {\r\n    return this.volumes.master * this.volumes[category];\r\n  }\r\n\r\n  public getMasterVolume(): number {\r\n    return this.volumes.master;\r\n  }\r\n\r\n  // ========== POOL MANAGEMENT ==========\r\n\r\n  private getFromPool(pool: THREE.Audio[]): THREE.Audio | null {\r\n    // Find an audio that's not playing\r\n    for (const audio of pool) {\r\n      if (!audio.isPlaying) {\r\n        return audio;\r\n      }\r\n    }\r\n\r\n    // All busy - return the first one (will interrupt oldest)\r\n    return pool[0] || null;\r\n  }\r\n\r\n  private getPositionalFromPool(): THREE.PositionalAudio | null {\r\n    for (const audio of this.positionalPool) {\r\n      if (!audio.isPlaying) {\r\n        return audio;\r\n      }\r\n    }\r\n    return this.positionalPool[0] || null;\r\n  }\r\n\r\n  // ========== AMBIENT ==========\r\n\r\n  public playAmbient(path: string, volume: number = 0.6): THREE.Audio | null {\r\n    return this.playSound(path, 'ambient', { volume, loop: true });\r\n  }\r\n\r\n  public playMusic(path: string, volume: number = 0.5): THREE.Audio | null {\r\n    // Stop any existing music first\r\n    this.stopCategory('music');\r\n    return this.playSound(path, 'ambient', { volume, loop: true });\r\n  }\r\n\r\n  // ========== UTILITY ==========\r\n\r\n  public stopCategory(category: 'music' | 'sfx' | 'ambient' | 'voice'): void {\r\n    this.activeAudio\r\n      .filter((a) => a.category === category)\r\n      .forEach((a) => {\r\n        if (a.audio.isPlaying) a.audio.stop();\r\n      });\r\n  }\r\n\r\n  public stopAll(): void {\r\n    [...this.sfxPool, ...this.positionalPool].forEach((audio) => {\r\n      if (audio.isPlaying) audio.stop();\r\n    });\r\n  }\r\n\r\n  public mute(): void {\r\n    this.listener.setMasterVolume(0);\r\n  }\r\n\r\n  public unmute(): void {\r\n    this.listener.setMasterVolume(this.volumes.master);\r\n  }\r\n\r\n  public dispose(): void {\r\n    this.stopAll();\r\n    this.bufferCache.clear();\r\n    this.sfxPool = [];\r\n    this.positionalPool = [];\r\n  }\r\n}\r\n","import * as THREE from 'three';\r\nimport { AssetManager } from './core/AssetManager';\r\nimport { WeaponSystem } from './systems/WeaponSystem';\r\nimport { ParticleSystem } from './systems/ParticleSystem';\r\nimport { DecalSystem, SurfaceMaterial } from './systems/DecalSystem';\r\nimport { BulletTracerSystem } from './systems/BulletTracerSystem';\r\nimport { ImpactSystem } from './systems/ImpactSystem';\r\nimport { ScreenEffects } from './systems/ScreenEffects';\r\nimport { HUDManager } from './ui/HUDManager';\r\nimport { KillfeedManager } from './ui/KillfeedManager';\r\n\r\nimport { AudioManager } from './managers/AudioManager';\r\nimport { MESSAGE_HIT } from './core/Constants';\r\n\r\n/**\r\n * RIFT Integration Manager\r\n * \r\n * This class serves as the bridge between the existing Drift engine and the new RIFT FPS systems.\r\n * It initializes and manages all the subsystems required for the FPS experience.\r\n */\r\nexport class RIFTIntegration {\r\n  // Systems\r\n  public weaponSystem: WeaponSystem;\r\n  public particleSystem: ParticleSystem;\r\n  public decalSystem: DecalSystem;\r\n  public tracerSystem: BulletTracerSystem;\r\n  public impactSystem: ImpactSystem;\r\n  public screenEffects: ScreenEffects;\r\n  public audioManager: AudioManager;\r\n  \r\n  // UI\r\n  public hudManager: HUDManager;\r\n  public killfeedManager: KillfeedManager;\r\n\r\n  // Core references\r\n  private camera: THREE.PerspectiveCamera;\r\n  private raycaster: THREE.Raycaster;\r\n\r\n  // State\r\n  private isInitialized: boolean = false;\r\n\r\n  constructor(\r\n    scene: THREE.Scene, \r\n    camera: THREE.PerspectiveCamera, \r\n    audioListener: THREE.AudioListener,\r\n    assetManager: AssetManager\r\n  ) {\r\n    this.camera = camera;\r\n    this.raycaster = new THREE.Raycaster();\r\n    this.raycaster.camera = camera;\r\n\r\n    // Initialize Audio Manager\r\n    this.audioManager = new AudioManager(camera);\r\n\r\n    // Initialize Systems\r\n    this.particleSystem = new ParticleSystem(scene);\r\n    this.decalSystem = new DecalSystem(scene);\r\n    this.tracerSystem = new BulletTracerSystem(scene, camera);\r\n    this.impactSystem = new ImpactSystem(scene, audioListener);\r\n    this.screenEffects = new ScreenEffects(camera);\r\n    \r\n    // WeaponSystem depends on ParticleSystem\r\n    this.weaponSystem = new WeaponSystem(scene, camera, assetManager, this.audioManager);\r\n\r\n    // Initialize UI\r\n    this.hudManager = new HUDManager();\r\n    this.killfeedManager = new KillfeedManager();\r\n\r\n    this.isInitialized = true;\r\n    console.log('RIFT Integration Initialized');\r\n  }\r\n\r\n  /**\r\n   * Handle shooting logic including raycasting, effects, and damage\r\n   */\r\n  public handleShooting(\r\n    playerOnGround: boolean, \r\n    playerIsSprinting: boolean, \r\n    playerVelocity: THREE.Vector3,\r\n    obstacles: THREE.Object3D[]\r\n  ): void {\r\n    const result = this.weaponSystem.shoot(\r\n      this.camera,\r\n      playerOnGround,\r\n      playerIsSprinting,\r\n      playerVelocity\r\n    );\r\n\r\n    if (result.shotFired) {\r\n      const config = this.weaponSystem.currentConfig;\r\n      \r\n      // Apply screen effects\r\n      // 1. Screen shake based on weapon power\r\n      const weaponPower = config.damage / 30; // Normalize damage to power scale\r\n      this.screenEffects.addFireShake(weaponPower);\r\n      \r\n      // 2. FOV punch for impact feel\r\n      this.screenEffects.addFOVPunch(1.5 * weaponPower, 0.08);\r\n      \r\n      // 3. Camera recoil (actual camera rotation)\r\n      const recoilPitch = config.recoil.pitchAmount * 0.5; // Scale down for camera\r\n      const recoilYaw = (Math.random() - 0.5) * config.recoil.yawAmount * 0.5;\r\n      this.screenEffects.applyRecoil(recoilPitch, recoilYaw);\r\n      this.screenEffects.setRecoilRecoveryRate(config.recoil.recoveryRate);\r\n      \r\n      // 4. Spawn muzzle smoke\r\n      const muzzlePos = this.weaponSystem.getMuzzleWorldPosition();\r\n      const muzzleDir = this.camera.getWorldDirection(new THREE.Vector3());\r\n      this.particleSystem.spawnMuzzleSmoke(muzzlePos, muzzleDir);\r\n\r\n      // Process each shot (shotguns have multiple)\r\n      const directions = result.directions || [result.direction];\r\n      \r\n      directions.forEach((dir: THREE.Vector3) => {\r\n        this.processShot(dir, obstacles);\r\n      });\r\n\r\n      // Update HUD\r\n      this.updateHUD();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Process a shot from an enemy (AI) entity\r\n   * @param camera The enemy's virtual camera\r\n   * @param direction The shot direction\r\n   * @param muzzlePosition The world position of the weapon muzzle\r\n   * @param obstacles Objects to raycast against\r\n   * @param shooter The enemy entity that fired the shot\r\n   * @param damage The damage amount\r\n   */\r\n  public processEnemyShot(\r\n    camera: THREE.Camera,\r\n    direction: THREE.Vector3,\r\n    muzzlePosition: THREE.Vector3,\r\n    obstacles: THREE.Object3D[],\r\n    shooter: any,\r\n    damage: number\r\n  ): void {\r\n    // Raycast from enemy camera\r\n    const rayOrigin = new THREE.Vector3();\r\n    camera.getWorldPosition(rayOrigin);\r\n    this.raycaster.set(rayOrigin, direction);\r\n    \r\n    const intersects = this.raycaster.intersectObjects(obstacles, true);\r\n\r\n    let endPoint: THREE.Vector3;\r\n    let hitObject: THREE.Object3D | null = null;\r\n\r\n    if (intersects.length > 0) {\r\n      const hit = intersects[0];\r\n      endPoint = hit.point;\r\n      hitObject = hit.object;\r\n\r\n      // Determine material\r\n      let material = SurfaceMaterial.ROCK;\r\n      \r\n      if (hitObject.name.includes('wood') || hitObject.userData.material === 'wood') {\r\n        material = SurfaceMaterial.WOOD;\r\n      } else if (hitObject.name.includes('metal') || hitObject.userData.material === 'metal') {\r\n        material = SurfaceMaterial.METAL;\r\n      }\r\n\r\n      // Spawn effects\r\n      this.decalSystem.createDecal(hit.point, hit.face?.normal || new THREE.Vector3(0, 1, 0), material);\r\n      this.particleSystem.spawnMaterialImpact(hit.point, hit.face?.normal || new THREE.Vector3(0, 1, 0), material);\r\n      this.impactSystem.playSurfaceImpact(hit.point, material);\r\n\r\n      // Apply damage if it's an entity\r\n      let entity = hitObject.userData.entity;\r\n      if (!entity) {\r\n        hitObject.traverseAncestors((ancestor: any) => {\r\n          if (!entity && ancestor.userData.entity) {\r\n            entity = ancestor.userData.entity;\r\n          }\r\n        });\r\n      }\r\n\r\n      if (entity && entity !== shooter) {\r\n        console.log('Enemy hit entity:', entity.name, 'Health:', entity.health, 'Damage:', damage);\r\n        \r\n        // Apply damage via message system\r\n        if (entity.handleMessage) {\r\n          const telegram = {\r\n            message: MESSAGE_HIT,\r\n            data: { damage: damage, direction: direction },\r\n            sender: shooter\r\n          };\r\n          entity.handleMessage(telegram);\r\n        }\r\n\r\n        this.impactSystem.playBodyImpact(hit.point);\r\n        this.particleSystem.spawnImpactEffect(hit.point, false);\r\n      }\r\n\r\n    } else {\r\n      // Miss - extend to max range\r\n      endPoint = camera.position.clone().add(direction.multiplyScalar(100));\r\n    }\r\n\r\n    // Create tracer\r\n    this.tracerSystem.createTracer(muzzlePosition, endPoint);\r\n  }\r\n\r\n  private processShot(direction: THREE.Vector3, obstacles: THREE.Object3D[]): void {\r\n    const muzzlePos = this.weaponSystem.getMuzzleWorldPosition();\r\n    \r\n    // Raycast from camera\r\n    const rayOrigin = new THREE.Vector3();\r\n    this.camera.getWorldPosition(rayOrigin);\r\n    this.raycaster.set(rayOrigin, direction);\r\n    \r\n    // Raycast against provided obstacles (already filtered by Player.shoot)\r\n    console.log('=== RAYCAST START ===');\r\n    console.log('Origin:', rayOrigin);\r\n    console.log('Direction:', direction);\r\n    console.log('Obstacles:', obstacles.length);\r\n    obstacles.forEach((obs, i) => {\r\n        console.log(`  [${i}] ${obs.name || obs.type} - Children: ${obs.children.length}`);\r\n    });\r\n\r\n    const intersects = this.raycaster.intersectObjects(obstacles, true);\r\n\r\n    console.log('Intersects found:', intersects.length);\r\n    if (intersects.length === 0) {\r\n        console.log(' MISS - No hits detected');\r\n    } else {\r\n        console.log(' HIT:', intersects[0].object.name, 'at distance', intersects[0].distance.toFixed(2));\r\n        console.log('  Object type:', intersects[0].object.type);\r\n        console.log('  Has userData.entity:', !!intersects[0].object.userData.entity);\r\n    }\r\n\r\n    let endPoint: THREE.Vector3;\r\n    let hitObject: THREE.Object3D | null = null;\r\n\r\n    if (intersects.length > 0) {\r\n      const hit = intersects[0];\r\n      endPoint = hit.point;\r\n      hitObject = hit.object;\r\n      \r\n      console.log('Raycast hit:', hitObject.name, hitObject.userData);\r\n\r\n      // Determine material\r\n      // In a real implementation, we'd check the object's userData or material type\r\n      // For now, we'll default to CONCRETE/STONE unless specified\r\n      let material = SurfaceMaterial.ROCK;\r\n      \r\n      // Check for specific materials based on object names or userData\r\n      if (hitObject.name.includes('wood') || hitObject.userData.material === 'wood') {\r\n        material = SurfaceMaterial.WOOD;\r\n      } else if (hitObject.name.includes('metal') || hitObject.userData.material === 'metal') {\r\n        material = SurfaceMaterial.METAL;\r\n      }\r\n\r\n      // Spawn effects\r\n      this.decalSystem.createDecal(hit.point, hit.face?.normal || new THREE.Vector3(0, 1, 0), material);\r\n      \r\n      // Use spawnMaterialImpact for surface hits\r\n      this.particleSystem.spawnMaterialImpact(hit.point, hit.face?.normal || new THREE.Vector3(0, 1, 0), material);\r\n      \r\n      this.impactSystem.playSurfaceImpact(hit.point, material);\r\n\r\n      // Apply damage if it's an entity\r\n      // Check the hit object and all its ancestors for userData.entity\r\n      let entity = hitObject.userData.entity;\r\n      if (!entity) {\r\n        hitObject.traverseAncestors((ancestor: any) => {\r\n          if (!entity && ancestor.userData.entity) {\r\n            entity = ancestor.userData.entity;\r\n          }\r\n        });\r\n      }\r\n\r\n      if (entity) {\r\n        console.log('HIT ENTITY:', entity.name, 'Health:', entity.health);\r\n        \r\n        // Headshot detection - check if hit point is in the upper part of the entity\r\n        // Assuming entity has a position and height of ~1.8 (human height)\r\n        const entityY = entity.position?.y ?? 0;\r\n        const entityHeight = entity.height ?? 1.8;\r\n        const headZone = entityY + entityHeight * 0.85; // Upper 15% is head zone\r\n        const isHeadshot = hit.point.y >= headZone;\r\n        \r\n        // Calculate damage with headshot multiplier\r\n        const baseDamage = this.weaponSystem.currentConfig.damage;\r\n        const damage = isHeadshot ? baseDamage * 2.5 : baseDamage; // 2.5x headshot multiplier\r\n        \r\n        console.log(`Hit at Y=${hit.point.y.toFixed(2)}, HeadZone=${headZone.toFixed(2)}, Headshot=${isHeadshot}`);\r\n        \r\n        // Apply damage via message system\r\n        if (entity.handleMessage) {\r\n            const telegram = {\r\n                message: MESSAGE_HIT,\r\n                data: { damage: damage, direction: direction, isHeadshot: isHeadshot },\r\n                sender: { isPlayer: true, uuid: 'player' }\r\n            };\r\n            entity.handleMessage(telegram);\r\n        }\r\n\r\n        // Play audio feedback\r\n        this.impactSystem.playBodyImpact(hit.point);\r\n        this.impactSystem.playHitConfirmation(); // Instant hit sound feedback\r\n        \r\n        // Check if kill (assuming entity has health)\r\n        const isKill = entity.health <= 0;\r\n        this.hudManager.showHitmarker(isKill);\r\n        this.hudManager.showHitFeedback(isKill, isHeadshot);\r\n        \r\n        // Show headshot/kill icons\r\n        if (isKill) {\r\n          this.impactSystem.playDeathImpact(hit.point);\r\n          if (isHeadshot) {\r\n            this.hudManager.showHeadshotIcon();\r\n          } else {\r\n            this.hudManager.showKillIcon();\r\n          }\r\n        }\r\n        \r\n        // Also spawn blood/impact effect for body hit\r\n        this.particleSystem.spawnImpactEffect(hit.point, isHeadshot);\r\n      }\r\n\r\n    } else {\r\n      // Miss - extend to max range\r\n      endPoint = this.camera.position.clone().add(direction.multiplyScalar(100));\r\n    }\r\n\r\n    // Create tracer\r\n    this.tracerSystem.createTracer(muzzlePos, endPoint);\r\n  }\r\n\r\n  public update(delta: number, mouseMovement: { x: number, y: number }, isSprinting: boolean): void {\r\n    if (!this.isInitialized) return;\r\n\r\n    // Update all systems\r\n    this.weaponSystem.update(delta, mouseMovement, isSprinting);\r\n    this.particleSystem.update(delta);\r\n    this.decalSystem.update(delta);\r\n    this.tracerSystem.update(delta);\r\n    this.screenEffects.update(delta);\r\n\r\n    // Update HUD with weapon state\r\n    this.updateHUD();\r\n  }\r\n\r\n  private updateHUD(): void {\r\n    this.hudManager.updateAmmo(\r\n      this.weaponSystem.currentMag,\r\n      this.weaponSystem.reserveAmmo\r\n    );\r\n    \r\n    // Update crosshair spread based on weapon state\r\n    const spread = this.weaponSystem.getCurrentSpread();\r\n    this.hudManager.updateCrosshair(spread * 100); // Scale for visual effect\r\n  }\r\n\r\n  public resize(_width: number, _height: number): void {\r\n    // Handle resize events if necessary\r\n  }\r\n\r\n  public dispose(): void {\r\n    this.decalSystem.clear();\r\n    this.tracerSystem.clear();\r\n    this.particleSystem.clear();\r\n    this.screenEffects.reset();\r\n    // Dispose other resources\r\n  }\r\n\r\n  /**\r\n   * Apply damage effects when player takes damage\r\n   * @param damageAmount Amount of damage taken\r\n   * @param maxHealth Player's max health\r\n   * @param directionAngle Optional angle to attacker in degrees\r\n   */\r\n  public applyDamageEffects(damageAmount: number, maxHealth: number, directionAngle?: number): void {\r\n    // Screen shake based on damage\r\n    const damagePercent = damageAmount / maxHealth;\r\n    this.screenEffects.addDamageShake(damagePercent);\r\n    \r\n    // HUD vignette effect\r\n    this.hudManager.showDamageVignette(damageAmount, maxHealth, directionAngle);\r\n    \r\n    // Directional damage indicator\r\n    if (directionAngle !== undefined) {\r\n      this.hudManager.flashDamage(directionAngle);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get current camera recoil for applying to player head rotation\r\n   */\r\n  public getCameraRecoil(): { pitch: number; yaw: number } {\r\n    return this.screenEffects.getRecoil();\r\n  }\r\n\r\n  /**\r\n   * Get screen shake offset to apply to camera position\r\n   */\r\n  public getShakeOffset(): THREE.Vector3 {\r\n    return this.screenEffects.getShakeOffset();\r\n  }\r\n}\r\n","// RIFT Integration - Game Mode Interface\r\n\r\n/**\r\n * Interface that all game modes must implement\r\n */\r\nexport interface IGameMode {\r\n  /** Initialize the game mode (setup) */\r\n  init(): void;\r\n  \r\n  /** Start the game mode (begin gameplay) */\r\n  start(): void;\r\n  \r\n  /** Update the game mode each frame */\r\n  update(delta: number): void;\r\n  \r\n  /** Clean up the game mode when switching/ending */\r\n  cleanup(): void;\r\n  \r\n  /** Get the display name of the mode */\r\n  getName(): string;\r\n  \r\n  /** Get the mode type identifier */\r\n  getType(): GameModeType;\r\n  \r\n  /** Check if the game is over */\r\n  isGameOver(): boolean;\r\n  \r\n  /** Handle player death */\r\n  onPlayerDeath(playerId: string): void;\r\n  \r\n  /** Handle player kill */\r\n  onPlayerKill(killerId: string, victimId: string, weapon: string, headshot: boolean): void;\r\n}\r\n\r\n/**\r\n * Available game mode types\r\n */\r\nexport enum GameModeType {\r\n  FREE_FOR_ALL = 'FREE_FOR_ALL',\r\n  TEAM_DEATHMATCH = 'TEAM_DEATHMATCH',\r\n  CAPTURE_THE_FLAG = 'CAPTURE_THE_FLAG',\r\n  WAVE_SURVIVAL = 'WAVE_SURVIVAL',\r\n  PRACTICE = 'PRACTICE',\r\n}\r\n\r\n/**\r\n * Team identifiers\r\n */\r\nexport enum Team {\r\n  NONE = 'NONE',\r\n  RED = 'RED',\r\n  BLUE = 'BLUE',\r\n}\r\n\r\n/**\r\n * Game mode configuration\r\n */\r\nexport interface GameModeConfig {\r\n  name: string;\r\n  type: GameModeType;\r\n  description: string;\r\n  minPlayers: number;\r\n  maxPlayers: number;\r\n  timeLimit?: number; // seconds, 0 = unlimited\r\n  scoreLimit?: number; // 0 = unlimited\r\n  respawnTime?: number; // seconds\r\n  teamBased: boolean;\r\n  friendlyFire: boolean;\r\n}\r\n\r\n/**\r\n * Player score data\r\n */\r\nexport interface PlayerScore {\r\n  id: string;\r\n  name: string;\r\n  team: Team;\r\n  kills: number;\r\n  deaths: number;\r\n  assists: number;\r\n  score: number;\r\n  headshots: number;\r\n  damageDealt: number;\r\n}\r\n\r\n/**\r\n * Game state for modes\r\n */\r\nexport interface GameModeState {\r\n  isRunning: boolean;\r\n  isPaused: boolean;\r\n  timeRemaining: number;\r\n  redScore: number;\r\n  blueScore: number;\r\n  wave: number;\r\n  roundNumber: number;\r\n  scores: Map<string, PlayerScore>;\r\n}\r\n","// RIFT Integration - Base Game Mode\r\n\r\nimport { \r\n  IGameMode, \r\n  GameModeType, \r\n  GameModeConfig, \r\n  GameModeState, \r\n  PlayerScore, \r\n  Team \r\n} from './IGameMode';\r\nimport { HUDManager } from '../ui/HUDManager';\r\n\r\n// Forward declare World type to avoid circular dependency\r\ninterface World {\r\n  player: {\r\n    uuid: string;\r\n    health: number;\r\n    maxHealth: number;\r\n    respawn: () => void;\r\n  };\r\n  competitors: Array<{\r\n    uuid: string;\r\n    name: string;\r\n    health: number;\r\n  }>;\r\n  spawningManager: {\r\n    respawnCompetitor: (entity: unknown) => void;\r\n  };\r\n}\r\n\r\n/**\r\n * Base class for all game modes\r\n * Provides common functionality and structure\r\n */\r\nexport abstract class BaseGameMode implements IGameMode {\r\n  protected world: World;\r\n  protected hudManager: HUDManager;\r\n  protected config: GameModeConfig;\r\n  protected state: GameModeState;\r\n  protected isActive: boolean = false;\r\n\r\n  constructor(world: World, hudManager: HUDManager, config: GameModeConfig) {\r\n    this.world = world;\r\n    this.hudManager = hudManager;\r\n    this.config = config;\r\n    \r\n    this.state = {\r\n      isRunning: false,\r\n      isPaused: false,\r\n      timeRemaining: config.timeLimit || 0,\r\n      redScore: 0,\r\n      blueScore: 0,\r\n      wave: 1,\r\n      roundNumber: 1,\r\n      scores: new Map(),\r\n    };\r\n  }\r\n\r\n  public init(): void {\r\n    console.log(`Initializing ${this.getName()} mode...`);\r\n    this.resetState();\r\n    this.setupHUD();\r\n  }\r\n\r\n  public start(): void {\r\n    console.log(`Starting ${this.getName()} mode...`);\r\n    this.isActive = true;\r\n    this.state.isRunning = true;\r\n    this.hudManager.showMessage(`${this.getName()} Started!`, 3000);\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    if (!this.isActive || !this.state.isRunning || this.state.isPaused) {\r\n      return;\r\n    }\r\n\r\n    // Update time if time-limited\r\n    if (this.config.timeLimit && this.config.timeLimit > 0) {\r\n      this.state.timeRemaining -= delta;\r\n      this.updateTimer();\r\n\r\n      if (this.state.timeRemaining <= 0) {\r\n        this.onTimeUp();\r\n      }\r\n    }\r\n\r\n    // Check score limit\r\n    if (this.config.scoreLimit && this.config.scoreLimit > 0) {\r\n      if (this.checkScoreLimit()) {\r\n        this.onScoreLimitReached();\r\n      }\r\n    }\r\n  }\r\n\r\n  public cleanup(): void {\r\n    console.log(`Cleaning up ${this.getName()} mode...`);\r\n    this.isActive = false;\r\n    this.state.isRunning = false;\r\n    this.hideHUD();\r\n  }\r\n\r\n  public abstract getName(): string;\r\n  public abstract getType(): GameModeType;\r\n\r\n  public isGameOver(): boolean {\r\n    return !this.state.isRunning;\r\n  }\r\n\r\n  public onPlayerDeath(playerId: string): void {\r\n    const score = this.state.scores.get(playerId);\r\n    if (score) {\r\n      score.deaths++;\r\n      this.state.scores.set(playerId, score);\r\n    }\r\n\r\n    // Schedule respawn if applicable\r\n    if (this.config.respawnTime !== undefined) {\r\n      setTimeout(() => {\r\n        this.respawnPlayer(playerId);\r\n      }, this.config.respawnTime * 1000);\r\n    }\r\n  }\r\n\r\n  public onPlayerKill(\r\n    killerId: string,\r\n    victimId: string,\r\n    weapon: string,\r\n    headshot: boolean\r\n  ): void {\r\n    // Update killer score\r\n    const killerScore = this.state.scores.get(killerId);\r\n    if (killerScore) {\r\n      killerScore.kills++;\r\n      killerScore.score += headshot ? 150 : 100;\r\n      if (headshot) {\r\n        killerScore.headshots++;\r\n      }\r\n      this.state.scores.set(killerId, killerScore);\r\n    }\r\n\r\n    // Add to killfeed\r\n    const killerName = this.getPlayerName(killerId);\r\n    const victimName = this.getPlayerName(victimId);\r\n    this.hudManager.addKillFeed(killerName, victimName, weapon, headshot);\r\n\r\n    // Show hitmarker/kill feedback if local player got the kill\r\n    if (killerId === this.world.player.uuid) {\r\n      this.hudManager.showHitmarker(true);\r\n      this.hudManager.showKillIcon();\r\n    }\r\n  }\r\n\r\n  // ========== Protected Methods ==========\r\n\r\n  protected resetState(): void {\r\n    this.state = {\r\n      isRunning: false,\r\n      isPaused: false,\r\n      timeRemaining: this.config.timeLimit || 0,\r\n      redScore: 0,\r\n      blueScore: 0,\r\n      wave: 1,\r\n      roundNumber: 1,\r\n      scores: new Map(),\r\n    };\r\n\r\n    // Initialize player scores\r\n    this.initializePlayerScores();\r\n  }\r\n\r\n  protected initializePlayerScores(): void {\r\n    // Add local player\r\n    this.state.scores.set(this.world.player.uuid, this.createEmptyScore(\r\n      this.world.player.uuid,\r\n      'Player',\r\n      Team.NONE\r\n    ));\r\n\r\n    // Add competitors (bots/enemies)\r\n    for (const competitor of this.world.competitors) {\r\n      if (competitor.uuid !== this.world.player.uuid) {\r\n        this.state.scores.set(competitor.uuid, this.createEmptyScore(\r\n          competitor.uuid,\r\n          competitor.name || `Bot_${competitor.uuid.slice(0, 4)}`,\r\n          Team.NONE\r\n        ));\r\n      }\r\n    }\r\n  }\r\n\r\n  protected createEmptyScore(id: string, name: string, team: Team): PlayerScore {\r\n    return {\r\n      id,\r\n      name,\r\n      team,\r\n      kills: 0,\r\n      deaths: 0,\r\n      assists: 0,\r\n      score: 0,\r\n      headshots: 0,\r\n      damageDealt: 0,\r\n    };\r\n  }\r\n\r\n  protected getPlayerName(playerId: string): string {\r\n    const score = this.state.scores.get(playerId);\r\n    if (score) {\r\n      return score.name;\r\n    }\r\n    return playerId === this.world.player.uuid ? 'You' : `Player_${playerId.slice(0, 4)}`;\r\n  }\r\n\r\n  protected setupHUD(): void {\r\n    // Override in subclasses for mode-specific HUD\r\n  }\r\n\r\n  protected hideHUD(): void {\r\n    // Override in subclasses for mode-specific HUD cleanup\r\n  }\r\n\r\n  protected updateTimer(): void {\r\n    // Format time as MM:SS\r\n    const minutes = Math.floor(Math.max(0, this.state.timeRemaining) / 60);\r\n    const seconds = Math.floor(Math.max(0, this.state.timeRemaining) % 60);\r\n    const timerElement = document.getElementById('game-timer');\r\n    if (timerElement) {\r\n      timerElement.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;\r\n    }\r\n  }\r\n\r\n  protected checkScoreLimit(): boolean {\r\n    // Override in subclasses\r\n    return false;\r\n  }\r\n\r\n  protected onTimeUp(): void {\r\n    this.endGame('TIME UP');\r\n  }\r\n\r\n  protected onScoreLimitReached(): void {\r\n    this.endGame('SCORE LIMIT REACHED');\r\n  }\r\n\r\n  protected endGame(reason: string): void {\r\n    this.state.isRunning = false;\r\n    const winner = this.determineWinner();\r\n    this.hudManager.showMessage(`${reason}\\n${winner}`, 5000);\r\n  }\r\n\r\n  protected determineWinner(): string {\r\n    // Override in subclasses for mode-specific win conditions\r\n    let highestScore = -1;\r\n    let winnerName = 'No Winner';\r\n\r\n    this.state.scores.forEach((score, _id) => {\r\n      if (score.score > highestScore) {\r\n        highestScore = score.score;\r\n        winnerName = score.name;\r\n      }\r\n    });\r\n\r\n    return `Winner: ${winnerName} (${highestScore} points)`;\r\n  }\r\n\r\n  protected respawnPlayer(playerId: string): void {\r\n    if (playerId === this.world.player.uuid) {\r\n      // Respawn local player\r\n      if (this.world.player.respawn) {\r\n        this.world.player.respawn();\r\n      }\r\n    } else {\r\n      // Find and respawn competitor\r\n      const competitor = this.world.competitors.find(c => c.uuid === playerId);\r\n      if (competitor) {\r\n        this.world.spawningManager.respawnCompetitor(competitor);\r\n      }\r\n    }\r\n  }\r\n\r\n  // ========== Public Getters ==========\r\n\r\n  public getState(): GameModeState {\r\n    return { ...this.state };\r\n  }\r\n\r\n  public getConfig(): GameModeConfig {\r\n    return { ...this.config };\r\n  }\r\n\r\n  public getScores(): PlayerScore[] {\r\n    return Array.from(this.state.scores.values()).sort((a, b) => b.score - a.score);\r\n  }\r\n\r\n  public pause(): void {\r\n    this.state.isPaused = true;\r\n  }\r\n\r\n  public resume(): void {\r\n    this.state.isPaused = false;\r\n  }\r\n}\r\n","// RIFT Integration - Free For All (Deathmatch) Mode\r\n\r\nimport { BaseGameMode } from './BaseGameMode';\r\nimport { GameModeType, GameModeConfig, Team } from './IGameMode';\r\nimport { HUDManager } from '../ui/HUDManager';\r\n\r\n// Forward declare World type\r\ninterface World {\r\n  player: {\r\n    uuid: string;\r\n    health: number;\r\n    maxHealth: number;\r\n    respawn: () => void;\r\n  };\r\n  competitors: Array<{\r\n    uuid: string;\r\n    name: string;\r\n    health: number;\r\n  }>;\r\n  spawningManager: {\r\n    respawnCompetitor: (entity: unknown) => void;\r\n  };\r\n}\r\n\r\nconst FFA_CONFIG: GameModeConfig = {\r\n  name: 'Free For All',\r\n  type: GameModeType.FREE_FOR_ALL,\r\n  description: 'Every player for themselves. First to reach the score limit wins!',\r\n  minPlayers: 2,\r\n  maxPlayers: 16,\r\n  timeLimit: 600, // 10 minutes\r\n  scoreLimit: 30,\r\n  respawnTime: 3,\r\n  teamBased: false,\r\n  friendlyFire: true,\r\n};\r\n\r\n/**\r\n * Free For All (Deathmatch) game mode\r\n * Every player fights against everyone else\r\n */\r\nexport class FreeForAllMode extends BaseGameMode {\r\n  private leaderId: string | null = null;\r\n\r\n  constructor(world: World, hudManager: HUDManager, customConfig?: Partial<GameModeConfig>) {\r\n    super(world, hudManager, { ...FFA_CONFIG, ...customConfig });\r\n  }\r\n\r\n  public getName(): string {\r\n    return 'Free For All';\r\n  }\r\n\r\n  public getType(): GameModeType {\r\n    return GameModeType.FREE_FOR_ALL;\r\n  }\r\n\r\n  public init(): void {\r\n    super.init();\r\n    this.leaderId = null;\r\n  }\r\n\r\n  public start(): void {\r\n    super.start();\r\n    \r\n    // Initialize all players with NONE team (FFA)\r\n    this.state.scores.forEach((score, id) => {\r\n      score.team = Team.NONE;\r\n      this.state.scores.set(id, score);\r\n    });\r\n\r\n    // Show timer\r\n    const timer = document.getElementById('game-timer');\r\n    if (timer) {\r\n      timer.style.display = 'block';\r\n    }\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    super.update(delta);\r\n\r\n    if (!this.state.isRunning) return;\r\n\r\n    // Update leader tracking\r\n    this.updateLeader();\r\n  }\r\n\r\n  public onPlayerKill(\r\n    killerId: string,\r\n    victimId: string,\r\n    weapon: string,\r\n    headshot: boolean\r\n  ): void {\r\n    super.onPlayerKill(killerId, victimId, weapon, headshot);\r\n\r\n    // Check if killer is now in the lead\r\n    const killerScore = this.state.scores.get(killerId);\r\n    if (killerScore && this.leaderId !== killerId) {\r\n      const leaderScore = this.leaderId ? this.state.scores.get(this.leaderId) : null;\r\n      \r\n      if (!leaderScore || killerScore.kills > leaderScore.kills) {\r\n        const previousLeader = this.leaderId;\r\n        this.leaderId = killerId;\r\n        \r\n        // Announce lead change\r\n        if (previousLeader && killerId === this.world.player.uuid) {\r\n          this.hudManager.showMessage('YOU TOOK THE LEAD!', 2000);\r\n        }\r\n      }\r\n    }\r\n\r\n    // Check for kill streaks\r\n    if (killerId === this.world.player.uuid && killerScore) {\r\n      this.checkKillStreak(killerScore.kills);\r\n    }\r\n  }\r\n\r\n  protected checkScoreLimit(): boolean {\r\n    if (!this.config.scoreLimit) return false;\r\n\r\n    for (const [_id, score] of this.state.scores) {\r\n      if (score.kills >= this.config.scoreLimit) {\r\n        return true;\r\n      }\r\n    }\r\n    return false;\r\n  }\r\n\r\n  protected determineWinner(): string {\r\n    let highestKills = -1;\r\n    let winnerName = 'No Winner';\r\n    let winnerId = '';\r\n\r\n    this.state.scores.forEach((score, id) => {\r\n      if (score.kills > highestKills) {\r\n        highestKills = score.kills;\r\n        winnerName = score.name;\r\n        winnerId = id;\r\n      }\r\n    });\r\n\r\n    if (winnerId === this.world.player.uuid) {\r\n      return 'YOU WIN!';\r\n    }\r\n\r\n    return `Winner: ${winnerName} (${highestKills} kills)`;\r\n  }\r\n\r\n  private updateLeader(): void {\r\n    let highestKills = -1;\r\n    let newLeader: string | null = null;\r\n\r\n    this.state.scores.forEach((score, id) => {\r\n      if (score.kills > highestKills) {\r\n        highestKills = score.kills;\r\n        newLeader = id;\r\n      }\r\n    });\r\n\r\n    this.leaderId = newLeader;\r\n  }\r\n\r\n  private checkKillStreak(kills: number): void {\r\n    // Announce kill streaks\r\n    const streakMessages: { [key: number]: string } = {\r\n      3: 'KILLING SPREE',\r\n      5: 'RAMPAGE',\r\n      7: 'DOMINATING',\r\n      10: 'UNSTOPPABLE',\r\n      15: 'GODLIKE',\r\n      20: 'LEGENDARY',\r\n    };\r\n\r\n    if (streakMessages[kills]) {\r\n      this.hudManager.showMessage(streakMessages[kills], 2000);\r\n    }\r\n  }\r\n\r\n  public cleanup(): void {\r\n    super.cleanup();\r\n    \r\n    // Hide timer\r\n    const timer = document.getElementById('game-timer');\r\n    if (timer) {\r\n      timer.style.display = 'none';\r\n    }\r\n  }\r\n}\r\n","// RIFT Integration - Team Deathmatch Mode\r\n\r\nimport { BaseGameMode } from './BaseGameMode';\r\nimport { GameModeType, GameModeConfig, Team } from './IGameMode';\r\nimport { HUDManager } from '../ui/HUDManager';\r\n\r\n// Forward declare World type\r\ninterface World {\r\n  player: {\r\n    uuid: string;\r\n    health: number;\r\n    maxHealth: number;\r\n    respawn: () => void;\r\n  };\r\n  competitors: Array<{\r\n    uuid: string;\r\n    name: string;\r\n    health: number;\r\n  }>;\r\n  spawningManager: {\r\n    respawnCompetitor: (entity: unknown) => void;\r\n  };\r\n}\r\n\r\nconst TDM_CONFIG: GameModeConfig = {\r\n  name: 'Team Deathmatch',\r\n  type: GameModeType.TEAM_DEATHMATCH,\r\n  description: 'Red vs Blue. First team to reach the score limit wins!',\r\n  minPlayers: 4,\r\n  maxPlayers: 16,\r\n  timeLimit: 900, // 15 minutes\r\n  scoreLimit: 75,\r\n  respawnTime: 5,\r\n  teamBased: true,\r\n  friendlyFire: false,\r\n};\r\n\r\n/**\r\n * Team Deathmatch game mode\r\n * Two teams compete to reach the score limit\r\n */\r\nexport class TeamDeathmatchMode extends BaseGameMode {\r\n  private playerTeam: Team = Team.BLUE;\r\n\r\n  constructor(world: World, hudManager: HUDManager, customConfig?: Partial<GameModeConfig>) {\r\n    super(world, hudManager, { ...TDM_CONFIG, ...customConfig });\r\n  }\r\n\r\n  public getName(): string {\r\n    return 'Team Deathmatch';\r\n  }\r\n\r\n  public getType(): GameModeType {\r\n    return GameModeType.TEAM_DEATHMATCH;\r\n  }\r\n\r\n  public init(): void {\r\n    super.init();\r\n    this.state.redScore = 0;\r\n    this.state.blueScore = 0;\r\n  }\r\n\r\n  public start(): void {\r\n    super.start();\r\n    \r\n    // Assign teams to players\r\n    this.assignTeams();\r\n    \r\n    // Show team scoreboard\r\n    this.showTeamScoreboard();\r\n    \r\n    // Update HUD with team colors\r\n    this.updateTeamHUD();\r\n  }\r\n\r\n  public update(delta: number): void {\r\n    super.update(delta);\r\n\r\n    if (!this.state.isRunning) return;\r\n\r\n    // Update team score display\r\n    this.updateTeamScores();\r\n  }\r\n\r\n  public onPlayerKill(\r\n    killerId: string,\r\n    victimId: string,\r\n    weapon: string,\r\n    headshot: boolean\r\n  ): void {\r\n    const killerScore = this.state.scores.get(killerId);\r\n    const victimScore = this.state.scores.get(victimId);\r\n\r\n    if (!killerScore || !victimScore) return;\r\n\r\n    // Check for team kill (friendly fire)\r\n    if (killerScore.team === victimScore.team) {\r\n      // Don't count team kills\r\n      if (!this.config.friendlyFire) return;\r\n      \r\n      // Penalize team killer\r\n      killerScore.score -= 50;\r\n      this.state.scores.set(killerId, killerScore);\r\n      \r\n      if (killerId === this.world.player.uuid) {\r\n        this.hudManager.showMessage('TEAM KILL! (-50)', 2000);\r\n      }\r\n      return;\r\n    }\r\n\r\n    // Award team point\r\n    if (killerScore.team === Team.RED) {\r\n      this.state.redScore++;\r\n    } else if (killerScore.team === Team.BLUE) {\r\n      this.state.blueScore++;\r\n    }\r\n\r\n    // Call parent for individual score tracking\r\n    super.onPlayerKill(killerId, victimId, weapon, headshot);\r\n\r\n    // Update team scores display\r\n    this.updateTeamScores();\r\n  }\r\n\r\n  protected checkScoreLimit(): boolean {\r\n    if (!this.config.scoreLimit) return false;\r\n    return this.state.redScore >= this.config.scoreLimit || \r\n           this.state.blueScore >= this.config.scoreLimit;\r\n  }\r\n\r\n  protected determineWinner(): string {\r\n    if (this.state.redScore > this.state.blueScore) {\r\n      if (this.playerTeam === Team.RED) {\r\n        return 'YOUR TEAM WINS!';\r\n      }\r\n      return 'RED TEAM WINS!';\r\n    } else if (this.state.blueScore > this.state.redScore) {\r\n      if (this.playerTeam === Team.BLUE) {\r\n        return 'YOUR TEAM WINS!';\r\n      }\r\n      return 'BLUE TEAM WINS!';\r\n    }\r\n    return 'DRAW!';\r\n  }\r\n\r\n  private assignTeams(): void {\r\n    const players = Array.from(this.state.scores.keys());\r\n    const half = Math.ceil(players.length / 2);\r\n\r\n    players.forEach((playerId, index) => {\r\n      const score = this.state.scores.get(playerId)!;\r\n      score.team = index < half ? Team.RED : Team.BLUE;\r\n      this.state.scores.set(playerId, score);\r\n\r\n      // Track local player's team\r\n      if (playerId === this.world.player.uuid) {\r\n        this.playerTeam = score.team;\r\n      }\r\n    });\r\n  }\r\n\r\n  private showTeamScoreboard(): void {\r\n    const scoreContainer = document.getElementById('score-container');\r\n    if (scoreContainer) {\r\n      scoreContainer.style.display = 'flex';\r\n    }\r\n\r\n    const timer = document.getElementById('game-timer');\r\n    if (timer) {\r\n      timer.style.display = 'block';\r\n      timer.style.top = '60px'; // Move down to make room for scores\r\n    }\r\n  }\r\n\r\n  private updateTeamScores(): void {\r\n    const redScoreEl = document.getElementById('red-score');\r\n    const blueScoreEl = document.getElementById('blue-score');\r\n\r\n    if (redScoreEl) {\r\n      redScoreEl.textContent = this.state.redScore.toString();\r\n    }\r\n    if (blueScoreEl) {\r\n      blueScoreEl.textContent = this.state.blueScore.toString();\r\n    }\r\n  }\r\n\r\n  private updateTeamHUD(): void {\r\n    // Could change HUD colors based on team\r\n    const hudContainer = document.getElementById('rift-hud');\r\n    if (hudContainer) {\r\n      hudContainer.classList.remove('team-red', 'team-blue');\r\n      hudContainer.classList.add(this.playerTeam === Team.RED ? 'team-red' : 'team-blue');\r\n    }\r\n  }\r\n\r\n  public getPlayerTeam(playerId: string): Team {\r\n    const score = this.state.scores.get(playerId);\r\n    return score?.team || Team.NONE;\r\n  }\r\n\r\n  public getTeamScores(): { red: number; blue: number } {\r\n    return {\r\n      red: this.state.redScore,\r\n      blue: this.state.blueScore,\r\n    };\r\n  }\r\n\r\n  public cleanup(): void {\r\n    super.cleanup();\r\n\r\n    // Hide team scoreboard\r\n    const scoreContainer = document.getElementById('score-container');\r\n    if (scoreContainer) {\r\n      scoreContainer.style.display = 'none';\r\n    }\r\n\r\n    const timer = document.getElementById('game-timer');\r\n    if (timer) {\r\n      timer.style.display = 'none';\r\n      timer.style.top = '20px';\r\n    }\r\n\r\n    const hudContainer = document.getElementById('rift-hud');\r\n    if (hudContainer) {\r\n      hudContainer.classList.remove('team-red', 'team-blue');\r\n    }\r\n  }\r\n}\r\n","// RIFT Integration - Wave Survival Mode (Like Drift's original bot fights)\r\n\r\nimport { BaseGameMode } from './BaseGameMode';\r\nimport { GameModeType, GameModeConfig } from './IGameMode';\r\nimport { HUDManager } from '../ui/HUDManager';\r\n\r\n// Forward declare World type\r\ninterface World {\r\n  player: {\r\n    uuid: string;\r\n    health: number;\r\n    maxHealth: number;\r\n    respawn: () => void;\r\n  };\r\n  competitors: Array<{\r\n    uuid: string;\r\n    name: string;\r\n    health: number;\r\n    active?: boolean;\r\n  }>;\r\n  spawningManager: {\r\n    respawnCompetitor: (entity: unknown) => void;\r\n  };\r\n  enemyCount: number;\r\n}\r\n\r\nconst WAVE_CONFIG: GameModeConfig = {\r\n  name: 'Wave Survival',\r\n  type: GameModeType.WAVE_SURVIVAL,\r\n  description: 'Survive endless waves of enemies. How long can you last?',\r\n  minPlayers: 1,\r\n  maxPlayers: 4, // Co-op\r\n  timeLimit: 0, // No time limit\r\n  scoreLimit: 0, // No score limit\r\n  respawnTime: 0, // No respawn in survival (1 life per wave)\r\n  teamBased: false,\r\n  friendlyFire: false,\r\n};\r\n\r\n/**\r\n * Wave Survival game mode\r\n * Players fight against waves of enemies with increasing difficulty\r\n */\r\nexport class WaveSurvivalMode extends BaseGameMode {\r\n  private waveInProgress: boolean = false;\r\n  private betweenWaves: boolean = false;\r\n  private enemiesRemaining: number = 0;\r\n  private waveStartTime: number = 0;\r\n  private timeBetweenWaves: number = 5000; // 5 seconds\r\n\r\n  constructor(world: World, hudManager: HUDManager, customConfig?: Partial<GameModeConfig>) {\r\n    super(world, hudManager, { ...WAVE_CONFIG, ...customConfig });\r\n  }\r\n\r\n  public getName(): string {\r\n    return 'Wave Survival';\r\n  }\r\n\r\n  public getType(): GameModeType {\r\n    return GameModeType.WAVE_SURVIVAL;\r\n  }\r\n\r\n  public init(): void {\r\n    super.init();\r\n    this.state.wave = 0;\r\n    this.waveInProgress = false;\r\n    this.betweenWaves = false;\r\n    this.enemiesRemaining = 0;\r\n  }\r\n\r\n  public start(): void {\r\n    super.start();\r\n    \r\n    // Reset wave state\r\n    this.state.wave = 0;\r\n    const playerScore = this.state.scores.get(this.world.player.uuid);\r\n    if (playerScore) {\r\n      playerScore.score = 0;\r\n      playerScore.kills = 0;\r\n      this.state.scores.set(this.world.player.uuid, playerScore);\r\n    }\r\n\r\n    // Show wave display\r\n    this.showWaveDisplay();\r\n    \r\n    // Start first wave\r\n    this.startNextWave();\r\n  }\r\n\r\n  public update(_delta: number): void {\r\n    // Don't call parent update (no time/score limits in wave mode)\r\n    if (!this.isActive || !this.state.isRunning || this.state.isPaused) {\r\n      return;\r\n    }\r\n\r\n    // Count remaining enemies\r\n    this.enemiesRemaining = this.countActiveEnemies();\r\n\r\n    // Update enemy counter display\r\n    this.updateEnemyCounter();\r\n\r\n    // Check for wave completion\r\n    if (this.waveInProgress && this.enemiesRemaining === 0) {\r\n      this.completeWave();\r\n    }\r\n\r\n    // Check if between waves timer is complete\r\n    if (this.betweenWaves) {\r\n      const elapsed = Date.now() - this.waveStartTime;\r\n      if (elapsed >= this.timeBetweenWaves) {\r\n        this.startNextWave();\r\n      } else {\r\n        // Update countdown\r\n        const remaining = Math.ceil((this.timeBetweenWaves - elapsed) / 1000);\r\n        this.hudManager.showMessage(`Next wave in ${remaining}...`, 1000);\r\n      }\r\n    }\r\n\r\n    // Check if player died\r\n    if (this.world.player.health <= 0 && !this.betweenWaves) {\r\n      this.onPlayerDeath(this.world.player.uuid);\r\n    }\r\n  }\r\n\r\n  public onPlayerKill(\r\n    killerId: string,\r\n    _victimId: string,\r\n    _weapon: string,\r\n    headshot: boolean\r\n  ): void {\r\n    // Only count kills by the player\r\n    if (killerId !== this.world.player.uuid) return;\r\n\r\n    const playerScore = this.state.scores.get(this.world.player.uuid);\r\n    if (playerScore) {\r\n      playerScore.kills++;\r\n      \r\n      // Score based on wave difficulty\r\n      const baseScore = 100 * this.state.wave;\r\n      const headshotBonus = headshot ? 50 : 0;\r\n      playerScore.score += baseScore + headshotBonus;\r\n      \r\n      if (headshot) {\r\n        playerScore.headshots++;\r\n      }\r\n      \r\n      this.state.scores.set(this.world.player.uuid, playerScore);\r\n    }\r\n\r\n    // Show kill feedback\r\n    this.hudManager.showHitmarker(true);\r\n    \r\n    // Update score display\r\n    this.updateScoreDisplay();\r\n  }\r\n\r\n  public onPlayerDeath(_playerId: string): void {\r\n    // Game over in survival mode\r\n    this.endGame('YOU DIED');\r\n  }\r\n\r\n  private startNextWave(): void {\r\n    this.state.wave++;\r\n    this.waveInProgress = true;\r\n    this.betweenWaves = false;\r\n\r\n    // Calculate enemies for this wave\r\n    const baseEnemies = 3;\r\n    const enemiesPerWave = 2;\r\n    const maxEnemies = Math.min(baseEnemies + (this.state.wave - 1) * enemiesPerWave, 20);\r\n    \r\n    // Spawn enemies\r\n    this.spawnWaveEnemies(maxEnemies);\r\n\r\n    // Announce wave\r\n    this.hudManager.showMessage(`WAVE ${this.state.wave}`, 2000);\r\n    this.updateWaveDisplay();\r\n  }\r\n\r\n  private completeWave(): void {\r\n    this.waveInProgress = false;\r\n    this.betweenWaves = true;\r\n    this.waveStartTime = Date.now();\r\n\r\n    // Award wave completion bonus\r\n    const playerScore = this.state.scores.get(this.world.player.uuid);\r\n    if (playerScore) {\r\n      const waveBonus = this.state.wave * 500;\r\n      playerScore.score += waveBonus;\r\n      this.state.scores.set(this.world.player.uuid, playerScore);\r\n    }\r\n\r\n    this.hudManager.showMessage(`WAVE ${this.state.wave} COMPLETE!\\n+${this.state.wave * 500} BONUS`, 3000);\r\n    this.updateScoreDisplay();\r\n\r\n    // Heal player slightly between waves\r\n    const healAmount = Math.min(25, this.world.player.maxHealth - this.world.player.health);\r\n    if (healAmount > 0) {\r\n      // This would need to be implemented in the Player class\r\n      // this.world.player.heal(healAmount);\r\n    }\r\n  }\r\n\r\n  private spawnWaveEnemies(count: number): void {\r\n    // Use existing spawning manager to respawn enemies\r\n    // In a real implementation, you might want to spawn specific enemy types\r\n    // based on wave difficulty\r\n    \r\n    let spawned = 0;\r\n    for (const competitor of this.world.competitors) {\r\n      if (competitor.uuid !== this.world.player.uuid && spawned < count) {\r\n        // Make enemy active and respawn\r\n        (competitor as { active?: boolean }).active = true;\r\n        this.world.spawningManager.respawnCompetitor(competitor);\r\n        spawned++;\r\n      }\r\n    }\r\n\r\n    this.enemiesRemaining = count;\r\n  }\r\n\r\n  private countActiveEnemies(): number {\r\n    let count = 0;\r\n    for (const competitor of this.world.competitors) {\r\n      const comp = competitor as { active?: boolean; uuid: string; health: number };\r\n      if (comp.uuid !== this.world.player.uuid && \r\n          comp.active && \r\n          comp.health > 0) {\r\n        count++;\r\n      }\r\n    }\r\n    return count;\r\n  }\r\n\r\n  private showWaveDisplay(): void {\r\n    // Create wave display if it doesn't exist\r\n    let waveDisplay = document.getElementById('wave-display');\r\n    if (!waveDisplay) {\r\n      waveDisplay = document.createElement('div');\r\n      waveDisplay.id = 'wave-display';\r\n      waveDisplay.style.cssText = `\r\n        position: absolute;\r\n        top: 20px;\r\n        left: 20px;\r\n        font-size: 24px;\r\n        font-weight: bold;\r\n        color: white;\r\n        text-shadow: 2px 2px 4px rgba(0,0,0,0.8);\r\n      `;\r\n      document.getElementById('rift-hud')?.appendChild(waveDisplay);\r\n    }\r\n    waveDisplay.style.display = 'block';\r\n  }\r\n\r\n  private updateWaveDisplay(): void {\r\n    const waveDisplay = document.getElementById('wave-display');\r\n    if (waveDisplay) {\r\n      waveDisplay.innerHTML = `\r\n        <div>WAVE ${this.state.wave}</div>\r\n        <div id=\"enemy-counter\" style=\"font-size: 16px; color: #ff6666;\">\r\n          Enemies: ${this.enemiesRemaining}\r\n        </div>\r\n      `;\r\n    }\r\n  }\r\n\r\n  private updateEnemyCounter(): void {\r\n    const counter = document.getElementById('enemy-counter');\r\n    if (counter) {\r\n      counter.textContent = `Enemies: ${this.enemiesRemaining}`;\r\n    }\r\n  }\r\n\r\n  private updateScoreDisplay(): void {\r\n    const playerScore = this.state.scores.get(this.world.player.uuid);\r\n    if (playerScore) {\r\n      // Update HUD score display\r\n      const scoreDisplay = document.getElementById('wave-score');\r\n      if (!scoreDisplay) {\r\n        const waveDisplay = document.getElementById('wave-display');\r\n        if (waveDisplay) {\r\n          const scoreEl = document.createElement('div');\r\n          scoreEl.id = 'wave-score';\r\n          scoreEl.style.cssText = 'font-size: 18px; color: #ffdd00;';\r\n          waveDisplay.appendChild(scoreEl);\r\n        }\r\n      }\r\n      const scoreEl = document.getElementById('wave-score');\r\n      if (scoreEl) {\r\n        scoreEl.textContent = `Score: ${playerScore.score}`;\r\n      }\r\n    }\r\n  }\r\n\r\n  protected determineWinner(): string {\r\n    const playerScore = this.state.scores.get(this.world.player.uuid);\r\n    return `Survived ${this.state.wave - 1} waves\\nKills: ${playerScore?.kills || 0}\\nFinal Score: ${playerScore?.score || 0}`;\r\n  }\r\n\r\n  public getWaveInfo(): { wave: number; enemiesRemaining: number; inProgress: boolean } {\r\n    return {\r\n      wave: this.state.wave,\r\n      enemiesRemaining: this.enemiesRemaining,\r\n      inProgress: this.waveInProgress,\r\n    };\r\n  }\r\n\r\n  public cleanup(): void {\r\n    super.cleanup();\r\n    \r\n    // Hide wave display\r\n    const waveDisplay = document.getElementById('wave-display');\r\n    if (waveDisplay) {\r\n      waveDisplay.style.display = 'none';\r\n    }\r\n  }\r\n}\r\n","// RIFT Integration - Game Mode Manager\r\n\r\nimport { IGameMode, GameModeType } from './IGameMode';\r\nimport { FreeForAllMode } from './FreeForAllMode';\r\nimport { TeamDeathmatchMode } from './TeamDeathmatchMode';\r\nimport { WaveSurvivalMode } from './WaveSurvivalMode';\r\nimport { HUDManager } from '../ui/HUDManager';\r\n\r\n// Forward declare World type\r\ninterface World {\r\n  player: {\r\n    uuid: string;\r\n    health: number;\r\n    maxHealth: number;\r\n    respawn: () => void;\r\n  };\r\n  competitors: Array<{\r\n    uuid: string;\r\n    name: string;\r\n    health: number;\r\n    active: boolean;\r\n  }>;\r\n  spawningManager: {\r\n    respawnCompetitor: (entity: unknown) => void;\r\n  };\r\n  enemyCount: number;\r\n}\r\n\r\n/**\r\n * Game Mode Manager\r\n * Manages switching between and updating game modes\r\n */\r\nexport class GameModeManager {\r\n  private world: World;\r\n  private hudManager: HUDManager;\r\n  private modes: Map<GameModeType, IGameMode>;\r\n  private currentMode: IGameMode | null = null;\r\n\r\n  constructor(world: World, hudManager: HUDManager) {\r\n    this.world = world;\r\n    this.hudManager = hudManager;\r\n    this.modes = new Map();\r\n\r\n    // Initialize all game modes\r\n    this.initializeModes();\r\n  }\r\n\r\n  private initializeModes(): void {\r\n    this.modes.set(\r\n      GameModeType.FREE_FOR_ALL,\r\n      new FreeForAllMode(this.world, this.hudManager)\r\n    );\r\n\r\n    this.modes.set(\r\n      GameModeType.TEAM_DEATHMATCH,\r\n      new TeamDeathmatchMode(this.world, this.hudManager)\r\n    );\r\n\r\n    this.modes.set(\r\n      GameModeType.WAVE_SURVIVAL,\r\n      new WaveSurvivalMode(this.world, this.hudManager)\r\n    );\r\n  }\r\n\r\n  /**\r\n   * Set and start a game mode\r\n   */\r\n  public setMode(type: GameModeType): void {\r\n    // Cleanup current mode if exists\r\n    if (this.currentMode) {\r\n      this.currentMode.cleanup();\r\n    }\r\n\r\n    // Get new mode\r\n    const newMode = this.modes.get(type);\r\n    if (!newMode) {\r\n      console.error(`Game mode ${type} not found!`);\r\n      return;\r\n    }\r\n\r\n    console.log(`Switching to ${newMode.getName()} mode`);\r\n    this.currentMode = newMode;\r\n    this.currentMode.init();\r\n    this.currentMode.start();\r\n  }\r\n\r\n  /**\r\n   * Update the current game mode\r\n   */\r\n  public update(delta: number): void {\r\n    if (this.currentMode) {\r\n      this.currentMode.update(delta);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the current game mode\r\n   */\r\n  public getCurrentMode(): IGameMode | null {\r\n    return this.currentMode;\r\n  }\r\n\r\n  /**\r\n   * Get current mode type\r\n   */\r\n  public getCurrentModeType(): GameModeType | null {\r\n    return this.currentMode?.getType() || null;\r\n  }\r\n\r\n  /**\r\n   * Get available game modes\r\n   */\r\n  public getAvailableModes(): GameModeType[] {\r\n    return Array.from(this.modes.keys());\r\n  }\r\n\r\n  /**\r\n   * Get mode by type\r\n   */\r\n  public getMode(type: GameModeType): IGameMode | undefined {\r\n    return this.modes.get(type);\r\n  }\r\n\r\n  /**\r\n   * Register a custom game mode\r\n   */\r\n  public registerMode(type: GameModeType, mode: IGameMode): void {\r\n    this.modes.set(type, mode);\r\n  }\r\n\r\n  /**\r\n   * Handle player kill event - forwards to current mode\r\n   */\r\n  public onPlayerKill(\r\n    killerId: string,\r\n    victimId: string,\r\n    weapon: string,\r\n    headshot: boolean\r\n  ): void {\r\n    if (this.currentMode) {\r\n      this.currentMode.onPlayerKill(killerId, victimId, weapon, headshot);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handle player death event - forwards to current mode\r\n   */\r\n  public onPlayerDeath(playerId: string): void {\r\n    if (this.currentMode) {\r\n      this.currentMode.onPlayerDeath(playerId);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Pause current game\r\n   */\r\n  public pause(): void {\r\n    if (this.currentMode) {\r\n      (this.currentMode as unknown as { pause: () => void }).pause?.();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Resume current game\r\n   */\r\n  public resume(): void {\r\n    if (this.currentMode) {\r\n      (this.currentMode as unknown as { resume: () => void }).resume?.();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Restart current game mode\r\n   */\r\n  public restart(): void {\r\n    if (this.currentMode) {\r\n      this.currentMode.cleanup();\r\n      this.currentMode.init();\r\n      this.currentMode.start();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if game is over\r\n   */\r\n  public isGameOver(): boolean {\r\n    return this.currentMode?.isGameOver() ?? true;\r\n  }\r\n\r\n  /**\r\n   * Clean up all modes\r\n   */\r\n  public dispose(): void {\r\n    if (this.currentMode) {\r\n      this.currentMode.cleanup();\r\n      this.currentMode = null;\r\n    }\r\n    this.modes.clear();\r\n  }\r\n}\r\n","// RIFT Integration - Network Types\r\n\r\nimport * as THREE from 'three';\r\n\r\n/**\r\n * Player position and state data sent over network\r\n */\r\nexport interface NetworkPlayerState {\r\n  userId: string;\r\n  position: { x: number; y: number; z: number };\r\n  rotation: { x: number; y: number };\r\n  velocity?: { x: number; y: number; z: number };\r\n  isSprinting: boolean;\r\n  isGrounded: boolean;\r\n  timestamp: number;\r\n}\r\n\r\n/**\r\n * Weapon shoot event data\r\n */\r\nexport interface NetworkShootData {\r\n  userId: string;\r\n  origin: { x: number; y: number; z: number };\r\n  direction: { x: number; y: number; z: number };\r\n  weaponType: string;\r\n}\r\n\r\n/**\r\n * Damage event data\r\n */\r\nexport interface NetworkDamageData {\r\n  targetId: string;\r\n  attackerId: string;\r\n  damage: number;\r\n  hitLocation: { x: number; y: number; z: number };\r\n}\r\n\r\n/**\r\n * Kill event data\r\n */\r\nexport interface NetworkKillData {\r\n  victimId: string;\r\n  attackerId: string;\r\n  weaponType: string;\r\n}\r\n\r\n/**\r\n * Player score data from server\r\n */\r\nexport interface NetworkPlayerScore {\r\n  kills: number;\r\n  deaths: number;\r\n  ping: number;\r\n  username: string;\r\n}\r\n\r\n/**\r\n * Match state from server\r\n */\r\nexport interface NetworkMatchState {\r\n  players: Record<string, NetworkPlayerScore>;\r\n  teams: Record<string, string>;\r\n  startTime: number;\r\n  endTime?: number;\r\n}\r\n\r\n/**\r\n * Connection configuration\r\n */\r\nexport interface NetworkConfig {\r\n  serverUrl: string;\r\n  updateRate: number; // milliseconds between updates\r\n  interpolationDelay: number; // milliseconds\r\n  maxPredictionTime: number; // milliseconds\r\n}\r\n\r\n/**\r\n * Default network configuration\r\n */\r\nexport const DEFAULT_NETWORK_CONFIG: NetworkConfig = {\r\n  serverUrl: '/',\r\n  updateRate: 50, // 20 updates per second\r\n  interpolationDelay: 100, // 100ms interpolation delay\r\n  maxPredictionTime: 200, // 200ms max prediction\r\n};\r\n\r\n/**\r\n * Network event types\r\n */\r\nexport enum NetworkEventType {\r\n  CONNECT = 'connect',\r\n  DISCONNECT = 'disconnect',\r\n  PLAYER_JOINED = 'player_joined',\r\n  PLAYER_LEFT = 'player_left',\r\n  PLAYER_UPDATE = 'player_update',\r\n  PLAYER_SHOOT = 'player_shoot',\r\n  PLAYER_DAMAGED = 'player_damaged',\r\n  PLAYER_KILLED = 'player_killed',\r\n  PLAYER_RESPAWNED = 'player_respawned',\r\n  MATCH_STATE = 'match_state',\r\n  SCORE_UPDATE = 'score_update',\r\n  MATCH_ENDED = 'match_ended',\r\n  FLAG_UPDATE = 'flag_update',\r\n}\r\n\r\n/**\r\n * Remote player data for rendering\r\n */\r\nexport interface RemotePlayerData {\r\n  id: string;\r\n  username: string;\r\n  team: string;\r\n  position: THREE.Vector3;\r\n  rotation: THREE.Euler;\r\n  health: number;\r\n  isDead: boolean;\r\n  currentWeapon: string;\r\n}\r\n","// RIFT Integration - Remote Player Entity\r\n// Represents other players in multiplayer\r\n\r\nimport * as THREE from 'three';\r\nimport { NetworkPlayerState } from './types';\r\n\r\n/**\r\n * Remote Player - Represents another player in the game\r\n * Handles interpolation and rendering of other players\r\n */\r\nexport class RemotePlayer {\r\n  public id: string;\r\n  public username: string;\r\n  public team: string = '';\r\n  public isDead: boolean = false;\r\n\r\n  private mesh: THREE.Group;\r\n  private scene: THREE.Scene;\r\n\r\n  // Interpolation\r\n  private targetPosition: THREE.Vector3;\r\n  private targetRotation: THREE.Euler;\r\n  private currentPosition: THREE.Vector3;\r\n\r\n  // State buffer for interpolation\r\n  private stateBuffer: NetworkPlayerState[] = [];\r\n  private interpolationDelay: number = 100; // ms\r\n\r\n  // Visual components\r\n  private bodyMesh: THREE.Mesh;\r\n  private headMesh: THREE.Mesh;\r\n  private nameLabelSprite: THREE.Sprite | null = null;\r\n\r\n  constructor(scene: THREE.Scene, id: string, username?: string) {\r\n    this.scene = scene;\r\n    this.id = id;\r\n    this.username = username || `Player_${id.slice(0, 4)}`;\r\n\r\n    // Initialize positions\r\n    this.currentPosition = new THREE.Vector3();\r\n    this.targetPosition = new THREE.Vector3();\r\n    this.targetRotation = new THREE.Euler();\r\n\r\n    // Create mesh\r\n    this.mesh = new THREE.Group();\r\n    this.mesh.name = `RemotePlayer_${id}`;\r\n\r\n    // Create body (simple capsule placeholder)\r\n    const bodyGeometry = new THREE.CapsuleGeometry(0.3, 1.2, 8, 16);\r\n    const bodyMaterial = new THREE.MeshStandardMaterial({ \r\n      color: 0x00ff00,\r\n      roughness: 0.7,\r\n      metalness: 0.1,\r\n    });\r\n    this.bodyMesh = new THREE.Mesh(bodyGeometry, bodyMaterial);\r\n    this.bodyMesh.position.y = 0.9;\r\n    this.bodyMesh.castShadow = true;\r\n    this.bodyMesh.receiveShadow = true;\r\n    this.mesh.add(this.bodyMesh);\r\n\r\n    // Create head\r\n    const headGeometry = new THREE.SphereGeometry(0.2, 16, 16);\r\n    const headMaterial = new THREE.MeshStandardMaterial({ \r\n      color: 0xffcc99,\r\n      roughness: 0.6,\r\n    });\r\n    this.headMesh = new THREE.Mesh(headGeometry, headMaterial);\r\n    this.headMesh.position.y = 1.7;\r\n    this.headMesh.castShadow = true;\r\n    this.mesh.add(this.headMesh);\r\n\r\n    // Create name label\r\n    this.createNameLabel();\r\n\r\n    // Add to scene\r\n    this.scene.add(this.mesh);\r\n  }\r\n\r\n  /**\r\n   * Create floating name label above player\r\n   */\r\n  private createNameLabel(): void {\r\n    const canvas = document.createElement('canvas');\r\n    const context = canvas.getContext('2d')!;\r\n    canvas.width = 256;\r\n    canvas.height = 64;\r\n\r\n    context.fillStyle = 'rgba(0, 0, 0, 0.5)';\r\n    context.fillRect(0, 0, canvas.width, canvas.height);\r\n\r\n    context.font = 'bold 24px Arial';\r\n    context.fillStyle = 'white';\r\n    context.textAlign = 'center';\r\n    context.textBaseline = 'middle';\r\n    context.fillText(this.username, canvas.width / 2, canvas.height / 2);\r\n\r\n    const texture = new THREE.CanvasTexture(canvas);\r\n    const spriteMaterial = new THREE.SpriteMaterial({ \r\n      map: texture,\r\n      transparent: true,\r\n      depthTest: false,\r\n    });\r\n\r\n    this.nameLabelSprite = new THREE.Sprite(spriteMaterial);\r\n    this.nameLabelSprite.position.y = 2.2;\r\n    this.nameLabelSprite.scale.set(1.5, 0.4, 1);\r\n    this.mesh.add(this.nameLabelSprite);\r\n  }\r\n\r\n  /**\r\n   * Update player state from network\r\n   */\r\n  public updateState(\r\n    position: { x: number; y: number; z: number },\r\n    rotation: { x: number; y: number },\r\n    _isSprinting: boolean,\r\n    _isGrounded: boolean\r\n  ): void {\r\n    // Add to state buffer for interpolation\r\n    this.stateBuffer.push({\r\n      userId: this.id,\r\n      position,\r\n      rotation,\r\n      isSprinting: _isSprinting,\r\n      isGrounded: _isGrounded,\r\n      timestamp: Date.now(),\r\n    });\r\n\r\n    // Keep buffer size manageable\r\n    while (this.stateBuffer.length > 10) {\r\n      this.stateBuffer.shift();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Update mesh each frame (interpolation)\r\n   */\r\n  public update(delta: number): void {\r\n    if (this.isDead) return;\r\n\r\n    // Find states to interpolate between\r\n    const renderTime = Date.now() - this.interpolationDelay;\r\n    \r\n    // Find two states to interpolate between\r\n    let state1: NetworkPlayerState | null = null;\r\n    let state2: NetworkPlayerState | null = null;\r\n\r\n    for (let i = 0; i < this.stateBuffer.length - 1; i++) {\r\n      if (this.stateBuffer[i].timestamp <= renderTime && \r\n          this.stateBuffer[i + 1].timestamp >= renderTime) {\r\n        state1 = this.stateBuffer[i];\r\n        state2 = this.stateBuffer[i + 1];\r\n        break;\r\n      }\r\n    }\r\n\r\n    if (state1 && state2) {\r\n      // Interpolate between states\r\n      const timeDiff = state2.timestamp - state1.timestamp;\r\n      const t = timeDiff > 0 ? (renderTime - state1.timestamp) / timeDiff : 0;\r\n\r\n      // Position interpolation\r\n      this.targetPosition.set(\r\n        state1.position.x + (state2.position.x - state1.position.x) * t,\r\n        state1.position.y + (state2.position.y - state1.position.y) * t,\r\n        state1.position.z + (state2.position.z - state1.position.z) * t\r\n      );\r\n\r\n      // Rotation interpolation\r\n      this.targetRotation.set(\r\n        state1.rotation.x + (state2.rotation.x - state1.rotation.x) * t,\r\n        state1.rotation.y + (state2.rotation.y - state1.rotation.y) * t,\r\n        0\r\n      );\r\n    } else if (this.stateBuffer.length > 0) {\r\n      // Use latest state if no interpolation possible\r\n      const latest = this.stateBuffer[this.stateBuffer.length - 1];\r\n      this.targetPosition.set(latest.position.x, latest.position.y, latest.position.z);\r\n      this.targetRotation.set(latest.rotation.x, latest.rotation.y, 0);\r\n    }\r\n\r\n    // Smooth movement\r\n    const smoothing = 1 - Math.pow(0.001, delta);\r\n    this.currentPosition.lerp(this.targetPosition, smoothing);\r\n    \r\n    // Apply to mesh\r\n    this.mesh.position.copy(this.currentPosition);\r\n    this.mesh.rotation.y = this.targetRotation.y;\r\n    \r\n    // Rotate head for look direction\r\n    this.headMesh.rotation.x = this.targetRotation.x;\r\n\r\n    // Make name label face camera (billboard effect)\r\n    if (this.nameLabelSprite) {\r\n      // Name label will automatically face camera due to sprite behavior\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Set team and update colors\r\n   */\r\n  public setTeam(team: string): void {\r\n    this.team = team;\r\n    \r\n    // Update body color based on team\r\n    const material = this.bodyMesh.material as THREE.MeshStandardMaterial;\r\n    if (team === 'red') {\r\n      material.color.setHex(0xff4444);\r\n    } else if (team === 'blue') {\r\n      material.color.setHex(0x4444ff);\r\n    } else {\r\n      material.color.setHex(0x00ff00);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Get the mesh group\r\n   */\r\n  public getMesh(): THREE.Group {\r\n    return this.mesh;\r\n  }\r\n\r\n  /**\r\n   * Get position\r\n   */\r\n  public getPosition(): THREE.Vector3 {\r\n    return this.currentPosition.clone();\r\n  }\r\n\r\n  /**\r\n   * Play death animation\r\n   */\r\n  public die(): void {\r\n    this.isDead = true;\r\n    \r\n    // Simple death effect - fall over\r\n    const duration = 500;\r\n    const startTime = Date.now();\r\n    \r\n    const animate = () => {\r\n      const elapsed = Date.now() - startTime;\r\n      const progress = Math.min(elapsed / duration, 1);\r\n      \r\n      this.mesh.rotation.z = Math.PI / 2 * progress;\r\n      this.mesh.position.y = 0.5 * (1 - progress);\r\n      \r\n      if (progress < 1) {\r\n        requestAnimationFrame(animate);\r\n      }\r\n    };\r\n    \r\n    animate();\r\n  }\r\n\r\n  /**\r\n   * Respawn player\r\n   */\r\n  public respawn(position?: THREE.Vector3): void {\r\n    this.isDead = false;\r\n    this.mesh.rotation.z = 0;\r\n    this.stateBuffer = [];\r\n\r\n    if (position) {\r\n      this.currentPosition.copy(position);\r\n      this.targetPosition.copy(position);\r\n      this.mesh.position.copy(position);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Clean up and remove from scene\r\n   */\r\n  public destroy(): void {\r\n    this.scene.remove(this.mesh);\r\n    \r\n    // Dispose geometries and materials\r\n    this.bodyMesh.geometry.dispose();\r\n    (this.bodyMesh.material as THREE.Material).dispose();\r\n    this.headMesh.geometry.dispose();\r\n    (this.headMesh.material as THREE.Material).dispose();\r\n    \r\n    if (this.nameLabelSprite) {\r\n      (this.nameLabelSprite.material as THREE.SpriteMaterial).map?.dispose();\r\n      (this.nameLabelSprite.material as THREE.Material).dispose();\r\n    }\r\n  }\r\n}\r\n","// RIFT Integration - Network Manager\r\n// Handles multiplayer networking via Socket.IO\r\n\r\nimport * as THREE from 'three';\r\nimport {\r\n  NetworkConfig,\r\n  DEFAULT_NETWORK_CONFIG,\r\n  NetworkMatchState,\r\n} from './types';\r\nimport { RemotePlayer } from './RemotePlayer';\r\n\r\n// Socket.IO types (dynamic import for optional multiplayer)\r\ninterface Socket {\r\n  connected: boolean;\r\n  emit: (event: string, data?: unknown) => void;\r\n  on: (event: string, callback: (...args: unknown[]) => void) => void;\r\n  off: (event: string, callback?: (...args: unknown[]) => void) => void;\r\n}\r\n\r\ntype IoFunction = (url: string, options?: any) => Socket;\r\n\r\n/**\r\n * Network Manager - Handles all multiplayer networking\r\n * \r\n * Features:\r\n * - Socket.IO connection management\r\n * - Player state synchronization\r\n * - Remote player management\r\n * - Kill/damage events\r\n * - Team management\r\n */\r\nexport class NetworkManager {\r\n  private socket: Socket | null = null;\r\n  private config: NetworkConfig;\r\n  private scene: THREE.Scene;\r\n\r\n  // Remote players\r\n  private remotePlayers: Map<string, RemotePlayer> = new Map();\r\n  private deadPlayers: Set<string> = new Set();\r\n\r\n  // Local player info\r\n  public myUserId: string = '';\r\n  public myTeam: string = '';\r\n  public playerTeams: Map<string, string> = new Map();\r\n\r\n  // Match state\r\n  private matchId: string = '';\r\n  private matchState: NetworkMatchState | null = null;\r\n\r\n  // Update timing\r\n  private lastUpdate: number = 0;\r\n\r\n  // Event callbacks\r\n  private onKillCallback?: (attackerId: string, victimId: string, weaponType: string) => void;\r\n  private onDamageCallback?: (targetId: string, attackerId: string, damage: number) => void;\r\n  private onMatchEndCallback?: (state: NetworkMatchState) => void;\r\n  private onScoreUpdateCallback?: (state: NetworkMatchState) => void;\r\n\r\n  // Socket.IO reference (loaded dynamically)\r\n  private io: IoFunction | null = null;\r\n\r\n  constructor(scene: THREE.Scene, config?: Partial<NetworkConfig>) {\r\n    this.scene = scene;\r\n    this.config = { ...DEFAULT_NETWORK_CONFIG, ...config };\r\n  }\r\n\r\n  /**\r\n   * Initialize network connection\r\n   */\r\n  public async connect(serverUrl: string, token: string, matchId: string = 'default_match'): Promise<boolean> {\r\n    if (this.socket?.connected) {\r\n      console.log('Already connected');\r\n      return true;\r\n    }\r\n\r\n    this.matchId = matchId;\r\n    this.myUserId = this.extractUserId(token);\r\n\r\n    try {\r\n      // Dynamically import socket.io-client\r\n      // @ts-ignore - socket.io-client is an optional dependency\r\n      const socketIo: any = await import('socket.io-client');\r\n      this.io = socketIo.io || socketIo.default?.io;\r\n\r\n      if (!this.io) {\r\n        throw new Error('socket.io-client not properly loaded');\r\n      }\r\n\r\n      console.log('Connecting to game server...');\r\n\r\n      this.socket = this.io(serverUrl, {\r\n        auth: { token },\r\n        transports: ['websocket'],\r\n      });\r\n\r\n      this.setupListeners();\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('Socket.IO not available, multiplayer disabled:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Extract user ID from token\r\n   */\r\n  private extractUserId(token: string): string {\r\n    const parts = token.split('-');\r\n    return parts[parts.length - 1] || '0';\r\n  }\r\n\r\n  /**\r\n   * Setup socket event listeners\r\n   */\r\n  private setupListeners(): void {\r\n    if (!this.socket) return;\r\n\r\n    this.socket.on('connect', () => {\r\n      console.log('Connected to game server');\r\n      this.socket?.emit('join_match', this.matchId);\r\n    });\r\n\r\n    this.socket.on('disconnect', () => {\r\n      console.log('Disconnected from game server');\r\n    });\r\n\r\n    this.socket.on('player_joined', (data: unknown) => {\r\n      const { userId, team } = data as { userId: string; team?: string };\r\n      console.log(`Player ${userId} joined (${team || 'no team'})`);\r\n\r\n      if (team) {\r\n        this.playerTeams.set(userId, team);\r\n      }\r\n\r\n      if (userId !== this.myUserId && !this.remotePlayers.has(userId)) {\r\n        this.addRemotePlayer(userId);\r\n      }\r\n    });\r\n\r\n    this.socket.on('player_update', (data: unknown) => {\r\n      const { userId, position, rotation, isSprinting, isGrounded } = data as {\r\n        userId: string;\r\n        position: { x: number; y: number; z: number };\r\n        rotation: { x: number; y: number };\r\n        isSprinting: boolean;\r\n        isGrounded: boolean;\r\n      };\r\n\r\n      const userIdStr = String(userId);\r\n\r\n      // Ignore dead players and self\r\n      if (this.deadPlayers.has(userIdStr) || userIdStr === this.myUserId) {\r\n        return;\r\n      }\r\n\r\n      let remotePlayer = this.remotePlayers.get(userIdStr);\r\n      if (!remotePlayer) {\r\n        remotePlayer = this.addRemotePlayer(userIdStr);\r\n      }\r\n\r\n      remotePlayer.updateState(position, rotation, isSprinting, isGrounded);\r\n    });\r\n\r\n    this.socket.on('player_shoot', (data: unknown) => {\r\n      const { userId } = data as { userId: string };\r\n      console.log(`Player ${userId} shot`);\r\n      // TODO: Show muzzle flash/tracer for remote player\r\n    });\r\n\r\n    this.socket.on('player_damaged', (data: unknown) => {\r\n      const { targetId, attackerId, damage } = data as {\r\n        targetId: string;\r\n        attackerId: string;\r\n        damage: number;\r\n      };\r\n\r\n      console.log(`Player ${targetId} took ${damage} damage from ${attackerId}`);\r\n\r\n      if (String(targetId) === this.myUserId && this.onDamageCallback) {\r\n        this.onDamageCallback(targetId, attackerId, damage);\r\n      }\r\n    });\r\n\r\n    this.socket.on('player_killed', (data: unknown) => {\r\n      const { victimId, attackerId, weaponType } = data as {\r\n        victimId: string;\r\n        attackerId: string;\r\n        weaponType: string;\r\n      };\r\n\r\n      console.log(`Player ${victimId} killed by ${attackerId} with ${weaponType}`);\r\n\r\n      const victimIdStr = String(victimId);\r\n      this.deadPlayers.add(victimIdStr);\r\n\r\n      // Remove dead player mesh\r\n      const deadPlayer = this.remotePlayers.get(victimIdStr);\r\n      if (deadPlayer) {\r\n        deadPlayer.die();\r\n        setTimeout(() => {\r\n          deadPlayer.destroy();\r\n          this.remotePlayers.delete(victimIdStr);\r\n        }, 2000);\r\n      }\r\n\r\n      // Trigger callback\r\n      if (this.onKillCallback) {\r\n        this.onKillCallback(attackerId, victimId, weaponType);\r\n      }\r\n    });\r\n\r\n    this.socket.on('player_respawned', (data: unknown) => {\r\n      const { userId, team } = data as { userId: string; team?: string };\r\n      const userIdStr = String(userId);\r\n\r\n      console.log(`Player ${userIdStr} respawned (${team || 'no team'})`);\r\n\r\n      if (team) {\r\n        this.playerTeams.set(userIdStr, team);\r\n      }\r\n\r\n      this.deadPlayers.delete(userIdStr);\r\n\r\n      if (userIdStr !== this.myUserId && !this.remotePlayers.has(userIdStr)) {\r\n        this.addRemotePlayer(userIdStr);\r\n      }\r\n    });\r\n\r\n    this.socket.on('match_state', (state: unknown) => {\r\n      console.log('Received match state:', state);\r\n      this.matchState = state as NetworkMatchState;\r\n\r\n      // Sync teams\r\n      if (this.matchState.teams) {\r\n        Object.entries(this.matchState.teams).forEach(([uid, team]) => {\r\n          this.playerTeams.set(uid, team);\r\n          if (uid === this.myUserId) {\r\n            this.myTeam = team;\r\n          } else {\r\n            const rp = this.remotePlayers.get(uid);\r\n            if (rp) rp.setTeam(team);\r\n          }\r\n        });\r\n      }\r\n\r\n      if (this.onScoreUpdateCallback) {\r\n        this.onScoreUpdateCallback(this.matchState);\r\n      }\r\n    });\r\n\r\n    this.socket.on('score_update', (state: unknown) => {\r\n      console.log('Score update:', state);\r\n      this.matchState = state as NetworkMatchState;\r\n\r\n      if (this.onScoreUpdateCallback) {\r\n        this.onScoreUpdateCallback(this.matchState);\r\n      }\r\n    });\r\n\r\n    this.socket.on('match_ended', (state: unknown) => {\r\n      console.log('Match ended:', state);\r\n      this.matchState = state as NetworkMatchState;\r\n\r\n      if (this.onMatchEndCallback) {\r\n        this.onMatchEndCallback(this.matchState);\r\n      }\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Add a remote player to the scene\r\n   */\r\n  private addRemotePlayer(userId: string): RemotePlayer {\r\n    const player = new RemotePlayer(this.scene, userId);\r\n    this.remotePlayers.set(userId, player);\r\n\r\n    const team = this.playerTeams.get(userId);\r\n    if (team) {\r\n      player.setTeam(team);\r\n    }\r\n\r\n    return player;\r\n  }\r\n\r\n  /**\r\n   * Update network state - call each frame\r\n   */\r\n  public update(\r\n    delta: number,\r\n    localPlayer: { position: THREE.Vector3; velocity: THREE.Vector3; isSprinting: boolean; isGrounded: boolean },\r\n    camera: THREE.Camera\r\n  ): void {\r\n    // Update remote players interpolation\r\n    this.remotePlayers.forEach(p => p.update(delta));\r\n\r\n    // Send local player update at fixed rate\r\n    const now = Date.now();\r\n    if (now - this.lastUpdate > this.config.updateRate) {\r\n      this.sendPlayerUpdate(localPlayer, camera);\r\n      this.lastUpdate = now;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Send local player state to server\r\n   */\r\n  private sendPlayerUpdate(\r\n    player: { position: THREE.Vector3; velocity: THREE.Vector3; isSprinting: boolean; isGrounded: boolean },\r\n    camera: THREE.Camera\r\n  ): void {\r\n    if (!this.socket?.connected) return;\r\n\r\n    this.socket.emit('player_update', {\r\n      matchId: this.matchId,\r\n      position: {\r\n        x: camera.position.x,\r\n        y: camera.position.y,\r\n        z: camera.position.z,\r\n      },\r\n      rotation: {\r\n        x: camera.rotation.x,\r\n        y: camera.rotation.y,\r\n      },\r\n      velocity: {\r\n        x: player.velocity.x,\r\n        y: player.velocity.y,\r\n        z: player.velocity.z,\r\n      },\r\n      isSprinting: player.isSprinting,\r\n      isGrounded: player.isGrounded,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send shoot event\r\n   */\r\n  public sendShoot(origin: THREE.Vector3, direction: THREE.Vector3, weaponType: string): void {\r\n    if (!this.socket?.connected) return;\r\n\r\n    this.socket.emit('player_shoot', {\r\n      matchId: this.matchId,\r\n      origin: { x: origin.x, y: origin.y, z: origin.z },\r\n      direction: { x: direction.x, y: direction.y, z: direction.z },\r\n      weaponType,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send hit event\r\n   */\r\n  public sendPlayerHit(targetId: string, damage: number, hitLocation: THREE.Vector3): void {\r\n    if (!this.socket?.connected) return;\r\n\r\n    // Check friendly fire\r\n    const targetTeam = this.playerTeams.get(targetId);\r\n    if (this.myTeam && targetTeam && this.myTeam === targetTeam) {\r\n      console.log('Friendly fire blocked');\r\n      return;\r\n    }\r\n\r\n    this.socket.emit('player_hit', {\r\n      matchId: this.matchId,\r\n      targetId,\r\n      damage,\r\n      hitLocation: { x: hitLocation.x, y: hitLocation.y, z: hitLocation.z },\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send death event\r\n   */\r\n  public sendPlayerDied(attackerId: string, weaponType: string): void {\r\n    if (!this.socket?.connected) return;\r\n\r\n    this.socket.emit('player_died', {\r\n      matchId: this.matchId,\r\n      attackerId,\r\n      weaponType,\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Send respawn event\r\n   */\r\n  public sendPlayerRespawn(): void {\r\n    if (!this.socket?.connected) return;\r\n\r\n    this.socket.emit('player_respawn', {\r\n      matchId: this.matchId,\r\n    });\r\n  }\r\n\r\n  // ========== Event Callbacks ==========\r\n\r\n  public onKill(callback: (attackerId: string, victimId: string, weaponType: string) => void): void {\r\n    this.onKillCallback = callback;\r\n  }\r\n\r\n  public onDamage(callback: (targetId: string, attackerId: string, damage: number) => void): void {\r\n    this.onDamageCallback = callback;\r\n  }\r\n\r\n  public onMatchEnd(callback: (state: NetworkMatchState) => void): void {\r\n    this.onMatchEndCallback = callback;\r\n  }\r\n\r\n  public onScoreUpdate(callback: (state: NetworkMatchState) => void): void {\r\n    this.onScoreUpdateCallback = callback;\r\n  }\r\n\r\n  // ========== Getters ==========\r\n\r\n  public get otherPlayers(): Map<string, RemotePlayer> {\r\n    return this.remotePlayers;\r\n  }\r\n\r\n  public getRemotePlayers(): RemotePlayer[] {\r\n    return Array.from(this.remotePlayers.values());\r\n  }\r\n\r\n  public getMatchState(): NetworkMatchState | null {\r\n    return this.matchState;\r\n  }\r\n\r\n  public isConnected(): boolean {\r\n    return this.socket?.connected ?? false;\r\n  }\r\n\r\n  // ========== Cleanup ==========\r\n\r\n  public disconnect(): void {\r\n    if (this.socket) {\r\n      this.socket.off('connect');\r\n      this.socket.off('disconnect');\r\n      this.socket.off('player_joined');\r\n      this.socket.off('player_update');\r\n      this.socket.off('player_shoot');\r\n      this.socket.off('player_damaged');\r\n      this.socket.off('player_killed');\r\n      this.socket.off('player_respawned');\r\n      this.socket.off('match_state');\r\n      this.socket.off('score_update');\r\n      this.socket.off('match_ended');\r\n\r\n      this.socket.emit('disconnect');\r\n      this.socket = null;\r\n    }\r\n\r\n    // Clean up remote players\r\n    this.remotePlayers.forEach(player => player.destroy());\r\n    this.remotePlayers.clear();\r\n    this.deadPlayers.clear();\r\n  }\r\n}\r\n","// RIFT Integration - Lobby Types\r\n\r\n/**\r\n * Available game modes for matchmaking\r\n */\r\nexport interface GameModeInfo {\r\n  id: string;\r\n  name: string;\r\n  description: string;\r\n  minPlayers: number;\r\n  maxPlayers: number;\r\n  category: 'Arena' | 'Competitive' | 'Casual';\r\n  estimatedWaitTime: number; // seconds\r\n  enabled: boolean;\r\n}\r\n\r\n/**\r\n * Match found response\r\n */\r\nexport interface MatchFoundData {\r\n  id: string;\r\n  modeId: string;\r\n  opponentIds: string[];\r\n  gameUrl?: string;\r\n}\r\n\r\n/**\r\n * Queue status\r\n */\r\nexport interface QueueStatus {\r\n  isQueued: boolean;\r\n  modeId: string | null;\r\n  queueTime: number;\r\n  estimatedWait: number;\r\n}\r\n\r\n/**\r\n * Player info in lobby\r\n */\r\nexport interface LobbyPlayer {\r\n  id: string;\r\n  username: string;\r\n  level: number;\r\n  status: 'idle' | 'queued' | 'in_game';\r\n  avatar?: string;\r\n}\r\n\r\n/**\r\n * Party data\r\n */\r\nexport interface Party {\r\n  id: string;\r\n  leaderId: string;\r\n  members: LobbyPlayer[];\r\n  maxSize: number;\r\n}\r\n\r\n/**\r\n * Lobby events\r\n */\r\nexport enum LobbyEventType {\r\n  QUEUE_STARTED = 'queue_started',\r\n  QUEUE_CANCELLED = 'queue_cancelled',\r\n  QUEUE_UPDATE = 'queue_update',\r\n  MATCH_FOUND = 'match_found',\r\n  MATCH_ACCEPTED = 'match_accepted',\r\n  MATCH_DECLINED = 'match_declined',\r\n  MATCH_CANCELLED = 'match_cancelled',\r\n  MATCH_STARTING = 'match_starting',\r\n  PARTY_CREATED = 'party_created',\r\n  PARTY_JOINED = 'party_joined',\r\n  PARTY_LEFT = 'party_left',\r\n  PARTY_DISBANDED = 'party_disbanded',\r\n  FRIEND_ONLINE = 'friend_online',\r\n  FRIEND_OFFLINE = 'friend_offline',\r\n  INVITE_RECEIVED = 'invite_received',\r\n}\r\n\r\n/**\r\n * Default game modes available\r\n */\r\nexport const DEFAULT_GAME_MODES: GameModeInfo[] = [\r\n  {\r\n    id: 'ffa',\r\n    name: 'Free For All',\r\n    description: 'Every player for themselves. First to 30 kills wins.',\r\n    minPlayers: 2,\r\n    maxPlayers: 8,\r\n    category: 'Arena',\r\n    estimatedWaitTime: 15,\r\n    enabled: true,\r\n  },\r\n  {\r\n    id: 'tdm',\r\n    name: 'Team Deathmatch',\r\n    description: 'Red vs Blue. Team with most kills wins.',\r\n    minPlayers: 4,\r\n    maxPlayers: 12,\r\n    category: 'Arena',\r\n    estimatedWaitTime: 20,\r\n    enabled: true,\r\n  },\r\n  {\r\n    id: 'survival',\r\n    name: 'Wave Survival',\r\n    description: 'Survive endless waves of enemies.',\r\n    minPlayers: 1,\r\n    maxPlayers: 4,\r\n    category: 'Casual',\r\n    estimatedWaitTime: 5,\r\n    enabled: true,\r\n  },\r\n  {\r\n    id: 'ranked',\r\n    name: 'Ranked Match',\r\n    description: 'Competitive 5v5 with skill-based matchmaking.',\r\n    minPlayers: 10,\r\n    maxPlayers: 10,\r\n    category: 'Competitive',\r\n    estimatedWaitTime: 60,\r\n    enabled: false, // Not implemented yet\r\n  },\r\n];\r\n","// RIFT Integration - Lobby Manager\r\n// Handles matchmaking queue, party management, and game mode selection\r\n\r\nimport {\r\n  GameModeInfo,\r\n  MatchFoundData,\r\n  QueueStatus,\r\n  Party,\r\n  LobbyEventType,\r\n  DEFAULT_GAME_MODES,\r\n} from './types';\r\n\r\n// Socket types for dynamic import\r\ninterface Socket {\r\n  connected: boolean;\r\n  emit: (event: string, data?: unknown) => void;\r\n  on: (event: string, callback: (...args: unknown[]) => void) => void;\r\n  off: (event: string, callback?: (...args: unknown[]) => void) => void;\r\n}\r\n\r\n/**\r\n * Lobby Manager - Handles matchmaking and social features\r\n */\r\nexport class LobbyManager {\r\n  private socket: Socket | null = null;\r\n  private serverUrl: string;\r\n  private userId: string = '';\r\n\r\n  // Queue state\r\n  private isQueued: boolean = false;\r\n  private currentModeId: string | null = null;\r\n  private queueStartTime: number = 0;\r\n  private queueTimer: number | null = null;\r\n\r\n  // Match state\r\n  private pendingMatch: MatchFoundData | null = null;\r\n\r\n  // Party state\r\n  private currentParty: Party | null = null;\r\n\r\n  // Available modes\r\n  private gameModes: GameModeInfo[] = [...DEFAULT_GAME_MODES];\r\n\r\n  // Event callbacks\r\n  private eventListeners: Map<LobbyEventType, Set<(data: unknown) => void>> = new Map();\r\n\r\n  // Socket.IO reference\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  private io: any = null;\r\n\r\n  constructor(serverUrl: string = '/') {\r\n    this.serverUrl = serverUrl;\r\n  }\r\n\r\n  /**\r\n   * Connect to lobby server\r\n   */\r\n  public async connect(token: string): Promise<boolean> {\r\n    if (this.socket?.connected) {\r\n      return true;\r\n    }\r\n\r\n    this.userId = this.extractUserId(token);\r\n\r\n    try {\r\n      // Dynamic import for socket.io-client\r\n      const socketIo = await import('socket.io-client');\r\n      this.io = socketIo.io || (socketIo.default as any)?.io;\r\n\r\n      if (!this.io) {\r\n        throw new Error('socket.io-client not loaded');\r\n      }\r\n\r\n      this.socket = this.io(this.serverUrl, {\r\n        auth: { token },\r\n        transports: ['websocket'],\r\n      }) as Socket;\r\n\r\n      this.setupListeners();\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('Lobby connection failed:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  private extractUserId(token: string): string {\r\n    const parts = token.split('-');\r\n    return parts[parts.length - 1] || '0';\r\n  }\r\n\r\n  /**\r\n   * Setup socket event listeners\r\n   */\r\n  private setupListeners(): void {\r\n    if (!this.socket) return;\r\n\r\n    this.socket.on('connect', () => {\r\n      console.log('Connected to lobby server');\r\n    });\r\n\r\n    this.socket.on('disconnect', () => {\r\n      console.log('Disconnected from lobby server');\r\n      this.stopQueueTimer();\r\n      this.isQueued = false;\r\n    });\r\n\r\n    this.socket.on('match_found', (data: unknown) => {\r\n      const matchData = data as MatchFoundData;\r\n      console.log('Match found:', matchData);\r\n      this.pendingMatch = matchData;\r\n      this.isQueued = false;\r\n      this.stopQueueTimer();\r\n      this.emit(LobbyEventType.MATCH_FOUND, matchData);\r\n    });\r\n\r\n    this.socket.on('match_start', (data: unknown) => {\r\n      console.log('Match starting:', data);\r\n      this.pendingMatch = null;\r\n      this.emit(LobbyEventType.MATCH_STARTING, data);\r\n    });\r\n\r\n    this.socket.on('match_cancelled', (data: unknown) => {\r\n      console.log('Match cancelled:', data);\r\n      this.pendingMatch = null;\r\n      this.emit(LobbyEventType.MATCH_CANCELLED, data);\r\n    });\r\n\r\n    this.socket.on('party_update', (data: unknown) => {\r\n      this.currentParty = data as Party;\r\n      this.emit(LobbyEventType.PARTY_JOINED, data);\r\n    });\r\n\r\n    this.socket.on('party_disbanded', () => {\r\n      this.currentParty = null;\r\n      this.emit(LobbyEventType.PARTY_DISBANDED, null);\r\n    });\r\n\r\n    this.socket.on('invite_received', (data: unknown) => {\r\n      this.emit(LobbyEventType.INVITE_RECEIVED, data);\r\n    });\r\n  }\r\n\r\n  // ========== Queue Management ==========\r\n\r\n  /**\r\n   * Start matchmaking queue\r\n   */\r\n  public startQueue(modeId: string): boolean {\r\n    if (!this.socket?.connected) {\r\n      console.warn('Not connected to lobby server');\r\n      return false;\r\n    }\r\n\r\n    // Validate mode\r\n    const mode = this.gameModes.find(m => m.id === modeId);\r\n    if (!mode || !mode.enabled) {\r\n      console.warn('Invalid or disabled game mode:', modeId);\r\n      return false;\r\n    }\r\n\r\n    // Check party constraints\r\n    if (this.currentParty && this.currentParty.leaderId !== this.userId) {\r\n      console.warn('Only party leader can start queue');\r\n      return false;\r\n    }\r\n\r\n    this.isQueued = true;\r\n    this.currentModeId = modeId;\r\n    this.queueStartTime = Date.now();\r\n\r\n    this.socket.emit('start_queue', { modeId });\r\n    this.startQueueTimer();\r\n    this.emit(LobbyEventType.QUEUE_STARTED, { modeId });\r\n\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Cancel matchmaking queue\r\n   */\r\n  public cancelQueue(): void {\r\n    if (!this.socket?.connected) return;\r\n\r\n    this.socket.emit('cancel_queue');\r\n    this.isQueued = false;\r\n    this.currentModeId = null;\r\n    this.stopQueueTimer();\r\n    this.emit(LobbyEventType.QUEUE_CANCELLED, null);\r\n  }\r\n\r\n  /**\r\n   * Get current queue status\r\n   */\r\n  public getQueueStatus(): QueueStatus {\r\n    const mode = this.currentModeId ? this.gameModes.find(m => m.id === this.currentModeId) : null;\r\n    \r\n    return {\r\n      isQueued: this.isQueued,\r\n      modeId: this.currentModeId,\r\n      queueTime: this.isQueued ? Math.floor((Date.now() - this.queueStartTime) / 1000) : 0,\r\n      estimatedWait: mode?.estimatedWaitTime || 0,\r\n    };\r\n  }\r\n\r\n  private startQueueTimer(): void {\r\n    this.stopQueueTimer();\r\n    this.queueTimer = window.setInterval(() => {\r\n      this.emit(LobbyEventType.QUEUE_UPDATE, this.getQueueStatus());\r\n    }, 1000);\r\n  }\r\n\r\n  private stopQueueTimer(): void {\r\n    if (this.queueTimer !== null) {\r\n      clearInterval(this.queueTimer);\r\n      this.queueTimer = null;\r\n    }\r\n  }\r\n\r\n  // ========== Match Management ==========\r\n\r\n  /**\r\n   * Accept found match\r\n   */\r\n  public acceptMatch(): void {\r\n    if (!this.socket?.connected || !this.pendingMatch) return;\r\n\r\n    this.socket.emit('accept_match', { matchId: this.pendingMatch.id });\r\n    this.emit(LobbyEventType.MATCH_ACCEPTED, this.pendingMatch);\r\n  }\r\n\r\n  /**\r\n   * Decline found match\r\n   */\r\n  public declineMatch(): void {\r\n    if (!this.socket?.connected || !this.pendingMatch) return;\r\n\r\n    this.socket.emit('decline_match', { matchId: this.pendingMatch.id });\r\n    this.pendingMatch = null;\r\n    this.emit(LobbyEventType.MATCH_DECLINED, null);\r\n  }\r\n\r\n  /**\r\n   * Get pending match\r\n   */\r\n  public getPendingMatch(): MatchFoundData | null {\r\n    return this.pendingMatch;\r\n  }\r\n\r\n  // ========== Party Management ==========\r\n\r\n  /**\r\n   * Create a party\r\n   */\r\n  public createParty(): void {\r\n    if (!this.socket?.connected) return;\r\n    this.socket.emit('create_party');\r\n  }\r\n\r\n  /**\r\n   * Invite player to party\r\n   */\r\n  public inviteToParty(playerId: string): void {\r\n    if (!this.socket?.connected) return;\r\n    this.socket.emit('invite_to_party', { playerId });\r\n  }\r\n\r\n  /**\r\n   * Join party by invite\r\n   */\r\n  public joinParty(partyId: string): void {\r\n    if (!this.socket?.connected) return;\r\n    this.socket.emit('join_party', { partyId });\r\n  }\r\n\r\n  /**\r\n   * Leave current party\r\n   */\r\n  public leaveParty(): void {\r\n    if (!this.socket?.connected || !this.currentParty) return;\r\n    this.socket.emit('leave_party');\r\n    this.currentParty = null;\r\n    this.emit(LobbyEventType.PARTY_LEFT, null);\r\n  }\r\n\r\n  /**\r\n   * Get current party\r\n   */\r\n  public getParty(): Party | null {\r\n    return this.currentParty;\r\n  }\r\n\r\n  /**\r\n   * Check if user is party leader\r\n   */\r\n  public isPartyLeader(): boolean {\r\n    return this.currentParty?.leaderId === this.userId;\r\n  }\r\n\r\n  // ========== Game Modes ==========\r\n\r\n  /**\r\n   * Get available game modes\r\n   */\r\n  public getGameModes(): GameModeInfo[] {\r\n    return this.gameModes.filter(m => m.enabled);\r\n  }\r\n\r\n  /**\r\n   * Get all game modes including disabled\r\n   */\r\n  public getAllGameModes(): GameModeInfo[] {\r\n    return [...this.gameModes];\r\n  }\r\n\r\n  /**\r\n   * Get game mode by ID\r\n   */\r\n  public getGameMode(modeId: string): GameModeInfo | undefined {\r\n    return this.gameModes.find(m => m.id === modeId);\r\n  }\r\n\r\n  /**\r\n   * Get modes by category\r\n   */\r\n  public getModesByCategory(category: string): GameModeInfo[] {\r\n    return this.gameModes.filter(m => m.category === category && m.enabled);\r\n  }\r\n\r\n  // ========== Event System ==========\r\n\r\n  /**\r\n   * Subscribe to lobby event\r\n   */\r\n  public on(event: LobbyEventType, callback: (data: unknown) => void): () => void {\r\n    if (!this.eventListeners.has(event)) {\r\n      this.eventListeners.set(event, new Set());\r\n    }\r\n    this.eventListeners.get(event)!.add(callback);\r\n\r\n    // Return unsubscribe function\r\n    return () => {\r\n      this.eventListeners.get(event)?.delete(callback);\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Emit event to listeners\r\n   */\r\n  private emit(event: LobbyEventType, data: unknown): void {\r\n    const listeners = this.eventListeners.get(event);\r\n    if (listeners) {\r\n      listeners.forEach(callback => callback(data));\r\n    }\r\n  }\r\n\r\n  // ========== Getters ==========\r\n\r\n  public getUserId(): string {\r\n    return this.userId;\r\n  }\r\n\r\n  public isConnected(): boolean {\r\n    return this.socket?.connected ?? false;\r\n  }\r\n\r\n  public isInQueue(): boolean {\r\n    return this.isQueued;\r\n  }\r\n\r\n  // ========== Cleanup ==========\r\n\r\n  public disconnect(): void {\r\n    this.stopQueueTimer();\r\n    \r\n    if (this.socket) {\r\n      this.socket.emit('disconnect');\r\n      this.socket = null;\r\n    }\r\n\r\n    this.isQueued = false;\r\n    this.currentModeId = null;\r\n    this.pendingMatch = null;\r\n    this.currentParty = null;\r\n    this.eventListeners.clear();\r\n  }\r\n}\r\n","// RIFT Integration - Lobby UI Helper\r\n// Provides UI utilities for lobby management\r\n\r\nimport { \r\n  LobbyManager \r\n} from './LobbyManager';\r\nimport { \r\n  QueueStatus, \r\n  MatchFoundData, \r\n  LobbyEventType \r\n} from './types';\r\n\r\n/**\r\n * Lobby UI Helper - Creates and manages lobby UI elements\r\n */\r\nexport class LobbyUI {\r\n  private lobbyManager: LobbyManager;\r\n  private container: HTMLElement | null = null;\r\n  private isVisible: boolean = false;\r\n\r\n  // UI Elements\r\n  private matchFoundPopup: HTMLElement | null = null;\r\n\r\n  constructor(lobbyManager: LobbyManager) {\r\n    this.lobbyManager = lobbyManager;\r\n    this.setupEventListeners();\r\n  }\r\n\r\n  /**\r\n   * Setup lobby event listeners\r\n   */\r\n  private setupEventListeners(): void {\r\n    this.lobbyManager.on(LobbyEventType.QUEUE_UPDATE, (data) => {\r\n      this.updateQueueDisplay(data as QueueStatus);\r\n    });\r\n\r\n    this.lobbyManager.on(LobbyEventType.MATCH_FOUND, (data) => {\r\n      this.showMatchFoundPopup(data as MatchFoundData);\r\n    });\r\n\r\n    this.lobbyManager.on(LobbyEventType.MATCH_CANCELLED, () => {\r\n      this.hideMatchFoundPopup();\r\n    });\r\n\r\n    this.lobbyManager.on(LobbyEventType.MATCH_STARTING, () => {\r\n      this.hideMatchFoundPopup();\r\n      this.hide();\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Initialize lobby UI\r\n   */\r\n  public init(containerId: string = 'lobby-container'): void {\r\n    this.container = document.getElementById(containerId);\r\n    \r\n    if (!this.container) {\r\n      // Create container if it doesn't exist\r\n      this.container = document.createElement('div');\r\n      this.container.id = containerId;\r\n      document.body.appendChild(this.container);\r\n    }\r\n\r\n    this.container.innerHTML = this.getMainTemplate();\r\n    this.setupUIEventHandlers();\r\n  }\r\n\r\n  /**\r\n   * Main lobby template\r\n   */\r\n  private getMainTemplate(): string {\r\n    return `\r\n      <div id=\"lobby-panel\" class=\"lobby-panel\">\r\n        <div class=\"lobby-header\">\r\n          <h1>PLAY</h1>\r\n          <button id=\"lobby-close-btn\" class=\"close-btn\">&times;</button>\r\n        </div>\r\n        \r\n        <div class=\"lobby-content\">\r\n          <!-- Category Tabs -->\r\n          <div class=\"category-tabs\" id=\"category-tabs\">\r\n            <button class=\"category-tab active\" data-category=\"Arena\">Arena</button>\r\n            <button class=\"category-tab\" data-category=\"Competitive\">Competitive</button>\r\n            <button class=\"category-tab\" data-category=\"Casual\">Casual</button>\r\n          </div>\r\n          \r\n          <!-- Game Modes Grid -->\r\n          <div class=\"modes-grid\" id=\"modes-grid\">\r\n            ${this.renderGameModes()}\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Queue Status -->\r\n        <div id=\"queue-status\" class=\"queue-status hidden\">\r\n          <div class=\"queue-info\">\r\n            <span class=\"queue-text\">SEARCHING...</span>\r\n            <span class=\"queue-time\" id=\"queue-time\">0:00</span>\r\n          </div>\r\n          <button id=\"cancel-queue-btn\" class=\"cancel-btn\">CANCEL</button>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Match Found Popup -->\r\n      <div id=\"match-found-popup\" class=\"match-popup hidden\">\r\n        <div class=\"popup-content\">\r\n          <h2>MATCH FOUND</h2>\r\n          <div class=\"match-info\" id=\"match-info\"></div>\r\n          <div class=\"match-timer\" id=\"match-timer\">10</div>\r\n          <div class=\"match-actions\">\r\n            <button id=\"accept-match-btn\" class=\"accept-btn\">ACCEPT</button>\r\n            <button id=\"decline-match-btn\" class=\"decline-btn\">DECLINE</button>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    `;\r\n  }\r\n\r\n  /**\r\n   * Render game modes for current category\r\n   */\r\n  private renderGameModes(category: string = 'Arena'): string {\r\n    const modes = this.lobbyManager.getModesByCategory(category);\r\n    \r\n    if (modes.length === 0) {\r\n      return '<div class=\"no-modes\">No game modes available</div>';\r\n    }\r\n\r\n    return modes.map(mode => `\r\n      <div class=\"mode-card ${mode.enabled ? '' : 'disabled'}\" \r\n           data-mode-id=\"${mode.id}\"\r\n           ${mode.enabled ? '' : 'title=\"Coming Soon\"'}>\r\n        <h3>${mode.name}</h3>\r\n        <p>${mode.description}</p>\r\n        <div class=\"mode-info\">\r\n          <span class=\"players\">${mode.minPlayers}-${mode.maxPlayers} Players</span>\r\n          <span class=\"wait-time\">~${mode.estimatedWaitTime}s wait</span>\r\n        </div>\r\n        ${mode.enabled ? '<div class=\"play-icon\"></div>' : '<div class=\"locked-icon\"></div>'}\r\n      </div>\r\n    `).join('');\r\n  }\r\n\r\n  /**\r\n   * Setup UI event handlers\r\n   */\r\n  private setupUIEventHandlers(): void {\r\n    if (!this.container) return;\r\n\r\n    // Close button\r\n    const closeBtn = this.container.querySelector('#lobby-close-btn');\r\n    closeBtn?.addEventListener('click', () => this.hide());\r\n\r\n    // Category tabs\r\n    const tabs = this.container.querySelectorAll('.category-tab');\r\n    tabs.forEach(tab => {\r\n      tab.addEventListener('click', (e) => {\r\n        const target = e.target as HTMLElement;\r\n        const category = target.dataset.category;\r\n        if (category) {\r\n          this.switchCategory(category);\r\n        }\r\n      });\r\n    });\r\n\r\n    // Mode cards\r\n    this.setupModeCardHandlers();\r\n\r\n    // Cancel queue button\r\n    const cancelBtn = this.container.querySelector('#cancel-queue-btn');\r\n    cancelBtn?.addEventListener('click', () => {\r\n      this.lobbyManager.cancelQueue();\r\n      this.hideQueueStatus();\r\n    });\r\n\r\n    // Match accept/decline\r\n    const acceptBtn = this.container.querySelector('#accept-match-btn');\r\n    acceptBtn?.addEventListener('click', () => this.lobbyManager.acceptMatch());\r\n\r\n    const declineBtn = this.container.querySelector('#decline-match-btn');\r\n    declineBtn?.addEventListener('click', () => this.lobbyManager.declineMatch());\r\n  }\r\n\r\n  /**\r\n   * Setup mode card click handlers\r\n   */\r\n  private setupModeCardHandlers(): void {\r\n    const cards = this.container?.querySelectorAll('.mode-card:not(.disabled)');\r\n    cards?.forEach(card => {\r\n      card.addEventListener('click', (e) => {\r\n        const target = e.currentTarget as HTMLElement;\r\n        const modeId = target.dataset.modeId;\r\n        if (modeId) {\r\n          this.lobbyManager.startQueue(modeId);\r\n          this.showQueueStatus();\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  /**\r\n   * Switch game mode category\r\n   */\r\n  private switchCategory(category: string): void {\r\n    // Update tab active states\r\n    const tabs = this.container?.querySelectorAll('.category-tab');\r\n    tabs?.forEach(tab => {\r\n      tab.classList.toggle('active', (tab as HTMLElement).dataset.category === category);\r\n    });\r\n\r\n    // Re-render modes\r\n    const grid = this.container?.querySelector('#modes-grid');\r\n    if (grid) {\r\n      grid.innerHTML = this.renderGameModes(category);\r\n      this.setupModeCardHandlers();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show queue status UI\r\n   */\r\n  private showQueueStatus(): void {\r\n    const status = this.container?.querySelector('#queue-status');\r\n    status?.classList.remove('hidden');\r\n    \r\n    // Disable mode cards while in queue\r\n    const cards = this.container?.querySelectorAll('.mode-card');\r\n    cards?.forEach(card => card.classList.add('queued'));\r\n  }\r\n\r\n  /**\r\n   * Hide queue status UI\r\n   */\r\n  private hideQueueStatus(): void {\r\n    const status = this.container?.querySelector('#queue-status');\r\n    status?.classList.add('hidden');\r\n    \r\n    // Re-enable mode cards\r\n    const cards = this.container?.querySelectorAll('.mode-card');\r\n    cards?.forEach(card => card.classList.remove('queued'));\r\n  }\r\n\r\n  /**\r\n   * Update queue display\r\n   */\r\n  private updateQueueDisplay(status: QueueStatus): void {\r\n    const timeEl = this.container?.querySelector('#queue-time');\r\n    if (timeEl) {\r\n      const mins = Math.floor(status.queueTime / 60);\r\n      const secs = status.queueTime % 60;\r\n      timeEl.textContent = `${mins}:${secs.toString().padStart(2, '0')}`;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Show match found popup\r\n   */\r\n  private showMatchFoundPopup(match: MatchFoundData): void {\r\n    this.hideQueueStatus();\r\n    \r\n    this.matchFoundPopup = this.container?.querySelector('#match-found-popup') as HTMLElement;\r\n    if (!this.matchFoundPopup) return;\r\n\r\n    // Show popup\r\n    this.matchFoundPopup.classList.remove('hidden');\r\n\r\n    // Update info\r\n    const infoEl = this.matchFoundPopup.querySelector('#match-info');\r\n    const mode = this.lobbyManager.getGameMode(match.modeId);\r\n    if (infoEl && mode) {\r\n      infoEl.textContent = mode.name;\r\n    }\r\n\r\n    // Start countdown timer\r\n    let timeLeft = 10;\r\n    const timerEl = this.matchFoundPopup.querySelector('#match-timer');\r\n    \r\n    const countdown = setInterval(() => {\r\n      timeLeft--;\r\n      if (timerEl) timerEl.textContent = timeLeft.toString();\r\n      \r\n      if (timeLeft <= 0) {\r\n        clearInterval(countdown);\r\n        // Auto-decline if time runs out\r\n        this.lobbyManager.declineMatch();\r\n      }\r\n    }, 1000);\r\n\r\n    // Store timer reference for cleanup\r\n    (this.matchFoundPopup as { _countdown?: number })._countdown = countdown;\r\n  }\r\n\r\n  /**\r\n   * Hide match found popup\r\n   */\r\n  private hideMatchFoundPopup(): void {\r\n    if (!this.matchFoundPopup) return;\r\n\r\n    // Clear countdown\r\n    const countdown = (this.matchFoundPopup as { _countdown?: number })._countdown;\r\n    if (countdown) {\r\n      clearInterval(countdown);\r\n    }\r\n\r\n    this.matchFoundPopup.classList.add('hidden');\r\n  }\r\n\r\n  /**\r\n   * Show lobby UI\r\n   */\r\n  public show(): void {\r\n    this.isVisible = true;\r\n    this.container?.classList.remove('hidden');\r\n    document.body.classList.add('lobby-open');\r\n  }\r\n\r\n  /**\r\n   * Hide lobby UI\r\n   */\r\n  public hide(): void {\r\n    this.isVisible = false;\r\n    this.container?.classList.add('hidden');\r\n    document.body.classList.remove('lobby-open');\r\n  }\r\n\r\n  /**\r\n   * Toggle lobby visibility\r\n   */\r\n  public toggle(): void {\r\n    if (this.isVisible) {\r\n      this.hide();\r\n    } else {\r\n      this.show();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Check if lobby is visible\r\n   */\r\n  public isShown(): boolean {\r\n    return this.isVisible;\r\n  }\r\n\r\n  /**\r\n   * Dispose of UI\r\n   */\r\n  public dispose(): void {\r\n    this.hideMatchFoundPopup();\r\n    this.container?.remove();\r\n    this.container = null;\r\n  }\r\n}\r\n","import { EntityManager, Time, MeshGeometry, Vector3, CellSpacePartitioning } from 'yuka';\r\nimport { WebGLRenderer, Scene, PerspectiveCamera, Color, AnimationMixer, Object3D, SkeletonHelper, SRGBColorSpace, ShaderMaterial, Vector3 as ThreeVector3, Mesh, Box3, BoxGeometry, MeshBasicMaterial } from 'three';\r\nimport { HemisphereLight, DirectionalLight } from 'three';\r\nimport { AxesHelper } from 'three';\r\n\r\nimport { AssetManager } from './AssetManager';\r\nimport { SpawningManager } from './SpawningManager';\r\nimport { UIManager } from './UIManager';\r\nimport { FirstPersonControls } from '../controls/FirstPersonControls';\r\nimport { NavMeshUtils } from '../utils/NavMeshUtils';\r\nimport { SceneUtils } from '../utils/SceneUtils';\r\nimport { Level } from '../entities/Level';\r\nimport { Enemy } from '../entities/Enemy';\r\nimport { Player } from '../entities/Player';\r\nimport { Bullet } from '../weapons/Bullet';\r\nimport { PathPlanner } from '../utils/PathPlanner';\r\nimport { Sky } from '../effects/Sky';\r\nimport { CONFIG } from './Config';\r\n\r\n// RIFT Integration imports\r\nimport { RIFTIntegration } from '../rift-integration';\r\nimport { GameModeManager, GameModeType } from '../gamemodes';\r\nimport { NetworkManager } from '../network';\r\nimport { LobbyManager, LobbyUI, LobbyEventType } from '../lobby';\r\nimport { SurfaceMaterial } from '../systems/DecalSystem';\r\n\r\nconst currentIntersectionPoint = new Vector3();\r\n\r\n/**\r\n* Class for representing the game world. It's the key point where\r\n* the scene and all game entities are created and managed.\r\n*\r\n*/\r\nclass World {\r\n\r\n\t// RIFT Integration systems\r\n\tpublic rift!: RIFTIntegration;\r\n\tpublic gameModeManager!: GameModeManager;\r\n\tpublic networkManager!: NetworkManager;\r\n\tpublic lobbyManager!: LobbyManager;\r\n\tpublic lobbyUI!: LobbyUI;\r\n\r\n\t// Physics collision objects\r\n\tpublic arenaObjects: Array<{ mesh: Mesh; box: Box3 }> = [];\r\n\r\n\t// Mouse tracking for weapon system\r\n\tprivate mouseMovement: { x: number; y: number } = { x: 0, y: 0 };\r\n\tprivate headBobTime: number = 0;\r\n\r\n\t// Zoom animation state\r\n\tprivate targetFOV: number = 75;\r\n\tprivate currentFOV: number = 75;\r\n\tprivate readonly baseFOV: number = 75;\r\n\tprivate readonly zoomedFOV: number = 15;\r\n\tprivate readonly fovLerpSpeed: number = 12; // Higher = faster transition\r\n\tpublic zoomTransitionProgress: number = 0;\r\n\r\n\r\n\r\n\tpublic entityManager: EntityManager;\r\n\tpublic time: Time;\r\n\tpublic tick: number;\r\n\r\n\tpublic assetManager!: AssetManager;\r\n\tpublic navMesh: any;\r\n\tpublic costTable: any;\r\n\tpublic pathPlanner!: PathPlanner;\r\n\tpublic spawningManager: SpawningManager;\r\n\tpublic uiManager: UIManager;\r\n\r\n\tpublic renderer!: WebGLRenderer;\r\n\tpublic camera!: PerspectiveCamera;\r\n\tpublic scene!: Scene;\r\n\tpublic fpsControls!: FirstPersonControls;\r\n\tpublic useFPSControls: boolean;\r\n\r\n\tpublic player!: Player;\r\n\tpublic level!: Level;\r\n\r\n\tpublic enemyCount: number;\r\n\tpublic competitors: Array<any>;\r\n\r\n\tpublic _animate: () => void;\r\n\tpublic _onWindowResize: () => void;\r\n\r\n\tpublic debug: boolean;\r\n\r\n\tpublic helpers: {\r\n\t\tconvexRegionHelper: Object3D | null;\r\n\t\tspatialIndexHelper: Object3D | null;\r\n\t\taxesHelper: AxesHelper | null;\r\n\t\tgraphHelper: Object3D | null;\r\n\t\tpathHelpers: Array<Object3D>;\r\n\t\tspawnHelpers: Object3D | null;\r\n\t\tuuidHelpers: Array<Object3D>;\r\n\t\tskeletonHelpers: Array<SkeletonHelper>;\r\n\t\titemHelpers: Array<Object3D>;\r\n\t};\r\n\r\n\tconstructor() {\r\n\r\n\t\tthis.entityManager = new EntityManager();\r\n\t\tthis.time = new Time();\r\n\t\tthis.tick = 0;\r\n\r\n\t\tthis.spawningManager = new SpawningManager(this);\r\n\t\tthis.uiManager = new UIManager(this);\r\n\r\n\t\tthis.useFPSControls = true;\r\n\r\n\t\tthis.enemyCount = CONFIG.BOT.COUNT;\r\n\t\tthis.competitors = new Array();\r\n\r\n\t\tthis._animate = this.animate.bind(this);\r\n\t\tthis._onWindowResize = this.onWindowResize.bind(this);\r\n\r\n\t\tthis.debug = false; this.helpers = {\r\n\t\t\tconvexRegionHelper: null,\r\n\t\t\tspatialIndexHelper: null,\r\n\t\t\taxesHelper: null,\r\n\t\t\tgraphHelper: null,\r\n\t\t\tpathHelpers: new Array(),\r\n\t\t\tspawnHelpers: null,\r\n\t\t\tuuidHelpers: new Array(),\r\n\t\t\tskeletonHelpers: new Array(),\r\n\t\t\titemHelpers: new Array()\r\n\t\t};\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Entry point for the game. It initializes the asset manager and then\r\n\t* starts to build the game environment.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\tinit() {\r\n\r\n\t\tthis.assetManager = new AssetManager();\r\n\r\n\t\tthis.assetManager.init().then(() => {\r\n\r\n\t\t\tthis._initScene();\r\n\t\t\tthis._initLevel();\r\n\t\t\tthis._initEnemies();\r\n\t\t\tthis._initPlayer();\r\n\t\t\tthis._initControls();\r\n\t\t\tthis._initUI();\r\n\r\n\t\t\tthis._animate();\r\n\r\n\t\t});\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Adds the given game entity to the game world. This means it is\r\n\t* added to the entity manager and to the scene if it has a render component.\r\n\t*\r\n\t* @param {GameEntity} entity - The game entity to add.\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\tadd(entity: any): this {\r\n\r\n\t\tthis.entityManager.add(entity);\r\n\r\n\t\tif (entity._renderComponent !== null) {\r\n\r\n\t\t\tthis.scene.add(entity._renderComponent);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Removes the given game entity from the game world. This means it is\r\n\t* removed from the entity manager and from the scene if it has a render component.\r\n\t*\r\n\t* @param {GameEntity} entity - The game entity to remove.\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\tremove(entity: any): this {\r\n\r\n\t\tthis.entityManager.remove(entity);\r\n\r\n\t\tif (entity._renderComponent !== null) {\r\n\r\n\t\t\tthis.scene.remove(entity._renderComponent);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Adds a bullet to the game world. The bullet is defined by the given\r\n\t* parameters and created by the method.\r\n\t*\r\n\t* @param {GameEntity} owner - The owner of the bullet.\r\n\t* @param {Ray} ray - The ray that defines the trajectory of this bullet.\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\taddBullet(owner: any, ray: any): this {\r\n\r\n\t\tconst bulletLine = this.assetManager.models.get('bulletLine').clone();\r\n\t\tbulletLine.visible = false;\r\n\r\n\t\tconst bullet = new Bullet(owner, ray);\r\n\t\tbullet.setRenderComponent(bulletLine, sync);\r\n\r\n\t\tthis.add(bullet);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* The method checks if compatible game entities intersect with a projectile.\r\n\t* The closest hitted game entity is returned. If no intersection is detected,\r\n\t* null is returned. A possible intersection point is stored into the second parameter.\r\n\t*\r\n\t* @param {Projectile} projectile - The projectile.\r\n\t* @param {Vector3} intersectionPoint - The intersection point.\r\n\t* @return {GameEntity} The hitted game entity.\r\n\t*/\r\n\tcheckProjectileIntersection(projectile: any, intersectionPoint: any) {\r\n\r\n\t\tconst entities = this.entityManager.entities;\r\n\t\tlet minDistance = Infinity;\r\n\t\tlet hittedEntity = null;\r\n\r\n\t\tconst owner = projectile.owner;\r\n\t\tconst ray = projectile.ray;\r\n\r\n\t\tfor (let i = 0, l = entities.length; i < l; i++) {\r\n\r\n\t\t\tconst entity = entities[i] as any;\r\n\r\n\t\t\t// do not test with the owner entity and only process entities with the correct interface\r\n\r\n\t\t\tif (entity !== owner && entity.active && entity.checkProjectileIntersection) {\r\n\r\n\t\t\t\tif (entity.checkProjectileIntersection(ray, currentIntersectionPoint) !== null) {\r\n\r\n\t\t\t\t\tconst squaredDistance = currentIntersectionPoint.squaredDistanceTo(ray.origin);\r\n\r\n\t\t\t\t\tif (squaredDistance < minDistance) {\r\n\r\n\t\t\t\t\t\tminDistance = squaredDistance;\r\n\t\t\t\t\t\thittedEntity = entity;\r\n\r\n\t\t\t\t\t\tintersectionPoint.copy(currentIntersectionPoint);\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn hittedEntity;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Finds the nearest item of the given item type for the given entity.\r\n\t*\r\n\t* @param {GameEntity} entity - The entity which searches for the item.\r\n\t* @param {Number} itemType - The requested item type.\r\n\t* @param {Object} result - The result object containing the item and the distance to it.\r\n\t* @return {Object} - The result object containing the item and the distance to it.\r\n\t*/\r\n\tgetClosestItem(entity: any, itemType: any, result: any): any {\r\n\r\n\t\t// pick correct item list\r\n\r\n\t\tlet itemList = this.spawningManager.getItemList(itemType);\r\n\r\n\t\t// determine closest item\r\n\r\n\t\tlet closestItem = null;\r\n\t\tlet minDistance = Infinity;\r\n\r\n\t\tif (itemList) {\r\n\t\t\tfor (let i = 0, l = itemList.length; i < l; i++) {\r\n\r\n\t\t\t\tconst item = itemList[i];\r\n\r\n\t\t\t\t// consider only active items\r\n\r\n\t\t\t\tif (item.active) {\r\n\r\n\t\t\t\t\tconst fromRegion = entity.currentRegion;\r\n\t\t\t\t\tconst toRegion = item.currentRegion;\r\n\r\n\t\t\t\t\tconst from = this.navMesh.getNodeIndex(fromRegion);\r\n\t\t\t\t\tconst to = this.navMesh.getNodeIndex(toRegion);\r\n\r\n\t\t\t\t\t// use lookup table to find the distance between two nodes\r\n\r\n\t\t\t\t\tconst distance = this.costTable.get(from, to);\r\n\r\n\t\t\t\t\tif (distance < minDistance) {\r\n\r\n\t\t\t\t\t\tminDistance = distance;\r\n\t\t\t\t\t\tclosestItem = item;\r\n\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t}\r\n\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tresult.item = closestItem;\r\n\t\tresult.distance = minDistance;\r\n\r\n\t\treturn result;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits all basic objects of the scene like the scene graph itself, the camera, lights\r\n\t* or the renderer.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initScene() {\r\n\r\n\t\t// scene\r\n\r\n\t\tthis.scene = new Scene();\r\n\t\tthis.scene.background = new Color(0xffffff);\r\n\r\n\t\t// camera\r\n\r\n\t\tthis.camera = new PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.001, 1000);\r\n\t\tthis.camera.position.set(0, 7.5, 10);\r\n\t\tthis.camera.add(this.assetManager.listener);\r\n\t\tthis.scene.add(this.camera); // Fix: Add camera to scene so its children (weapons) are rendered\r\n\r\n\t\t// helpers\r\n\r\n\t\tif (this.debug) {\r\n\r\n\t\t\tthis.helpers.axesHelper = new AxesHelper(5);\r\n\t\t\tthis.helpers.axesHelper.visible = false;\r\n\t\t\tthis.scene.add(this.helpers.axesHelper);\r\n\r\n\t\t}\r\n\r\n\t\t// lights\r\n\r\n\t\tconst hemiLight = new HemisphereLight(0xffffff, 0x444444, 0.4);\r\n\t\themiLight.position.set(0, 100, 0);\r\n\t\tthis.scene.add(hemiLight);\r\n\r\n\t\tconst dirLight = new DirectionalLight(0xffffff, 0.8);\r\n\t\tdirLight.position.set(- 700, 1000, - 750);\r\n\t\tthis.scene.add(dirLight);\r\n\r\n\t\t// sky\r\n\r\n\t\tconst sky = new Sky();\r\n\t\tsky.scale.setScalar(1000);\r\n\r\n\t\tconst skyMaterial = sky.material as ShaderMaterial;\r\n\t\tskyMaterial.uniforms.turbidity.value = 5;\r\n\t\tskyMaterial.uniforms.rayleigh.value = 1.5;\r\n\t\tskyMaterial.uniforms.sunPosition.value.set(- 700, 1000, - 750);\r\n\r\n\t\tthis.scene.add(sky);\r\n\r\n\t\t// renderer\r\n\r\n\t\tthis.renderer = new WebGLRenderer({ antialias: true });\r\n\t\tthis.renderer.setSize(window.innerWidth, window.innerHeight);\r\n\t\tthis.renderer.autoClear = false;\r\n\t\tthis.renderer.shadowMap.enabled = true;\r\n\t\tthis.renderer.outputColorSpace = SRGBColorSpace;\r\n\t\tdocument.body.appendChild(this.renderer.domElement);\r\n\r\n\t\t// event listeners\r\n\r\n\t\twindow.addEventListener('resize', this._onWindowResize, false);\r\n\r\n\t\t// Initialize RIFT Integration systems\r\n\t\tthis._initRIFT();\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates a specific amount of enemies.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initEnemies() {\r\n\r\n\t\tconst enemyCount = this.enemyCount;\r\n\t\tconst navMesh = this.assetManager.navMesh;\r\n\r\n\t\tthis.pathPlanner = new PathPlanner(navMesh);\r\n\r\n\t\tfor (let i = 0; i < enemyCount; i++) {\r\n\r\n\t\t\tconst renderComponent = SceneUtils.cloneWithSkinning(this.assetManager.models.get('soldier'));\r\n\r\n\t\t\tconst enemy = new Enemy(this);\r\n\t\t\tenemy.name = 'Bot' + i;\r\n\t\t\tenemy.setRenderComponent(renderComponent, sync);\r\n\r\n\t\t\t// Link render component to entity for raycasting\r\n\t\t\trenderComponent.userData.entity = enemy;\r\n\t\t\t// Set userData on ALL children (not just meshes) for reliable hit detection\r\n\t\t\trenderComponent.traverse((child: any) => {\r\n\t\t\t\tchild.userData.entity = enemy;\r\n\t\t\t});\r\n\r\n\t\t\t// set animations\r\n\r\n\t\t\tconst mixer = new AnimationMixer(renderComponent);\r\n\r\n\t\t\tconst idleClip = this.assetManager.animations.get('soldier_idle');\r\n\t\t\tconst runForwardClip = this.assetManager.animations.get('soldier_forward');\r\n\t\t\tconst runBackwardClip = this.assetManager.animations.get('soldier_backward');\r\n\t\t\tconst strafeLeftClip = this.assetManager.animations.get('soldier_left');\r\n\t\t\tconst strafeRightClip = this.assetManager.animations.get('soldier_right');\r\n\t\t\tconst death1Clip = this.assetManager.animations.get('soldier_death1');\r\n\t\t\tconst death2Clip = this.assetManager.animations.get('soldier_death2');\r\n\r\n\t\t\tconst clips = [idleClip, runForwardClip, runBackwardClip, strafeLeftClip, strafeRightClip, death1Clip, death2Clip];\r\n\r\n\t\t\tenemy.setAnimations(mixer, clips);\r\n\r\n\t\t\t//\r\n\r\n\t\t\tthis.add(enemy);\r\n\t\t\tthis.competitors.push(enemy);\r\n\t\t\tthis.spawningManager.respawnCompetitor(enemy);\r\n\r\n\t\t\t//\r\n\r\n\t\t\tif (this.debug) {\r\n\r\n\t\t\t\tconst pathHelper = NavMeshUtils.createPathHelper();\r\n\t\t\t\tenemy.pathHelper = pathHelper;\r\n\r\n\t\t\t\tthis.scene.add(pathHelper);\r\n\t\t\t\tthis.helpers.pathHelpers.push(pathHelper);\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tconst uuidHelper = SceneUtils.createUUIDLabel(enemy.uuid);\r\n\t\t\t\tuuidHelper.position.y = 2;\r\n\t\t\t\tuuidHelper.visible = false;\r\n\r\n\t\t\t\trenderComponent.add(uuidHelper);\r\n\t\t\t\tthis.helpers.uuidHelpers.push(uuidHelper);\r\n\r\n\t\t\t\t//\r\n\r\n\t\t\t\tconst skeletonHelper = new SkeletonHelper(renderComponent);\r\n\t\t\t\tskeletonHelper.visible = false;\r\n\r\n\t\t\t\tthis.scene.add(skeletonHelper);\r\n\t\t\t\tthis.helpers.skeletonHelpers.push(skeletonHelper);\r\n\r\n\t\t\t}\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates the actual level.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initLevel() {\r\n\r\n\t\t// level entity\r\n\r\n\t\tconst renderComponent = this.assetManager.models.get('level');\r\n\t\tconst mesh = renderComponent.getObjectByName('level');\r\n\r\n\t\tconst vertices = mesh.geometry.attributes.position.array;\r\n\t\tconst indices = mesh.geometry.index.array;\r\n\r\n\t\tconst geometry = new MeshGeometry(vertices, indices);\r\n\t\tconst level = new Level(geometry);\r\n\t\tlevel.name = 'level';\r\n\t\tlevel.setRenderComponent(renderComponent, sync);\r\n\r\n\t\t// Set userData.entity on level for consistent entity lookup\r\n\t\trenderComponent.userData.entity = level;\r\n\t\trenderComponent.traverse((child: any) => {\r\n\t\t\tchild.userData.entity = level;\r\n\t\t});\r\n\r\n\t\tthis.level = level;\r\n\t\tthis.add(level);\r\n\r\n\t\t// Populate arenaObjects for physics collision\r\n\t\tthis.arenaObjects = [];\r\n\t\t\r\n\t\t// Ensure world matrices are updated before computing boxes\r\n\t\trenderComponent.updateMatrixWorld(true);\r\n\r\n\t\t// We no longer create Box3 for the level mesh because it's concave and causes\r\n\t\t// the player to float on top of the bounding box.\r\n\t\t// Instead, Player.ts will use the Level entity's BVH for precise collision.\r\n\t\t\r\n\t\t// Only add other objects if needed\r\n\t\t/*\r\n\t\trenderComponent.traverse((object: any) => {\r\n\t\t\tif (object.isMesh) {\r\n\t\t\t\tconst box = new Box3().setFromObject(object);\r\n\t\t\t\tthis.arenaObjects.push({ mesh: object as Mesh, box: box });\r\n\t\t\t}\r\n\t\t});\r\n\t\t*/\r\n\t\tconsole.log('Total arenaObjects:', this.arenaObjects.length);\r\n\r\n\t\t// navigation mesh\r\n\r\n\t\tthis.navMesh = this.assetManager.navMesh;\r\n\t\tthis.costTable = this.assetManager.costTable;\r\n\r\n\t\t// spatial index\r\n\r\n\t\tconst levelConfig = this.assetManager.configs.get('level');\r\n\r\n\t\tconst width = levelConfig.spatialIndex.width;\r\n\t\tconst height = levelConfig.spatialIndex.height;\r\n\t\tconst depth = levelConfig.spatialIndex.depth;\r\n\t\tconst cellsX = levelConfig.spatialIndex.cellsX;\r\n\t\tconst cellsY = levelConfig.spatialIndex.cellsY;\r\n\t\tconst cellsZ = levelConfig.spatialIndex.cellsZ;\r\n\r\n\t\tthis.navMesh.spatialIndex = new CellSpacePartitioning(width, height, depth, cellsX, cellsY, cellsZ);\r\n\t\tthis.navMesh.updateSpatialIndex();\r\n\r\n\t\tthis.helpers.spatialIndexHelper = NavMeshUtils.createCellSpaceHelper(this.navMesh.spatialIndex);\r\n\t\tthis.scene.add(this.helpers.spatialIndexHelper);\r\n\r\n\t\t// init spawning points and items\r\n\r\n\t\tthis.spawningManager.init();\r\n\r\n\t\t// debugging\r\n\r\n\t\tif (this.debug) {\r\n\r\n\t\t\tthis.helpers.convexRegionHelper = NavMeshUtils.createConvexRegionHelper(this.navMesh);\r\n\t\t\tthis.scene.add(this.helpers.convexRegionHelper);\r\n\r\n\t\t\t//\r\n\r\n\t\t\tthis.helpers.graphHelper = NavMeshUtils.createGraphHelper(this.navMesh.graph, 0.2);\r\n\t\t\tthis.scene.add(this.helpers.graphHelper);\r\n\r\n\t\t\t//\r\n\r\n\t\t\tthis.helpers.spawnHelpers = SceneUtils.createSpawnPointHelper(this.spawningManager.spawningPoints);\r\n\t\t\tthis.scene.add(this.helpers.spawnHelpers);\r\n\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Creates the player instance.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initPlayer() {\r\n\r\n\t\tconst assetManager = this.assetManager;\r\n\r\n\t\tconst player = new Player(this);\r\n\r\n\t\t// render component\r\n\r\n\t\tconst body = new Object3D(); // dummy 3D object for adding spatial audios\r\n\t\tbody.matrixAutoUpdate = false;\r\n\t\t\r\n\t\t// Add invisible collision mesh for raycast hit detection by enemies\r\n\t\t// Player is 1.8m tall, 0.5m radius (diameter 1m)\r\n\t\tconst collisionGeometry = new BoxGeometry(0.5, 1.8, 0.5);\r\n\t\tconst collisionMaterial = new MeshBasicMaterial({ visible: false });\r\n\t\tconst collisionMesh = new Mesh(collisionGeometry, collisionMaterial);\r\n\t\tcollisionMesh.position.y = 0.9; // Center at half player height\r\n\t\tcollisionMesh.name = 'playerCollision';\r\n\t\tcollisionMesh.userData.entity = player; // Link to player entity for damage\r\n\t\tbody.add(collisionMesh);\r\n\t\t\r\n\t\tplayer.setRenderComponent(body, sync);\r\n\r\n\t\t// audio\r\n\r\n\t\tconst step1 = assetManager.cloneAudio(assetManager.audios.get('step1')!);\r\n\t\tconst step2 = assetManager.cloneAudio(assetManager.audios.get('step2')!);\r\n\r\n\t\t// the following audios are unique and will be used only for the player (no cloning needed)\r\n\r\n\t\tconst impact1 = assetManager.audios.get('impact1')!;\r\n\t\tconst impact2 = assetManager.audios.get('impact2')!;\r\n\t\tconst impact3 = assetManager.audios.get('impact3')!;\r\n\t\tconst impact4 = assetManager.audios.get('impact4')!;\r\n\t\tconst impact5 = assetManager.audios.get('impact5')!;\r\n\t\tconst impact6 = assetManager.audios.get('impact6')!;\r\n\t\tconst impact7 = assetManager.audios.get('impact7')!;\r\n\r\n\t\tstep1.setVolume(0.5);\r\n\t\tstep2.setVolume(0.5);\r\n\r\n\t\tbody.add(step1, step2);\r\n\t\tbody.add(impact1, impact2, impact3, impact4, impact5, impact6, impact7);\r\n\r\n\t\tplayer.audios.set('step1', step1);\r\n\t\tplayer.audios.set('step2', step2);\r\n\t\tplayer.audios.set('impact1', impact1);\r\n\t\tplayer.audios.set('impact2', impact2);\r\n\t\tplayer.audios.set('impact3', impact3);\r\n\t\tplayer.audios.set('impact4', impact4);\r\n\t\tplayer.audios.set('impact5', impact5);\r\n\t\tplayer.audios.set('impact6', impact6);\r\n\t\tplayer.audios.set('impact7', impact7);\r\n\r\n\t\t// animation\r\n\r\n\t\tconst mixer = new AnimationMixer(player.head as any);\r\n\r\n\t\tconst deathClip = this.assetManager.animations.get('player_death');\r\n\r\n\t\tconst clips = [deathClip];\r\n\r\n\t\tplayer.setAnimations(mixer, clips);\r\n\r\n\t\t// add the player to the world\r\n\r\n\t\tthis.add(player);\r\n\t\tthis.competitors.push(player);\r\n\t\tthis.spawningManager.respawnCompetitor(player);\r\n\r\n\t\t// in dev mode we start with orbit controls\r\n\r\n\t\tif (this.debug) {\r\n\r\n\t\t\tplayer.deactivate();\r\n\r\n\t\t}\r\n\r\n\t\t//\r\n\r\n\t\tthis.player = player;\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Inits the controls used by the player.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initControls() {\r\n\r\n\t\tthis.fpsControls = new FirstPersonControls(this.player);\r\n\t\tthis.fpsControls.sync();\r\n\r\n\t\t// Attach camera immediately so we see the world even before locking\r\n\t\tthis.camera.matrixAutoUpdate = false;\r\n\t\tthis.player.activate();\r\n\t\tthis.player.head.setRenderComponent(this.camera, syncCamera);\r\n\r\n\t\t// Show RIFT HUD immediately\r\n\t\tif (this.rift) {\r\n\t\t\tthis.rift.hudManager.show();\r\n\t\t\tconsole.log('RIFT HUD shown');\r\n\t\t}\r\n\r\n\t\tthis.fpsControls.addEventListener('lock', () => {\r\n\r\n\t\t\t// Hide old Drift UI\r\n\t\t\tconst oldAmmo = document.getElementById('hudAmmo');\r\n\t\t\tconst oldHealth = document.getElementById('hudHealth');\r\n\t\t\tconst oldFragList = document.getElementById('hudFragList');\r\n\t\t\tif (oldAmmo) oldAmmo.style.display = 'none';\r\n\t\t\tif (oldHealth) oldHealth.style.display = 'none';\r\n\t\t\tif (oldFragList) oldFragList.style.display = 'none';\r\n\r\n\t\t});\r\n\r\n\t\tthis.fpsControls.addEventListener('unlock', () => {\r\n\r\n\t\t\t// Optional: Detach camera on unlock? \r\n\t\t\t// For now, let's keep it attached so the view doesn't jump to the sky\r\n\t\t\t// this.camera.matrixAutoUpdate = true;\r\n\t\t\t// this.player.deactivate();\r\n\t\t\t// (this.player.head as any).setRenderComponent(null, null);\r\n\r\n\t\t\tthis.uiManager.hideFPSInterface();\r\n\r\n\t\t\t// Hide RIFT HUD\r\n\t\t\t// if (this.rift) {\r\n\t\t\t// \tthis.rift.hudManager.hide();\r\n\t\t\t// }\r\n\r\n\t\t});\r\n\r\n\t\t// Connect controls (adds listeners)\r\n\t\tthis.fpsControls.connect();\r\n\r\n\t\treturn this;\r\n\r\n\t}\t/**\r\n\t* Inits the user interface.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initUI() {\r\n\r\n\t\tthis.uiManager.init();\r\n\r\n\t\t// Show RIFT HUD\r\n\t\tif (this.rift) {\r\n\t\t\tthis.rift.hudManager.show();\r\n\t\t}\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Initializes the RIFT integration systems.\r\n\t* This includes weapon effects, HUD, audio, game modes, network, and lobby.\r\n\t*\r\n\t* @return {World} A reference to this world object.\r\n\t*/\r\n\t_initRIFT() {\r\n\r\n\t\t// Initialize main RIFT integration (particles, weapons, decals, tracers, HUD, audio)\r\n\t\tthis.rift = new RIFTIntegration(this.scene, this.camera, this.assetManager.listener, this.assetManager);\r\n\r\n\t\t// Initialize Game Mode Manager\r\n\t\tthis.gameModeManager = new GameModeManager(this, this.rift.hudManager);\r\n\r\n\t\t// Initialize Network Manager for multiplayer\r\n\t\tthis.networkManager = new NetworkManager(this.scene);\r\n\r\n\t\t// Initialize Lobby Manager\r\n\t\tthis.lobbyManager = new LobbyManager();\r\n\t\tthis.lobbyUI = new LobbyUI(this.lobbyManager);\r\n\r\n\t\t// Setup lobby event handlers\r\n\t\tthis._setupLobbyEvents();\r\n\r\n\t\t// Setup shell ejection callback for weapon system\r\n\t\tthis.rift.weaponSystem.setShellEjectCallback((pos, dir) => {\r\n\t\t\t// Ground level is the player's Y position (player.position is at feet level)\r\n\t\t\t// The player entity position represents the feet, head is offset by player.height\r\n\t\t\tconst groundLevel = this.player.position.y;\r\n\t\t\tthis.rift.particleSystem.spawnShellCasing(pos, dir, groundLevel);\r\n\t\t});\r\n\r\n\t\t// Setup shell bounce sound callback\r\n\t\tthis.rift.particleSystem.setShellBounceCallback((position, bounceNumber) => {\r\n\t\t\t// Play shell drop sound with decreasing volume for each bounce\r\n\t\t\t// First bounce is loudest, subsequent bounces are quieter\r\n\t\t\tconst volumeScale = Math.max(0.3, 1.0 - (bounceNumber - 1) * 0.25);\r\n\t\t\t\r\n\t\t\t// Only play sound for first 4 bounces to avoid audio spam\r\n\t\t\tif (bounceNumber <= 4) {\r\n\t\t\t\tthis.rift.impactSystem.playShellDrop(position, volumeScale);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Setup zoom callback for sniper scope overlay\r\n\t\tthis.rift.weaponSystem.setZoomCallback((isZoomed) => {\r\n\t\t\t// Set target FOV for smooth interpolation\r\n\t\t\tthis.targetFOV = isZoomed ? this.zoomedFOV : this.baseFOV;\r\n\t\t\t\r\n\t\t\t// Toggle HUD sniper scope overlay (CSS handles fade animation)\r\n\t\t\tthis.rift.hudManager.toggleScope(isZoomed);\r\n\t\t});\r\n\r\n\t\t// Equip default weapon (AK47)\r\n\t\tthis.rift.weaponSystem.switchWeapon(0);\r\n\r\n\t\tconsole.log('RIFT Integration initialized successfully');\r\n\r\n\t\t// Remove any old Drift weapon meshes from the scene\r\n\t\tconst oldWeaponNames = ['blaster_high', 'shotgun_high', 'assaultRifle_high'];\r\n\t\tconst meshesToRemove: any[] = [];\r\n\r\n\t\tthis.scene.traverse((object: any) => {\r\n\t\t\tif (object.isMesh && oldWeaponNames.some(name => object.name?.includes(name))) {\r\n\t\t\t\tmeshesToRemove.push(object);\r\n\t\t\t}\r\n\t\t\t// Also check parent objects that might be the weapon groups\r\n\t\t\tif (object.isGroup && object.children.length > 0) {\r\n\t\t\t\tconst hasWeaponMesh = object.children.some((child: any) =>\r\n\t\t\t\t\tchild.isMesh && oldWeaponNames.some(name => child.name?.includes(name))\r\n\t\t\t\t);\r\n\t\t\t\tif (hasWeaponMesh) {\r\n\t\t\t\t\tmeshesToRemove.push(object);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tmeshesToRemove.forEach(mesh => {\r\n\t\t\tthis.scene.remove(mesh);\r\n\t\t\tconsole.log('Removed old Drift weapon from scene:', mesh.name || mesh.type);\r\n\t\t});\r\n\r\n\t\tconsole.log(`Removed ${meshesToRemove.length} old weapon meshes from scene`);\r\n\r\n\t\treturn this;\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Sets up event handlers for the lobby system.\r\n\t*/\r\n\tprivate _setupLobbyEvents(): void {\r\n\t\t// Handle match found\r\n\t\tthis.lobbyManager.on(LobbyEventType.MATCH_FOUND, (data) => {\r\n\t\t\tconsole.log('Match found!', data);\r\n\t\t});\r\n\r\n\t\t// Handle match starting\r\n\t\tthis.lobbyManager.on(LobbyEventType.MATCH_STARTING, async (data: unknown) => {\r\n\t\t\tconst matchData = data as { serverUrl: string; token: string; matchId: string; modeId: string };\r\n\r\n\t\t\t// Connect to game server\r\n\t\t\tconst connected = await this.networkManager.connect(\r\n\t\t\t\tmatchData.serverUrl,\r\n\t\t\t\tmatchData.token,\r\n\t\t\t\tmatchData.matchId\r\n\t\t\t);\r\n\r\n\t\t\tif (connected) {\r\n\t\t\t\tthis.lobbyUI.hide();\r\n\t\t\t\tthis._startMultiplayerGame(matchData.modeId);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Handle queue updates\r\n\t\tthis.lobbyManager.on(LobbyEventType.QUEUE_UPDATE, (status) => {\r\n\t\t\tconsole.log('Queue update:', status);\r\n\t\t});\r\n\t}\r\n\r\n\t/**\r\n\t* Starts a multiplayer game with the specified mode.\r\n\t*/\r\n\tprivate _startMultiplayerGame(modeId: string): void {\r\n\t\tconst modeMap: { [key: string]: GameModeType } = {\r\n\t\t\t'ffa': GameModeType.FREE_FOR_ALL,\r\n\t\t\t'tdm': GameModeType.TEAM_DEATHMATCH,\r\n\t\t\t'wave': GameModeType.WAVE_SURVIVAL\r\n\t\t};\r\n\r\n\t\tconst gameMode = modeMap[modeId] || GameModeType.FREE_FOR_ALL;\r\n\t\tthis.gameModeManager.setMode(gameMode);\r\n\t}\r\n\r\n\t/**\r\n\t* Handles RIFT weapon shooting with visual effects.\r\n\t* Call this when player shoots to create tracers, impacts, and decals.\r\n\t*/\r\n\tpublic handleRiftShot(hitPoint: Vector3 | null, hitNormal: Vector3 | null, hitEntity: any): void {\r\n\t\tconst muzzlePos = this.rift.weaponSystem.getMuzzleWorldPosition();\r\n\r\n\t\tif (hitPoint) {\r\n\t\t\t// Convert Yuka Vector3 to Three.js Vector3\r\n\t\t\tconst threeHitPoint = new ThreeVector3(hitPoint.x, hitPoint.y, hitPoint.z);\r\n\t\t\tthis.rift.tracerSystem.createTracer(muzzlePos, threeHitPoint);\r\n\r\n\t\t\t// Create impact effects\r\n\t\t\tif (hitNormal) {\r\n\t\t\t\tconst threeNormal = new ThreeVector3(hitNormal.x, hitNormal.y, hitNormal.z);\r\n\r\n\t\t\t\tif (hitEntity instanceof Enemy) {\r\n\t\t\t\t\t// Enemy hit - blood particles\r\n\t\t\t\t\tthis.rift.particleSystem.spawnImpactEffect(threeHitPoint, false);\r\n\t\t\t\t\tthis.rift.hudManager.showHitmarker(hitEntity.health <= 0);\r\n\t\t\t\t} else {\r\n\t\t\t\t\t// Environment hit - bullet hole and sparks\r\n\t\t\t\t\tthis.rift.decalSystem.createDecal(threeHitPoint, threeNormal, SurfaceMaterial.ROCK);\r\n\t\t\t\t\tthis.rift.particleSystem.spawnMaterialImpact(threeHitPoint, threeNormal, SurfaceMaterial.ROCK);\r\n\t\t\t\t\tthis.rift.impactSystem.playSurfaceImpact(threeHitPoint, SurfaceMaterial.ROCK);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tpublic onWindowResize() {\r\n\r\n\t\tconst width = window.innerWidth;\r\n\t\tconst height = window.innerHeight;\r\n\r\n\t\tthis.camera.aspect = width / height;\r\n\t\tthis.camera.updateProjectionMatrix();\r\n\r\n\t\tthis.renderer.setSize(width, height);\r\n\t\tthis.uiManager.setSize(width, height);\r\n\r\n\t}\r\n\r\n\tpublic animate() {\r\n\r\n\t\trequestAnimationFrame(this._animate);\r\n\r\n\t\tthis.time.update();\r\n\r\n\t\tthis.tick++;\r\n\r\n\t\tconst delta = this.time.getDelta();\r\n\r\n\t\tif (this.debug) {\r\n\r\n\t\t\tif (this.useFPSControls) {\r\n\r\n\t\t\t\tthis.fpsControls.update(delta);\r\n\r\n\t\t\t}\r\n\r\n\t\t} else {\r\n\r\n\t\t\tthis.fpsControls.update(delta);\r\n\r\n\t\t}\r\n\r\n\t\tthis.spawningManager.update(delta);\r\n\r\n\t\tthis.entityManager.update(delta);\r\n\r\n\t\t// Sync render components (visuals) with entity logic\r\n\t\t// This is crucial for Player.head -> Camera sync\r\n\t\tfor (const entity of this.entityManager.entities) {\r\n\t\t\tthis._syncRenderComponent(entity);\r\n\t\t}\r\n\r\n\t\tthis.pathPlanner.update();\r\n\r\n\t\t// Update RIFT systems\r\n\t\tthis._updateRIFT(delta);\r\n\r\n\t\tthis.renderer.clear();\r\n\r\n\t\tthis.renderer.render(this.scene, this.camera);\r\n\r\n\t\tthis.uiManager.update(delta);\r\n\r\n\t}\r\n\r\n\t/**\r\n\t* Updates all RIFT integration systems.\r\n\t*\r\n\t* @param {Number} delta - The time delta.\r\n\t*/\r\n\tprivate _updateRIFT(delta: number): void {\r\n\t\tif (!this.rift) return;\r\n\r\n\t\t// Smooth FOV interpolation for zoom animation\r\n\t\tif (Math.abs(this.currentFOV - this.targetFOV) > 0.01) {\r\n\t\t\tthis.currentFOV += (this.targetFOV - this.currentFOV) * Math.min(1, delta * this.fovLerpSpeed);\r\n\t\t\tthis.camera.fov = this.currentFOV;\r\n\t\t\tthis.camera.updateProjectionMatrix();\r\n\t\t\t\r\n\t\t\t// Track zoom progress for other effects (0 = unzoomed, 1 = zoomed)\r\n\t\t\tthis.zoomTransitionProgress = 1 - (this.currentFOV - this.zoomedFOV) / (this.baseFOV - this.zoomedFOV);\r\n\t\t}\r\n\r\n\t\t// Track head bob time for weapon animation\r\n\t\tconst speed = this.player?.velocity ?\r\n\t\t\tMath.sqrt(this.player.velocity.x ** 2 + this.player.velocity.z ** 2) : 0;\r\n\t\t\r\n\t\tif (speed > 0.1) {\r\n\t\t\t// Walking/running bob\r\n\t\t\tthis.headBobTime += delta * speed * 2.0;\r\n\t\t} else {\r\n\t\t\t// Idle breathing\r\n\t\t\tthis.headBobTime += delta * 2.0;\r\n\t\t}\r\n\r\n\t\t// Use actual sprint input from controls\r\n\t\tconst isSprinting = this.fpsControls?.input?.sprint ?? false;\r\n\r\n\t\t// Update all RIFT visual systems (particles, decals, tracers, weapon system)\r\n\t\tthis.rift.particleSystem.update(delta);\r\n\t\tthis.rift.decalSystem.update(delta);\r\n\t\tthis.rift.tracerSystem.update(delta);\r\n\t\tthis.rift.weaponSystem.update(delta, this.mouseMovement, isSprinting, this.headBobTime);\r\n\t\tthis.rift.screenEffects.update(delta);\r\n\t\tthis.rift.hudManager.updateKillfeed(delta);\r\n\r\n\t\t// Apply camera recoil to player's head rotation\r\n\t\tconst recoil = this.rift.getCameraRecoil();\r\n\t\tif (this.fpsControls && (Math.abs(recoil.pitch) > 0.0001 || Math.abs(recoil.yaw) > 0.0001)) {\r\n\t\t\t// Apply recoil to the controls' movement values\r\n\t\t\tthis.fpsControls.movementY -= recoil.pitch * delta * 0.5;\r\n\t\t\tthis.fpsControls.movementX -= recoil.yaw * delta * 0.5;\r\n\t\t\t\r\n\t\t\t// Clamp pitch\r\n\t\t\tconst PI05 = Math.PI / 2;\r\n\t\t\tthis.fpsControls.movementY = Math.max(-PI05, Math.min(PI05, this.fpsControls.movementY));\r\n\t\t}\r\n\r\n\t\t// Apply screen shake offset to camera\r\n\t\tconst shakeOffset = this.rift.getShakeOffset();\r\n\t\tif (shakeOffset.length() > 0.0001) {\r\n\t\t\t// Apply shake relative to camera orientation\r\n\t\t\tconst shakeWorld = shakeOffset.clone();\r\n\t\t\tshakeWorld.applyQuaternion(this.camera.quaternion);\r\n\t\t\tthis.camera.position.add(shakeWorld);\r\n\t\t}\r\n\r\n\t\t// Update HUD with player state\r\n\t\tif (this.player) {\r\n\t\t\t// Update health\r\n\t\t\tthis.rift.hudManager.updateHealth(this.player.health, this.player.maxHealth);\r\n\t\t}\r\n\r\n\t\t// Update weapon HUD from RIFT weapon system\r\n\t\tconst config = this.rift.weaponSystem.currentConfig;\r\n\t\tthis.rift.hudManager.updateWeaponName(config.name);\r\n\t\tthis.rift.hudManager.updateAmmo(this.rift.weaponSystem.currentMag, this.rift.weaponSystem.reserveAmmo);\r\n\t\tthis.rift.hudManager.showReloading(this.rift.weaponSystem.isReloading);\r\n\t\tthis.rift.hudManager.updateCrosshair(this.rift.weaponSystem.getCurrentSpread());\r\n\r\n\t\t// Update game mode\r\n\t\tif (this.gameModeManager) {\r\n\t\t\tthis.gameModeManager.update(delta);\r\n\t\t}\r\n\r\n\t\t// Update network (multiplayer sync)\r\n\t\tif (this.networkManager && this.player) {\r\n\t\t\tthis.networkManager.update(delta, this.player as any, this.camera);\r\n\t\t}\r\n\r\n\t\t// Reset mouse movement for next frame\r\n\t\tthis.mouseMovement.x = 0;\r\n\t\tthis.mouseMovement.y = 0;\r\n\t}\r\n\r\n\t/**\r\n\t* Called from FirstPersonControls when mouse moves.\r\n\t* Updates the mouse movement tracking for weapon system.\r\n\t*/\r\n\tpublic onMouseMove(movementX: number, movementY: number): void {\r\n\t\tthis.mouseMovement.x = movementX;\r\n\t\tthis.mouseMovement.y = movementY;\r\n\t}\r\n\r\n\t/**\r\n\t * Recursively syncs the render component of an entity and its children.\r\n\t * \r\n\t * @param {GameEntity} entity - The entity to sync.\r\n\t */\r\n\tprivate _syncRenderComponent(entity: any): void {\r\n\t\tif (entity.renderComponent) {\r\n\t\t\t// If a custom callback is defined (like for Camera), use it\r\n\t\t\tif (entity._renderComponentCallback) {\r\n\t\t\t\tentity._renderComponentCallback(entity, entity.renderComponent);\r\n\t\t\t} else {\r\n\t\t\t\t// Default sync: copy world matrix\r\n\t\t\t\tentity.renderComponent.matrix.copy(entity.worldMatrix);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Recursively sync children (e.g. Player -> Head -> Camera)\r\n\t\tif (entity.children) {\r\n\t\t\tfor (const child of entity.children) {\r\n\t\t\t\tthis._syncRenderComponent(child);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\nfunction sync(entity: any, renderComponent: any) {\r\n\r\n\trenderComponent.matrix.copy(entity.worldMatrix);\r\n\r\n}\r\n\r\nfunction syncCamera(entity: any, camera: any) {\r\n\t// Copy the entity's world matrix to camera's matrixWorld and decompose to update position/rotation\r\n\tcamera.matrixWorld.copy(entity.worldMatrix);\r\n\t\r\n\t// Decompose the world matrix to update camera's position and quaternion\r\n\tcamera.matrixWorld.decompose(camera.position, camera.quaternion, camera.scale);\r\n\t\r\n\t// Update the local matrix as well\r\n\tcamera.matrix.copy(entity.worldMatrix);\r\n}\r\n\r\nexport default new World();\r\n","\r\nimport world from './core/World';\r\n\r\n// Expose world for debugging\r\n(window as any).world = world;\r\n\r\nconst startButton = document.getElementById('start');\r\nif (startButton) {\r\n\tstartButton.addEventListener('click', () => {\r\n\r\n\t\tconst startScreen = document.getElementById('startScreen');\r\n\t\tif (startScreen) startScreen.remove();\r\n\r\n\t\tworld.init();\r\n\r\n\t});\r\n}\r\n"],"file":"assets/index-Dfs48HFN.js"}